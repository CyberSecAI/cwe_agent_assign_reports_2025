# Raw Retriever Results for CVE-2025-21986

# Raw Retriever Results for CVE-2025-21986
## Query
In the Linux kernel, the following vulnerability has been resolved net switchdev Convert blocking notification chain to a raw one A blocking notification chain uses a read-write semaphore to protect the integrity of the chain. The semaphore is acquired for writing when adding / removing notifiers to / from the chain and acquired for reading when traversing the chain and informing notifiers about an event. In case of the blocking switchdev notification chain, recursive notifications are possible which leads to the semaphore being acquired twice for reading and to lockdep warnings being generated [1]. Specifically, this can happen when the bridge driver processes a SWITCHDEV_BRPORT_UNOFFLOADED event which causes it to emit notifications about deferred events when calling switchdev_deferred_process(). Fix this by converting the notification chain to a raw notification chain in a similar fashion to the netdev notification chain. Protect the chain using the RTNL mutex by acquiring it when modifying the chain. Events are always informed under the RTNL mutex, but add an assertion in call_switchdev_blocking_notifiers() to make sure this is not violated in the future. Maintain the blocking prefix as events are always emitted from process context and listeners are allowed to block. [1] WARNING possible recursive locking detected 6.14.0-rc4-custom-g079270089484 #1 Not tainted -------------------------------------------- ip/52731 is trying to acquire lock ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{44}, at blocking_notifier_call_chain+0x58/0xa0 but task is already holding lock ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{44}, at blocking_notifier_call_chain+0x58/0xa0 other info that might help us debug this Possible unsafe locking scenario CPU0 ---- lock((switchdev_blocking_notif_chain).rwsem) lock((switchdev_blocking_notif_chain).rwsem) *** DEADLOCK *** May be due to missing lock nesting notation 3 locks held by ip/52731 #0 ffffffff84f795b0 (rtnl_mutex){+.+.}-{44}, at rtnl_newlink+0x727/0x1dc0 #1 ffffffff8731f628 (&net->rtnl_mutex){+.+.}-{44}, at rtnl_newlink+0x790/0x1dc0 #2 ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{44}, at blocking_notifier_call_chain+0x58/0xa0 stack backtrace ... ? __pfx_down_read+0x10/0x10 ? __pfx_mark_lock+0x10/0x10 ? __pfx_switchdev_port_attr_set_deferred+0x10/0x10 blocking_notifier_call_chain+0x58/0xa0 switchdev_port_attr_notify.constprop.0+0xb3/0x1b0 ? __pfx_switchdev_port_attr_notify.constprop.0+0x10/0x10 ? mark_held_locks+0x94/0xe0 ? switchdev_deferred_process+0x11a/0x340 switchdev_port_attr_set_deferred+0x27/0xd0 switchdev_deferred_process+0x164/0x340 br_switchdev_port_unoffload+0xc8/0x100 [bridge] br_switchdev_blocking_event+0x29f/0x580 [bridge] notifier_call_chain+0xa2/0x440 blocking_notifier_call_chain+0x6e/0xa0 switchdev_bridge_port_unoffload+0xde/0x1a0 ...

## Keyphrases
- **weakness**: 'recursive locking'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4803 | 0.5548 | 0.5066 | 0.5018 | 20 |
| Sparse | 371.9736 | 1261.5465 | 1032.4637 | 1073.1099 | 11 |
| Graph | 1.4784 | 2.2100 | 1.7948 | 1.6848 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 226 | Sensitive Information in Resource Not Removed Before Reuse | base | 2.2100 | Allowed |
| 2 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | base | 2.2100 | Allowed |
| 3 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 4 | 1322 | Use of Blocking Code in Single-threaded, Non-blocking Context | base | 2.2100 | Allowed |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | base | 2.1190 | Allowed |
| 6 | 416 | Use After Free | variant | 2.0400 | Allowed |
| 7 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 8 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 9 | 833 | Deadlock | Base | 1.7165 | Allowed |
| 10 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 11 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 12 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 13 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 14 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 1.6616 | Allowed |
| 15 | 61 | UNIX Symbolic Link (Symlink) Following | compound | 1.6100 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 667 | Improper Locking | Class | 0.5548 | 0.5548 | Allowed-with-Review |
| 2 | 833 | Deadlock | Base | 0.5507 | 0.5507 | Allowed |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5276 | 0.5276 | Allowed-with-Review |
| 4 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5259 | 0.5259 | Allowed |
| 5 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.5254 | 0.5254 | Allowed |
| 6 | 413 | Improper Resource Locking | Base | 0.5207 | 0.5207 | Allowed |
| 7 | 911 | Improper Update of Reference Count | Base | 0.5167 | 0.5167 | Allowed |
| 8 | 606 | Unchecked Input for Loop Condition | Base | 0.5155 | 0.5155 | Allowed |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5154 | 0.5154 | Allowed |
| 10 | 476 | NULL Pointer Dereference | Base | 0.5096 | 0.5096 | Allowed |
| 11 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.4941 | 0.4941 | Allowed |
| 12 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.4935 | 0.4935 | Discouraged |
| 13 | 909 | Missing Initialization of Resource | Class | 0.4920 | 0.4920 | Allowed-with-Review |
| 14 | 121 | Stack-based Buffer Overflow | Variant | 0.4918 | 0.4918 | Allowed |
| 15 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.4855 | 0.4855 | Allowed |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 667 | Improper Locking | 1261.5465 | 1261.5465 | Allowed-with-Review |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1143.3501 | 1143.3501 | Allowed-with-Review |
| 3 | 833 | Deadlock | 1122.5253 | 1122.5253 | Allowed |
| 4 | 201 | Insertion of Sensitive Information Into Sent Data | 1099.8561 | 1099.8561 | Allowed |
| 5 | 674 | Uncontrolled Recursion | 1096.5867 | 1096.5867 | Allowed-with-Review |
| 6 | 863 | Incorrect Authorization | 1073.1099 | 1073.1099 | Allowed-with-Review |
| 7 | 911 | Improper Update of Reference Count | 1055.0999 | 1055.0999 | Allowed |
| 8 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | 1045.3229 | 1045.3229 | Allowed |
| 9 | 787 | Out-of-bounds Write | 1044.3815 | 1044.3815 | Allowed |
| 10 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | 1043.3481 | 1043.3481 | Allowed |
| 11 | 287 | Improper Authentication | 371.9736 | 371.9736 | Discouraged |
