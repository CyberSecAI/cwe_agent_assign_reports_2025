## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved KEYS trusted dcp fix leak of blob encryption key **Trusted keys unseal the key blob on load**, but keep the sealed payload in the blob field so that every subsequent read (export) will simply convert this field to hex and send it to userspace. With DCP-based trusted keys, we decrypt the blob encryption key (BEK) in the Kernel due hardware limitations and then decrypt the blob payload. BEK decryption is done in-place which means that the trusted key blob field is modified and it consequently holds the BEK in plain text. Every subsequent read of that key thus send the plain text BEK instead of the encrypted BEK to userspace. This issue only occurs when importing a trusted DCP-based key and then exporting it again. This should rarely happen as the common use cases are to either create a new trusted key and export it, or import a key blob and then just use it without exporting it again. Fix this by performing BEK decryption and encryption in a dedicated buffer. Further always wipe the plain text BEK buffer to prevent leaking the key via **uninitialized memory**.

### Vulnerability Description Key Phrases
- **rootcause:** **uninitialized memory**
- **weakness:** **Trusted keys unseal the key blob on load**
- **impact:** leak of blob encryption key
- **product:** Linux kernel

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
The vulnerability stems from the in-place decryption of the Blob Encryption Key (BEK) within the trusted key blob when using DCP-based trusted keys. After the BEK is decrypted, it remains in plaintext within the blob field. Subsequent reads (exports) of the key would then send the plaintext BEK to userspace instead of the encrypted version.

**Weaknesses/Vulnerabilities:**
- **Plaintext Key Exposure:** The primary vulnerability is the exposure of the plaintext BEK after decryption in the kernel's memory. This decrypted key is then sent to userspace during export operations.
- **In-place decryption:** The BEK is decrypted directly into the blob field, overwriting the encrypted data.

**Impact of Exploitation:**
- **Key Leakage:** An attacker could potentially obtain the plaintext BEK by exporting the key after it has been imported. This compromised key could then be used to decrypt other sensitive data.

**Attack Vectors:**
- **Import and Export:** The vulnerability is triggered by importing a trusted DCP-based key and then exporting it. This would leak the decrypted BEK.

**Required Attacker Capabilities/Position:**
- **Ability to Import and Export Keys:** The attacker needs to be able to import a trusted DCP-based key into the kernel's keyring and then export it. This typically implies having some level of privilege on the system to interact with the kernel keyring.

**Additional Details:**
- The vulnerability is specific to NXP DCP-backed trusted keys.
- The issue is present in Linux kernel versions v6.10 and later.
- The fix involves performing BEK decryption and encryption in a dedicated buffer, and clearing the plaintext BEK buffer to prevent leaks.
- The issue occurs when exporting the trusted key after it has been imported and unsealed
- Common use cases are either to create a new trusted key and export it or import a key blob and use it without exporting it, which means this issue is less likely to occur in common use cases

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 1.002 |
| 2 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 1.000 |
| 3 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.995 |
| 4 | 335 | Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG) | Base | Allowed | sparse | 0.980 |
| 5 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.976 |
| 6 | 321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | sparse | 0.975 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.966 |
| 8 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.945 |
| 9 | 1394 | Use of Default Cryptographic Key | Base | Allowed | dense | 0.503 |
| 10 | 208 | Observable Timing Discrepancy | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-327: Use of a Broken or Risky Cryptographic Algorithm

CWE-295: Improper Certificate Validation

CWE-203: Observable Discrepancy

CWE-335: Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG)

CWE-522: Insufficiently Protected Credentials

CWE-321: Use of Hard-coded Cryptographic Key

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-532: Insertion of Sensitive Information into Log File

CWE-1394: Use of Default Cryptographic Key

CWE-208: Observable Timing Discrepancy