## Vulnerability Description
mudler/LocalAI version 2.17.1 allows for arbitrary file write due to **improper handling of automatic archive extraction**. When model configurations specify additional files as archives (e.g., .tar), these archives are automatically extracted after downloading. This behavior can be exploited to perform a tarslip attack, allowing files to be written to arbitrary locations on the server, bypassing checks that normally restrict files to the models directory. This vulnerability can lead to remote code execution (RCE) by overwriting backend assets used by the server.

### Vulnerability Description Key Phrases
- **rootcause:** **improper handling of automatic archive extraction**
- **impact:** arbitrary file write and remote code execution
- **vector:** tarslip attack
- **product:** mudler/LocalAI
- **version:** version 2.17.1

## CVE Reference Links Content Summary
The provided content is related to a commit in the `LocalAI` repository on GitHub. The commit `a181dd0ebc5d3092fc50f61674d552604fe8ef9c` introduces a refactor of the gallery feature and a fix to prevent symlink creation during unarchiving.

**Root cause of vulnerability:**
The fix addresses a vulnerability related to symlink creation during the unarchiving process.

**Weaknesses/vulnerabilities present:**
- The vulnerability lies in the `pkg/utils/untar.go` file which previously allowed symlinks to be created during the unarchiving process. This could lead to path traversal vulnerabilities or other issues if malicious archives are processed.

**Impact of exploitation:**
- If not addressed, a malicious actor could craft a specially crafted archive containing symlinks to arbitrary locations in the filesystem that could overwrite or modify files outside the intended target directory.

**Attack vectors:**
- The attack vector is by providing a malicious archive during the unarchive process.

**Required attacker capabilities/position:**
- An attacker would need to be able to upload or provide the malicious archive to the application. This could be through an exposed API or other vulnerability.

The commit includes a fix which prevents symlink creation, which resolves the vulnerability.

**Additional changes in the commit:**
- Refactoring the gallery feature to move its related files under the `core/` directory.
- Changes to config, CLI, HTTP endpoints and service files to reflect the move of gallery related components
- Modifications in the import statements of multiple files.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.546 |
| 2 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.499 |
| 3 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.486 |
| 4 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.447 |
| 5 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.435 |
| 6 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.410 |
| 7 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.402 |
| 8 | 754 | Improper Check for Unusual or Exceptional Conditions | Class | Allowed-with-Review | sparse | 0.398 |
| 9 | 24 | Path Traversal: '../filedir' | Variant | Allowed | dense | 0.534 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-23: Relative Path Traversal

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-61: UNIX Symbolic Link (Symlink) Following

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-427: Uncontrolled Search Path Element

CWE-754: Improper Check for Unusual or Exceptional Conditions

CWE-24: Path Traversal: '../filedir'

CWE-363: Race Condition Enabling Link Following