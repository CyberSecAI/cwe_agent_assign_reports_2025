# Vulnerability Information: CVE-2024-41115

## Vulnerability Description
streamlit-geospatial is a streamlit multipage app for geospatial applications. Prior to commit c4f81d9616d40c60584e36abb15300853a66e489, the `palette` variable on line 488 in `pages/1__Timelapse.py` takes user input, which is later used in the `eval()` function on line 493, leading to remote code execution. Commit c4f81d9616d40c60584e36abb15300853a66e489 fixes this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input validation**
- **impact:** remote code execution
- **product:** streamlit-geospatial
- **version:** prior to commit c4f81d9616d40c60584e36abb15300853a66e489
- **component:** palette variable

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-NVD-noinfo

#### Top CWEs
- CWE-NVD-noinfo (Count: 34)
- CWE-918 (Count: 4)

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-41115:

**Vulnerability Details**

*   **CVE ID:** CVE-2024-41115
*   **Description:**  The `palette` variable within the `MODIS Ocean Color SMI` option in the `pages/1_üì∑_Timelapse.py` file of the `streamlit-geospatial` project is vulnerable to remote code execution (RCE). The application uses user-provided input from a text area field to set the palette, and then passes it to the `eval()` function without proper sanitization, leading to RCE.
*   **Root Cause:** Unsanitized user input passed to the `eval()` function. Specifically, the `palette` variable takes user input, which is then directly executed by Python's `eval()` function.

**Weaknesses/Vulnerabilities**

*   **Remote Code Execution (RCE):** The primary vulnerability is the ability to execute arbitrary code on the server due to the use of `eval()` on unsanitized user input. This is a classic case of RCE where an attacker can inject malicious code through the `palette` input.

**Impact of Exploitation**

*   **Complete System Compromise:** Successful exploitation could allow an attacker to gain complete control of the server where the `streamlit-geospatial` application is running.
*   **Data Breach:** An attacker could access sensitive data, including environment variables or data stored on the server.
*   **Malware Installation:** Attackers could install malware, backdoors, or other malicious software.
*   **Service Disruption:** They can disrupt the application or the entire server.

**Attack Vectors**

*   **User Input:** The attack vector is through the web interface of the application where the user can provide input to the `palette` text area.
*   **Network Access:** The attacker needs to be able to access the application's web interface to provide input.

**Required Attacker Capabilities/Position**

*   **Access to Web Interface:** The attacker needs access to the `streamlit-geospatial` application's web interface.
*   **Basic Understanding of Python:** The attacker needs to understand how to inject Python code into the text area that will be executed by the `eval()` function.

**Technical Details**

*   The vulnerable code snippet is in `pages/1_üì∑_Timelapse.py` in the `MODIS Ocean Color SMI` option:

```python
palette = st.text_area(
    "Enter a custom palette:",
    palette_values,
)
st.write(cm.plot_colormap(cmap=palette_options, return_fig=True))
st.session_state["palette"] = eval(palette)
```

*   The attacker injects malicious code within the `Enter a custom palette` input. For example:

```
__import__('code').InteractiveInterpreter().runsource('import os;os.system(\"echo $(uname -a) > foobar.txt\")')
```

*   This code creates a file named "foobar.txt" containing the output of the `uname -a` command, which is executed on the server.

**Mitigation:**

The provided content shows that the vulnerability was fixed by replacing `eval()` with `json.loads()` after sanitizing the input string. The fix replaces single quotes with double quotes. This prevents the execution of arbitrary code by only parsing the JSON data and is implemented in multiple files such as  `pages/1_üì∑_Timelapse.py`, `pages/10_üåç_Earth_Engine_Datasets.py`, `pages/8_üèúÔ∏è_Raster_Data_Visualization.py` and other mentioned in the advisory.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.251 |
| 2 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | sparse | 0.249 |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.235 |
| 4 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.232 |
| 5 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.226 |
| 6 | 193 | Off-by-one Error | Base | Allowed | sparse | 0.226 |
| 7 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.218 |
| 8 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.217 |
| 9 | 1287 | Improper Validation of Specified Type of Input | Base | Allowed | dense | 0.384 |
| 10 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | graph | 0.002 |

