# Vulnerability Information: CVE-2024-39462

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved clk bcm dvp Assign ->num before accessing ->hws Commit f316cdff8d67 (clk Annotate struct clk_hw_onecell_data with __counted_by) annotated the hws member of struct clk_hw_onecell_data with __counted_by, which informs the bounds sanitizer about the number of elements in hws, so that it can warn when hws is accessed out of bounds. As noted in that change, the __counted_by member must be initialized with the number of elements before the first array access happens, otherwise there will be a warning from each access prior to the initialization because the number of elements is zero. This occurs in clk_dvp_probe() due to ->num being assigned after ->hws has been accessed UBSAN **array-index-out-of-bounds** in drivers/clk/bcm/clk-bcm2711-dvp.c592 index 0 is out of range for type struct clk_hw *[] __counted_by(num) (aka struct clk_hw *[]) Move the ->num initialization to before the first access of ->hws, which clears up the warning.

### Vulnerability Description Key Phrases
- **rootcause:** **uninitialized __counted_by member**
- **weakness:** **array-index-out-of-bounds**
- **vector:** accessing ->hws out of bounds
- **product:** Linux kernel
- **component:** clk bcm dvp

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-129

#### Top CWEs
- CWE-129 (Count: 6)

## CVE Reference Links Content Summary
Based on the provided information, this content relates to CVE-2024-39462.

**Root Cause of Vulnerability:**
The vulnerability is due to an out-of-bounds access in the `clk_dvp_probe()` function within the Linux kernel's clock framework. The `hws` member of the `struct clk_hw_onecell_data` is accessed before the `num` member, which specifies the size of the `hws` array, is initialized. This leads to a situation where the bounds sanitizer detects that the array is being accessed out of bounds because the size is still zero.

**Weaknesses/Vulnerabilities Present:**
- **Out-of-bounds array access:** The `hws` array is accessed before its size, indicated by `num`, is set, resulting in an out-of-bounds read.

**Impact of Exploitation:**
- **UBSAN warning:** While the code was triggering a warning from the Undefined Behavior Sanitizer (UBSAN), the code was not crashing or corrupting data. The primary impact is the warning, indicating a bug that needs fixing to avoid potential future issues, even if there are no current exploitable consequences.

**Attack Vectors:**
- There is no information provided indicating that this is an exploitable vulnerability. The provided information indicates this would be detected via the bounds sanitizer.

**Required Attacker Capabilities/Position:**
- Not applicable, the issue is triggered internally by the code, not through external attack vectors.

**Additional Notes:**
- The fix involves moving the initialization of `data->num` to before the access to `data->hws`.
- The vulnerability is present in the `drivers/clk/bcm/clk-bcm2711-dvp.c` file.
- This issue was introduced by commit `f316cdff8d67`.
- The fix has been applied to the stable kernel branch.
- Multiple commits address this issue, they all contain the same fix, for the same issue.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.774 |
| 2 | 191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | sparse | 0.765 |
| 3 | 824 | Access of Uninitialized Pointer | Base | Allowed | sparse | 0.763 |
| 4 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.760 |
| 5 | 908 | Use of Uninitialized Resource | Base | Allowed | sparse | 0.758 |
| 6 | 823 | Use of Out-of-range Pointer Offset | Base | Allowed | sparse | 0.753 |
| 7 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | sparse | 0.745 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.740 |
| 9 | 606 | Unchecked Input for Loop Condition | Base | Allowed | dense | 0.521 |
| 10 | 129 | Improper Validation of Array Index | Variant | Allowed | graph | 0.003 |

