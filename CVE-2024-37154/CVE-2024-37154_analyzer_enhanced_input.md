## Vulnerability Description
Evmos is the Ethereum Virtual Machine (EVM) Hub on the Cosmos Network. Users are able to delegate tokens that have not yet been vested. This affects employees and grantees who have funds managed via `ClawbackVestingAccount`. This affects 18.1.0 and earlier.

### Vulnerability Description Key Phrases
- **impact:** delegate tokens that have not yet been vested
- **product:** Evmos
- **version:** 18.1.0 and earlier

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
The vulnerability stems from the ability to delegate tokens that have not yet vested within `ClawbackVestingAccount`. This allows users, specifically those with vesting accounts like employees and grantees, to delegate more tokens than they have currently available.

**Weaknesses/Vulnerabilities:**
- The core weakness lies in the insufficient validation of delegatable balances, allowing unvested tokens to be used in staking operations.
- The system fails to properly track and restrict the delegation of tokens that are still subject to vesting schedules.

**Impact of Exploitation:**
- Users can delegate more tokens than they are entitled to, potentially creating an imbalance in the staking system.
- This could lead to inflated voting power for malicious users, thereby allowing them to disproportionately influence the network's governance.
- It also allows the users to stake funds that they haven't technically received yet, potentially disrupting the tokenomics of the system.

**Attack Vectors:**
- An attacker with a `ClawbackVestingAccount` can exploit this vulnerability.
- The attack vector involves using the standard transaction (`tx staking delegate`) to delegate unvested tokens.

**Required Attacker Capabilities/Position:**
- The attacker needs to have a `ClawbackVestingAccount` with tokens subject to a vesting schedule.
- The attacker needs to be able to execute transactions on the network using the CLI.

**Additional Information:**
- The advisory provides a step-by-step guide on how to reproduce the exploit using the CLI.
- The fix for this vulnerability is spread across two separate advisories, one in the main `evmos` repository and another in the `cosmos-sdk` fork.
- The severity of the vulnerability is marked as "Moderate".
- The vulnerability is present in all versions of the Evmos package.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.064 |
| 2 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.063 |
| 3 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.063 |
| 4 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.062 |
| 5 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.062 |
| 6 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.062 |
| 7 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.062 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.062 |
| 9 | 1274 | Improper Access Control for Volatile Memory Containing Boot Code | Base | Allowed | dense | 0.323 |
| 10 | 410 | Insufficient Resource Pool | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-863: Incorrect Authorization

CWE-400: Uncontrolled Resource Consumption

CWE-285: Improper Authorization

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-522: Insufficiently Protected Credentials

CWE-347: Improper Verification of Cryptographic Signature

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-1274: Improper Access Control for Volatile Memory Containing Boot Code

CWE-410: Insufficient Resource Pool