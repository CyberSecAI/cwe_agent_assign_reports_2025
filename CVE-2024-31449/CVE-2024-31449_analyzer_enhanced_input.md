## Vulnerability Description
Redis is an open source, in-memory database that persists on disk. An authenticated user may use a specially crafted Lua script to trigger a **stack buffer overflow** in the bit library, which may potentially lead to remote code execution. The problem exists in all versions of Redis with Lua scripting. This problem has been fixed in Redis versions 6.2.16, 7.2.6, and 7.4.1. Users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **weakness:** **stack buffer overflow**
- **impact:** remote code execution
- **vector:** specially crafted Lua script
- **attacker:** authenticated user
- **product:** Redis
- **version:** all versions with Lua scripting
- **component:** bit library

## CVE Reference Links Content Summary
The provided content is related to CVE-2024-31449.

**Root cause of vulnerability:**
The vulnerability is caused by a stack buffer overflow in the `bit.tohex` function of the Lua bit library used in Redis. The function does not properly handle the `INT_MIN` value when converting it to a hexadecimal string, leading to incorrect behavior and a potential overflow.

**Weaknesses/vulnerabilities present:**
- Stack buffer overflow (CWE-121)
- Improper handling of edge cases leading to unexpected behavior (CWE-20)
- Specifically, integer negation of `INT_MIN` results in the same value, causing issues in subsequent logic within the `bit.tohex` function.

**Impact of exploitation:**
- An authenticated user can execute arbitrary code on the server through crafted Lua script.
- Potential for remote code execution (RCE).
- Could lead to loss of confidentiality, integrity, and availability.

**Attack vectors:**
- Attacker needs to be an authenticated user to execute arbitrary Lua scripts.
- The vulnerable component is the Lua bit library within Redis.

**Required attacker capabilities/position:**
- Must be an authenticated user with the ability to execute Lua scripts within the Redis environment.
- The attacker needs to craft a malicious Lua script.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | alternate_terms | 0.800 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.503 |
| 4 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.487 |
| 5 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.481 |
| 6 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.473 |
| 7 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.467 |
| 8 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.466 |
| 9 | 126 | Buffer Over-read | Variant | Allowed | dense | 0.450 |
| 10 | 128 | Wrap-around Error | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer

CWE-190: Integer Overflow or Wraparound

CWE-125: Out-of-bounds Read

CWE-674: Uncontrolled Recursion

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-121: Stack-based Buffer Overflow

CWE-126: Buffer Over-read

CWE-128: Wrap-around Error