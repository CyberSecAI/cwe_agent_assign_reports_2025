## Vulnerability Description
The Royal Elementor Addons and Templates plugin for WordPress is vulnerable to **Information Exposure** in all versions up to, and including, 1.3.986 via the data_fetch. This makes it possible for authenticated attackers, with subscriber-level access and above, to extract data from password protected posts.

### Vulnerability Description Key Phrases
- **weakness:** **Information Exposure**
- **impact:** extract data from password protected posts
- **attacker:** authenticated attackers with subscriber-level access and above
- **product:** Royal Elementor Addons and Templates plugin for WordPress
- **version:** all versions up to and including 1.3.986
- **component:** data_fetch

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-7417

**Root Cause of Vulnerability:**
The vulnerability stems from insufficient access control checks within the `data_fetch` function of the `WPR_Ajax_Search` class in the Royal Elementor Addons and Templates plugin. Specifically, it allows access to password-protected posts via AJAX requests even when the user should not have permission.

**Weaknesses/Vulnerabilities Present:**
- **Improper Access Control:** The code does not properly verify if the current user has the necessary permission to view password-protected posts before including them in the search results. This is exposed through the `wpr_data_fetch` AJAX action.
- **Information Exposure:** The vulnerability leads to the disclosure of sensitive information from password-protected posts.

**Impact of Exploitation:**
- An attacker with minimal privileges (Subscriber+) can bypass password protection on posts and extract content, potentially including sensitive or private data.

**Attack Vectors:**
- The vulnerability is exploited via AJAX calls to the `wp_ajax_wpr_data_fetch` or `wp_ajax_nopriv_wpr_data_fetch` action.
- The attacker sends a crafted AJAX request containing the necessary parameters to trigger the vulnerable code in `wpr-ajax-search.php`, which is the `data_fetch` function, bypassing the access control checks.

**Required Attacker Capabilities/Position:**
- The attacker must have an account on the WordPress site with at least Subscriber-level access.
- The attacker needs to be able to send an AJAX request to the WordPress site.

**Technical Details:**
The vulnerable code is located in the `data_fetch` function of the `WPR_Ajax_Search` class within the `wpr-ajax-search.php` file.

The original code (before patch) had a conditional check:
```php
if ( 'yes' !== sanitize_text_field($_POST['wpr_show_ps_pt'] ) )
```
This check only considered a setting controlled by the user which intended to hide the password protected posts. The problem was that it did not also check if the user had the `read_private_posts` capability. Thus, if the user had the `read_private_posts` capability, then password protected posts would be included in the search results, regardless of the `wpr_show_ps_pt` setting, meaning a subscriber or higher could bypass this protection.

The patched code includes an additional check using `current_user_can('read_private_posts')`:
```php
if ( ( 'yes' !== sanitize_text_field($_POST['wpr_show_ps_pt'] ) ) || !$can_view_protected_posts )
```
And also, it added this check on where the data is rendered:
```php
<?php if ( !post_password_required() || $can_view_protected_posts ) : ?>
```
This ensures that password-protected posts are only included if the user is authorized to view them or when the post is not password protected.

**Affected Versions:**
- Royal Elementor Addons and Templates plugin versions <= 1.3.986

**Patched Version:**
- Royal Elementor Addons and Templates plugin version 1.3.987

**Additional Notes:**
The Wordfence article provides additional context, confirming that the vulnerability is an information exposure issue. It also indicates that the vulnerability was discovered and reported by the researcher "stealthcopter". The fix involves correctly checking the user's ability to view password-protected posts within the AJAX search functionality.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 284 | Improper Access Control | Pillar | Discouraged | sparse | 0.285 |
| 2 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.285 |
| 3 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.277 |
| 4 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.269 |
| 5 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.268 |
| 6 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.268 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.258 |
| 8 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.257 |
| 9 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | dense | 0.529 |
| 10 | 471 | Modification of Assumed-Immutable Data (MAID) | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-284: Improper Access Control

CWE-862: Missing Authorization

CWE-863: Incorrect Authorization

CWE-200: Exposure of Sensitive Information to an Unauthorized Actor

CWE-285: Improper Authorization

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-359: Exposure of Private Personal Information to an Unauthorized Actor

CWE-471: Modification of Assumed-Immutable Data (MAID)