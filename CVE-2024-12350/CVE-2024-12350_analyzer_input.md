# Vulnerability Information: CVE-2024-12350

## Vulnerability Description
A vulnerability was found in JFinalCMS 1.0. It has been rated as critical. Affected by this issue is the function update of the file \src\main\java\com\cms\controller\admin\TemplateController.java of the component Template Handler. The manipulation of the argument content leads to **command injection**. The attack may be launched remotely. The exploit has been disclosed to the public and may be used.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input validation**
- **weakness:** **command injection**
- **impact:** execute arbitrary commands
- **vector:** manipulation of content argument
- **product:** JFinalCMS
- **version:** 1
- **component:** update function in TemplateController.java

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root cause of vulnerability:**
The vulnerability stems from a lack of input sanitization in the `TemplateController.java` file within the JFinalCMS project. Specifically, when updating template files, the `content` parameter, which contains the template code, is directly written to the file system without any filtering or validation.

**Weaknesses/vulnerabilities present:**
- **Server-Side Template Injection (SSTI):** The core weakness is the use of user-controlled input (`content` parameter) directly within the Freemarker template engine. This allows an attacker to inject malicious template code.
- **Lack of Input Sanitization/Validation:** The `update()` method in `TemplateController.java` does not sanitize or validate the `content` parameter, allowing arbitrary code to be embedded within the template file.

**Impact of exploitation:**
- **Remote Code Execution (RCE):** By injecting malicious Freemarker template code, an attacker can execute arbitrary code on the server. This can lead to complete compromise of the server, data theft, malware installation, or other malicious actions.
- **System Compromise:** An attacker can gain complete control of the server, allowing them to read, modify, or delete any data or resources.

**Attack vectors:**
- **HTTP POST Request:** The attacker sends a crafted POST request to the `/admin/template/update` endpoint, providing a malicious template code in the `content` parameter.
- **Template File Modification:** The attacker targets a specific template file for modification through the `fileName` and `directory` parameters, overwriting it with malicious code.

**Required attacker capabilities/position:**
- **Authentication:** The attacker needs to be logged in as an admin or have the ability to access the `TemplateController.java` endpoint.
- **Knowledge of Freemarker:** The attacker must know the syntax and capabilities of the Freemarker template engine to craft a successful exploit payload.
- **Targeted Template:** The attacker needs to know the location and name of an existing template file to overwrite.
- **Network Access:** The attacker needs network access to the server hosting the vulnerable JFinalCMS application.

**Additional details:**
- The provided example shows how an attacker can inject `<#assign value="freemarker.template.utility.Execute"?new()>${value("calc.exe")}` into a template file, causing the server to execute the `calc.exe` command (for testing, other commands could be used).
- The vulnerability is in `JFinalCMS-master\src\main\java\com\cms\controller\admin\TemplateController.java`.
- The attacker targets the `update` function in the `TemplateController.java`.
- The code `FreeMarkerRender.getConfiguration().clearTemplateCache();` forces the template engine to reload the modified template, executing the attacker's payload.
- The `TemplateUtils.write` function is responsible for writing the modified content into the template file without any sanitization.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.498 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.485 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.468 |
| 6 | 117 | Improper Output Neutralization for Logs | Base | Allowed | sparse | 0.427 |
| 7 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.401 |
| 8 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.398 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.634 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

