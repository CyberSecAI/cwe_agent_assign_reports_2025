{
  "cve_id": "CVE-2024-27730",
  "description": "**Insecure Permissions** vulnerability in Friendica v.2023.12 allows a remote attacker to obtain sensitive information and execute arbitrary code via the cid parameter of the calendar event feature.",
  "key_phrases": {
    "rootcause": "Insecure Permissions",
    "weakness": "",
    "impact": [
      "obtain sensitive information",
      "execute arbitrary code"
    ],
    "vector": "cid parameter of the calendar event feature",
    "attacker": "remote attacker",
    "product": "Friendica",
    "version": "v.2023.12",
    "component": ""
  },
  "reference_content": "Based on the provided information, here's an analysis of CVE-2024-27730:\n\n**CVE-2024-27730: Access control, insecure direct object reference (IDOR) issue in calendar event feature.**\n\n*   **Root Cause:** The vulnerability stems from a lack of proper access control checks when creating and editing calendar events. Specifically, the `cid` (contact ID) parameter, which determines the user associated with the event, can be manipulated by an attacker.\n\n*   **Weaknesses/Vulnerabilities:**\n    *   **Insecure Direct Object Reference (IDOR):** The system relies on the `cid` parameter, which can be directly modified by an attacker to impersonate other users.\n    *   **Insufficient Access Control:** The application does not verify if the user making the request is authorized to create or modify events on behalf of the specified `cid`.\n\n*   **Impact of Exploitation:**\n    *   **Event Creation Impersonation:** An attacker can create calendar events as any other user on the Friendica server.\n    *   **Combined with XSS:** When combined with the stored XSS vulnerability (CVE-2024-27729) in the calendar event feature, an attacker can inject malicious scripts into events created on behalf of other users. This would allow the attacker to steal session cookies or password hashes of targeted users when they view the manipulated events.\n\n*   **Attack Vectors:**\n    *   **Direct Parameter Manipulation:**  An attacker can directly modify the `cid` parameter in the `/calendar/api/create` POST request.\n    *   **Event Edit:** Attackers can create an event with their own user ID, then modify that event to be associated with another user (by setting the `cid` to `0`), causing it to be shared on the victim's feed.\n\n*   **Required Attacker Capabilities/Position:**\n    *   The attacker needs to be a registered user of the Friendica instance.\n    *   The attacker needs to know the contact ID (`cid`) of the target user. However this is typically sequential.\n    *   The attacker needs to be able to send HTTP requests to the Friendica server.\n\n**Additional Details from the Content:**\n\n* The provided content explains in detail how this vulnerability can be exploited.\n* It clarifies that while creating an event with a different user's CID does not share it by default, editing the event with cid=0 triggers sharing.\n* This IDOR vulnerability, in combination with stored XSS, allows for a more severe attack targeting any user on the server, not just the attacker's followers.\n* The fix involved preventing overwriting the `cid` during event edits.",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-639 | Authorization Bypass Through User-Controlled Key | 0.9 | Base | Primary | Allowed |\n| CWE-285 | Improper Authorization | 0.7 | Class | Secondary | Discouraged |\n| CWE-862 | Missing Authorization | 0.6 | Class | Secondary | Allowed-with-Review |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE, CWE-639, is a Base level CWE which is preferred. It is related to the higher level CWE-285 Improper Authorization. CWE-862 Missing Authorization is a peer of CWE-863 Incorrect Authorization which is a child of CWE-285. The selection of CWE-639 reflects the specific mechanism of bypassing authorization through a user-controlled key, a more precise identification than the more general authorization issues.\n\n```mermaid\ngraph TD\n    cwe639[\"CWE-639: Authorization Bypass Through User-Controlled Key\"]\n    cwe285[\"CWE-285: Improper Authorization\"]\n    cwe862[\"CWE-862: Missing Authorization\"]\n    cwe863[\"CWE-863: Incorrect Authorization\"]\n\n    cwe639 -->|CHILDOF| cwe285\n    cwe862 -->|PEEROF| cwe863\n    cwe863 -->|CHILDOF| cwe285\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe639 primary\n    class cwe285,cwe862,cwe863 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **insecure permissions** and **insufficient access control** on the `cid` parameter, leading to the ability to manipulate the parameter. This allows an attacker to create and modify calendar events as other users, potentially combined with XSS for further impact.\n\n**Chain:**\n1.  **CWE-639: Authorization Bypass Through User-Controlled Key** (**Root Cause**) - Attacker manipulates the `cid` parameter.\n2.  **CWE-200: Information Exposure** (Potential Intermediate, not explicitly identified) - Access to other user's calendar events.\n3.  **CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')** (Secondary impact, mentioned in CVE details) - Exploitation of stored XSS.\n\n## Summary of Analysis\nThe initial assessment, based on the vulnerability description and CVE details, pointed to an authorization issue related to **insecure permissions**. The selection of CWE-639 is driven by the specific exploitation mechanism of manipulating the `cid` parameter.\n\nThe evidence from the CVE Reference Links Content Summary explicitly states: \"The vulnerability stems from a lack of proper access control checks when creating and editing calendar events. Specifically, the `cid` (contact ID) parameter, which determines the user associated with the event, can be manipulated by an attacker.\"\n\nThis aligns perfectly with CWE-639: \"The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.\"\n\nOther CWEs considered but not selected:\n\n*   CWE-732: Incorrect Permission Assignment for Critical Resource - While the initial description mentioned **insecure permissions**, the CVE details clarify that the issue is related to authorization bypass through manipulating the `cid` parameter, not just incorrect permission assignments.\n*   CWE-285: Improper Authorization and CWE-862: Missing Authorization - These are higher-level Class CWEs, and CWE-639 provides a more specific description of the vulnerability.\n\nRelevant CWE Information:\n* CWE-639: Authorization Bypass Through User-Controlled Key: \"The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.\"",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-639 | Authorization Bypass Through User-Controlled Key | 0.9 | Base | Primary | Allowed |\n| CWE-285 | Improper Authorization | 0.7 | Class | Secondary | Discouraged |\n| CWE-862 | Missing Authorization | 0.6 | Class | Secondary | Allowed-with-Review |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE, CWE-639, is a Base level CWE which is preferred. It is related to the higher level CWE-285 Improper Authorization. CWE-862 Missing Authorization is a peer of CWE-863 Incorrect Authorization which is a child of CWE-285. The selection of CWE-639 reflects the specific mechanism of bypassing authorization through a user-controlled key, a more precise identification than the more general authorization issues.\n\n```mermaid\ngraph TD\n    cwe639[\"CWE-639: Authorization Bypass Through User-Controlled Key\"]\n    cwe285[\"CWE-285: Improper Authorization\"]\n    cwe862[\"CWE-862: Missing Authorization\"]\n    cwe863[\"CWE-863: Incorrect Authorization\"]\n\n    cwe639 -->|CHILDOF| cwe285\n    cwe862 -->|PEEROF| cwe863\n    cwe863 -->|CHILDOF| cwe285\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe639 primary\n    class cwe285,cwe862,cwe863 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **insecure permissions** and **insufficient access control** on the `cid` parameter, leading to the ability to manipulate the parameter. This allows an attacker to create and modify calendar events as other users, potentially combined with XSS for further impact.\n\n**Chain:**\n1.  **CWE-639: Authorization Bypass Through User-Controlled Key** (**Root Cause**) - Attacker manipulates the `cid` parameter.\n2.  **CWE-200: Information Exposure** (Potential Intermediate, not explicitly identified) - Access to other user's calendar events.\n3.  **CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')** (Secondary impact, mentioned in CVE details) - Exploitation of stored XSS.\n\n## Summary of Analysis\nThe initial assessment, based on the vulnerability description and CVE details, pointed to an authorization issue related to **insecure permissions**. The selection of CWE-639 is driven by the specific exploitation mechanism of manipulating the `cid` parameter.\n\nThe evidence from the CVE Reference Links Content Summary explicitly states: \"The vulnerability stems from a lack of proper access control checks when creating and editing calendar events. Specifically, the `cid` (contact ID) parameter, which determines the user associated with the event, can be manipulated by an attacker.\"\n\nThis aligns perfectly with CWE-639: \"The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.\"\n\nOther CWEs considered but not selected:\n\n*   CWE-732: Incorrect Permission Assignment for Critical Resource - While the initial description mentioned **insecure permissions**, the CVE details clarify that the issue is related to authorization bypass through manipulating the `cid` parameter, not just incorrect permission assignments.\n*   CWE-285: Improper Authorization and CWE-862: Missing Authorization - These are higher-level Class CWEs, and CWE-639 provides a more specific description of the vulnerability.\n\nRelevant CWE Information:\n* CWE-639: Authorization Bypass Through User-Controlled Key: \"The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.\"\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-863:**\n- 863 (Incorrect Authorization) - ROOT\n\n\n**Chain starting from CWE-732:**\n- 732 (Incorrect Permission Assignment for Critical Resource) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "732",
        "name": "Incorrect Permission Assignment for Critical Resource",
        "source": "sparse"
      },
      "similarity": 177.77269670881537
    },
    {
      "metadata": {
        "doc_id": "639",
        "name": "Authorization Bypass Through User-Controlled Key",
        "source": "sparse"
      },
      "similarity": 170.06032665593366
    },
    {
      "metadata": {
        "doc_id": "425",
        "name": "Direct Request ('Forced Browsing')",
        "source": "sparse"
      },
      "similarity": 163.7128022615558
    },
    {
      "metadata": {
        "doc_id": "378",
        "name": "Creation of Temporary File With Insecure Permissions",
        "source": "sparse"
      },
      "similarity": 162.63179283609435
    },
    {
      "metadata": {
        "doc_id": "379",
        "name": "Creation of Temporary File in Directory with Insecure Permissions",
        "source": "sparse"
      },
      "similarity": 159.54715003130494
    },
    {
      "metadata": {
        "doc_id": "285",
        "name": "Improper Authorization",
        "source": "sparse"
      },
      "similarity": 155.54243943289836
    },
    {
      "metadata": {
        "doc_id": "798",
        "name": "Use of Hard-coded Credentials",
        "source": "sparse"
      },
      "similarity": 150.8454791627513
    },
    {
      "metadata": {
        "doc_id": "522",
        "name": "Insufficiently Protected Credentials",
        "source": "sparse"
      },
      "similarity": 150.39166223135723
    },
    {
      "metadata": {
        "doc_id": "862",
        "name": "Missing Authorization",
        "type": "Class",
        "original_content": "The product does not perform an authorization check when an actor attempts to access a resource or perform an action.",
        "keyphrase_source": "rootcause:Insecure Permissions",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed-with-Review",
          "rationale": "This CWE entry is a Class and might have Base-level children that would be more appropriate",
          "comments": "Examine children of this entry to see if there is a better fit",
          "reasons": [
            "Abstraction"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "dense": 0.5369147321467087
          }
        }
      },
      "similarity": 0.5369147321467087
    },
    {
      "doc_id": "471",
      "text": "CWE-471: Modification of Assumed-Immutable Data (MAID)",
      "score": 2.7196000000000002,
      "metadata": {
        "doc_id": "471",
        "name": "Modification of Assumed-Immutable Data (MAID)",
        "type": "base",
        "original_content": "CWE-471: Modification of Assumed-Immutable Data (MAID)",
        "relationships": [
          {
            "source_id": "471",
            "target_id": "621",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "607",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "602",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "473",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "472",
            "label": "PARENTOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "425",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "291",
            "label": "PARENTOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "1321",
            "label": "CANFOLLOW",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "1282",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "471",
            "target_id": "664",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "664",
            "target_id": "471",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "621",
            "target_id": "471",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "607",
            "target_id": "471",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "602",
            "target_id": "471",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "473",
            "target_id": "471",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "472",
            "target_id": "471",
            "label": "CHILDOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "425",
            "target_id": "471",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "291",
            "target_id": "471",
            "label": "CHILDOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "1321",
            "target_id": "471",
            "label": "CANPRECEDE",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "1282",
            "target_id": "471",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "abstraction_path": 0.5599999999999999,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "abstraction_path_up",
            "vulnerability_sequence_forward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "425",
                  "471",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "425"
            },
            "abstraction_path_up": {
              "path": [
                [
                  "472",
                  "471",
                  "CHILDOF"
                ]
              ],
              "score": 0.5599999999999999,
              "type": "abstraction_path_up",
              "source": "472"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "425",
                  "471",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_forward",
              "source": "425"
            }
          }
        },
        "abstraction_level": "base",
        "position": "after",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.7196000000000002
          }
        }
      },
      "similarity": 2.7196000000000002
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-863",
      "CWE-732",
      "CWE-862",
      "CWE-639",
      "CWE-79",
      "CWE-285",
      "CWE-200"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}