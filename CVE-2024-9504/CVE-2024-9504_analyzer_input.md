# Vulnerability Information: CVE-2024-9504

## Vulnerability Description
The Booking calendar, Appointment Booking System plugin for WordPress is vulnerable to Stored Cross-Site Scripting via SVG File uploads in all versions up to, and including, 3.2.15 due to **insufficient input sanitization and output escaping**. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that will execute whenever a user accesses the SVG file.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient input sanitization and output escaping**
- **weakness:** **cross-site scripting**
- **impact:** execute arbitrary web scripts and inject arbitrary web scripts
- **vector:** SVG File uploads
- **attacker:** unauthenticated attackers
- **product:** Booking calendar and Appointment Booking System WordPress plugin
- **version:** all versions up to 3.2.15

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2024-9504:

**Root Cause:**
The root cause of the vulnerability lies in the insufficient input sanitization and output escaping within the "Booking calendar, Appointment Booking System" WordPress plugin. Specifically, the plugin allows unrestricted uploads of files with dangerous types (SVG), which can then be used to inject malicious scripts.

**Weaknesses/Vulnerabilities Present:**
*   **Unrestricted File Upload:** The plugin does not properly validate or restrict file types during the upload process, allowing the upload of SVG files.
*   **Stored Cross-Site Scripting (XSS):** By allowing the upload of malicious SVG files, attackers can inject arbitrary web scripts that are stored on the server. These scripts will execute whenever a user accesses the uploaded SVG file.
*   **Insufficient Sanitization:** The plugin does not adequately sanitize the content of uploaded SVG files, failing to remove potentially malicious script tags or other executable content.

**Impact of Exploitation:**
Successful exploitation of this vulnerability can lead to:
*   **Arbitrary Code Execution:** An attacker can inject arbitrary web scripts that will execute in the context of the user's browser when they access the malicious SVG file.
*   **Session Hijacking:** Attackers could potentially steal user session cookies or other sensitive information by injecting malicious JavaScript code into the SVG files, which could result in account compromise.
*  **Malicious Redirects:** An attacker could redirect users to a malicious website through JavaScript injection within the SVG file.

**Attack Vectors:**
*   **File Upload:** The attack vector is through the file upload functionality within the plugin.
*  **Unauthenticated Access:** The vulnerable function is accessible via an AJAX action that does not require user authentication, allowing unauthenticated attackers to exploit the vulnerability.
*   **SVG File Injection:** The attacker uploads a specially crafted SVG file containing malicious JavaScript code.
*   **User Interaction**: The malicious script executes when a user accesses the uploaded SVG file, triggering the XSS.

**Required Attacker Capabilities/Position:**
*   **No Authentication Required:** The attacker does not need any user credentials or specific privileges to exploit the vulnerability.
*   **Network Access:** The attacker only needs network access to the vulnerable WordPress site.
*   **Knowledge of Vulnerable Plugin:** The attacker needs to be aware of the vulnerable plugin and its file upload functionality.
*   **Ability to Craft Malicious SVG File:** The attacker needs the ability to create an SVG file with a malicious JavaScript payload.

**Additional Notes:**

*   The vulnerability was found by grepping through WordPress plugins to find insecure file types in whitelists, using the regex `svg.*png`.
*   The vulnerable function is `save_reserv` which is called via the `wpdevart_form_ajax` AJAX action, which is accessible to non-authenticated users.
*   The vulnerability was patched in version 3.2.16 of the plugin with the addition of a `sanitizeSvgContent` function that attempts to strip potentially malicious elements from uploaded SVG files using regular expressions. However, this is not a comprehensive security solution and might still be bypassed.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.456 |
| 2 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.437 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.427 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.404 |
| 5 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.367 |
| 6 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.350 |
| 7 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.348 |
| 8 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.333 |
| 9 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | dense | 0.503 |
| 10 | 73 | External Control of File Name or Path | Base | Allowed | graph | 0.002 |

