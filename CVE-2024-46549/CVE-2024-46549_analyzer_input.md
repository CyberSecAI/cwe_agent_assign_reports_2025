# Vulnerability Information: CVE-2024-46549

## Vulnerability Description
An issue in the TP-Link MQTT Broker and API gateway of TP-Link Kasa KP125M v1.0.3 allows attackers to establish connections by impersonating devices owned by other users.

### Vulnerability Description Key Phrases
- **impact:** establish connections by impersonating devices owned by other users
- **attacker:** attackers
- **product:** TP-Link MQTT Broker and API gateway of TP-Link Kasa KP125M
- **version:** v1.0.3

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** Improper implementation of the TP-Link MQTT Broker and API gateway fails to enforce consistency of device identity. Specifically, the API does not properly validate the `deviceId` in the request body of `/common/v1/uploadDeviceInfo`, while it does validate the `deviceId` and `deviceToken` in request parameters.
- **Weaknesses/vulnerabilities present:** Inadequate validation of the `deviceId` in the request body, leading to horizontal privilege escalation.
- **Impact of exploitation:** An authenticated attacker can impersonate another legitimate device, report false device properties, and potentially prevent the legitimate user from accessing the device through the mobile application. This can affect the device properties displayed on the mobile app and potentially make the device inaccessible.
- **Attack vectors:** The attacker exploits the vulnerability by intercepting MQTT messages, modifying the `deviceId` in the request body of `/common/v1/uploadDeviceInfo` and sending the modified request through an authenticated device. The attacker can perform the attack from any node between the device and the TP-Link Cloud service.
- **Required attacker capabilities/position:** The attacker needs to have a legitimate TP-Link device that can authenticate with the MQTT broker. They also need to be able to intercept and modify MQTT messages.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 290 | Authentication Bypass by Spoofing | Base | Allowed | sparse | 0.053 |
| 2 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | sparse | 0.053 |
| 3 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.051 |
| 4 | 228 | Improper Handling of Syntactically Invalid Structure | Class | Allowed-with-Review | sparse | 0.051 |
| 5 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.051 |
| 6 | 1263 | Improper Physical Access Control | Class | Allowed-with-Review | sparse | 0.050 |
| 7 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.050 |
| 8 | 294 | Authentication Bypass by Capture-replay | Base | Allowed | sparse | 0.050 |
| 9 | 306 | Missing Authentication for Critical Function | Base | Allowed | dense | 0.478 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

