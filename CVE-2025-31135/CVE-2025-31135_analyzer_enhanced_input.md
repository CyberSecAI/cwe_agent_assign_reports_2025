## Vulnerability Description
Go-Guerrilla SMTP Daemon is a lightweight SMTP server written in Go. Prior to 1.6.7, when ProxyOn is enabled, the PROXY command will be accepted multiple times, with later invocations overriding earlier ones. The proxy protocol only supports one initial PROXY header anything after that is considered part of the exchange between client and server, so the client is free to send further PROXY commands with whatever data it pleases. go-guerrilla will treat these as coming from the reverse proxy, allowing a client to spoof its IP address. This vulnerability is fixed in 1.6.7.

### Vulnerability Description Key Phrases
- **impact:** spoof IP address
- **vector:** multiple PROXY commands
- **product:** Go-Guerrilla SMTP Daemon
- **version:** prior to 1.6.7
- **component:** PROXY command

## CVE Reference Links Content Summary
## CVE-2025-31135 Analysis

The provided content is **RELEVANT** to CVE-2025-31135. It details a vulnerability in the `go-guerrilla` library that allows a client to spoof its IP address when the proxy protocol is enabled. Here's a breakdown of the information:

**Root cause of vulnerability:**

The `PROXY` command is accepted multiple times, allowing subsequent invocations to override earlier ones. The proxy protocol only supports a single initial `PROXY` header.

**Weaknesses/vulnerabilities present:**

*   Improper input validation: The server doesn't properly restrict the number of `PROXY` commands it accepts.
*   Reliance on client-provided data: The server trusts the IP address provided in subsequent `PROXY` commands.

**Impact of exploitation:**

*   IP address spoofing: An attacker can spoof the `RemoteIP` field, potentially impacting logging, access control, or other security measures that rely on the client's IP address. The impact is considered limited, but could be more significant depending on how the `RemoteIP` is used.

**Attack vectors:**

*   Network: An attacker can exploit this vulnerability over the network by sending multiple `PROXY` commands to a vulnerable server.

**Required attacker capabilities/position:**

*   Network access: The attacker needs network access to the vulnerable server.
*   Ability to send crafted `PROXY` commands: The attacker needs to be able to send specifically crafted `PROXY` commands.

**Mitigation or fix:**

*   The vulnerability is patched in version 1.6.7.
*   The commit 7673947 prevents IP address spoofing with the PROXY command.
*   Disabling `ProxyOn` in the configuration file if a reverse proxy is not being used.

**Additional Details (more than official CVE description):**

*   The content provides details about the format of the `PROXY` header and why it's being treated incorrectly.
*   It explains the potential impact on an MTA (Mail Transfer Agent) versus a web server.
*   It includes a CVSS score (5.3/10) and a breakdown of the CVSS v3 base metrics.
*   It mentions a planned unit test to serve as a Proof of Concept (PoC).
*   The content details the changes made in the fix, including reading the PROXY header only once and validating the IP address.
*   The content also includes a test case that verifies the fix.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.170 |
| 2 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.161 |
| 3 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.161 |
| 4 | 757 | Selection of Less-Secure Algorithm During Negotiation ('Algorithm Downgrade') | Base | Allowed | sparse | 0.160 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.156 |
| 6 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.155 |
| 7 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.154 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.153 |
| 9 | 441 | Unintended Proxy or Intermediary ('Confused Deputy') | Class | Allowed-with-Review | dense | 0.375 |
| 10 | 208 | Observable Timing Discrepancy | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-327: Use of a Broken or Risky Cryptographic Algorithm

CWE-863: Incorrect Authorization

CWE-757: Selection of Less-Secure Algorithm During Negotiation ('Algorithm Downgrade')

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-287: Improper Authentication

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-441: Unintended Proxy or Intermediary ('Confused Deputy')

CWE-208: Observable Timing Discrepancy