## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved stackdepot fix stack_depot_save_flags() in NMI context Per documentation, stack_depot_save_flags() was meant to be usable from NMI context if STACK_DEPOT_FLAG_CAN_ALLOC is unset. However, it still would try to take the pool_lock in an attempt to save a stack trace in the current pool (if space is available). This could result in **deadlock** if an NMI is handled while pool_lock is already held. To avoid **deadlock**, only try to take the lock in NMI context and give up if unsuccessful. The documentation is fixed to clearly convey this.

### Vulnerability Description Key Phrases
- **weakness:** **deadlock**
- **product:** Linux kernel
- **component:** stackdepot

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.526 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.502 |
| 3 | 451 | User Interface (UI) Misrepresentation of Critical Information | Class | Allowed-with-Review | sparse | 0.449 |
| 4 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.433 |
| 5 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.428 |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.427 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.427 |
| 8 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.425 |
| 9 | 562 | Return of Stack Variable Address | Base | Allowed | dense | 0.454 |
| 10 | 825 | Expired Pointer Dereference | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-667: Improper Locking

CWE-833: Deadlock

CWE-451: User Interface (UI) Misrepresentation of Critical Information

CWE-787: Out-of-bounds Write

CWE-674: Uncontrolled Recursion

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-863: Incorrect Authorization

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-562: Return of Stack Variable Address

CWE-825: Expired Pointer Dereference