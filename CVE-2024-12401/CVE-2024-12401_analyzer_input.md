# Vulnerability Information: CVE-2024-12401

## Vulnerability Description
A flaw was found in the cert-manager package. This flaw allows an attacker who can modify PEM data that the cert-manager reads, for example, in a Secret resource, to use large amounts of CPU in the cert-manager controller pod to effectively create a denial-of-service (DoS) vector for the cert-manager in the cluster.

### Vulnerability Description Key Phrases
- **impact:** denial of service
- **vector:** modify PEM data
- **attacker:** attacker
- **product:** cert-manager

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-12401:

**Root Cause of Vulnerability:**

The vulnerability stems from the `pem.Decode()` function in the Go standard library. This function, when processing specially crafted, large PEM inputs, exhibits excessive CPU consumption and takes a long time to process, leading to a potential denial-of-service (DoS).

**Weaknesses/Vulnerabilities Present:**

- **Inefficient PEM Parsing:** The core issue is the inefficiency of `pem.Decode()` when handling specific types of malformed PEM data. This inefficiency allows an attacker to cause high CPU usage.
- **Lack of Input Validation:** The vulnerability exists due to the lack of input validation or size limitations in how PEM data is handled before being passed to the `pem.Decode` function.

**Impact of Exploitation:**

- **Denial of Service (DoS):** An attacker can cause a DoS in the cert-manager controller by providing specially crafted PEM inputs which cause high CPU usage.
- **Resource Exhaustion:** The excessive CPU usage can impact the performance and stability of the cert-manager controller, potentially affecting the overall cluster.

**Attack Vectors:**

- **Modification of PEM Data:** An attacker needs to be able to modify PEM data that cert-manager reads (e.g., in a Kubernetes Secret resource).

**Required Attacker Capabilities/Position:**

- **Access to modify Kubernetes resources:** An attacker needs to have the ability to create or modify resources such as Secrets that contain PEM data. This typically requires some level of RBAC access to the cluster.
- **Knowledge of vulnerable function:** The attacker needs to be aware of the vulnerability in `pem.Decode()` and be able to craft a PEM input that triggers it.

**Additional Details:**

- The vulnerability was discovered via fuzzing.
- The size of PEM data required to trigger the vulnerability is relatively large. The provided example mentions an ~856kB input causing a 750ms delay on an M2 Max Macbook Pro.
- The vulnerability exists due to an upstream issue in the Go standard library ([golang/go#50116](https://github.com/golang/go/issues/50116)).
- The vulnerability affects all versions of cert-manager released before the patches (v1.16.2, v1.15.4, and v1.12.14).
- The fix involves setting a maximum size for PEM inputs and removing calls to `pem.Decode()` in non-test code.
- The vulnerability has been assigned the GitHub Security Advisory ID GHSA-r4pg-vg54-wxx4.
- Patches are available in cert-manager versions v1.16.2, v1.15.4, and v1.12.14, and corresponding pull requests are linked: [#7400](https://github.com/cert-manager/cert-manager/pull/7400), [#7401](https://github.com/cert-manager/cert-manager/pull/7401), [#7402](https://github.com/cert-manager/cert-manager/pull/7402), and [#7403](https://github.com/cert-manager/cert-manager/pull/7403).
- Secondary defense includes ensuring sensible RBAC to limit the ability for unauthorized users to modify resources containing PEM data.

The provided content gives more context than the official CVE description by providing insights into the attack vector, the specific function vulnerable, the scale of the problem, and the fixes implemented.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.122 |
| 2 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.121 |
| 3 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.120 |
| 4 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.116 |
| 5 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.115 |
| 6 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.115 |
| 7 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.113 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.113 |
| 9 | 295 | Improper Certificate Validation | Base | Allowed | dense | 0.524 |
| 10 | 370 | Missing Check for Certificate Revocation after Initial Check | Variant | Allowed | graph | 0.002 |

