# Vulnerability Information: CVE-2024-5535

## Vulnerability Description
Issue summary **Calling the OpenSSL API function SSL_select_next_proto with an empty supported client protocols buffer** may cause a crash or memory contents to be sent to the peer. Impact summary A **buffer overread** can have a range of potential consequences such as unexpected application beahviour or a crash. In particular this issue could result in up to 255 bytes of arbitrary private data from memory being sent to the peer leading to a loss of confidentiality. However, only applications that directly call the SSL_select_next_proto function with a 0 length list of supported client protocols are affected by this issue. This would normally never be a valid scenario and is typically not under attacker control but may occur by accident in the case of a configuration or programming error in the calling application. The OpenSSL API function SSL_select_next_proto is typically used by TLS applications that support ALPN (Application Layer Protocol Negotiation) or NPN (Next Protocol Negotiation). NPN is older, was never standardised and is deprecated in favour of ALPN. We believe that ALPN is significantly more widely deployed than NPN. The SSL_select_next_proto function accepts a list of protocols from the server and a list of protocols from the client and returns the first protocol that appears in the server list that also appears in the client list. In the case of no overlap between the two lists it returns the first item in the client list. In either case it will signal whether an

### Vulnerability Description Key Phrases
- **rootcause:** **Calling the OpenSSL API function SSL_select_next_proto with an empty supported client protocols buffer**
- **weakness:** **buffer overread**
- **impact:** cause a crash and crash or memory contents to be sent to the peer and loss of confidentiality
- **product:** OpenSSL
- **component:** SSL_select_next_proto function

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-5535

**Root Cause:** The `SSL_select_next_proto` function in OpenSSL fails to properly handle a zero-length client protocol list. This results in a buffer over-read, as the function returns a pointer to memory immediately following the provided client list.

**Weaknesses/Vulnerabilities:**
*   **Buffer Over-read:** The primary vulnerability is a buffer over-read, where the function reads data beyond the allocated buffer.
*   **Lack of Input Validation:** The `SSL_select_next_proto` function does not validate the length of the client protocol list, allowing a zero-length list to be processed.

**Impact of Exploitation:**
*   **Information Disclosure:** Up to 255 bytes of arbitrary private data from memory can be sent to the peer, leading to a loss of confidentiality.
*   **Crash:** The buffer over-read can cause a crash, leading to a denial of service.

**Attack Vectors:**
*   The vulnerability is triggered when the `SSL_select_next_proto` function is called with a zero-length client protocol list. This can occur in two scenarios:
    *   **NPN:** When used with NPN, a zero-length client list will cause the function to return an invalid memory pointer.
    *   **ALPN:** When used with ALPN, the application must incorrectly supply the zero length server list as the client list and also not handle the "no overlap" response.

**Required Attacker Capabilities/Position:**
*   The attacker must be able to cause the `SSL_select_next_proto` function to be called with a zero-length client protocol list. This typically involves a configuration or programming error in the application. It is not typically under attacker control making active exploitation unlikely.
*   The attacker would likely be a peer in a TLS connection with the vulnerable application, which is acting as a server or client depending on the application type (ALPN or NPN).

**Additional Information:**

*   The vulnerability affects OpenSSL versions 3.3, 3.2, 3.1, 3.0, 1.1.1, and 1.0.2.
*   The vulnerability is considered low severity because it requires an application configuration or programming error and is not typically under attacker control.
*   The vulnerability is primarily relevant for applications using NPN (Next Protocol Negotiation), which is less widely deployed than ALPN (Application Layer Protocol Negotiation).
*   The FIPS modules in OpenSSL are not affected.
*   Patches for the vulnerability are available in specific commits in the OpenSSL git repository.
*   NetApp products that incorporate vulnerable versions of OpenSSL are also affected.
*   Python 3.9 and earlier versions are vulnerable if built with NPN enabled OpenSSL, due to an improper handling of an empty protocol list.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 1.407 |
| 2 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 1.402 |
| 3 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 1.396 |
| 4 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 1.367 |
| 5 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | sparse | 1.355 |
| 6 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 1.329 |
| 7 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 1.319 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 1.311 |
| 9 | 757 | Selection of Less-Secure Algorithm During Negotiation ('Algorithm Downgrade') | Base | Allowed | dense | 0.512 |
| 10 | 208 | Observable Timing Discrepancy | Base | Allowed | graph | 0.002 |

