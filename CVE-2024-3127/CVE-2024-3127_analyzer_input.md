# Vulnerability Information: CVE-2024-3127

## Vulnerability Description
An issue has been discovered in GitLab EE affecting all versions starting from 12.5 before 17.1.6, all versions starting from 17.2 before 17.2.4, all versions starting from 17.3 before 17.3.1. Under certain conditions it may be possible to bypass the IP restriction for groups through GraphQL allowing unauthorised users to perform some actions at the group level.

### Vulnerability Description Key Phrases
- **impact:** bypass the IP restriction for groups through GraphQL
- **attacker:** unauthorised users
- **product:** GitLab EE
- **version:** 12.5 to 17.1.6, 17.2 to 17.2.4, 17.3 to 17.3.1

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

The root cause is a bypass in IP address restrictions implemented by GitLab. While the intention is to block users from specified IP addresses from accessing group resources, the GraphQL API endpoint `/api/graphql` did not enforce these restrictions, allowing users from blocked IPs to create group epics.

**Weaknesses/Vulnerabilities:**

*   **Insufficient Access Control:** The primary weakness is the failure to apply IP-based access restrictions consistently across all access points, specifically the GraphQL API. The restriction was implemented at the application level (web UI) but not the API layer.
*   **GraphQL API Bypass:** The GraphQL API allowed a user with developer role to create group epics, even though their IP address was blocked by the group owner.

**Impact of Exploitation:**

*   **Unauthorized Data Modification:** An attacker with a developer role but from a blocked IP address could bypass the intended access restrictions and create group epics.
*   **Circumvention of Security Controls:** The vulnerability undermines the IP address blocking feature, allowing users who should be completely restricted to access and modify group resources.

**Attack Vectors:**

*   **Network-based:** The attack vector is over the network by sending a crafted GraphQL POST request to the `/api/graphql` endpoint.

**Required Attacker Capabilities/Position:**

*   **GitLab Account with Developer Role:** The attacker needs to have a user account with a developer role within a GitLab group.
*   **Blocked IP Address:** The attacker's IP address must be included in the group's blocked IP address list.
*   **Ability to Craft API Request:** The attacker needs to be able to craft a GraphQL request to create a group epic.

**Additional Information:**

*   The report was submitted by `0x777` on 2024-02-29.
*   The vulnerable endpoint is `/api/graphql`.
*   The vulnerability was reproducible using a specific GraphQL mutation.

This report provides significantly more detail than the placeholder CVE description, including the specific API endpoint, steps to reproduce, and a detailed impact assessment.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.134 |
| 2 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.133 |
| 3 | 696 | Incorrect Behavior Order | Class | Allowed-with-Review | sparse | 0.131 |
| 4 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.122 |
| 5 | 267 | Privilege Defined With Unsafe Actions | Base | Allowed | sparse | 0.115 |
| 6 | 1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | sparse | 0.115 |
| 7 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.115 |
| 8 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.113 |
| 9 | 842 | Placement of User into Incorrect Group | Base | Allowed | dense | 0.512 |
| 10 | 410 | Insufficient Resource Pool | Base | Allowed | graph | 0.002 |

