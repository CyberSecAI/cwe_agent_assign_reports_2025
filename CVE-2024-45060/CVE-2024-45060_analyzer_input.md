# Vulnerability Information: CVE-2024-45060

## Vulnerability Description
PHPSpreadsheet is a pure PHP library for reading and writing spreadsheet files. One of the sample scripts in PhpSpreadsheet is susceptible to a **cross-site scripting** (XSS) vulnerability due to improper handling of input where a number is expected leading to formula injection. The code in in `45_Quadratic_equation_solver.php` concatenates the user supplied parameters directly into spreadsheet formulas. This allows an attacker to take control over the formula and output unsanitized data into the page, resulting in JavaScript execution. This issue has been addressed in release versions 1.29.2, 2.1.1, and 2.3.0. All users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input handling**
- **weakness:** **cross-site scripting**
- **impact:** formula injection
- **product:** PHPSpreadsheet
- **component:** 45_Quadratic_equation_solver.php

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-45060.

**Root cause of vulnerability:**
The vulnerability exists due to improper handling of user-supplied input in the `45_Quadratic_equation_solver.php` sample script. The script concatenates user-provided parameters directly into spreadsheet formulas without sanitization.

**Weaknesses/vulnerabilities present:**
- Cross-Site Scripting (XSS) vulnerability.
- Formula injection is possible due to the lack of input sanitization.

**Impact of exploitation:**
- An attacker can inject arbitrary JavaScript code into the page by manipulating the spreadsheet formulas.
- This can lead to various attacks, including but not limited to:
    - Data exfiltration
    - Session hijacking
    - Defacement
    - Redirection to malicious sites

**Attack vectors:**
- Network-based attack, performed by sending a specially crafted HTTP POST request with malicious input values for parameters A, B and C when accessing `45_Quadratic_equation_solver.php`.

**Required attacker capabilities/position:**
- The attacker needs to be able to access the vulnerable `45_Quadratic_equation_solver.php` script through a web browser.
- The attacker does not require any special privileges.
- User interaction is required to submit the malicious input via the form on the page.

**Additional details:**
- The vulnerability is present in the sample file `45_Quadratic_equation_solver.php`.
- Affected versions:
    - >= 2.2.0, < 2.3.0
    - < 1.29.2
    - >= 2.0.0, < 2.1.1
- Patched versions:
    - 2.3.0
    - 1.29.2
    - 2.1.1
- The provided PoC demonstrates how to inject JavaScript code by manipulating the 'a' parameter.
- The suggested remediation is to ensure that the parameters are forced to be numerical values using `floatval()` function.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1236 | Improper Neutralization of Formula Elements in a CSV File | Base | Allowed | sparse | 0.653 |
| 2 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.643 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.639 |
| 4 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.636 |
| 5 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.584 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.578 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.576 |
| 8 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.575 |
| 9 | 80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | dense | 0.502 |
| 10 | 494 | Download of Code Without Integrity Check | Base | Allowed | graph | 0.002 |

