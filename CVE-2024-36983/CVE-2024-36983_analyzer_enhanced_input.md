## Vulnerability Description
In Splunk Enterprise versions below 9.2.2, 9.1.5, and 9.0.10 and Splunk Cloud Platform versions below 9.1.2312.109 and 9.1.2308.207, an authenticated user could create an external lookup that calls a legacy internal function. The authenticated user could use this internal function to insert code into the Splunk platform installation directory. From there, the user could execute arbitrary code on the Splunk platform Instance.

### Vulnerability Description Key Phrases
- **impact:** arbitrary code execution and execute arbitrary code
- **vector:** create an external lookup that calls a legacy internal function
- **attacker:** authenticated user
- **product:** ['Splunk Enterprise' and 'Splunk Cloud Platform']
- **version:** ['below 9.2.2 and 9.1.5 and and 9.0.10' and 'below 9.1.2312.109 and 9.1.2308.207']

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of CVE-2024-36983:

**Root Cause:**

*   The vulnerability stems from the use of a deprecated internal function, `runshellscript`, within scripted alert actions, in combination with external command lookups.

**Weaknesses/Vulnerabilities:**

*   **Command Injection:** Authenticated users can create external lookups that call the deprecated `runshellscript` function. This allows them to inject arbitrary code into the Splunk platform's installation directory.
*   **Insecure Use of Deprecated Function:** The `runshellscript` command, intended for internal use, is being exposed through external lookups.
*   **Lack of Input Sanitization:** The vulnerability implies that user-supplied input to the external lookup is not properly sanitized or validated before being used to construct commands executed on the system.

**Impact of Exploitation:**

*   **Arbitrary Code Execution (ACE):** Successful exploitation allows an attacker to execute arbitrary code on the Splunk platform instance, within a privileged context.
*   **System Compromise:** This could lead to complete system compromise, data loss, unauthorized data transfer, and other malicious activities.

**Attack Vectors:**

*   **Network:** The attack vector is network-based (AV:N).
*   **External Lookups:**  The vulnerability is triggered by creating a malicious external lookup.
*   **User Interaction (UI):** The attack requires user interaction (UI:R) as the attacker needs to configure the malicious external lookup.

**Required Attacker Capabilities/Position:**

*   **Authenticated Access:** The attacker needs to be an authenticated user with the ability to create external lookups (PR:L).
*   **Knowledge of Deprecated Function:** The attacker must be aware of the `runshellscript` function and how to call it using an external lookup.

**Additional Details:**
*   The vulnerability is rated as high severity (8.0) with a CVSSv3.1 vector of CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H.
*   The affected versions are Splunk Enterprise below 9.2.2, 9.1.5, and 9.0.10, and Splunk Cloud Platform versions below 9.1.2312.109 and 9.1.2308.207.
*   The provided detection query helps identify the usage of the vulnerable command `runshellscript` along with other risky commands such as `collect`, `delete` and `sendemail`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.121 |
| 2 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.118 |
| 3 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.116 |
| 4 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.115 |
| 5 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.114 |
| 6 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.114 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.114 |
| 8 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.114 |
| 9 | 426 | Untrusted Search Path | Base | Allowed | dense | 0.478 |
| 10 | 427 | Uncontrolled Search Path Element | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-732: Incorrect Permission Assignment for Critical Resource

CWE-200: Exposure of Sensitive Information to an Unauthorized Actor

CWE-23: Relative Path Traversal

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-502: Deserialization of Untrusted Data

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-426: Untrusted Search Path

CWE-427: Uncontrolled Search Path Element