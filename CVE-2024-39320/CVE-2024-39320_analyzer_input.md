# Vulnerability Information: CVE-2024-39320

## Vulnerability Description
Discourse is an open source discussion platform. Prior to 3.2.5 and 3.3.0.beta5, the vulnerability allows an attacker to inject iframes from any domain, bypassing the intended restrictions enforced by the allowed_iframes setting. This vulnerability is fixed in 3.2.5 and 3.3.0.beta5.

### Vulnerability Description Key Phrases
- **impact:** inject iframes from any domain
- **attacker:** attacker
- **product:** Discourse
- **version:** Prior to 3.2.5 and 3.3.0.beta5

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The vulnerability arises from the way Discourse handles the `allowed_iframes` site setting. It was discovered that the application did not enforce a strict format for URLs listed in this setting, specifically not requiring a trailing slash in the URL. This lack of enforcement allowed an attacker to bypass the intended restrictions by injecting iframes from domains not explicitly included in the `allowed_iframes` list.",
    "weaknesses": [
      "Improper input validation",
       "Insufficient URL format enforcement"
    ],
    "impact": "An attacker could inject iframes from arbitrary domains, which could potentially lead to various malicious activities, such as phishing, cross-site scripting (XSS), or other forms of attacks, by embedding malicious content within iframes.",
    "attack_vectors": "The vulnerability can be exploited by manipulating the `allowed_iframes` site setting. If a user inputs an iframe URL without the trailing slash, the system would interpret any URL that starts with this value as valid.",
      "required_attacker_capabilities": "The attacker needs to have the ability to modify the `allowed_iframes` site setting, which typically requires administrator or moderator privileges. However, an attacker might also exploit this using other vulnerabilities or social engineering techniques if available to gain such access. It is also possible to exploit this vulnerability if an administrator accidentally sets an improper `allowed_iframes` value (without the necessary trailing slash)."
  },
  "fixes": [
    "The fix involves updating the Discourse code to ensure that URLs in the `allowed_iframes` setting must have at least three slashes (e.g., `https://example.com/`) to be considered valid. This ensures that only URLs with a trailing slash are allowed, thus preventing the injection of iframes from unintended domains.",
      "The default value for the `allowed_iframes` setting was also updated to include a trailing slash for each URL."
  ]
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.097 |
| 2 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.094 |
| 3 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.090 |
| 4 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.090 |
| 5 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.089 |
| 6 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.087 |
| 7 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.085 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.084 |
| 9 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | dense | 0.498 |
| 10 | 494 | Download of Code Without Integrity Check | Base | Allowed | graph | 0.002 |

