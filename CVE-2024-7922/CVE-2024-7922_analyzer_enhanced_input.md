## Vulnerability Description
A vulnerability was found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240814 and classified as critical. Affected by this issue is the function cgi_audio_search/cgi_create_playlist/cgi_get_album_all_tracks/cgi_get_alltracks_editlist/cgi_get_artist_all_album/cgi_get_genre_all_tracks/cgi_get_tracks_list/cgi_set_airplay_content/cgi_write_playlist of the file /cgi-bin/myMusic.cgi. The manipulation leads to **command injection**. The attack may be launched remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** D-Link DNS-120 and DNR-202L and DNS-315L and DNS-320 and DNS-320L and DNS-320LW and DNS-321 and DNR-322L and DNS-323 and DNS-325 and DNS-326 and DNS-327L and DNR-326 and DNS-340L and DNS-343 and DNS-345 and DNS-726-4 and DNS-1100-4 and DNS-1200-05 and DNS-1550-04
- **version:** up to 20240814
- **component:** /cgi-bin/myMusic.cgi

## CVE Reference Links Content Summary
The provided content relates to command injection vulnerabilities affecting D-Link NAS devices. Here's a breakdown of the relevant information:

**CVE-2024-7922** is not mentioned in the provided text. However, the content describes a command injection vulnerability affecting D-Link NAS devices, specifically the DNS-320/320L/321/323/325/327L models, which may be related to this CVE.

**Root Cause of Vulnerability:**
- The vulnerability stems from a command injection flaw in the `cgi_create_playlist` function within the `/cgi-bin/myMusic.cgi` file.
- The `artist` variable, passed via a POST request, is used in a `sprintf` function to construct a command, which is then executed by the `system` command.
- The `SpecSymbol2BackSlash` function, intended to sanitize special characters, fails to do so, enabling command execution through crafted input.

**Weaknesses/Vulnerabilities Present:**
- Command injection vulnerability in the `myMusic.cgi` file, specifically in the handling of the `artist` parameter within the `cgi_create_playlist` function.
- Insufficient input sanitization. The `SpecSymbol2BackSlash` function fails to prevent the execution of arbitrary commands.

**Impact of Exploitation:**
- Remote attackers can execute arbitrary system commands on the affected devices.
- This could lead to complete device compromise, including data theft, malware installation, denial of service, and other malicious activities.

**Attack Vectors:**
- The vulnerability is exploitable through a specially crafted POST request to the `/cgi-bin/myMusic.cgi` endpoint.
- The attacker needs to include malicious commands within the `artist` parameter of the POST request.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to send POST requests to the vulnerable device.
- The attacker does not need to be authenticated.
- The attacker needs to know the vulnerable endpoint and parameters.

**Additional Notes:**
- The D-Link security advisory (SAP10383) confirms that several D-Link NAS devices, including those listed above, are affected by command injection vulnerabilities. It attributes one such vulnerability to the "BuaaIOTTeam", which also published the technical details about `/cgi-bin/myMusic.cgi`.
- These devices have reached their End of Life (EOL)/End of Service Life (EOS) and D-Link is no longer providing security patches or support.
- D-Link recommends that users retire and replace these devices.
- The VulDB entry [275108] is likely related to this vulnerability and mentions `/cgi-bin/myMusic.cgi`.

The provided content gives more specific information than the CVE description placeholder, detailing the vulnerable file and function, the attack vector, and impact. It also confirms the affected models and their end-of-life status.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.714 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.673 |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.651 |
| 6 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.645 |
| 7 | 350 | Reliance on Reverse DNS Resolution for a Security-Critical Action | Variant | Allowed | sparse | 0.637 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.637 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.665 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-346: Origin Validation Error

CWE-330: Use of Insufficiently Random Values

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-359: Exposure of Private Personal Information to an Unauthorized Actor

CWE-350: Reliance on Reverse DNS Resolution for a Security-Critical Action

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-790: Improper Filtering of Special Elements

CWE-322: Key Exchange without Entity Authentication