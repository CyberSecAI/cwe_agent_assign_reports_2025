# Vulnerability Information: CVE-2024-49968

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved ext4 filesystems without casefold feature cannot be mounted with siphash When mounting the ext4 filesystem, if the default hash version is set to DX_HASH_SIPHASH but the casefold feature is not set, exit the mounting.

### Vulnerability Description Key Phrases
- **impact:** exit the mounting
- **product:** Linux kernel
- **component:** ext4 filesystems without casefold feature

## CVE Reference Links Content Summary
The provided content relates to a fix for a vulnerability in the Linux kernel's ext4 filesystem driver. The fix prevents mounting an ext4 filesystem with the `siphash` hash version set as default if the `casefold` feature is not also enabled.

Here's a breakdown of the relevant information:

**Root Cause:**
- The vulnerability stems from allowing the `siphash` hash version to be used on ext4 filesystems that do not have the `casefold` feature enabled. This is problematic because the `siphash` hash function is intended to be used with the `casefold` feature.

**Weaknesses/Vulnerabilities:**
- The core vulnerability is a missing check during the mounting of ext4 filesystems, where a configuration mismatch between the default hash version and supported features is not being enforced.
- Specifically, it was possible to set the default hash version to `DX_HASH_SIPHASH` without requiring the `casefold` feature to be set on the filesystem.

**Impact of Exploitation:**
- This issue, while not directly allowing remote code execution, could lead to mounting failures.
- The content indicates that a syzbot identified this issue, which hints that it could possibly be used in some form of DoS if the attacker could force mount attempts under specific conditions.
- The more serious implication would likely be a crash or unexpected behavior by forcing the kernel to use the siphash hashing method on filesystems where it's not intended to be used, leading to undefined behavior.

**Attack Vectors:**
- The attack vector is through mounting an ext4 filesystem with a specific configuration where the `s_def_hash_version` is set to `DX_HASH_SIPHASH` while the `casefold` feature is not enabled.
- This could be achieved by modifying filesystem images or creating malicious filesystem images.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to create or modify ext4 filesystem images with specific features set and then cause the system to mount such a modified image.
- This would typically require some level of access, likely local, to be able to mount an arbitrary image on the target.
- It's likely that user with mount privileges is needed to exploit this issue.

**Additional Details:**
- The fix involves adding a check in `fs/ext4/super.c` within the `ext4_feature_set_ok` function to ensure that if the default hash version is `DX_HASH_SIPHASH`, the `casefold` feature must also be set.
- The patch prevents the mount operation if this condition is not met, and it will produce an error message in the kernel logs.
- The original commit introducing this issue is not directly mentioned, so the vulnerability exists in the kernel versions prior to the provided patch.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1335 | Incorrect Bitwise Shift of Integer | Base | Allowed | sparse | 0.073 |
| 2 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.070 |
| 3 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.070 |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.069 |
| 5 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.069 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.068 |
| 7 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | sparse | 0.068 |
| 8 | 24 | Path Traversal: '../filedir' | Variant | Allowed | sparse | 0.068 |
| 9 | 328 | Use of Weak Hash | Base | Allowed | dense | 0.388 |
| 10 | 386 | Symbolic Name not Mapping to Correct Object | Base | Allowed | graph | 0.002 |

