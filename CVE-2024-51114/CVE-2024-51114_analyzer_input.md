# Vulnerability Information: CVE-2024-51114

## Vulnerability Description
An issue in Beijing Digital China Yunke Information Technology Co.Ltd v.7.2.6.120 allows a remote attacker to execute arbitrary code via the code/function/dpi/web_auth/customizable.php file

### Vulnerability Description Key Phrases
- **impact:** execute arbitrary code
- **attacker:** remote attacker
- **product:** Beijing Digital China Yunke Information Technology Co.Ltd
- **version:** v.7.2.6.120
- **component:** code/function/dpi/web_auth/customizable.php file

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

*   **Root cause of vulnerability:** The vulnerability stems from the lack of proper input sanitization of the `img` parameter in the `customizable.php` file. The value of this parameter is directly passed to the `exec` function without any validation, allowing for command injection.

*   **Weaknesses/vulnerabilities present:**
    *   **Command Injection:** The primary vulnerability is a command injection flaw.  The application uses user-supplied data to construct a system command. Because the data is not sanitized, an attacker can inject arbitrary commands that will be executed by the system.
    *   **Lack of Input Sanitization:** The code doesn't sanitize or validate the `img` parameter before using it in the `exec` function.
*   **Impact of exploitation:** Successful exploitation allows an attacker to execute arbitrary system commands with the privileges of the web server process. This can lead to:
    *   Full system compromise
    *   Data exfiltration or manipulation.
    *   Denial of service
    *   Privilege escalation.
*   **Attack vectors:**
    *   **HTTP POST Request:** The attacker sends a specially crafted POST request to the `/function/dpi/web_auth/customizable.php` endpoint with a malicious payload in the `img` parameter. The `multipart/form-data` content type is used, which is expected by the target script.
*   **Required attacker capabilities/position:**
    *   **Network Access:** The attacker needs to have network access to the vulnerable firewall device.
    *   **Authentication (in some cases):** While the provided exploit does not explicitly demonstrate authentication, it does rely on an active session by setting a cookie, so authentication may be needed to exploit the vulnerability if the target application requires it.

**Additional details:**

*   The specific vulnerable code snippet is within the `customizable.php` file, where the `getVar` function retrieves the `img` parameter value, and this value is later used in an `exec` function without any sanitization.
*   The provided Proof of Concept (POC) demonstrates how to inject a command that writes the output of `id` command to a file named `1.txt`. The attacker can then access `1.txt` via the web to verify command execution.
*   The vulnerability affects version 7.2.6.120 of the vendor firewall.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 439 | Behavioral Change in New Version or Environment | Base | Allowed | alternate_terms | 0.700 |
| 2 | 426 | Untrusted Search Path | Base | Allowed | sparse | 0.052 |
| 3 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | sparse | 0.049 |
| 4 | 425 | Direct Request ('Forced Browsing') | Base | Allowed | sparse | 0.048 |
| 5 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.047 |
| 6 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.046 |
| 7 | 130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | sparse | 0.043 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.042 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.557 |
| 10 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | graph | 0.003 |

