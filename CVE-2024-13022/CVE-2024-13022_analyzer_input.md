# Vulnerability Information: CVE-2024-13022

## Vulnerability Description
A vulnerability, which was classified as critical, was found in taisan tarzan-cms 1.0.0. This affects the function UploadResponse of the file src/main/java/com/tarzan/cms/modules/admin/controller/common/UploadController.java of the component Article Management. The manipulation of the argument file leads to **unrestricted upload**. It is possible to initiate the attack remotely. The exploit has been disclosed to the public and may be used.

### Vulnerability Description Key Phrases
- **weakness:** **unrestricted upload**
- **product:** taisan tarzan-cms
- **version:** 1.0.0
- **component:** function UploadResponse of the file src/main/java/com/tarzan/cms/modules/admin/controller/common/UploadController.java

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause of Vulnerability:**
The vulnerability stems from the lack of proper file content validation in the `OssService.upload` method. This method receives a `MultipartFile` object, checks only if it's null, and then proceeds to store the file without verifying its content or type.

**Weaknesses/Vulnerabilities Present:**
- **Arbitrary File Upload:** The primary weakness is the ability to upload any type of file, including potentially executable ones like `.jsp`, `.php`, or `.html`, as well as malicious files.
- **Lack of Content Validation:** The code lacks checks to validate the file's content, extension, or MIME type.
- **Insufficient Input Sanitization:**  The file name and contents are not sanitized, making it possible to upload files with malicious names or embedded code.

**Impact of Exploitation:**
- **Remote Code Execution (RCE):** By uploading malicious files (e.g., a JSP file containing server-side code) an attacker could execute arbitrary code on the server, potentially gaining complete control of the system.
- **Website Defacement:** Attackers could upload files to deface the website or inject malicious scripts to redirect users to malicious sites or steal user data.
- **Data Breaches:**  If the attacker gains access to the server they could potentially access sensitive data stored on the system.

**Attack Vectors:**
- **Web Interface:** The attack vector involves the `/upload` endpoint, accessible through the article management section in the application's web interface.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to access the `/upload` endpoint which appears to be behind authentication.
- The attacker needs to be able to intercept and modify HTTP requests to change the filename and potentially the contents of the file being uploaded.
- Basic understanding of HTTP requests and web application interaction.
- Knowledge of how to create malicious files (e.g., JSP, PHP).

**Additional Notes:**

- The provided code snippets and screenshots directly show the vulnerability in the `UploadController` and `OssService` classes.
- The issue was reported in the gitee repository issues section for the `tarzan-cms` project, which validates the report's relevance.
- The attack involves intercepting the file upload request, modifying the filename and potentially the contents, and submitting the modified request to upload malicious file.
- The report also provides the repository name: `taisan/tarzan-cms`,  and the specific vulnerable files within the repository `src/main/java/com/tarzan/cms/modules/admin/controller/common/UploadController.java` and `src/main/java/com/tarzan/cms/modules/admin/service/common/OssService.java`

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.459 |
| 2 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.442 |
| 3 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.440 |
| 4 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.395 |
| 5 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.380 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.370 |
| 7 | 1241 | Use of Predictable Algorithm in Random Number Generator | Base | Allowed | sparse | 0.354 |
| 8 | 1391 | Use of Weak Credentials | Class | Allowed-with-Review | sparse | 0.351 |
| 9 | 646 | Reliance on File Name or Extension of Externally-Supplied File | Variant | Allowed | dense | 0.564 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

