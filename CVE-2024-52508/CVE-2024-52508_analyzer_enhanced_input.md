## Vulnerability Description
Nextcloud Mail is the mail app for Nextcloud, a self-hosted productivity platform. When a user is trying to set up a mail account with an email address like user@example.tld that does not support auto configuration, and an attacker managed to register autoconfig.tld, the used email details would be send to the server of the attacker. It is recommended that the Nextcloud Mail app is upgraded to 1.14.6, 1.15.4, 2.2.11, 3.6.3, 3.7.7 or 4.0.0.

### Vulnerability Description Key Phrases
- **impact:** send user email details to attacker server
- **attacker:** attacker
- **product:** Nextcloud Mail

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root cause of vulnerability:**
The Nextcloud Mail app's auto-configuration feature, when it cannot find an automatic configuration for a given email domain, falls back to querying a generic domain `autoconfig.tld`. If an attacker registers this domain, they can intercept the email details sent by the vulnerable Nextcloud instance.

**Weaknesses/vulnerabilities present:**
- **Information Disclosure:** The application sends sensitive email account details (including email address) to a third-party domain when auto-configuration fails.
- **Lack of Input Validation/Sanitization:** The application does not validate if the fallback domain used for auto-configuration is legitimate, allowing it to be potentially hijacked.
- **Reliance on Potentially Unsafe Fallback:** The reliance on a generic domain (`autoconfig.tld`) for auto-configuration fallback is a design weakness, as it can be registered by anyone.

**Impact of exploitation:**
- **Confidentiality Breach:** Attackers can gain access to users' email addresses and potentially other email account details, which can be used for various malicious purposes such as phishing or spam campaigns.
- **Potential for Phishing:** Attackers can use intercepted information to craft targeted phishing attacks.
- **Compromised Account Security:** The information disclosure could lead to compromised email accounts.

**Attack vectors:**
- **Network:** The vulnerability is exploited over the network when a Nextcloud Mail app attempts to configure an account and the auto-configuration fails for the given domain.
- **DNS Hijacking:**  The attacker gains control of the domain `autoconfig.tld` to intercept requests.

**Required attacker capabilities/position:**
- **Domain Registration:** The attacker needs to register the domain `autoconfig.tld` (or a similar domain used by the app) .
- **Network Access:** The attacker does not need access to the victim's network or system, just the ability to intercept DNS requests for `autoconfig.tld`.
- **User Interaction:** The user has to attempt to configure a mail account using an email address without a valid auto-configuration to trigger the vulnerability.

**Additional Details:**
- The vulnerability is triggered when no auto-configuration is found, not during normal operation.
- The fix involves not relying on the `autoconfig.tld` fallback mechanism by refactoring the DNS lookup and using a public suffix list, as seen in the provided commit.
- The vulnerability affects multiple versions of the Nextcloud Mail app.
- The severity of the vulnerability is rated as high.
- The vulnerability is related to CWE-200: Information Exposure.
- The fix was backported to multiple stable versions of the application.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.191 |
| 2 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.188 |
| 3 | 209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | sparse | 0.184 |
| 4 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.180 |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.178 |
| 6 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 0.177 |
| 7 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.175 |
| 8 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.174 |
| 9 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | dense | 0.330 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-209: Generation of Error Message Containing Sensitive Information

CWE-1390: Weak Authentication

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-295: Improper Certificate Validation

CWE-532: Insertion of Sensitive Information into Log File

CWE-862: Missing Authorization

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-322: Key Exchange without Entity Authentication