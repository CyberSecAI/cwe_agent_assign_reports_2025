## Vulnerability Description
The WordPress Simple HTML Sitemap plugin for WordPress is vulnerable to SQL Injection via the id parameter in all versions up to, and including, 3.1 due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**. This makes it possible for authenticated attackers, with Administrator-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**
- **weakness:** **SQL injection**
- **impact:** extract sensitive information from the database
- **vector:** id parameter
- **attacker:** authenticated attackers with Administrator-level access
- **product:** WordPress Simple HTML Sitemap plugin
- **version:** up to and including 3.1

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**
The vulnerability stems from insufficient input sanitization and lack of proper preparation of SQL queries when handling the 'id' parameter in the WordPress Simple HTML Sitemap plugin. Specifically, the `esc_sql()` function was used incorrectly, allowing for SQL injection.

**Weaknesses/Vulnerabilities:**
- **SQL Injection:** The plugin is vulnerable to SQL injection due to the failure to properly sanitize the user-supplied 'id' parameter before using it in a database query.
- **Insufficient Input Sanitization:** The plugin uses `esc_sql()` which is intended for escaping data *within* a query string, but not for constructing the query itself, making the query vulnerable to SQL injection.

**Impact of Exploitation:**
- **Sensitive Data Exposure:** Attackers can potentially extract sensitive information from the database by injecting malicious SQL code.
- **Data Manipulation:** It might be possible for attackers to modify or delete data within the database.

**Attack Vectors:**
- **HTTP Request Parameter:** The vulnerability is triggered through the 'id' parameter within an HTTP request. The 'action' parameter must also be set to 'delete'.

**Required Attacker Capabilities/Position:**
- **Authentication:** Attackers need to be authenticated with administrative-level access or above to exploit the vulnerability.
- **Network Access:** The attacker must have network access to the WordPress site to send malicious requests.

**Technical Details:**
- The vulnerable code is located in `inc/wshs_saved.php` file, specifically when processing the delete action.
- The original vulnerable code used `$wpdb->query($wpdb->prepare("DELETE FROM $table_name WHERE id = ".esc_sql($id)));` which is incorrect as `esc_sql` is not suitable to sanitize query parts like the column value.
- The fix implemented in version 3.2 changed the query to:
   ```php
   $wpdb->query(
     $wpdb->prepare("DELETE FROM $table_name WHERE `id` = %d", esc_sql($id))
   );
   ```
  This uses the placeholder `%d` which ensures that the input `$id` is treated as an integer in the query, preventing SQL injection.

This content provides more specific technical details than the CVE description, including the vulnerable code snippet and how it was fixed.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.589 |
| 3 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.538 |
| 4 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | sparse | 0.509 |
| 5 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.506 |
| 6 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.506 |
| 7 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.505 |
| 8 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.505 |
| 9 | 425 | Direct Request ('Forced Browsing') | Base | Allowed | dense | 0.503 |
| 10 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-116: Improper Encoding or Escaping of Output

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-90: Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')

CWE-502: Deserialization of Untrusted Data

CWE-790: Improper Filtering of Special Elements

CWE-138: Improper Neutralization of Special Elements

CWE-862: Missing Authorization

CWE-425: Direct Request ('Forced Browsing')

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')