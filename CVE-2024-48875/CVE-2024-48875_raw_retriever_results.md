# Raw Retriever Results for CVE-2024-48875

# Raw Retriever Results for CVE-2024-48875
## Query
In the Linux kernel, the following vulnerability has been resolved btrfs dont take dev_replace rwsem on task already holding it Running fstests btrfs/011 with MKFS_OPTIONS=-O rst to force the usage of the RAID stripe-tree, we get the following splat from lockdep BTRFS info (device sdd) dev_replace from /dev/sdd (devid 1) to /dev/sdb started ============================================ WARNING possible recursive locking detected 6.11.0-rc3-btrfs-for-next #599 Not tainted -------------------------------------------- btrfs/2326 is trying to acquire lock ffff88810f215c98 (&fs_info->dev_replace.rwsem){++++}-{33}, at btrfs_map_block+0x39f/0x2250 but task is already holding lock ffff88810f215c98 (&fs_info->dev_replace.rwsem){++++}-{33}, at btrfs_map_block+0x39f/0x2250 other info that might help us debug this Possible unsafe locking scenario CPU0 ---- lock(&fs_info->dev_replace.rwsem) lock(&fs_info->dev_replace.rwsem) *** DEADLOCK *** May be due to missing lock nesting notation 1 lock held by btrfs/2326 #0 ffff88810f215c98 (&fs_info->dev_replace.rwsem){++++}-{33}, at btrfs_map_block+0x39f/0x2250 stack backtrace CPU 1 UID 0 PID 2326 Comm btrfs Not tainted 6.11.0-rc3-btrfs-for-next #599 Hardware name Bochs Bochs, BIOS Bochs 01/01/2011 Call Trace dump_stack_lvl+0x5b/0x80 __lock_acquire+0x2798/0x69d0 ? __pfx___lock_acquire+0x10/0x10 ? __pfx___lock_acquire+0x10/0x10 lock_acquire+0x19d/0x4a0 ? btrfs_map_block+0x39f/0x2250 ? __pfx_lock_acquire+0x10/0x10 ? find_held_lock+0x2d/0x110 ? lock_is_held_type+0x8f/0x100 down_read+0x8e/0x440 ? btrfs_map_block+0x39f/0x2250 ? __pfx_down_read+0x10/0x10 ? do_raw_read_unlock+0x44/0x70 ? _raw_read_unlock+0x23/0x40 btrfs_map_block+0x39f/0x2250 ? btrfs_dev_replace_by_ioctl+0xd69/0x1d00 ? btrfs_bio_counter_inc_blocked+0xd9/0x2e0 ? __kasan_slab_alloc+0x6e/0x70 ? __pfx_btrfs_map_block+0x10/0x10 ? __pfx_btrfs_bio_counter_inc_blocked+0x10/0x10 ? kmem_cache_alloc_noprof+0x1f2/0x300 ? mempool_alloc_noprof+0xed/0x2b0 btrfs_submit_chunk+0x28d/0x17e0 ? __pfx_btrfs_submit_chunk+0x10/0x10 ? bvec_alloc+0xd7/0x1b0 ? bio_add_folio+0x171/0x270 ? __pfx_bio_add_folio+0x10/0x10 ? __kasan_check_read+0x20/0x20 btrfs_submit_bio+0x37/0x80 read_extent_buffer_pages+0x3df/0x6c0 btrfs_read_extent_buffer+0x13e/0x5f0 read_tree_block+0x81/0xe0 read_block_for_search+0x4bd/0x7a0 ? __pfx_read_block_for_search+0x10/0x10 btrfs_search_slot+0x78d/0x2720 ? __pfx_btrfs_search_slot+0x10/0x10 ? lock_is_held_type+0x8f/0x100 ? kasan_save_track+0x14/0x30 ? __kasan_slab_alloc+0x6e/0x70 ? kmem_cache_alloc_noprof+0x1f2/0x300 btrfs_get_raid_extent_offset+0x181/0x820 ? __pfx_lock_acquire+0x10/0x10 ? __pfx_btrfs_get_raid_extent_offset+0x10/0x10 ? down_read+0x194/0x440 ? __pfx_down_read+0x10/0x10 ? do_raw_read_unlock+0x44/0x70 ? _raw_read_unlock+0x23/0x40 btrfs_map_block+0x5b5/0x2250 ? __pfx_btrfs_map_block+0x10/0x10 scrub_submit_initial_read+0x8fe/0x11b0 ? __pfx_scrub_submit_initial_read+0x10/0x10 submit_initial_group_read+0x161/0x3a0 ? lock_release+0x20e/0x710 ? __pfx_submit_initial_group_read+0x10/0x10 ? __pfx_lock_release+0x10/0x10 scrub_simple_mirror.isra.0+0x3eb/0x580 scrub_stripe+0xe4d/0x1440 ? lock_release+0x20e/0x710 ? __pfx_scrub_stripe+0x10/0x10 ? __pfx_lock_release+0x10/0x10 ? do_raw_read_unlock+0x44/0x70 ? _raw_read_unlock+0x23/0x40 scrub_chunk+0x257/0x4a0 scrub_enumerate_chunks+0x64c/0xf70 ? __mutex_unlock_slowpath+0x147/0x5f0 ? __pfx_scrub_enumerate_chunks+0x10/0x10 ? bit_wait_timeout+0xb0/0x170 ? __up_read+0x189/0x700 ? scrub_workers_get+0x231/0x300 ? up_write+0x490/0x4f0 btrfs_scrub_dev+0x52e/0xcd0 ? create_pending_snapshots+0x230/0x250 ? __pfx_btrfs_scrub_dev+0x10/0x10 btrfs_dev_replace_by_ioctl+0xd69/0x1d00 ? lock_acquire+0x19d/0x4a0 ? __pfx_btrfs_dev_replace_by_ioctl+0x10/0x10 ? ---truncated---

## Keyphrases
No keyphrases provided.

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4802 | 0.5651 | 0.5021 | 0.4951 | 20 |
| Sparse | 149.8720 | 248.5549 | 172.4163 | 158.9196 | 10 |
| Graph | 1.4784 | 2.3400 | 1.7247 | 1.6796 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.3400 | Allowed |
| 2 | 319 | Cleartext Transmission of Sensitive Information | base | 2.1190 | Allowed |
| 3 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 4 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | base | 1.7680 | Allowed |
| 5 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 6 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 7 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 8 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 9 | 833 | Deadlock | Base | 1.7074 | Allowed |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 11 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 12 | 20 | Improper Input Validation | class | 1.6736 | Discouraged |
| 13 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 14 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 1.6638 | Allowed |
| 15 | 770 | Allocation of Resources Without Limits or Throttling | Base | 1.6074 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 667 | Improper Locking | Class | 0.5651 | 0.5651 | Allowed-with-Review |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5484 | 0.5484 | Allowed-with-Review |
| 3 | 909 | Missing Initialization of Resource | Class | 0.5353 | 0.5353 | Allowed-with-Review |
| 4 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5145 | 0.5145 | Allowed |
| 5 | 833 | Deadlock | Base | 0.5123 | 0.5123 | Allowed |
| 6 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.5092 | 0.5092 | Allowed |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.5048 | 0.5048 | Allowed |
| 8 | 908 | Use of Uninitialized Resource | Base | 0.5033 | 0.5033 | Allowed |
| 9 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.4999 | 0.4999 | Discouraged |
| 10 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4957 | 0.4957 | Allowed |
| 11 | 126 | Buffer Over-read | Variant | 0.4946 | 0.4946 | Allowed |
| 12 | 125 | Out-of-bounds Read | Base | 0.4883 | 0.4883 | Allowed |
| 13 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.4870 | 0.4870 | Allowed |
| 14 | 190 | Integer Overflow or Wraparound | Base | 0.4865 | 0.4865 | Allowed |
| 15 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.4860 | 0.4860 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 667 | Improper Locking | 248.5549 | 248.5549 | Allowed-with-Review |
| 2 | 833 | Deadlock | 217.0996 | 217.0996 | Allowed |
| 3 | 1390 | Weak Authentication | 164.8948 | 164.8948 | Allowed-with-Review |
| 4 | 319 | Cleartext Transmission of Sensitive Information | 162.2017 | 162.2017 | Allowed |
| 5 | 770 | Allocation of Resources Without Limits or Throttling | 159.2981 | 159.2981 | Allowed |
| 6 | 674 | Uncontrolled Recursion | 158.5411 | 158.5411 | Allowed-with-Review |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 157.2324 | 157.2324 | Allowed-with-Review |
| 8 | 401 | Missing Release of Memory after Effective Lifetime | 156.5835 | 156.5835 | Allowed |
| 9 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | 149.8848 | 149.8848 | Allowed |
| 10 | 451 | User Interface (UI) Misrepresentation of Critical Information | 149.8720 | 149.8720 | Allowed-with-Review |
