## Vulnerability Description
In Eclipse Dataspace Components, from version 0.5.0 and before version 0.9.0, the **ConsumerPullTransferTokenValidationApiController does not check for token validity** (expiry, not-before, issuance date), which can allow an attacker to bypass the check for token expiration. The issue requires to have a dataplane configured to support http proxy consumer pull AND include the module transfer-data-plane. The affected code was marked deprecated from the version 0.6.0 in favour of Dataplane Signaling. In 0.9.0 the vulnerable code has been removed.

### Vulnerability Description Key Phrases
- **rootcause:** **ConsumerPullTransferTokenValidationApiController does not check for token validity**
- **impact:** bypass check for token expiration
- **attacker:** attacker
- **product:** Eclipse Dataspace Components
- **version:** 0.5.0 to 0.9.0
- **component:** ConsumerPullTransferTokenValidationApiController

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-8642:

**Root Cause of Vulnerability:**

The vulnerability stems from an incorrect implementation in the `ConsumerPullTransferTokenValidationApiController` of the Eclipse EDC. Specifically, the `TokenValidationService`'s `validate` method, which requires three arguments (token, public key resolver, and token validation rules), is called with only two arguments. The crucial third argument, which dictates the validation rules to be applied (including expiration checks), is missing, resulting in an empty list of rules. Consequently, only the token signature is verified, but not its expiration date.

**Weaknesses/Vulnerabilities Present:**

*   **Missing Expiration Check:** The primary weakness is the failure to enforce token expiration. The `ExpirationDateValidationRule` is not invoked, allowing expired tokens to be treated as valid.
*   **Incomplete Token Validation:** The token validation logic is incomplete, as it only checks the signature, not other time-based constraints.

**Impact of Exploitation:**

*   **Confidentiality Breach:** Data can be pulled from the provider or data sources can be queried by the consumer, even if the token has expired and the consumer should no longer have access. This exposes potentially sensitive information.
*   **Integrity Compromise:** Since "data transfers" in EDC can modify resources at the provider, attackers might be able to use expired tokens to make API calls (with payload) to the provider's data source, thus modifying resources beyond the permitted time window.
*   **Indefinite Access:** If a token is leaked, unauthorized entities can use it to access or modify resources indefinitely.
*   **Bypassing Permissions:** The vulnerability enables bypassing the intended permissions and access controls tied to token expiration.

**Attack Vectors:**

*   **Consumer Pull Endpoint:** The attack vector is the public (consumer pull) endpoint at the provider side.
*   **Expired Token Usage:** An attacker with a valid but expired token can continue using it to access data or interact with the provider's resources.
*   **Leaked Token Exploitation**: If a token is leaked, it can be used to access resources even by parties not intended to have access.

**Required Attacker Capabilities/Position:**

*   **Access to Consumer System:** The attacker needs access to a consumer system that has negotiated a contract agreement with a provider, and that has obtained an EDR (with a token) using the http proxy consumer pull method.
*   **Valid but Expired Token:** The attacker must have obtained a valid token at some point, which has since expired.
*  **Configuration of Http Proxy Feature**: For attacks threatening integrity, the proxyMethod/Path/Payload/... configuration needs to be enabled for the asset.

**Additional Details:**

*   The vulnerability is located in the `ConsumerPullTransferTokenValidationApiController` within the `org.eclipse.edc:transfer-data-plane` maven artifact.
*   The issue was introduced with version v0.5.0 of Eclipse EDC and remains in the main branch.
*   The vulnerability can be reproduced using the sample provided, if the correct version is used.
*   Mitigation involves blocking access to the public consumer pull endpoint until a fix is available.
*   The fix includes switching to `data-plane-public-api-v2` which does not use the vulnerable `ConsumerPullTransferTokenValidationApiController`.
*   CVSS score: CVSS:4.0/AV:N/AC:L/AT:P/PR:L/UI:N/VC:N/VI:N/VA:L/SC:H/SI:H/SA:L - 5.6 (Medium)

The provided information is more detailed than a typical CVE description, outlining the exact code location, the root cause and impact, making it more valuable for analysis.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.508 |
| 2 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.491 |
| 3 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.486 |
| 4 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.482 |
| 5 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.474 |
| 6 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.473 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.461 |
| 8 | 1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | sparse | 0.459 |
| 9 | 488 | Exposure of Data Element to Wrong Session | Base | Allowed | dense | 0.467 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-863: Incorrect Authorization

CWE-1390: Weak Authentication

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-287: Improper Authentication

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-285: Improper Authorization

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-1286: Improper Validation of Syntactic Correctness of Input

CWE-488: Exposure of Data Element to Wrong Session

CWE-226: Sensitive Information in Resource Not Removed Before Reuse