# Vulnerability Information: CVE-2024-39315

# Vulnerability Description

    Pomerium is an identity and context-aware access proxy. Prior to version 0.26.1, the Pomerium user info page (at `/.pomerium`) unintentionally included serialized OAuth2 access and ID tokens from the logged-in users session. These tokens are not intended to be exposed to end users. This issue may be more severe in the presence of a **cross-site scripting** vulnerability in an upstream application proxied through Pomerium. If an attacker could insert a malicious script onto a web page proxied through Pomerium, that script could access these tokens by making a request to the `/.pomerium` endpoint. Upstream applications that authenticate only the ID token may be vulnerable to user impersonation using a token obtained in this manner. Note that an OAuth2 access token or ID token by itself is not sufficient to hijack a users Pomerium session. Upstream applications should not be vulnerable to user impersonation via these tokens provided the application verifies the Pomerium JWT for each request, the connection between Pomerium and the application is secured by mTLS, or the connection between Pomerium and the application is otherwise secured at the network layer. The issue is patched in Pomerium v0.26.1. No known workarounds are available.

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## WEAKNESS: 'cross-site scripting'

Relevant CWEs for this WEAKNESS:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') (Score: 1080.10)

The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users....

### 4. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 5. CWE-639: Authorization Bypass Through User-Controlled Key (Score: 1018.63)

The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data....

## WEAKNESS: 'information exposure'

Relevant CWEs for this WEAKNESS:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-639: Authorization Bypass Through User-Controlled Key (Score: 1018.63)

The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data....

### 5. CWE-287: Improper Authentication (Score: 1011.10)

When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct....

## IMPACT: 'access serialized OAuth2 access and ID tokens'

Relevant CWEs for this IMPACT:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-287: Improper Authentication (Score: 1011.10)

When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct....

### 5. CWE-1390: Weak Authentication (Score: 384.84)

The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....

## IMPACT: 'impersonation'

Relevant CWEs for this IMPACT:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-287: Improper Authentication (Score: 1011.10)

When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct....

### 5. CWE-1390: Weak Authentication (Score: 384.84)

The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....

## PRODUCT: 'Pomerium'

Relevant CWEs for this PRODUCT:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-287: Improper Authentication (Score: 1011.10)

When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct....

### 5. CWE-1390: Weak Authentication (Score: 384.84)

The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....

## VERSION: 'prior to 0.26.1'

Relevant CWEs for this VERSION:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-639: Authorization Bypass Through User-Controlled Key (Score: 1018.63)

The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data....

### 5. CWE-287: Improper Authentication (Score: 1011.10)

When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct....

## COMPONENT: '/.pomerium endpoint'

Relevant CWEs for this COMPONENT:

### 1. CWE-489: Active Debug Code (Score: 1122.26)

The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information....

### 2. CWE-863: Incorrect Authorization (Score: 1102.24)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-201: Insertion of Sensitive Information Into Sent Data (Score: 1079.85)

The code transmits data to another actor, but a portion of the data includes sensitive information that should not be accessible to that actor....

### 4. CWE-639: Authorization Bypass Through User-Controlled Key (Score: 1018.63)

The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data....

### 5. CWE-923: Improper Restriction of Communication Channel to Intended Endpoints (Score: 360.08)

The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    