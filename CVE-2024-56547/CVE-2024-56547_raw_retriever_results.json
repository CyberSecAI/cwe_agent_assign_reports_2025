{
  "query": "In the Linux kernel, the following vulnerability has been resolved rcu/nocb Fix missed RCU barrier on deoffloading Currently, running rcutorture test with torture_type=rcu fwd_progress=8 n_barrier_cbs=8 nocbs_nthreads=8 nocbs_toggle=100 onoff_interval=60 test_boost=2, will trigger the following warning WARNING CPU 19 PID 100 at kernel/rcu/tree_nocb.h1061 rcu_nocb_rdp_deoffload+0x292/0x2a0 RIP 0010rcu_nocb_rdp_deoffload+0x292/0x2a0 Call Trace ? __warn+0x7e/0x120 ? rcu_nocb_rdp_deoffload+0x292/0x2a0 ? report_bug+0x18e/0x1a0 ? handle_bug+0x3d/0x70 ? exc_invalid_op+0x18/0x70 ? asm_exc_invalid_op+0x1a/0x20 ? rcu_nocb_rdp_deoffload+0x292/0x2a0 rcu_nocb_cpu_deoffload+0x70/0xa0 rcu_nocb_toggle+0x136/0x1c0 ? __pfx_rcu_nocb_toggle+0x10/0x10 kthread+0xd1/0x100 ? __pfx_kthread+0x10/0x10 ret_from_fork+0x2f/0x50 ? __pfx_kthread+0x10/0x10 ret_from_fork_asm+0x1a/0x30 CPU0 CPU2 CPU3 //rcu_nocb_toggle //nocb_cb_wait //rcutorture // deoffload CPU1 // process CPU1s rdp rcu_barrier() rcu_segcblist_entrain() rcu_segcblist_add_len(1) // len == 2 // enqueue barrier // callback to CPU1s // rdp->cblist rcu_do_batch() // invoke CPU1s rdp->cblist // callback rcu_barrier_callback() rcu_barrier() mutex_lock(&rcu_state.barrier_mutex) // still see len == 2 // enqueue barrier callback // to CPU1s rdp->cblist rcu_segcblist_entrain() rcu_segcblist_add_len(1) // len == 3 // decrement len rcu_segcblist_add_len(-2) kthread_parkme() // CPU1s rdp->cblist len == 1 // Warn because there is // still a pending barrier // trigger warning WARN_ON_ONCE(rcu_segcblist_n_cbs(&rdp->cblist)) cpus_read_unlock() // wait CPU1 to comes online and // invoke barrier callback on // CPU1 rdps->cblist wait_for_completion(&rcu_state.barrier_completion) // deoffload CPU4 cpus_read_lock() rcu_barrier() mutex_lock(&rcu_state.barrier_mutex) // block on barrier_mutex // wait rcu_barrier() on // CPU3 to unlock barrier_mutex // but CPU3 unlock barrier_mutex // need to wait CPU1 comes online // when CPU1 going online will block on cpus_write_lock The above scenario will not only trigger a WARN_ON_ONCE(), but also trigger a deadlock. Thanks to nocb locking, a second racing rcu_barrier() on an offline CPU will either observe the decremented callback counter down to 0 and spare the callback enqueue, or rcuo will observe the new callback and keep rdp->nocb_cb_sleep to false. Therefore check rdp->nocb_cb_sleep before parking to make sure no further rcu_barrier() is waiting on the rdp.",
  "keyphrases": {
    "rootcause": [
      "missed RCU barrier on deoffloading"
    ]
  },
  "timestamp": "2025-07-13T23:49:26.033820",
  "retriever_config": {
    "weights": {
      "dense": 0.35,
      "sparse": 0.4,
      "graph": 0.25
    },
    "use_graph": true,
    "use_rag": true,
    "use_sparse": true
  },
  "raw_results": {
    "graph": [
      {
        "cwe_id": "364",
        "name": "Signal Handler Race Condition",
        "abstraction": "base",
        "score": 2.3400000000000003,
        "description": "CWE-364: Signal Handler Race Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "772",
        "name": "Missing Release of Resource after Effective Lifetime",
        "abstraction": "base",
        "score": 2.2100000000000004,
        "description": "CWE-772: Missing Release of Resource after Effective Lifetime...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "410",
        "name": "Insufficient Resource Pool",
        "abstraction": "base",
        "score": 2.2100000000000004,
        "description": "CWE-410: Insufficient Resource Pool...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "416",
        "name": "Use After Free",
        "abstraction": "variant",
        "score": 2.04,
        "description": "CWE-416: Use After Free...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1284",
        "name": "Improper Validation of Specified Quantity in Input",
        "abstraction": "Base",
        "score": 1.9525478256224744,
        "description": "The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "120",
        "name": "Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "123",
        "name": "Write-what-where Condition",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-123: Write-what-where Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "789",
        "name": "Memory Allocation with Excessive Size Value",
        "abstraction": "Variant",
        "score": 1.7248606823851822,
        "description": "The product allocates memory based on an untrusted, large size value, but it does not ensure that the size is within expected limits, allowing arbitrary amounts of memory to be allocated....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 1.7112404330422895,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 1.694530947767081,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "826",
        "name": "Premature Release of Resource During Expected Lifetime",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-826: Premature Release of Resource During Expected Lifetime...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "562",
        "name": "Return of Stack Variable Address",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-562: Return of Stack Variable Address...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1341",
        "name": "Multiple Releases of Same Resource or Handle",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-1341: Multiple Releases of Same Resource or Handle...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1265",
        "name": "Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-1265: Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "386",
        "name": "Symbolic Name not Mapping to Correct Object",
        "abstraction": "base",
        "score": 1.6744000000000003,
        "description": "CWE-386: Symbolic Name not Mapping to Correct Object...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "662",
        "name": "Improper Synchronization",
        "abstraction": "class",
        "score": 1.6736000000000002,
        "description": "CWE-662: Improper Synchronization...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "abstraction": "compound",
        "score": 1.61,
        "description": "CWE-61: UNIX Symbolic Link (Symlink) Following...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "129",
        "name": "Improper Validation of Array Index",
        "abstraction": "variant",
        "score": 1.5552000000000004,
        "description": "CWE-129: Improper Validation of Array Index...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "476",
        "name": "NULL Pointer Dereference",
        "abstraction": "Base",
        "score": 1.5262546090454812,
        "description": "The product dereferences a pointer that it expects to be valid but is NULL....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1325",
        "name": "Improperly Controlled Sequential Memory Allocation",
        "abstraction": "Base",
        "score": 1.5215403726443069,
        "description": "The product manages a group of objects or resources and performs a separate memory allocation for each object, but it does not properly limit the total amount of memory that is consumed by all of the ...",
        "mapping_usage": "Allowed"
      }
    ],
    "dense": [
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 0.5225067847640074,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 0.5103420159870657,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 0.488810330595855,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 0.484886875576085,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "911",
        "name": "Improper Update of Reference Count",
        "abstraction": "Base",
        "score": 0.48276957029761813,
        "description": "The product uses a reference count to manage a resource, but it does not update or incorrectly updates the reference count....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "366",
        "name": "Race Condition within a Thread",
        "abstraction": "Base",
        "score": 0.47791168887374025,
        "description": "If two threads of execution use a resource simultaneously, there exists the possibility that resources may be used while invalid, in turn making the state of execution undefined....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 0.4732832043826306,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 0.46695486899693495,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "606",
        "name": "Unchecked Input for Loop Condition",
        "abstraction": "Base",
        "score": 0.4668933069196025,
        "description": "The product does not properly check inputs that are used for loop conditions, potentially leading to a denial of service or other consequences because of excessive looping....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "191",
        "name": "Integer Underflow (Wrap or Wraparound)",
        "abstraction": "Base",
        "score": 0.46625896995925903,
        "description": "The product subtracts one value from another, such that the result is less than the minimum allowable integer value, which produces a value that is not equal to the correct result....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1260",
        "name": "Improper Handling of Overlap Between Protected Memory Ranges",
        "abstraction": "Base",
        "score": 0.46146576838967535,
        "description": "The product allows address regions to overlap, which can result in the bypassing of intended memory protection....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "126",
        "name": "Buffer Over-read",
        "abstraction": "Variant",
        "score": 0.45944312063586323,
        "description": "The product reads from a buffer using buffer access mechanisms such as indexes or pointers that reference memory locations after the targeted buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1281",
        "name": "Sequence of Processor Instructions Leads to Unexpected Behavior",
        "abstraction": "Base",
        "score": 0.45356453562764876,
        "description": "Specific combinations of processor instructions lead to undesirable behavior such as locking the processor until a hard reset performed....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "367",
        "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
        "abstraction": "Base",
        "score": 0.4533580795403297,
        "description": "The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can ca...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1342",
        "name": "Information Exposure through Microarchitectural State after Transient Execution",
        "abstraction": "Base",
        "score": 0.45074259135280864,
        "description": "The processor does not properly clear microarchitectural state after incorrect microcode assists or speculative execution, resulting in transient execution....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "476",
        "name": "NULL Pointer Dereference",
        "abstraction": "Base",
        "score": 0.44947837689713976,
        "description": "The product dereferences a pointer that it expects to be valid but is NULL....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "119",
        "name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
        "abstraction": "Class",
        "score": 0.4489899147673345,
        "description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected m...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "1331",
        "name": "Improper Isolation of Shared Resources in Network On Chip (NoC)",
        "abstraction": "Base",
        "score": 0.4486074401319887,
        "description": "The Network On Chip (NoC) does not isolate or incorrectly isolates its on-chip-fabric and internal resources such that they are shared between trusted and untrusted agents, creating timing channels....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.44806238402596116,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "663",
        "name": "Use of a Non-reentrant Function in a Concurrent Context",
        "abstraction": "Base",
        "score": 0.44795750371471266,
        "description": "The product calls a non-reentrant function in a concurrent context in which a competing code sequence (e.g. thread or signal handler) may have an opportunity to call the same function or otherwise inf...",
        "mapping_usage": "Allowed"
      }
    ],
    "sparse": [
      {
        "cwe_id": "1390",
        "name": "Weak Authentication",
        "abstraction": "Class",
        "score": 722.0122079282735,
        "description": "The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "775",
        "name": "Missing Release of File Descriptor or Handle after Effective Lifetime",
        "abstraction": "Variant",
        "score": 710.0338843294189,
        "description": "The product does not release a file descriptor or handle after its effective lifetime has ended, i.e., after the file descriptor/handle is no longer needed....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1284",
        "name": "Improper Validation of Specified Quantity in Input",
        "abstraction": "Base",
        "score": 687.8947850819587,
        "description": "The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "230",
        "name": "Improper Handling of Missing Values",
        "abstraction": "Variant",
        "score": 679.1484237814624,
        "description": "The product does not handle or incorrectly handles when a parameter, field, or argument name is specified, but the associated value is missing, i.e. it is empty, blank, or null....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "400",
        "name": "Uncontrolled Resource Consumption",
        "abstraction": "Class",
        "score": 677.173819528798,
        "description": "The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustio...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "789",
        "name": "Memory Allocation with Excessive Size Value",
        "abstraction": "Variant",
        "score": 667.1435529551756,
        "description": "The product allocates memory based on an untrusted, large size value, but it does not ensure that the size is within expected limits, allowing arbitrary amounts of memory to be allocated....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 667.0542952657092,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "125",
        "name": "Out-of-bounds Read",
        "abstraction": "Base",
        "score": 663.7806757812923,
        "description": "The product reads data past the end, or before the beginning, of the intended buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 657.2859389029214,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 654.6367600413924,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      }
    ]
  },
  "score_statistics": {
    "dense": {
      "min": 0.44795750371471266,
      "max": 0.5225067847640074,
      "mean": 0.4681143665718131,
      "median": 0.4638623691744672,
      "count": 20
    },
    "sparse": {
      "min": 654.6367600413924,
      "max": 722.0122079282735,
      "mean": 678.6164343596404,
      "median": 672.1586862419867,
      "count": 10
    },
    "graph": {
      "min": 1.5215403726443069,
      "max": 2.3400000000000003,
      "mean": 1.7859687435253409,
      "median": 1.6896654738835406,
      "count": 20
    }
  }
}