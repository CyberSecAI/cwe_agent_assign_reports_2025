# Raw Retriever Results for CVE-2024-47741

# Raw Retriever Results for CVE-2024-47741
## Query
In the Linux kernel, the following vulnerability has been resolved btrfs fix race setting file private on concurrent lseek using same fd When doing concurrent lseek(2) system calls against the same file descriptor, using multiple threads belonging to the same process, we have a short time window where a race happens and can result in a memory leak. The race happens like this 1) A program opens a file descriptor for a file and then spawns two threads (with the pthreads library for example), lets call them task A and task B 2) Task A calls lseek with SEEK_DATA or SEEK_HOLE and ends up at file.cfind_desired_extent() while holding a read lock on the inode 3) At the start of find_desired_extent(), it extracts the files private_data pointer into a local variable named private, which has a value of NULL 4) Task B also calls lseek with SEEK_DATA or SEEK_HOLE, locks the inode in shared mode and enters file.cfind_desired_extent(), where it also extracts file->private_data into its local variable private, which has a NULL value 5) Because it saw a NULL file private, task A allocates a private structure and assigns to the file structure 6) Task B also saw a NULL file private so it also allocates its own file private and then assigns it to the same file structure, since both tasks are using the same file descriptor. At this point we leak the private structure allocated by task A. Besides the memory leak, theres also the detail

## Keyphrases
- **rootcause**: 'race condition'
- **weakness**: 'memory leak'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4595 | 0.5574 | 0.4917 | 0.4792 | 20 |
| Sparse | 1001.7339 | 1187.3530 | 1121.2446 | 1114.9384 | 11 |
| Graph | 1.6320 | 2.8652 | 1.9645 | 1.7680 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 609 | Double-Checked Locking | base | 2.8652 | Allowed |
| 2 | 476 | NULL Pointer Dereference | Base | 2.8002 | Allowed |
| 3 | 386 | Symbolic Name not Mapping to Correct Object | base | 2.3764 | Allowed |
| 4 | 252 | Unchecked Return Value | base | 2.2100 | Allowed |
| 5 | 59 | Improper Link Resolution Before File Access ('Link Following') | base | 2.2100 | Allowed |
| 6 | 825 | Expired Pointer Dereference | base | 2.2100 | Allowed |
| 7 | 824 | Access of Uninitialized Pointer | base | 2.2100 | Allowed |
| 8 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 1.7755 | Allowed |
| 9 | 1284 | Improper Validation of Specified Quantity in Input | base | 1.7680 | Allowed |
| 10 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 11 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 12 | 562 | Return of Stack Variable Address | base | 1.7680 | Allowed |
| 13 | 787 | Out-of-bounds Write | base | 1.7680 | Allowed |
| 14 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 1.7543 | Allowed-with-Review |
| 15 | 366 | Race Condition within a Thread | Base | 1.7035 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 403 | Exposure of File Descriptor to Unintended Control Sphere ('File Descriptor Leak') | Base | 0.5574 | 0.5574 | Allowed |
| 2 | 909 | Missing Initialization of Resource | Class | 0.5431 | 0.5431 | Allowed-with-Review |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5311 | 0.5311 | Allowed-with-Review |
| 4 | 363 | Race Condition Enabling Link Following | Base | 0.5291 | 0.5291 | Allowed |
| 5 | 366 | Race Condition within a Thread | Base | 0.5223 | 0.5223 | Allowed |
| 6 | 667 | Improper Locking | Class | 0.5174 | 0.5174 | Allowed-with-Review |
| 7 | 1421 | Exposure of Sensitive Information in Shared Microarchitectural Structures during Transient Execution | Base | 0.5047 | 0.5047 | Allowed |
| 8 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.4916 | 0.4916 | Allowed |
| 9 | 908 | Use of Uninitialized Resource | Base | 0.4872 | 0.4872 | Allowed |
| 10 | 413 | Improper Resource Locking | Base | 0.4854 | 0.4854 | Allowed |
| 11 | 911 | Improper Update of Reference Count | Base | 0.4730 | 0.4730 | Allowed |
| 12 | 1423 | Exposure of Sensitive Information caused by Shared Microarchitectural Predictor State that Influences Transient Execution | Base | 0.4714 | 0.4714 | Allowed |
| 13 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | 0.4700 | 0.4700 | Allowed |
| 14 | 763 | Release of Invalid Pointer or Reference | Base | 0.4698 | 0.4698 | Allowed |
| 15 | 775 | Missing Release of File Descriptor or Handle after Effective Lifetime | Variant | 0.4690 | 0.4690 | Allowed |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1187.3530 | 1187.3530 | Allowed-with-Review |
| 2 | 667 | Improper Locking | 1184.1127 | 1184.1127 | Allowed-with-Review |
| 3 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 1176.2395 | 1176.2395 | Allowed |
| 4 | 125 | Out-of-bounds Read | 1164.3219 | 1164.3219 | Allowed |
| 5 | 476 | NULL Pointer Dereference | 1132.1627 | 1132.1627 | Allowed |
| 6 | 909 | Missing Initialization of Resource | 1114.9384 | 1114.9384 | Allowed-with-Review |
| 7 | 364 | Signal Handler Race Condition | 1107.5994 | 1107.5994 | Allowed |
| 8 | 201 | Insertion of Sensitive Information Into Sent Data | 1100.4261 | 1100.4261 | Allowed |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | 1089.2651 | 1089.2651 | Allowed |
| 10 | 427 | Uncontrolled Search Path Element | 1075.5383 | 1075.5383 | Allowed |
| 11 | 203 | Observable Discrepancy | 1001.7339 | 1001.7339 | Allowed |
