{
  "retriever": "sparse",
  "query": "In the Linux kernel, the following vulnerability has been resolved xhci Handle TD clearing for multiple streams case When multiple streams are in use, multiple TDs might be in flight when an endpoint is stopped. We need to issue a Set TR Dequeue Pointer for each, to ensure everything is reset properly and the caches cleared. Change the logic so that any N>1 TDs found active for different streams are deferred until after the first one is processed, calling xhci_invalidate_cancelled_tds() again from xhci_handle_cmd_set_deq() to queue another command until we are done with all of them. Also change the error/should never happen paths to ensure we at least clear any affected TDs, even if we cant issue a command to clear the hardware cache, and complain loudly with an xhci_warn() if this ever happens. This problem case dates back to commit e9df17eb1408 (USB xhci Correct assumptions about number of rings per endpoint.) early on in the XHCI drivers life, when stream support was first added. It was then identified but not fixed nor made into a warning in commit 674f8438c121 (xhci split handling halted endpoints into two steps), which added a FIXME comment for the problem case (without materially changing the behavior as far as I can tell, though the new logic made the problem more obvious). Then later, in commit 94f339147fc3 (xhci Fix failure to give back some cached cancelled URBs.), it was acknowledged again. [Mathias commit 94f339147fc3 (xhci Fix failure to",
  "keyphrases": {
    "rootcause": [
      "multiple TDs might be in flight when an endpoint is stopped"
    ]
  },
  "timestamp": "2025-07-13 12:42:55",
  "cve_id": "CVE-2024-40927",
  "result_count": 11,
  "results": [
    {
      "cwe_id": "1284",
      "name": "Improper Validation of Specified Quantity in Input",
      "score": 1057.1938117914306,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "863",
      "name": "Incorrect Authorization",
      "score": 1055.575598594719,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "306",
      "name": "Missing Authentication for Critical Function",
      "score": 1033.4391512811212,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "617",
      "name": "Reachable Assertion",
      "score": 1033.2680228144673,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "1390",
      "name": "Weak Authentication",
      "score": 1030.9251479144252,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "667",
      "name": "Improper Locking",
      "score": 1018.2791184208647,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "score": 1017.8214471116542,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "407",
      "name": "Inefficient Algorithmic Complexity",
      "score": 1011.0389341692439,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "201",
      "name": "Insertion of Sensitive Information Into Sent Data",
      "score": 1007.3202497266977,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "79",
      "name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
      "score": 1006.3741555758834,
      "search_source": "rootcause:multiple TDs might be in flight when an endpoint is stopped"
    },
    {
      "cwe_id": "212",
      "name": "Improper Removal of Sensitive Information Before Storage or Transfer",
      "score": 317.40505077902526,
      "search_source": "base_query"
    }
  ]
}