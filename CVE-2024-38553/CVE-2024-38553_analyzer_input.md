# Vulnerability Information: CVE-2024-38553

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved net fec remove .ndo_poll_controller to avoid **deadlock**s There is a **deadlock** issue found in sungem driver, please refer to the commit ac0a230f719b (eth sungem remove .ndo_poll_controller to avoid **deadlock**s). The root cause of the issue is that **netpoll is in atomic context and disable_irq() is called by .ndo_poll_controller interface** of sungem driver, however, disable_irq() might sleep. After analyzing the implementation of fec_poll_controller(), the fec driver should have the same issue. Due to the fec driver uses NAPI for TX completions, the .ndo_poll_controller is unnecessary to be implemented in the fec driver, so fec_poll_controller() can be safely removed.

### Vulnerability Description Key Phrases
- **rootcause:** **netpoll is in atomic context and disable_irq() is called by .ndo_poll_controller interface**
- **weakness:** **deadlock**
- **product:** Linux kernel and sungem driver

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
The root cause is the improper use of `disable_irq()` within the `fec_poll_controller()` function when called in the context of netpoll. `disable_irq()` can sleep, which is not allowed in an atomic context such as netpoll, leading to a potential deadlock.

**Weaknesses/Vulnerabilities:**
- The `fec_poll_controller` function calls `disable_irq()` and `enable_irq()` which can sleep, and are not safe in atomic context.
- The driver implements a `.ndo_poll_controller` which is not required since NAPI is used for TX completions

**Impact of Exploitation:**
- Deadlock: The primary impact is a potential deadlock when `fec_poll_controller()` is called from an atomic context, such as when using netpoll for debugging or similar situations. This can make the system unresponsive.

**Attack Vectors:**
- Netpoll: The vulnerability is triggered when the `fec_poll_controller()` function is called in the context of netpoll. This commonly happens during system debugging and console output scenarios via the network.

**Required Attacker Capabilities/Position:**
- The attacker does not need to be in a privileged position, but must be able to trigger netpoll, typically by activating network debugging or related scenarios.

**Additional Notes:**
- The fix is to remove the unnecessary `.ndo_poll_controller` implementation from the FEC driver, which eliminates the problematic `disable_irq()` calls in the `fec_poll_controller()` function, because the FEC driver uses NAPI for TX completions, which makes the `.ndo_poll_controller` unnecessary.
- This issue is similar to a deadlock that was found in the `sungem` driver.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 833 | Deadlock | Base | Allowed | sparse | 0.608 |
| 2 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.591 |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.567 |
| 4 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.559 |
| 5 | 415 | Double Free | Variant | Allowed | sparse | 0.541 |
| 6 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | sparse | 0.537 |
| 7 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.535 |
| 8 | 911 | Improper Update of Reference Count | Base | Allowed | sparse | 0.535 |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | dense | 0.462 |
| 10 | 609 | Double-Checked Locking | Base | Allowed | graph | 0.003 |

