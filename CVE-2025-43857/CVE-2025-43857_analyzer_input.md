# Vulnerability Information: CVE-2025-43857

## Vulnerability Description
NetIMAP implements Internet Message Access Protocol (IMAP) client functionality in Ruby. Prior to versions 0.5.7, 0.4.20, 0.3.9, and 0.2.5, there is a possibility for denial of service by **memory exhaustion** when net-imap reads server responses. At any time while the client is connected, a malicious server can send can send a literal byte count, which is automatically read by the clients receiver thread. The response reader immediately allocates memory for the number of bytes indicated by the server response. This should not be an issue when securely connecting to trusted IMAP servers that are well-behaved. It can affect insecure connections and buggy, untrusted, or compromised servers (for example, connecting to a user supplied hostname). This issue has been patched in versions 0.5.7, 0.4.20, 0.3.9, and 0.2.5.

### Vulnerability Description Key Phrases
- **weakness:** **memory exhaustion**
- **impact:** denial of service
- **product:** NetIMAP
- **version:** prior to 0.5.7, 0.4.20, 0.3.9, and 0.2.5

## CVE Reference Links Content Summary
```text
Root cause of vulnerability:
The vulnerability is caused by the `net-imap` library's handling of "literal" strings in server responses. Specifically, when `Net::IMAP` receives a response containing a literal string, it calls `IO#read` with the size specified in the response.  `IO#read` immediately allocates memory to buffer the entire string before processing continues. There is no limit on the size of literals that will be accepted.

Weaknesses/vulnerabilities present:
- Denial of Service (DoS) due to memory exhaustion. An attacker can send a malicious server response with a large literal size, causing the client to allocate excessive memory, potentially leading to a denial-of-service condition.
- The IMAP protocol allows "literal" strings to be sent in responses, prefixed with their size in curly braces (e.g. `{1234567890}\r\n`).
- The server does not need to send any more data.

Impact of exploitation:
- Denial of Service (DoS): The client can exhaust memory resources and become unavailable.

Attack vectors:
- A malicious or compromised IMAP server can send a crafted response with a large literal string size.
- Connecting to a user-supplied hostname could be a risk.
- Insecure connections

Required attacker capabilities/position:
- The attacker needs to control or compromise an IMAP server or be able to send crafted responses to an IMAP client.

Mitigation or fix:
- Upgrade to `net-imap` 0.5.7 or later. A configurable `max_response_size` limit has been added.
- Backports to `net-imap` 0.2.5, 0.3.9, and 0.4.20 are available.
- Set a `max_response_size` when connecting to untrusted servers or using insecure connections.
- Users are responsible for adding response handlers to prune excessive unhandled responses.
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.744 |
| 2 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.717 |
| 3 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.703 |
| 4 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.682 |
| 5 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.670 |
| 6 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.668 |
| 7 | 617 | Reachable Assertion | Base | Allowed | sparse | 0.664 |
| 8 | 319 | Cleartext Transmission of Sensitive Information | Base | Allowed | sparse | 0.662 |
| 9 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | dense | 0.403 |
| 10 | 476 | NULL Pointer Dereference | Base | Allowed | graph | 0.002 |

