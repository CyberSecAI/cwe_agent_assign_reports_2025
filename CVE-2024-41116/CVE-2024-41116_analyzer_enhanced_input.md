## Vulnerability Description
streamlit-geospatial is a streamlit multipage app for geospatial applications. Prior to commit c4f81d9616d40c60584e36abb15300853a66e489, the `vis_params` variable on line 1254 in `pages/1__Timelapse.py` takes user input, which is later used in the `eval()` function on line 1345, leading to remote code execution. Commit c4f81d9616d40c60584e36abb15300853a66e489 fixes this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input validation**
- **impact:** remote code execution
- **product:** streamlit-geospatial
- **version:** prior to commit c4f81d9616d40c60584e36abb15300853a66e489

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-NVD-noinfo

#### Top CWEs
- CWE-NVD-noinfo (Count: 34)
- CWE-918 (Count: 4)

## CVE Reference Links Content Summary
The provided content contains information about multiple vulnerabilities in the `streamlit-geospatial` project. CVE-2024-41116 is associated with `GHSL-2024-104`, which is a Remote Code Execution (RCE) vulnerability in `pages/1_ðŸ“·_Timelapse.py` related to the `MODIS Ocean Color SMI` option's `vis_params`.

Here's a breakdown of the vulnerability:

**Root Cause:**

- The application takes user-provided input for visualization parameters (`vis_params`) and uses it within an `eval()` function. This allows the user to execute arbitrary Python code.

**Vulnerability:**

- Uncontrolled use of `eval()` with user input: The application directly evaluates user-provided strings, allowing for the injection of malicious code.

**Impact of Exploitation:**

- Remote Code Execution (RCE): An attacker can execute arbitrary code on the server hosting the `streamlit-geospatial` application. This can lead to full control of the server, data breaches, and other malicious activities.

**Attack Vectors:**

- User input through the `Enter visualization parameters` text area in the `MODIS Ocean Color SMI` section of the `ðŸ“· Timelapse` tab.

**Attacker Capabilities:**

- The attacker needs to be able to interact with the application's web interface and provide malicious input into the `Enter visualization parameters` text area when the `MODIS Ocean Color SMI` option is selected.

**Technical Details:**

- The vulnerability occurs in `pages/1_ðŸ“·_Timelapse.py` at line 1254 where the `vis_params` variable is defined and then evaluated using `eval()` at line 1345 within the conditional block where `collection == "MODIS Ocean Color SMI"`.

```python
vis_params = st.text_area(
    "Enter visualization parameters",
    "",
    help="Enter a string in the format of a dictionary, such as '{'min': 23, 'max': 32}'",
)

--- snip

        elif collection == "MODIS Ocean Color SMI":
            if vis_params.startswith("{") and vis_params.endswith(
                "}"
            ):
                vis_params = eval(vis_params)
```
**Mitigation:**
The provided commit diff shows that the `eval()` calls were replaced with `json.loads()`, which will prevent the execution of arbitrary code. Additionally, a check was added to ensure the input is a dictionary.
```diff
--- a/pages/1_ðŸ“·_Timelapse.py
+++ b/pages/1_ðŸ“·_Timelapse.py
@@ -1342,7 +1347,9 @@
                 "}"
             ):
                 vis_params = eval(vis_params)
+                vis_params = json.loads(
+                    vis_params.replace("'", '"')
+                )
             else:
                 vis_params = None
             out_gif = geemap.modis_ocean_color_timelapse(

```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.251 |
| 2 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | sparse | 0.249 |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.235 |
| 4 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.232 |
| 5 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.226 |
| 6 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.218 |
| 7 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.217 |
| 8 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.217 |
| 9 | 1287 | Improper Validation of Specified Type of Input | Base | Allowed | dense | 0.387 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-917: Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-116: Improper Encoding or Escaping of Output

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-20: Improper Input Validation

CWE-125: Out-of-bounds Read

CWE-1287: Improper Validation of Specified Type of Input

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')