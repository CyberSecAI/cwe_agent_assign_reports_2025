# Vulnerability Information: CVE-2024-7160

## Vulnerability Description
A vulnerability classified as critical has been found in TOTOLINK A3700R 9.1.2u.5822_B20200513. Affected is the function setWanCfg of the file /cgi-bin/cstecgi.cgi. The manipulation of the argument hostName leads to **command injection**. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. VDB-272574 is the identifier assigned to this vulnerability. NOTE The vendor was contacted early about this disclosure but did not respond in any way.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** TOTOLINK A3700R
- **version:** 9.1.2u.5822_B20200513
- **component:** setWanCfg in /cgi-bin/cstecgi.cgi

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 44)
- CWE-89 (Count: 15)
- CWE-78 (Count: 9)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

*   The vulnerability stems from a command injection flaw in the `setWanCfg` function of the TOTOLINK A3700R router's firmware.

**Weaknesses/Vulnerabilities:**

*   **Command Injection:** The `hostName` parameter, received from a POST request, is directly incorporated into a system command executed by `doSystem`.
*   **Unsanitized Input:** The firmware fails to sanitize or validate the `hostName` parameter, allowing an attacker to inject arbitrary shell commands.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** By injecting shell commands, an attacker can execute arbitrary code on the router's operating system. This could lead to:
    *   Full control over the device.
    *   Data exfiltration.
    *   Installation of malware.
    *   Denial of service.

**Attack Vectors:**

*   **HTTP POST Request:** The attack vector is a crafted HTTP POST request to the `/cgi-bin/cstecgi.cgi` endpoint.
*   **`hostName` Parameter:** The malicious payload is placed within the `hostName` parameter of the POST request's JSON data.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable router. This would likely require being on the same network or having remote access through a port forward.
*   **Authentication (likely):** The provided Proof of Concept (POC) includes a cookie, suggesting the attacker may need to be authenticated to exploit this vulnerability. This could potentially be bypassed, but the information indicates the need for a valid session cookie.

**Additional Details:**

*   **Affected Version:** The vulnerability is confirmed to exist in the A3700R V9.1.2u.5822\_B20200513 firmware version.
*   **POC:** The provided POC demonstrates how to inject a command to list files and directories on the router.
*   **Vulnerable Function:** The `setWanCfg` function is specifically mentioned as the vulnerable component.
*   **`doSystem`:** The use of the `doSystem` function without proper input sanitization is the core issue.

This information provides a clear picture of the command injection vulnerability, its attack vectors, and potential impact, which aligns with the description of a command injection vulnerability as given in CVE descriptions.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.554 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.517 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.447 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.436 |
| 7 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.435 |
| 8 | 80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | sparse | 0.428 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.672 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |

