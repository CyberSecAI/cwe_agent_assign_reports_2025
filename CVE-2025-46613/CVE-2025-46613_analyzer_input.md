# Vulnerability Information: CVE-2025-46613

## Vulnerability Description
OpenPLC 3 through 64f9c11 has server.cpp **Memory Corruption** because a **thread may access handleConnections arguments after the parent stack frame becomes unavailable**.

### Vulnerability Description Key Phrases
- **rootcause:** **thread may access handleConnections arguments after the parent stack frame becomes unavailable**
- **weakness:** **Memory Corruption**
- **product:** OpenPLC
- **version:** 3 through 64f9c11
- **component:** server.cpp

## CVE Reference Links Content Summary
## Analysis of CVE-2025-46613 Content

This content **IS RELATED** to a vulnerability report. It provides significantly more detail than a standard CVE description would.

**Root cause of vulnerability:**

The vulnerability stems from passing thread arguments to `handleConnections()` using a stack-allocated array. This is unsafe because the thread may access the arguments after the parent stack frame has been destroyed or overwritten, leading to invalid memory access.

**Weaknesses/vulnerabilities present:**

*   **Memory Corruption:** Improper handling of thread arguments leads to potential memory corruption.
*   **Denial of Service (DoS):** The memory corruption can cause thread crashes and segmentation faults, resulting in a denial of service.

**Impact of exploitation:**

Remote attackers can trigger the vulnerability by sending crafted or rapid TCP sessions to OpenPLC on ports 502 or 44818. This can lead to thread crashes, segmentation faults, and denial of service. The issue affects default configurations and is exploitable without authentication.

**Attack vectors:**

*   Network-based: Sending crafted TCP sessions to the OpenPLC server.
*   Rapid connection attempts.

**Required attacker capabilities/position:**

*   Network access to the OpenPLC server on ports 502 or 44818.
*   No authentication is required.

**Mitigation or fix:**

The proposed fix involves:

1.  Switching to heap-allocated thread arguments using a structured type (`thread_args_t`).
2.  Adding runtime validation using a "magic" constant within the `handleConnections()` function to verify the integrity of the arguments.
3.  The provided patch demonstrates the implementation of these changes, including the definition of `thread_args_t`, the use of `calloc` for allocation, and the inclusion of the magic number check.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 787 | Out-of-bounds Write | Base | Allowed | alternate_terms | 1.000 |
| 2 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | sparse | 0.176 |
| 3 | 126 | Buffer Over-read | Variant | Allowed | sparse | 0.150 |
| 4 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.150 |
| 5 | 908 | Use of Uninitialized Resource | Base | Allowed | sparse | 0.145 |
| 6 | 696 | Incorrect Behavior Order | Class | Allowed-with-Review | sparse | 0.145 |
| 7 | 617 | Reachable Assertion | Base | Allowed | sparse | 0.144 |
| 8 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.143 |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | dense | 0.556 |
| 10 | 825 | Expired Pointer Dereference | Base | Allowed | graph | 0.003 |

