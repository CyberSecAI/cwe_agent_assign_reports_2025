## Vulnerability Description
matrix-react-sdk is a react-based SDK for inserting a Matrix chat/voip client into a web page. A malicious homeserver could manipulate a users account data to cause the client to enable URL previews in end-to-end encrypted rooms, in which case any URLs in encrypted messages would be sent to the server. This was patched in matrix-react-sdk 3.105.0. Deployments that trust their homeservers, as well as closed federations of trusted servers, are not affected. Users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **impact:** enable URL previews in end-to-end encrypted rooms
- **vector:** manipulate a users account data
- **attacker:** malicious homeserver
- **product:** matrix-react-sdk
- **version:** prior to 3.105.0

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-42347:

**Root Cause of Vulnerability:**
The vulnerability stems from the ability of a malicious homeserver to manipulate a user's account data. Specifically, it can alter settings related to URL previews.

**Weaknesses/Vulnerabilities Present:**
- The client (matrix-react-sdk) does not properly validate or handle settings related to URL previews received from the homeserver.
- There is a lack of trust boundary between the homeserver and client regarding the handling of these settings.

**Impact of Exploitation:**
- If exploited, a malicious homeserver can force the client to enable URL previews even in end-to-end encrypted rooms.
- This results in any URLs in encrypted messages being sent to the server, potentially exposing sensitive information.

**Attack Vectors:**
- A malicious homeserver is the attack vector.

**Required Attacker Capabilities/Position:**
- The attacker needs to control a homeserver that a user's client connects to.
- The attacker has to be able to manipulate account data on the homeserver to set the client's URL preview setting to enabled

**Additional Details:**
- The vulnerability is classified as high severity.
- The issue is present in matrix-react-sdk versions prior to 3.105.1
- The vulnerability is related to CWE-359.
- The CVSS score is 4.1 (AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:N/A:N).
- Deployments that trust their homeservers, as well as closed federations of trusted servers, are not affected.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 290 | Authentication Bypass by Spoofing | Base | Allowed | sparse | 0.206 |
| 2 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.175 |
| 3 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.174 |
| 4 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.169 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.169 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.163 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.162 |
| 8 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.160 |
| 9 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | dense | 0.432 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-290: Authentication Bypass by Spoofing

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-1333: Inefficient Regular Expression Complexity

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-863: Incorrect Authorization

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-287: Improper Authentication

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')