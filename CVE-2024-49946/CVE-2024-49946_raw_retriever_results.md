# Raw Retriever Results for CVE-2024-49946

# Raw Retriever Results for CVE-2024-49946
## Query
In the Linux kernel, the following vulnerability has been resolved ppp do not assume bh is held in ppp_channel_bridge_input() Networking receive path is usually handled from BH handler. However, some protocols need to acquire the socket lock, and packets might be stored in the socket backlog is the socket was owned by a user process. In this case, release_sock(), __release_sock(), and sk_backlog_rcv() might call the sk->sk_backlog_rcv() handler in process context. sybot caught ppp was not considering this case in ppp_channel_bridge_input() WARNING inconsistent lock state 6.11.0-rc7-syzkaller-g5f5673607153 #0 Not tainted -------------------------------- inconsistent {SOFTIRQ-ON-W} -> {IN-SOFTIRQ-W} usage. ksoftirqd/1/24 [HC0[0]SC1[1]HE1SE0] takes ffff0000db7f11e0 (&pch->downl){+.?.}-{22}, at spin_lock include/linux/spinlock.h351 [inline] ffff0000db7f11e0 (&pch->downl){+.?.}-{22}, at ppp_channel_bridge_input drivers/net/ppp/ppp_generic.c2272 [inline] ffff0000db7f11e0 (&pch->downl){+.?.}-{22}, at ppp_input+0x16c/0x854 drivers/net/ppp/ppp_generic.c2304 {SOFTIRQ-ON-W} state was registered at lock_acquire+0x240/0x728 kernel/locking/lockdep.c5759 __raw_spin_lock include/linux/spinlock_api_smp.h133 [inline] _raw_spin_lock+0x48/0x60 kernel/locking/spinlock.c154 spin_lock include/linux/spinlock.h351 [inline] ppp_channel_bridge_input drivers/net/ppp/ppp_generic.c2272 [inline] ppp_input+0x16c/0x854 drivers/net/ppp/ppp_generic.c2304 pppoe_rcv_core+0xfc/0x314 drivers/net/ppp/pppoe.c379 sk_backlog_rcv include/net/sock.h1111 [inline] __release_sock+0x1a8/0x3d8 net/core/sock.c3004 release_sock+0x68/0x1b8 net/core/sock.c3558 pppoe_sendmsg+0xc8/0x5d8 drivers/net/ppp/pppoe.c903 sock_sendmsg_nosec net/socket.c730 [inline] __sock_sendmsg net/socket.c745 [inline] __sys_sendto+0x374/0x4f4 net/socket.c2204 __do_sys_sendto net/socket.c2216 [inline] __se_sys_sendto net/socket.c2212 [inline] __arm64_sys_sendto+0xd8/0xf8 net/socket.c2212 __invoke_syscall arch/arm64/kernel/syscall.c35 [inline] invoke_syscall+0x98/0x2b8 arch/arm64/kernel/syscall.c49 el0_svc_common+0x130/0x23c arch/arm64/kernel/syscall.c132 do_el0_svc+0x48/0x58 arch/arm64/kernel/syscall.c151 el0_svc+0x54/0x168 arch/arm64/kernel/entry-common.c712 el0t_64_sync_handler+0x84/0xfc arch/arm64/kernel/entry-common.c730 el0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S598 irq event stamp 282914 hardirqs last enabled at (282914) [] __raw_spin_unlock_irqrestore include/linux/spinlock_api_smp.h151 [inline] hardirqs last enabled at (282914) [] _raw_spin_unlock_irqrestore+0x38/0x98 kernel/locking/spinlock.c194 hardirqs last disabled at (282913) [] __raw_spin_lock_irqsave include/linux/spinlock_api_smp.h108 [inline] hardirqs last disabled at (282913) [] _raw_spin_lock_irqsave+0x2c/0x7c kernel/locking/spinlock.c162 softirqs last enabled at (282904) [] softirq_handle_end kernel/softirq.c400 [inline] softirqs last enabled at (282904) [] handle_softirqs+0xa3c/0xbfc kernel/softirq.c582 softirqs last disabled at (282909) [] run_ksoftirqd+0x70/0x158 kernel/softirq.c928 other info that might help us debug this Possible unsafe locking scenario CPU0 ---- lock(&pch->downl) lock(&pch->downl) *** DEADLOCK *** 1 lock held by ksoftirqd/1/24 #0 ffff80008f74dfa0 (rcu_read_lock){....}-{12}, at rcu_lock_acquire+0x10/0x4c include/linux/rcupdate.h325 stack backtrace CPU 1 UID 0 PID 24 Comm ksoftirqd/1 Not tainted 6.11.0-rc7-syzkaller-g5f5673607153 #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 08/06/2024 Call trace dump_backtrace+0x1b8/0x1e4 arch/arm64/kernel/stacktrace.c319 show_stack+0x2c/0x3c arch/arm64/kernel/stacktrace.c326 __dump_sta ---truncated---

## Keyphrases
- **rootcause**: 'The ppp_channel_bridge_input function in the Linux kernel's PPP implementation does not properly handle cases where it is called from a process context', 'leading to a potential lock state inconsistency', 'deadlock.'
- **weakness**: 'The ppp_channel_bridge_input function assumes it is always called from a bottom half (BH) handler', 'which is not always the case. This function uses a spinlock (`pch->downl`) without considering that it might be called in a process context', 'which leads to re-entrancy of the lock', 'The ppp_channel_bridge_input function assumes it is always called from a bottom half (BH) handler', 'which deadlock'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4925 | 0.5668 | 0.5219 | 0.5198 | 20 |
| Sparse | 1061.4152 | 1332.3816 | 1142.1132 | 1129.5241 | 10 |
| Graph | 1.4784 | 2.8162 | 1.8286 | 1.7287 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 476 | NULL Pointer Dereference | Base | 2.8162 | Allowed |
| 2 | 129 | Improper Validation of Array Index | variant | 2.2704 | Allowed |
| 3 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 4 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.2100 | Allowed |
| 5 | 789 | Memory Allocation with Excessive Size Value | variant | 2.0400 | Allowed |
| 6 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 1.7693 | Allowed-with-Review |
| 8 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 9 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 10 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 11 | 833 | Deadlock | Base | 1.7024 | Allowed |
| 12 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 13 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 14 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 15 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 1.6322 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 667 | Improper Locking | Class | 0.5668 | 0.5668 | Allowed-with-Review |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5576 | 0.5576 | Allowed-with-Review |
| 3 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5479 | 0.5479 | Allowed |
| 4 | 909 | Missing Initialization of Resource | Class | 0.5459 | 0.5459 | Allowed-with-Review |
| 5 | 833 | Deadlock | Base | 0.5424 | 0.5424 | Allowed |
| 6 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5359 | 0.5359 | Allowed |
| 7 | 416 | Use After Free | Variant | 0.5318 | 0.5318 | Allowed |
| 8 | 121 | Stack-based Buffer Overflow | Variant | 0.5318 | 0.5318 | Allowed |
| 9 | 413 | Improper Resource Locking | Base | 0.5279 | 0.5279 | Allowed |
| 10 | 126 | Buffer Over-read | Variant | 0.5238 | 0.5238 | Allowed |
| 11 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.5157 | 0.5157 | Allowed |
| 12 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.5123 | 0.5123 | Discouraged |
| 13 | 190 | Integer Overflow or Wraparound | Base | 0.5080 | 0.5080 | Allowed |
| 14 | 122 | Heap-based Buffer Overflow | Variant | 0.5054 | 0.5054 | Allowed |
| 15 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.5046 | 0.5046 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 667 | Improper Locking | 1332.3816 | 1332.3816 | Allowed-with-Review |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1219.0806 | 1219.0806 | Allowed-with-Review |
| 3 | 476 | NULL Pointer Dereference | 1137.9814 | 1137.9814 | Allowed |
| 4 | 401 | Missing Release of Memory after Effective Lifetime | 1132.1963 | 1132.1963 | Allowed |
| 5 | 909 | Missing Initialization of Resource | 1131.0880 | 1131.0880 | Allowed-with-Review |
| 6 | 911 | Improper Update of Reference Count | 1127.9603 | 1127.9603 | Allowed |
| 7 | 770 | Allocation of Resources Without Limits or Throttling | 1103.3448 | 1103.3448 | Allowed |
| 8 | 833 | Deadlock | 1098.0626 | 1098.0626 | Allowed |
| 9 | 822 | Untrusted Pointer Dereference | 1077.6214 | 1077.6214 | Allowed |
| 10 | 787 | Out-of-bounds Write | 1061.4152 | 1061.4152 | Allowed |
