{
  "retriever": "sparse",
  "query": "In the Linux kernel, the following vulnerability has been resolved mm/migrate fix shmem xarray update during migration A shmem folio can be either in page cache or in swap cache, but not at the same time. Namely, once it is in swap cache, folio->mapping should be NULL, and the folio is no longer in a shmem mapping. In __folio_migrate_mapping(), to determine the number of xarray entries to update, folio_test_swapbacked() is used, but that conflates shmem in page cache case and shmem in swap cache case. It leads to xarray multi-index entry corruption, since it turns a sibling entry to a normal entry during xas_store() (see [1] for a userspace reproduction). Fix it by only using folio_test_swapcache() to determine whether xarray is storing swap cache entries or not to choose the right number of xarray entries to update. [1] https//lore.kernel.org/linux-mm/Z8idPCkaJW1IChjT@casper.infradead.org/ Note In __split_huge_page(), folio_test_anon() && folio_test_swapcache() is used to get swap_cache address space, but that ignores the shmem folio in swap cache case. It could lead to NULL pointer dereferencing when a in-swap-cache shmem folio is split at __xa_store(), since !folio_test_anon() is true and folio->mapping is NULL. But fortunately, its caller split_huge_page_to_list_to_order() bails out early with EBUSY when folio->mapping is NULL. So no need to take care of it here.",
  "keyphrases": {
    "rootcause": [
      "conflates shmem in page cache case",
      "shmem in swap cache case"
    ],
    "weakness": [
      "xarray multi-index entry corruption"
    ]
  },
  "timestamp": "2025-07-12 10:00:13",
  "cve_id": "CVE-2025-22015",
  "result_count": 13,
  "results": [
    {
      "cwe_id": "617",
      "name": "Reachable Assertion",
      "score": 1047.376764370227,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "404",
      "name": "Improper Resource Shutdown or Release",
      "score": 1029.5783734166384,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "476",
      "name": "NULL Pointer Dereference",
      "score": 1005.6292921867246,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "1251",
      "name": "Mirrored Regions with Different Values",
      "score": 999.2903451769732,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "score": 990.7083966140058,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "276",
      "name": "Incorrect Default Permissions",
      "score": 981.7039383579198,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "591",
      "name": "Sensitive Data Storage in Improperly Locked Memory",
      "score": 970.2185606351374,
      "search_source": "rootcause:shmem in swap cache case"
    },
    {
      "cwe_id": "79",
      "name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
      "score": 960.5975783024476,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "204",
      "name": "Observable Response Discrepancy",
      "score": 958.5863111313115,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "125",
      "name": "Out-of-bounds Read",
      "score": 954.3441511878043,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "367",
      "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
      "score": 953.5567584728028,
      "search_source": "rootcause:conflates shmem in page cache case"
    },
    {
      "cwe_id": "667",
      "name": "Improper Locking",
      "score": 895.488971055941,
      "search_source": "weakness:xarray multi-index entry corruption"
    },
    {
      "cwe_id": "190",
      "name": "Integer Overflow or Wraparound",
      "score": 882.3506743360962,
      "search_source": "weakness:xarray multi-index entry corruption"
    }
  ]
}