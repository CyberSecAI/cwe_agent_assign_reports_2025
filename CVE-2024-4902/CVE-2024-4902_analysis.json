{
  "cve_id": "CVE-2024-4902",
  "description": "The Tutor LMS - eLearning and online course solution plugin for WordPress is vulnerable to **time-based SQL Injection** via the course_id parameter in all versions up to, and including, 2.7.1 due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**. This makes it possible for authenticated attackers, with admin access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.",
  "key_phrases": {
    "rootcause": "insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query",
    "weakness": "time-based SQL Injection",
    "impact": "extract sensitive information from the database",
    "vector": "",
    "attacker": "authenticated attackers",
    "product": "Tutor LMS - eLearning and online course solution plugin for WordPress",
    "version": "all versions up to and including 2.7.1",
    "component": "course_id parameter"
  },
  "reference_content": "Based on the provided information, here's an analysis of CVE-2024-4902:\n\n**1. Verification of CVE Relevance**\n   - The provided content from Wordfence directly references **CVE-2024-4902** and describes a SQL injection vulnerability in the Tutor LMS plugin.\n   - The description matches the stated vulnerability: a time-based SQL Injection via the `course_id` parameter due to insufficient escaping and query preparation.\n\n**2. Root Cause of Vulnerability**\n   - The root cause is the **lack of proper sanitization and escaping** of the `course_id` parameter when constructing SQL queries. This allows an attacker to inject malicious SQL code into the query.\n   - The vulnerability lies within the plugin\u2019s `classes/Utils.php` file in a function that performs a database query.\n\n**3. Weaknesses/Vulnerabilities Present**\n   - **SQL Injection:** The primary vulnerability is SQL injection, specifically time-based.\n   - **Insufficient Input Sanitization:** The plugin does not sufficiently sanitize or escape the user-supplied `course_id` parameter before using it in a SQL query.\n   - **Lack of Prepared Statements:** The use of direct string concatenation to build SQL queries rather than prepared statements allows the injected SQL code to be executed.\n\n**4. Impact of Exploitation**\n   - **Information Disclosure:** Successful exploitation of this vulnerability can allow attackers to gain access to sensitive information from the database.\n  - **Data Manipulation:** The attacker could possibly modify data within the database or delete it.\n   - **Full system compromise:** In severe cases, an attacker may achieve full control over the database and the affected system.\n\n**5. Attack Vectors**\n   - **Attack Vector:** The vulnerability is exploitable remotely via a web request that includes a malformed `course_id` parameter.\n   - **Attack Location:** The attack occurs in the `classes/Utils.php` file, where the vulnerable SQL query is executed.\n\n**6. Required Attacker Capabilities/Position**\n   - **Authentication:** An attacker needs to be an authenticated user with Administrator or a higher-level access rights.\n   - **Technical Skill:** Some technical knowledge is required to craft the malformed SQL injection query effectively.\n\n**Additional Details Beyond the CVE Description**\n- The content from `plugins.trac.wordpress.org` provides specific code changes made to the `Utils.php` file in the Tutor LMS plugin to address the vulnerability (commit: 3098465)\n- Wordfence's analysis indicates that the vulnerability is time-based SQL injection and affects all versions of Tutor LMS up to and including 2.7.1, and that CVE-2024-37256 is likely a duplicate of this vulnerability.",
  "similar_info": {
    "cwe_distribution": {
      "95": {
        "cwe_counts": {
          "CWE-89": 1
        },
        "total_samples": 1,
        "distribution": [
          {
            "cwes": [
              "CWE-89"
            ],
            "frequency": 1,
            "proportion": 1.0
          }
        ]
      },
      "90": {
        "cwe_counts": {},
        "total_samples": 2,
        "distribution": [
          {
            "cwes": [],
            "frequency": 2,
            "proportion": 1.0
          }
        ]
      },
      "85": {
        "cwe_counts": {
          "CWE-89": 3
        },
        "total_samples": 10,
        "distribution": [
          {
            "cwes": [],
            "frequency": 7,
            "proportion": 0.7
          },
          {
            "cwes": [
              "CWE-89"
            ],
            "frequency": 3,
            "proportion": 0.3
          }
        ]
      },
      "80": {
        "cwe_counts": {
          "CWE-89": 4
        },
        "total_samples": 9,
        "distribution": [
          {
            "cwes": [],
            "frequency": 5,
            "proportion": 0.556
          },
          {
            "cwes": [
              "CWE-89"
            ],
            "frequency": 4,
            "proportion": 0.444
          }
        ]
      },
      "75": {
        "cwe_counts": {
          "CWE-89": 5
        },
        "total_samples": 11,
        "distribution": [
          {
            "cwes": [],
            "frequency": 6,
            "proportion": 0.545
          },
          {
            "cwes": [
              "CWE-89"
            ],
            "frequency": 5,
            "proportion": 0.455
          }
        ]
      },
      "70": {
        "cwe_counts": {
          "CWE-89": 6
        },
        "total_samples": 12,
        "distribution": [
          {
            "cwes": [
              "CWE-89"
            ],
            "frequency": 6,
            "proportion": 0.5
          },
          {
            "cwes": [],
            "frequency": 6,
            "proportion": 0.5
          }
        ]
      }
    },
    "cwe_consensus": "CWE-89",
    "similarity_stats": {
      "thresholds": [
        95,
        90,
        85,
        80,
        75,
        70
      ],
      "total_samples_by_threshold": {
        "95": 1,
        "90": 2,
        "85": 10,
        "80": 9,
        "75": 11,
        "70": 12
      },
      "top_cwes_by_threshold": {
        "95": [
          [
            "CWE-89",
            1
          ]
        ],
        "90": [],
        "85": [
          [
            "CWE-89",
            3
          ]
        ],
        "80": [
          [
            "CWE-89",
            4
          ]
        ],
        "75": [
          [
            "CWE-89",
            5
          ]
        ],
        "70": [
          [
            "CWE-89",
            6
          ]
        ]
      }
    },
    "raw_matches": [
      {
        "similarity": 95,
        "cwes": [
          "89"
        ],
        "total": 1,
        "frequency": 1,
        "proportion": 1.0
      },
      {
        "similarity": 90,
        "cwes": [],
        "total": 2,
        "frequency": 2,
        "proportion": 1.0
      },
      {
        "similarity": 85,
        "cwes": [],
        "total": 10,
        "frequency": 7,
        "proportion": 0.7
      },
      {
        "similarity": 85,
        "cwes": [
          "89"
        ],
        "total": 10,
        "frequency": 3,
        "proportion": 0.3
      },
      {
        "similarity": 80,
        "cwes": [],
        "total": 9,
        "frequency": 5,
        "proportion": 0.556
      },
      {
        "similarity": 80,
        "cwes": [
          "89"
        ],
        "total": 9,
        "frequency": 4,
        "proportion": 0.444
      },
      {
        "similarity": 75,
        "cwes": [],
        "total": 11,
        "frequency": 6,
        "proportion": 0.545
      },
      {
        "similarity": 75,
        "cwes": [
          "89"
        ],
        "total": 11,
        "frequency": 5,
        "proportion": 0.455
      },
      {
        "similarity": 70,
        "cwes": [
          "89"
        ],
        "total": 12,
        "frequency": 6,
        "proportion": 0.5
      },
      {
        "similarity": 70,
        "cwes": [],
        "total": 12,
        "frequency": 6,
        "proportion": 0.5
      }
    ]
  },
  "similarity_summary": {
    "consensus_cwe": "CWE-89",
    "top_cwes": [
      [
        "CWE-89",
        19
      ]
    ],
    "confidence_levels": {
      "high": [],
      "medium": [],
      "low": []
    },
    "total_samples": 45
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | 1.0 | Base | Primary CWE | Allowed |\n| CWE-116 | Improper Encoding or Escaping of Output | 0.5 | Class | Secondary Candidate | Allowed-with-Review |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 1.0\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship is that CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] is a base-level CWE, which is generally preferred. There is no child CWE that better represents the **time-based SQL Injection** vulnerability described. CWE-116 [Improper Encoding or Escaping of Output] is a Class-level CWE and a potential secondary weakness, but not the root cause.\n\n```mermaid\ngraph TD\n    cwe89[\"CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')\"]\n    cwe116[\"CWE-116: Improper Encoding or Escaping of Output\"]\n    \n    cwe89 -- o\n    cwe116 -- o\n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    \n    class cwe89 primary\n    class cwe116 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query** (root cause). This leads directly to the **time-based SQL Injection** vulnerability, which allows attackers to extract sensitive information from the database (impact).\n\n## Summary of Analysis\nThe primary CWE identified is CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')], with a confidence of 1.0. The root cause of this vulnerability is the **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**.\n\nThe evidence supporting this includes:\n*   The vulnerability description explicitly states: \"due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**\".\n*   The CVE Reference Links Content Summary states: \"The root cause is the **lack of proper sanitization and escaping** of the `course_id` parameter when constructing SQL queries.\"\n\nCWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] is the most specific and accurate representation of this **SQL Injection** vulnerability.\n\nI considered CWE-116 [Improper Encoding or Escaping of Output] as a secondary weakness but it is a class level CWE and does not directly represent the **SQL Injection** nature of the vulnerability. It is a more general weakness related to output encoding. Also, CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] already covers the **lack of proper sanitization and escaping**.",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | 1.0 | Base | Primary CWE | Allowed |\n| CWE-116 | Improper Encoding or Escaping of Output | 0.5 | Class | Secondary Candidate | Allowed-with-Review |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 1.0\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship is that CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] is a base-level CWE, which is generally preferred. There is no child CWE that better represents the **time-based SQL Injection** vulnerability described. CWE-116 [Improper Encoding or Escaping of Output] is a Class-level CWE and a potential secondary weakness, but not the root cause.\n\n```mermaid\ngraph TD\n    cwe89[\"CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')\"]\n    cwe116[\"CWE-116: Improper Encoding or Escaping of Output\"]\n    \n    cwe89 -- o\n    cwe116 -- o\n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    \n    class cwe89 primary\n    class cwe116 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query** (root cause). This leads directly to the **time-based SQL Injection** vulnerability, which allows attackers to extract sensitive information from the database (impact).\n\n## Summary of Analysis\nThe primary CWE identified is CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')], with a confidence of 1.0. The root cause of this vulnerability is the **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**.\n\nThe evidence supporting this includes:\n*   The vulnerability description explicitly states: \"due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**\".\n*   The CVE Reference Links Content Summary states: \"The root cause is the **lack of proper sanitization and escaping** of the `course_id` parameter when constructing SQL queries.\"\n\nCWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] is the most specific and accurate representation of this **SQL Injection** vulnerability.\n\nI considered CWE-116 [Improper Encoding or Escaping of Output] as a secondary weakness but it is a class level CWE and does not directly represent the **SQL Injection** nature of the vulnerability. It is a more general weakness related to output encoding. Also, CWE-89 [Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')] already covers the **lack of proper sanitization and escaping**.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-89:**\n- 89 (Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')) - ROOT\n\n\n**Chain starting from CWE-116:**\n- 116 (Improper Encoding or Escaping of Output) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "89",
        "name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
        "source": "alternate_terms",
        "original_matched_text": "AlternateTerms: SQL injection",
        "match_reason": "term_in_phrase_whole_phrase"
      },
      "similarity": 800.0,
      "alternate_term_match": true
    },
    {
      "metadata": {
        "doc_id": "116",
        "name": "Improper Encoding or Escaping of Output",
        "source": "sparse"
      },
      "similarity": 576.6477172196703
    },
    {
      "metadata": {
        "doc_id": "352",
        "name": "Cross-Site Request Forgery (CSRF)",
        "source": "sparse"
      },
      "similarity": 528.1225247254775
    },
    {
      "metadata": {
        "doc_id": "434",
        "name": "Unrestricted Upload of File with Dangerous Type",
        "source": "sparse"
      },
      "similarity": 515.1203862161415
    },
    {
      "metadata": {
        "doc_id": "90",
        "name": "Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')",
        "source": "sparse"
      },
      "similarity": 509.53645903717415
    },
    {
      "metadata": {
        "doc_id": "502",
        "name": "Deserialization of Untrusted Data",
        "source": "sparse"
      },
      "similarity": 506.3207974571885
    },
    {
      "metadata": {
        "doc_id": "790",
        "name": "Improper Filtering of Special Elements",
        "source": "sparse"
      },
      "similarity": 505.6520062169708
    },
    {
      "metadata": {
        "doc_id": "862",
        "name": "Missing Authorization",
        "source": "sparse"
      },
      "similarity": 502.68446222778243
    },
    {
      "metadata": {
        "doc_id": "472",
        "name": "External Control of Assumed-Immutable Web Parameter",
        "type": "Base",
        "original_content": "The web application does not sufficiently verify inputs that are assumed to be immutable but are actually externally controllable, such as hidden form fields.",
        "keyphrase_source": "weakness:time-based SQL Injection",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense",
            "graph"
          ],
          "retriever_count": 2,
          "normalized_scores": {
            "dense": 0.5016960072088488,
            "graph": 2.054513129056197
          }
        }
      },
      "similarity": 0.5016960072088488
    },
    {
      "doc_id": "73",
      "text": "CWE-73: External Control of File Name or Path",
      "score": 2.2100000000000004,
      "metadata": {
        "doc_id": "73",
        "name": "External Control of File Name or Path",
        "type": "base",
        "original_content": "CWE-73: External Control of File Name or Path",
        "relationships": [
          {
            "source_id": "73",
            "target_id": "114",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "59",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "434",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "98",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "41",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "22",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "20",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "700"
            }
          },
          {
            "source_id": "73",
            "target_id": "610",
            "label": "CHILDOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "73",
            "target_id": "642",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "99",
            "target_id": "73",
            "label": "CANALSOBE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "98",
            "target_id": "73",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "642",
            "target_id": "73",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "610",
            "target_id": "73",
            "label": "PARENTOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "59",
            "target_id": "73",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "434",
            "target_id": "73",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "41",
            "target_id": "73",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "22",
            "target_id": "73",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "20",
            "target_id": "73",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "700"
            }
          },
          {
            "source_id": "114",
            "target_id": "73",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "434",
                  "73",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "434"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "434",
                  "73",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "434"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "73",
                  "434",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "434"
            }
          }
        },
        "position": "after",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.2100000000000004
          }
        }
      },
      "similarity": 2.2100000000000004
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-89",
      "CWE-116"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}