# Vulnerability Information: CVE-2024-35242

## Vulnerability Description
Composer is a dependency manager for PHP. On the 2.x branch prior to versions 2.2.24 and 2.7.7, the `composer install` command running inside a git/hg repository which has specially crafted branch names can lead to **command injection**. This requires cloning untrusted repositories. Patches are available in version 2.2.24 for 2.2 LTS or 2.7.7 for mainline. As a workaround, avoid cloning potentially compromised repositories.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **impact:** execute arbitrary commands
- **vector:** specially crafted branch names
- **product:** Composer
- **version:** 2.x prior to 2.2.24 and 2.7.7

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-35242:

**Root Cause of Vulnerability:**

The vulnerability stems from the way Composer handles version guessing when dealing with Git and Mercurial (hg) repositories. Specifically, when determining the version of a package, Composer executes shell commands using branch names as part of the command arguments. If an attacker can control these branch names, they can inject arbitrary commands, leading to command injection.

**Weaknesses/Vulnerabilities Present:**

*   **Command Injection:** The core weakness is the lack of proper sanitization or escaping of branch names when constructing shell commands. This allows an attacker to inject malicious code into the command string.
*   **Insecure use of `str_replace`**: The code uses `str_replace` to inject branch names into the command. This is vulnerable to command injection as special characters in branch names are not escaped.
*  **Use of shell commands**: The application uses shell commands to determine version information. This makes it vulnerable to command injection.

**Impact of Exploitation:**

Successful exploitation of this vulnerability allows an attacker to execute arbitrary commands on the system running Composer. This can lead to:

*   **Remote Code Execution (RCE):** The attacker can gain full control of the system, enabling them to install malware, steal sensitive information, or disrupt services.
*   **Data Breach:** The attacker can access and exfiltrate sensitive data stored on the system.
*   **System Compromise:** The attacker can modify or delete system files, causing significant damage.

**Attack Vectors:**

*   **Malicious Repository:** An attacker can create a Git or Hg repository with specially crafted branch names.
*   **Cloning Untrusted Repositories:** The vulnerability is triggered when a user clones a malicious repository and executes `composer install`.

**Required Attacker Capabilities/Position:**

*   **Repository Control:** The attacker needs control over a Git or Hg repository.
*   **User Interaction:** The attack requires a user to clone the attacker's malicious repository and run `composer install`.

**Additional Notes:**

*   The fix involves passing the SCM command as an array, instead of as a string, which prevents the shell from interpreting special characters and commands from the branch names.
*   The vulnerability is present in versions of Composer prior to 2.2.24 and 2.7.7.
*   The vulnerability is rated as High severity.
*  The vulnerability affects both git and hg repositories.
* The vulnerability can be triggered by cloning an untrusted repository.

This analysis is based on the provided content, which includes the commit diffs, and the security advisory.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.503 |
| 4 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.388 |
| 5 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.372 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.371 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.358 |
| 8 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.356 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.446 |
| 10 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | graph | 0.003 |

