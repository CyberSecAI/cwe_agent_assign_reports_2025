{
  "cve_id": "CVE-2024-43801",
  "description": "Jellyfin is an open source self hosted media server. The Jellyfin user profile image upload accepts SVG files, allowing for a **stored XSS attack** against an admin user via a specially crafted malicious SVG file. When viewed by an admin outside of the Jellyfin Web UI (e.g. via view image in a browser), this malicious SVG file could interact with the browsers LocalStorage and retrieve an AccessToken, which in turn can be used in an API call to elevate the target user to a Jellyfin administrator. The actual attack vector is unlikely to be exploited, as it requires specific actions by the administrator to view the SVG image outside of Jellyfins WebUI, i.e. it is not a passive attack. The underlying exploit mechanism is solved by PR #12490, which forces attached images (including the potential malicious SVG) to be treated as attachments and thus downloaded by browsers, rather than viewed. This prevents exploitation of the LocalStorage of the browser. This PR has been merged and the relevant code changes are included in release version 10.9.10. All users are advised to upgrade.",
  "key_phrases": {
    "rootcause": "",
    "weakness": "stored XSS attack",
    "impact": "access the AccessToken",
    "vector": "specially crafted malicious SVG file",
    "attacker": "Jellyfin user",
    "product": "Jellyfin",
    "version": "before 10.9.10",
    "component": "user profile image upload"
  },
  "reference_content": "Based on the provided content, here's a breakdown of the vulnerability described in CVE-2024-43801:\n\n**Root Cause of Vulnerability:**\n\n*   The Jellyfin user profile image upload functionality accepts SVG files without proper validation. This allows an attacker to upload a malicious SVG file containing JavaScript code.\n\n**Weaknesses/Vulnerabilities Present:**\n\n*   **Stored Cross-Site Scripting (XSS):** Malicious JavaScript code embedded within a crafted SVG file is stored on the server. When this SVG is viewed, the JavaScript executes.\n*   **Insufficient Input Validation:** The server doesn't properly sanitize or validate SVG files, allowing for the inclusion of executable script tags.\n*   **Insecure Storage of Access Tokens:** Access tokens are stored in the browser's `localStorage` instead of using secure HTTP-only cookies. This makes them accessible to client-side JavaScript.\n*   **Lack of Proper Access Control for Privileged Actions**: Administrative actions, such as adding plugin repositories, installing plugins, or modifying user privileges, do not require additional re-authentication.\n\n**Impact of Exploitation:**\n\n*   **Privilege Escalation:** An attacker can exploit the XSS vulnerability to steal an administrator's access token. They can then use this token to elevate their own user account to administrator privileges.\n*  **Arbitrary Code Execution:** By adding a malicious plugin repository and installing a malicious plugin, an attacker can achieve arbitrary code execution on the host server. This allows the attacker to execute operating system commands.\n*   **Full System Compromise**: By achieving RCE the attacker effectively compromises the underlying system.\n\n**Attack Vectors:**\n\n*   **Malicious SVG Upload:** A low-privileged user uploads a specially crafted SVG file as their profile picture.\n*   **Social Engineering/Direct Access:** An administrator views the malicious SVG file directly (e.g., by opening the image in a new browser tab or being sent the URL to it). This can be achieved by an attacker sending the URL to their profile picture to an administrator.\n*   **XSS Execution:** When the administrator views the image, the embedded JavaScript executes.\n*   **API Exploitation:** The attacker's JavaScript retrieves the admin's access token from `localStorage`. This token is then used to make API calls to escalate the low-privileged attacker user to admin status and install malicious plugins.\n\n**Required Attacker Capabilities/Position:**\n\n*   **Low-Privileged User Account:** The attacker needs a valid user account on the Jellyfin server to upload the malicious SVG.\n*   **Administrator Interaction:** The attacker needs an administrator to view the malicious SVG file directly for the exploit to work.\n*   **Network Access (for RCE):** For RCE, the attacker needs a web server where the malicious plugin manifest and DLL are hosted and accessible to the Jellyfin server.\n\n**Additional Information:**\n\n*   The vulnerability affects Jellyfin versions 10.8.0 and later up to 10.9.9.\n*   The vulnerability is fixed in version 10.9.10 and later.\n*   The fix implemented forces browsers to download the images rather than rendering them to prevent the XSS.\n*   The exploit chain detailed in the blog goes beyond a simple stored XSS by adding in privilege escalation and RCE using a malicious plugin.\n*   The blog post suggests best practice such as implementing `content-disposition: attachment` header, sanitizing SVG upon upload, implementing a content security policy, and requiring re-authentication for privileged functionality.\n\nThe provided content offers more technical details and a comprehensive explanation of the exploit chain than the typical CVE description would provide. It also includes a detailed timeline of the vulnerability discovery and disclosure process.",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | 1.0 | Base | Allowed | Primary CWE. The root cause is the **stored XSS attack** due to the acceptance of SVG files without proper neutralization. |\n| CWE-434 | Unrestricted Upload of File with Dangerous Type | 0.8 | Base | Allowed | Secondary Candidate. The vulnerability exists because the application allows the upload of SVG files, which can contain malicious code. |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary weakness is CWE-79, which is triggered by uploading a file with a dangerous type, CWE-434. CWE-79 is at the Base level, which is a preferred level for mapping.\n\n```mermaid\ngraph TD\n    cwe79[\"CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\"]\n    cwe434[\"CWE-434: Unrestricted Upload of File with Dangerous Type\"]\n\n    cwe79 -- CANFOLLOW --> cwe434\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe79 primary\n    class cwe434 secondary\n```\n\n## Vulnerability Chain\n1.  **Unrestricted File Upload (CWE-434):** A user can upload an SVG file.\n2.  **Improper Neutralization of Input During Web Page Generation (CWE-79):** The SVG file contains malicious JavaScript that is executed when the image is viewed, leading to a **stored XSS attack**.\n3.  **Privilege Escalation:** The XSS attack allows an attacker to access the AccessToken and escalate privileges.\n4.  **Remote Code Execution:** By adding a malicious plugin repository and installing a malicious plugin.\n\n## Summary of Analysis\nThe primary weakness is CWE-79, as the root cause is the **improper neutralization of input**, leading to a **stored XSS attack**. This is supported by the vulnerability description and CVE reference links. The application allows the upload of SVG files (CWE-434), which facilitates the XSS attack, making it a secondary concern. The relationship analysis shows that CWE-434 can precede CWE-79 in a vulnerability chain.\n\nThe vulnerability description clearly states, \"The Jellyfin user profile image upload accepts SVG files, allowing for a **stored XSS attack** against an admin user via a specially crafted malicious SVG file.\" This directly supports the selection of CWE-79. The CVE Reference Links Content Summary also states \"**Stored Cross-Site Scripting (XSS):** Malicious JavaScript code embedded within a crafted SVG file is stored on the server. When this SVG is viewed, the JavaScript executes.\"\n\nThe retriever results also list CWE-79 and CWE-434 as high-scoring candidates.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-434: Unrestricted Upload of File with Dangerous Type\n**Abstraction Level**: Base\n**Similarity Score**: 0.77\n**Source**: dense\n\n**Description**:\nThe product allows the upload or transfer of dangerous file types that are automatically processed within its environment.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n## CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | 1.0 | Base | Allowed | Primary CWE. The root cause is the **stored XSS attack** due to the acceptance of SVG files without proper neutralization. |\n| CWE-434 | Unrestricted Upload of File with Dangerous Type | 0.8 | Base | Allowed | Secondary Candidate. The vulnerability exists because the application allows the upload of SVG files, which can contain malicious code. |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary weakness is CWE-79, which is triggered by uploading a file with a dangerous type, CWE-434. CWE-79 is at the Base level, which is a preferred level for mapping.\n\n```mermaid\ngraph TD\n    cwe79[\"CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\"]\n    cwe434[\"CWE-434: Unrestricted Upload of File with Dangerous Type\"]\n\n    cwe79 -- CANFOLLOW --> cwe434\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe79 primary\n    class cwe434 secondary\n```\n\n## Vulnerability Chain\n1.  **Unrestricted File Upload (CWE-434):** A user can upload an SVG file.\n2.  **Improper Neutralization of Input During Web Page Generation (CWE-79):** The SVG file contains malicious JavaScript that is executed when the image is viewed, leading to a **stored XSS attack**.\n3.  **Privilege Escalation:** The XSS attack allows an attacker to access the AccessToken and escalate privileges.\n4.  **Remote Code Execution:** By adding a malicious plugin repository and installing a malicious plugin.\n\n## Summary of Analysis\nThe primary weakness is CWE-79, as the root cause is the **improper neutralization of input**, leading to a **stored XSS attack**. This is supported by the vulnerability description and CVE reference links. The application allows the upload of SVG files (CWE-434), which facilitates the XSS attack, making it a secondary concern. The relationship analysis shows that CWE-434 can precede CWE-79 in a vulnerability chain.\n\nThe vulnerability description clearly states, \"The Jellyfin user profile image upload accepts SVG files, allowing for a **stored XSS attack** against an admin user via a specially crafted malicious SVG file.\" This directly supports the selection of CWE-79. The CVE Reference Links Content Summary also states \"**Stored Cross-Site Scripting (XSS):** Malicious JavaScript code embedded within a crafted SVG file is stored on the server. When this SVG is viewed, the JavaScript executes.\"\n\nThe retriever results also list CWE-79 and CWE-434 as high-scoring candidates.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-434: Unrestricted Upload of File with Dangerous Type\n**Abstraction Level**: Base\n**Similarity Score**: 0.77\n**Source**: dense\n\n**Description**:\nThe product allows the upload or transfer of dangerous file types that are automatically processed within its environment.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n## CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-79:**\n- 79 (Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')) - ROOT\n\n\n**Chain starting from CWE-434:**\n- 434 (Unrestricted Upload of File with Dangerous Type) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "79",
        "name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
        "source": "alternate_terms",
        "original_matched_text": "AlternateTerms: XSS",
        "match_reason": "term_in_phrase_whole_phrase"
      },
      "similarity": 800.0,
      "alternate_term_match": true
    },
    {
      "metadata": {
        "doc_id": "611",
        "name": "Improper Restriction of XML External Entity Reference",
        "source": "sparse"
      },
      "similarity": 978.256385814981
    },
    {
      "metadata": {
        "doc_id": "434",
        "name": "Unrestricted Upload of File with Dangerous Type",
        "source": "sparse"
      },
      "similarity": 969.9308812694255
    },
    {
      "metadata": {
        "doc_id": "23",
        "name": "Relative Path Traversal",
        "source": "sparse"
      },
      "similarity": 930.0220002243343
    },
    {
      "metadata": {
        "doc_id": "22",
        "name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
        "source": "sparse"
      },
      "similarity": 915.1163781656841
    },
    {
      "metadata": {
        "doc_id": "352",
        "name": "Cross-Site Request Forgery (CSRF)",
        "source": "sparse"
      },
      "similarity": 890.380622043521
    },
    {
      "metadata": {
        "doc_id": "522",
        "name": "Insufficiently Protected Credentials",
        "source": "sparse"
      },
      "similarity": 884.9746385793383
    },
    {
      "metadata": {
        "doc_id": "863",
        "name": "Incorrect Authorization",
        "source": "sparse"
      },
      "similarity": 884.3237304359665
    },
    {
      "metadata": {
        "doc_id": "82",
        "name": "Improper Neutralization of Script in Attributes of IMG Tags in a Web Page",
        "type": "Variant",
        "original_content": "The web application does not neutralize or incorrectly neutralizes scripting elements within attributes of HTML IMG tags, such as the src attribute.",
        "keyphrase_source": "weakness:stored XSS attack",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "dense": 0.5031966815034268
          }
        }
      },
      "similarity": 0.5031966815034268
    },
    {
      "doc_id": "184",
      "text": "CWE-184: Incomplete List of Disallowed Inputs",
      "score": 2.2100000000000004,
      "metadata": {
        "doc_id": "184",
        "name": "Incomplete List of Disallowed Inputs",
        "type": "base",
        "original_content": "CWE-184: Incomplete List of Disallowed Inputs",
        "relationships": [
          {
            "source_id": "184",
            "target_id": "692",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "98",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "434",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "78",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "79",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "1023",
            "label": "CHILDOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "184",
            "target_id": "693",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "98",
            "target_id": "184",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "86",
            "target_id": "184",
            "label": "PEEROF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "79",
            "target_id": "184",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "78",
            "target_id": "184",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "693",
            "target_id": "184",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "692",
            "target_id": "184",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "692",
            "target_id": "184",
            "label": "STARTSWITH",
            "properties": {
              "view_id": "709"
            }
          },
          {
            "source_id": "625",
            "target_id": "184",
            "label": "PEEROF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "434",
            "target_id": "184",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "186",
            "target_id": "184",
            "label": "CANALSOBE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "1023",
            "target_id": "184",
            "label": "PARENTOF",
            "properties": {
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "79",
                  "184",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "79"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "79",
                  "184",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "79"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "184",
                  "79",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "79"
            }
          }
        },
        "position": "after",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.2100000000000004
          }
        }
      },
      "similarity": 2.2100000000000004
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-79",
      "CWE-434"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}