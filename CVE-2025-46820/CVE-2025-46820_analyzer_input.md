# Vulnerability Information: CVE-2025-46820

## Vulnerability Description
phpgt/Dom provides access to modern DOM APIs. Versions of phpgt/Dom prior to 4.1.8 expose the GITHUB_TOKEN in the Dom workflow run artifact. The ci.yml workflow file uses actions/upload-artifact@v4 to upload the build artifact. This artifact is a zip of the current directory, which includes the automatically generated .git/config file containing the runs GITHUB_TOKEN. Seeing as the artifact can be downloaded prior to the end of the workflow, there is a few seconds where an attacker can extract the token from the artifact and use it with the GitHub API to push malicious code or rewrite release commits in your repository. Any downstream user of the repository may be affected, but the token should only be valid for the duration of the workflow run, limiting the time during which exploitation could occur. Version 4.1.8 fixes the issue.

### Vulnerability Description Key Phrases
- **component:** Dom workflow run artifact
- **weakness:** **GITHUB_TOKEN exposure**
- **product:** phpgt/Dom
- **impact:** ['push malicious code', 'rewrite release commits']
- **version:** prior to 4.1.8

## CVE Reference Links Content Summary
## Analysis of CVE-2025-46820 based on provided content

The provided content is directly related to CVE-2025-46820. It details a vulnerability in the phpgt/Dom project, specifically regarding the potential leakage of the `GITHUB_TOKEN` during workflow runs.

**Root cause of vulnerability:**

The vulnerability stems from including the `.git/config` file (which contains the `GITHUB_TOKEN`) when archiving the build artifact using `actions/upload-artifact@v4`. This file is automatically generated by GitHub for workflow authentication.

**Weaknesses/vulnerabilities present:**

*   Insecure artifact creation: Archiving the entire working directory, including sensitive files like `.git/config`.
*   Exposure of secrets: The `GITHUB_TOKEN` is a secret that, if compromised, can allow an attacker to perform actions on behalf of the repository owner.

**Impact of exploitation:**

An attacker who gains access to the `GITHUB_TOKEN` can:

*   Push malicious code to the repository.
*   Rewrite release commits, potentially injecting backdoors into released software.

**Attack vectors:**

*   Monitoring workflow runs and downloading the artifact before it's cleaned up.
*   Extracting the `GITHUB_TOKEN` from the `.git/config` file within the downloaded artifact.

**Required attacker capabilities/position:**

*   Ability to monitor GitHub workflow runs.
*   Ability to download workflow artifacts.
*   Basic understanding of the GitHub API and how to use the `GITHUB_TOKEN`.

**Mitigation or fix:**

The commit message (205cddc) details the following fixes:

*   Excluding the `.git` directory from the archived build artifact using `--exclude=".git"` in the `tar` command.
*   Restricting token permissions.
*   Deleting old artifacts that start with "build-artifact".
*   Opening action permission only on the remove artifact job.
*   Adding permissions to the workflow file to restrict access.

**Additional Details (more than official CVE description):**

*   The CVSS score is calculated as 7.1/10.
*   CVSS v3 base metrics are provided: AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:H/A:H
*   The vulnerability was reported by @jackhac and @nopcorn.
*   The patched version is 4.1.8.
*   The affected versions are <4.1.8.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.778 |
| 2 | 214 | Invocation of Process Using Visible Sensitive Information | Base | Allowed | sparse | 0.761 |
| 3 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.748 |
| 4 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.723 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.716 |
| 6 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.713 |
| 7 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.711 |
| 8 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.710 |
| 9 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | dense | 0.399 |
| 10 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | graph | 0.002 |

