## Vulnerability Description
Vault and Vault Enterprise **did not properly validate the JSON Web Token (JWT) role-bound audience claim** when using the Vault JWT auth method. This may have resulted in Vault validating a JWT the audience and role-bound claims do not match, allowing an invalid login to succeed when it should have been rejected. This vulnerability, CVE-2024-5798, was fixed in Vault and Vault Enterprise 1.17.0, 1.16.3, and 1.15.9

### Vulnerability Description Key Phrases
- **rootcause:** **did not properly validate the JSON Web Token (JWT) role-bound audience claim**
- **impact:** allowing an invalid login to succeed when it should have been rejected
- **product:** Vault and Vault Enterprise
- **version:** before 1.17.0, 1.16.3, and 1.15.9
- **component:** Vault JWT auth method

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

*   The vulnerability stems from an incorrect implementation of JWT audience claim validation within the Vault JWT auth method. Specifically, Vault only applied validation logic if the audience claim was a single string, failing to handle cases where it was a list of strings, which is allowed by RFC 7518.

**Weaknesses/Vulnerabilities:**

*   **Incorrect JWT Audience Validation:** The primary weakness is the flawed validation logic for the JWT audience claim. When the audience claim was provided as a list of strings, the validation logic was skipped, leading to a bypass of security checks.
*   **Missing Role-Bound Audience Check:** The intended logic to verify the presence of role-bound audience claims against the JWT audience claims was not executed when the audience was a list, resulting in improper authentication.

**Impact of Exploitation:**

*   **Unauthorized Access:** An attacker could potentially bypass authentication by presenting a JWT with an audience claim structured as a list of strings, even if it did not match the expected role-bound audiences.
*   **Invalid Login Success:** Vault would incorrectly validate the JWT, allowing an invalid login to succeed, which would not have happened if the audience validation had been performed correctly.
*   **Compromised System Access:** Successful login through this vulnerability could grant an attacker access to the underlying system protected by Vault.

**Attack Vectors:**

*   **Malicious JWT:** An attacker crafts a JWT with an audience claim structured as a list of strings, ensuring it bypasses Vault's faulty validation.
*   **JWT Auth Method:** The vulnerability is specific to the JWT auth method of Vault.

**Required Attacker Capabilities/Position:**

*   **Ability to forge JWTs:** The attacker needs to be able to create or manipulate JWTs, potentially by controlling the system that issues the tokens.
*   **Knowledge of the vulnerable Vault setup:** The attacker must be aware that the target system uses the Vault JWT auth method and the version is vulnerable.
*  **Access to Vault endpoint:** The attacker needs to be able to send their forged JWT to the Vault server.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.511 |
| 2 | 267 | Privilege Defined With Unsafe Actions | Base | Allowed | sparse | 0.483 |
| 3 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.466 |
| 4 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.454 |
| 5 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.448 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.424 |
| 7 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.421 |
| 8 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.415 |
| 9 | 1270 | Generation of Incorrect Security Tokens | Base | Allowed | dense | 0.484 |
| 10 | 613 | Insufficient Session Expiration | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-502: Deserialization of Untrusted Data

CWE-267: Privilege Defined With Unsafe Actions

CWE-863: Incorrect Authorization

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-287: Improper Authentication

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-347: Improper Verification of Cryptographic Signature

CWE-306: Missing Authentication for Critical Function

CWE-1270: Generation of Incorrect Security Tokens

CWE-613: Insufficient Session Expiration