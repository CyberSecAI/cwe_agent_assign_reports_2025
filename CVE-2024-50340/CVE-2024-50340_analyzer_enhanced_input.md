## Vulnerability Description
symfony/runtime is a module for the Symphony PHP framework which enables decoupling PHP applications from global state. When the `register_argv_argc` php directive is set to `on` , and users call any URL with a special crafted query string, they are able to change the environment or debug mode used by the kernel when handling the request. As of versions 5.4.46, 6.4.14, and 7.1.7 the `SymfonyRuntime` now ignores the `argv` values for non-SAPI PHP runtimes. All users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **impact:** change the environment or debug mode used by the kernel
- **vector:** special crafted query string
- **product:** symfony/runtime
- **version:** 5.4.46, 6.4.14, and 7.1.7

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

- The vulnerability arises when the PHP directive `register_argc_argv` is set to `on`.
- When this directive is enabled, the `SymfonyRuntime` component incorrectly uses values from the `argv` array (command-line arguments), even when the application is not running in a command-line interface (CLI) environment, like when handling web requests.

**Weaknesses/Vulnerabilities:**

- **Incorrect use of `argv`:** The `SymfonyRuntime` component was designed to use command-line arguments (`argv`) to determine the environment or debug mode, but it was not correctly distinguishing between CLI and non-CLI SAPI environments. When `register_argc_argv` is on, the server populates $_SERVER['argv'] even in a non-CLI context.
- **Environment manipulation:**  By crafting a special query string, attackers can influence the `argv` array. Because the runtime uses `argv` to determine which environment or debug mode to use, this allows attackers to change the environment/debug mode of the kernel.

**Impact of Exploitation:**

- **Environment Modification:** Attackers can change the application's environment or debug mode by using a specially crafted query string. This can have a range of consequences, including:
    - Potential exposure of sensitive information.
    - Altering application behavior in unintended ways.
    - Facilitating further attacks by placing the application in a debug state or specific environment where further vulnerabilities might be present.

**Attack Vectors:**

- **Network-based:** The attack is performed via HTTP requests by sending a specifically crafted query string in the URL.

**Required Attacker Capabilities/Position:**

- **No authentication required:** The attacker does not need any special privileges to perform the attack.
- **Network access:** The attacker needs to be able to send HTTP requests to the vulnerable application.
- **Knowledge of the vulnerability**: the attacker must be aware of the vulnerability and craft their query string accordingly.

**Additional Details:**

- The fix implemented in the commit `a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa` addresses the issue by ensuring that `SymfonyRuntime` ignores `argv` values for non-CLI SAPIs.
- The provided CVSS score is 7.3, which is considered high severity.

**Summary of the fix:**

The fix modifies the SymfonyRuntime.php file to check if the request contains GET parameters. If it does, and if `register_argc_argv` is enabled, an exception is thrown to prevent CLI parameters from being interpreted in a web context, which is an unsafe operation. Additionally, the fix modifies the kernel test file to construct the test kernel with both the environment and a variable value so the test can more accurately represent the expected kernel creation.

This vulnerability highlights a case where a feature intended for CLI use was improperly extended to non-CLI environments, leading to a security risk.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.178 |
| 2 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.177 |
| 3 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.175 |
| 4 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.175 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.174 |
| 6 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.171 |
| 7 | 1236 | Improper Neutralization of Formula Elements in a CSV File | Base | Allowed | sparse | 0.170 |
| 8 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.169 |
| 9 | 473 | PHP External Variable Modification | Variant | Allowed | dense | 0.403 |
| 10 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-863: Incorrect Authorization

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-116: Improper Encoding or Escaping of Output

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-502: Deserialization of Untrusted Data

CWE-1236: Improper Neutralization of Formula Elements in a CSV File

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-473: PHP External Variable Modification

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')