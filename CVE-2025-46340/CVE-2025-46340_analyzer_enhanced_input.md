## Vulnerability Description
Misskey is an open source, federated social media platform. Starting in version 12.0.0 and prior to version 2025.4.1, due to an oversight in the validation performed in `UrlPreviewService` and `MkUrlPreview`, it is possible for an attacker to inject arbitrary CSS into the `MkUrlPreview` component. `UrlPreviewService.wrap` falls back to returning the original URL if its using a protocol that is likely to not be understood by Misskey, IE something other than `http` or `https`. This both can de-anonymize users and_allow further attacks in the client. Additionally, `MkUrlPreview` doesnt escape CSS when applying a `background-image` property, allowing an attacker to craft a URL that applies arbitrary styles to the preview element. Theoretically, an attacker can craft a CSS injection payload to create a fake error message that can deceive the user into giving away their credentials or similar sensitive information. Version 2025.4.1 contains a patch for the issue.

### Vulnerability Description Key Phrases
- **component:** UrlPreviewService and MkUrlPreview
- **rootcause:** **oversight in validation performed in UrlPreviewService and MkUrlPreview**
- **vector:** craft a URL
- **weakness:** **cross-site scripting**
- **product:** Misskey
- **impact:** de-anonymize users, inject arbitrary CSS
- **version:** 12.0.0 to 2025.4.1

## CVE Reference Links Content Summary
```text
Root cause of vulnerability:
- Oversight in the validation performed in `UrlPreviewService` and `MkUrlPreview`.
- `UrlPreviewService.wrap` falls back to returning the original URL if it's using a protocol that is likely to not be understood by Misskey (e.g., not `http` or `https`).
- `MkUrlPreview` doesn't escape CSS when applying a `background-image` property.

Weaknesses/vulnerabilities present:
- CSS Injection
- Improper Input Validation

Impact of exploitation:
- An attacker can inject arbitrary CSS into the `MkUrlPreview` component.
- An attacker can craft a CSS injection payload to create a fake error message to deceive users.
- Potential deanonymization of users.

Attack vectors:
- Network (Remote)
- Crafting a URL with a malicious `twitter:image` opengraph attribute (e.g., using `ftp://` protocol).
- Linking to a webserver hosting a malicious HTML page.

Required attacker capabilities/position:
- No privileges required.
- No user interaction required.
- Network access.

Mitigation or fix:
- Patched in version 2025.4.1.
- Proper validation of URLs in `UrlPreviewService`.
- Escaping CSS when applying `background-image` property in `MkUrlPreview`.

CVSS Score: 7.2 (High)
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
CWE ID: CWE-20
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.877 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.818 |
| 3 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.809 |
| 4 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.796 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.792 |
| 6 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.791 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.791 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.789 |
| 9 | 451 | User Interface (UI) Misrepresentation of Critical Information | Class | Allowed-with-Review | dense | 0.533 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-116: Improper Encoding or Escaping of Output

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-863: Incorrect Authorization

CWE-1333: Inefficient Regular Expression Complexity

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-138: Improper Neutralization of Special Elements

CWE-451: User Interface (UI) Misrepresentation of Critical Information

CWE-117: Improper Output Neutralization for Logs