{
  "retriever": "sparse",
  "query": "In the Linux kernel, the following vulnerability has been resolved team prevent adding a device which is already a team device lower Prevent adding a device which is already a team device lower, e.g. adding veth0 if vlan1 was already added and veth0 is a lower of vlan1. This is not useful in practice and can lead to recursive locking $ ip link add veth0 type veth peer name veth1 $ ip link set veth0 up $ ip link set veth1 up $ ip link add link veth0 name veth0.1 type vlan protocol 802.1Q id 1 $ ip link add team0 type team $ ip link set veth0.1 down $ ip link set veth0.1 master team0 team0 Port device veth0.1 added $ ip link set veth0 down $ ip link set veth0 master team0 ============================================ WARNING possible recursive locking detected 6.13.0-rc2-virtme-00441-ga14a429069bb #46 Not tainted -------------------------------------------- ip/7684 is trying to acquire lock ffff888016848e00 (team->team_lock_key){+.+.}-{44}, at team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) but task is already holding lock ffff888016848e00 (team->team_lock_key){+.+.}-{44}, at team_add_slave (drivers/net/team/team_core.c1147 drivers/net/team/team_core.c1977) other info that might help us debug this Possible unsafe locking scenario CPU0 ---- lock(team->team_lock_key) lock(team->team_lock_key) *** DEADLOCK *** May be due to missing lock nesting notation 2 locks held by ip/7684 stack backtrace CPU 3 UID 0 PID 7684 Comm ip Not tainted 6.13.0-rc2-virtme-00441-ga14a429069bb #46 Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014 Call Trace dump_stack_lvl (lib/dump_stack.c122) print_deadlock_bug.cold (kernel/locking/lockdep.c3040) __lock_acquire (kernel/locking/lockdep.c3893 kernel/locking/lockdep.c5226) ? netlink_broadcast_filtered (net/netlink/af_netlink.c1548) lock_acquire.part.0 (kernel/locking/lockdep.c467 kernel/locking/lockdep.c5851) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) ? trace_lock_acquire (./include/trace/events/lock.h24 (discriminator 2)) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) ? lock_acquire (kernel/locking/lockdep.c5822) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) __mutex_lock (kernel/locking/mutex.c587 kernel/locking/mutex.c735) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) ? fib_sync_up (net/ipv4/fib_semantics.c2167) ? team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) team_device_event (drivers/net/team/team_core.c2928 drivers/net/team/team_core.c2951 drivers/net/team/team_core.c2973) notifier_call_chain (kernel/notifier.c85) call_netdevice_notifiers_info (net/core/dev.c1996) __dev_notify_flags (net/core/dev.c8993) ? __dev_change_flags (net/core/dev.c8975) dev_change_flags (net/core/dev.c9027) vlan_device_event (net/8021q/vlan.c85 net/8021q/vlan.c470) ? br_device_event (net/bridge/br.c143) notifier_call_chain (kernel/notifier.c85) call_netdevice_notifiers_info (net/core/dev.c1996) dev_open (net/core/dev.c1519 net/core/dev.c1505) team_add_slave (drivers/net/team/team_core.c1219 drivers/net/team/team_core.c1977) ? __pfx_team_add_slave (drivers/net/team/team_core.c1972) do_set_master (net/core/rtnetlink.c2917) do_setlink.isra.0 (net/core/rtnetlink.c3117)",
  "keyphrases": {
    "rootcause": [
      "unsafe locking scenario"
    ]
  },
  "timestamp": "2025-07-14 00:46:54",
  "cve_id": "CVE-2024-58071",
  "result_count": 10,
  "results": [
    {
      "cwe_id": "667",
      "name": "Improper Locking",
      "score": 1535.7972315931695,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "338",
      "name": "Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)",
      "score": 1504.8054144237267,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "401",
      "name": "Missing Release of Memory after Effective Lifetime",
      "score": 1447.127895194438,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "674",
      "name": "Uncontrolled Recursion",
      "score": 1345.494354770451,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "score": 1328.6336310168836,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "502",
      "name": "Deserialization of Untrusted Data",
      "score": 1312.0958403701388,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "909",
      "name": "Missing Initialization of Resource",
      "score": 1257.0418197626502,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "787",
      "name": "Out-of-bounds Write",
      "score": 1235.2613182114249,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "1389",
      "name": "Incorrect Parsing of Numbers with Different Radices",
      "score": 1228.1113717324888,
      "search_source": "rootcause:unsafe locking scenario"
    },
    {
      "cwe_id": "476",
      "name": "NULL Pointer Dereference",
      "score": 1227.4472469607201,
      "search_source": "rootcause:unsafe locking scenario"
    }
  ]
}