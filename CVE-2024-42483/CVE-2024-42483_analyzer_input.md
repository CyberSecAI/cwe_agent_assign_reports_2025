# Vulnerability Information: CVE-2024-42483

## Vulnerability Description
ESP-NOW Component provides a connectionless Wi-Fi communication protocol. An replay attacks vulnerability was discovered in the implementation of the ESP-NOW because the **caches is not differentiated by message types**, it is a single, shared resource for all kinds of messages, whether they are broadcast or unicast, and regardless of whether they are ciphertext or plaintext. This can result an attacker to clear the cache of its legitimate entries, there by creating an opportunity to re-inject previously captured packets. This vulnerability is fixed in 2.5.2.

### Vulnerability Description Key Phrases
- **rootcause:** **caches is not differentiated by message types**
- **impact:** clear the cache of its legitimate entries and replay attacks
- **attacker:** attacker
- **version:** 2.5.2
- **component:** ESP-NOW Component

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

- The `ESP-NOW` implementation uses a single, shared cache for all message types (broadcast, unicast, ciphertext, plaintext). This lack of differentiation allows an attacker to manipulate the cache.

**Weaknesses/Vulnerabilities:**

- **Replay Attack Vulnerability:** Due to the shared cache, an attacker can clear legitimate entries and re-inject previously captured packets. This is a classic replay attack scenario.
- **Insufficient Cache Separation:** The core issue is the lack of separate caches for plaintext and ciphertext messages.

**Impact of Exploitation:**

- An attacker can replay previously captured packets, potentially leading to:
    - Unauthorized actions
    - Denial of service
    - Other application-specific consequences

**Attack Vectors:**

- The attack vector involves capturing legitimate `ESP-NOW` packets, manipulating the message cache by sending specially crafted packets to evict the legitimate entries, and then re-injecting the captured packets.

**Required Attacker Capabilities/Position:**

- The attacker needs to be within radio range to intercept and transmit `ESP-NOW` packets.
- The attacker needs to understand the structure of `ESP-NOW` messages and the caching mechanism.

**Additional Details:**

- **Patch:** The vulnerability is addressed by implementing separate caches for plaintext and ciphertext messages. This prevents attackers from clearing the ciphertext cache with plaintext messages and vice-versa.
- **Mitigation:** While the patch mitigates the specific attack vector, it is not a complete solution. An attacker with more effort can still replay old ciphertext messages. However, given the connectionless nature of `ESP-NOW`, the fix is considered sufficient.
- **Affected Versions:** Versions of `ESP-NOW` up to and including 2.5.1 are affected.
- **Patched Version:** Version 2.5.2 contains the fix.
- **CVE ID:** CVE-2024-42483
- **CWE:** CWE-349 (Acceptance of Inconsistent Information)

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.557 |
| 2 | 319 | Cleartext Transmission of Sensitive Information | Base | Allowed | sparse | 0.540 |
| 3 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.521 |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.508 |
| 5 | 294 | Authentication Bypass by Capture-replay | Base | Allowed | sparse | 0.493 |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.492 |
| 7 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | sparse | 0.490 |
| 8 | 204 | Observable Response Discrepancy | Base | Allowed | sparse | 0.490 |
| 9 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | dense | 0.502 |
| 10 | 208 | Observable Timing Discrepancy | Base | Allowed | graph | 0.003 |

