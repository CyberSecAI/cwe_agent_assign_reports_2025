## Vulnerability Description
Extract is aA Go library to extract archives in zip, tar.gz or tar.bz2 formats. A maliciously crafted archive may allow an attacker to create a symlink outside the extraction target directory. This vulnerability is fixed in 4.0.0. If youre using the Extractor.FS interface, then upgrading to /v4 will require to implement the new methods that have been added.

### Vulnerability Description Key Phrases
- **weakness:** **create symlink outside the extraction target directory**
- **vector:** maliciously crafted archive
- **attacker:** attacker
- **product:** Extract
- **version:** 4.0.0

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-47877:

**Root Cause of Vulnerability:**
The vulnerability stems from insufficient checks during the extraction of archives, specifically tar and zip files. The `extract` library fails to properly sanitize symlink paths, allowing an attacker to create symbolic links pointing outside of the intended extraction directory.

**Weaknesses/Vulnerabilities Present:**
- **Path Traversal:** The primary vulnerability is a path traversal issue via symlinks. The library doesn't adequately validate the target paths of symbolic links before creating them on the filesystem.
- **Insecure Symlink Handling**: The code creates a placeholder file for symlinks before creating the symlink itself. This is a common technique, but without sufficient validation on the symlink path, it can be exploited.
- The vulnerability is present in both `Tar` and `Zip` archive extraction functions.

**Impact of Exploitation:**
- **Arbitrary File System Access:** By creating symlinks pointing outside the target extraction directory, an attacker can potentially overwrite arbitrary files and directories on the system that the application has permissions to access.
- **Privilege Escalation (Potentially):** Depending on the context in which the application runs and the files it has access to, this could potentially be used to escalate privileges or gain access to sensitive information.
- **Denial of Service (Potentially):** If the symlinks created are part of a loop or target important system files, it could potentially lead to a denial of service.

**Attack Vectors:**
- The attacker crafts a malicious archive (either tar or zip) containing specially constructed symlinks with path traversal sequences.
- The vulnerable application uses the `extract` library to unpack this archive to an arbitrary target directory.
- The symlinks are created, pointing to locations outside the target extraction directory.

**Required Attacker Capabilities/Position:**
- The attacker needs the ability to create a malicious archive, either tar or zip format.
- The attacker must be able to deliver or have the crafted archive processed by an application using the vulnerable `extract` library.
- No special permissions or user level requirements are needed besides the application permissions.

**Additional details:**
- The vulnerability was found by `buglloc` and the fix was implemented by `cmaglie`.
- The fix involves adding new methods to the `FS` interface of the library, providing more control over the file system operations.
- Version `v4` of the library is not backwards compatible with version `v3` if custom `FS` interface is used.
- The vulnerability is assigned CWE-22 which refers to "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')".

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.501 |
| 2 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.456 |
| 3 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.403 |
| 4 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.400 |
| 5 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.307 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.306 |
| 7 | 64 | Windows Shortcut Following (.LNK) | Variant | Allowed | sparse | 0.300 |
| 8 | 377 | Insecure Temporary File | Class | Allowed-with-Review | sparse | 0.300 |
| 9 | 621 | Variable Extraction Error | Variant | Allowed | dense | 0.513 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-61: UNIX Symbolic Link (Symlink) Following

CWE-23: Relative Path Traversal

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-306: Missing Authentication for Critical Function

CWE-64: Windows Shortcut Following (.LNK)

CWE-377: Insecure Temporary File

CWE-621: Variable Extraction Error

CWE-363: Race Condition Enabling Link Following