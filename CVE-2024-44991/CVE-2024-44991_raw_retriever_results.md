# Raw Retriever Results for CVE-2024-44991

# Raw Retriever Results for CVE-2024-44991
## Query
In the Linux kernel, the following vulnerability has been resolved tcp prevent concurrent execution of tcp_sk_exit_batch Its possible that two threads call tcp_sk_exit_batch() concurrently, once from the cleanup_net workqueue, once from a task that failed to clone a new netns. In the latter case, error unwinding calls the exit handlers in reverse order for the failed netns. tcp_sk_exit_batch() calls tcp_twsk_purge(). Problem is that since commit b099ce2602d8 (net Batch inet_twsk_purge), this function picks up twsk in any dying netns, not just the one passed in via exit_batch list. This means that the error unwind of setup_net() can steal and destroy timewait sockets belonging to the exiting netns. This allows the netns exit worker to proceed to call WARN_ON_ONCE(!refcount_dec_and_test(&net->ipv4.tcp_death_row.tw_refcount)) without the expected 1 -> 0 transition, which then splats. At same time, error unwind path that is also running inet_twsk_purge() will splat as well WARNING .. at lib/refcount.c31 refcount_warn_saturate+0x1ed/0x210 ... refcount_dec include/linux/refcount.h351 [inline] inet_twsk_kill+0x758/0x9c0 net/ipv4/inet_timewait_sock.c70 inet_twsk_deschedule_put net/ipv4/inet_timewait_sock.c221 inet_twsk_purge+0x725/0x890 net/ipv4/inet_timewait_sock.c304 tcp_sk_exit_batch+0x1c/0x170 net/ipv4/tcp_ipv4.c3522 ops_exit_list+0x128/0x180 net/core/net_namespace.c178 setup_net+0x714/0xb40 net/core/net_namespace.c375 copy_net_ns+0x2f0/0x670

## Keyphrases
- **rootcause**: 'concurrent execution'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4288 | 0.4874 | 0.4477 | 0.4478 | 20 |
| Sparse | 217.4603 | 715.3360 | 636.7037 | 672.0995 | 11 |
| Graph | 1.5188 | 2.6880 | 1.8922 | 1.7264 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 416 | Use After Free | variant | 2.6880 | Allowed |
| 2 | 123 | Write-what-where Condition | base | 2.4700 | Allowed |
| 3 | 415 | Double Free | variant | 2.4192 | Allowed |
| 4 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 5 | 322 | Key Exchange without Entity Authentication | base | 2.2100 | Allowed |
| 6 | 502 | Deserialization of Untrusted Data | base | 2.1190 | Allowed |
| 7 | 350 | Reliance on Reverse DNS Resolution for a Security-Critical Action | variant | 2.0400 | Allowed |
| 8 | 364 | Signal Handler Race Condition | Base | 1.9101 | Allowed |
| 9 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 10 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 11 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 12 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 13 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 14 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 15 | 833 | Deadlock | Base | 1.6538 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 394 | Unexpected Status Code or Return Value | Base | 0.4874 | 0.4874 | Allowed |
| 2 | 833 | Deadlock | Base | 0.4764 | 0.4764 | Allowed |
| 3 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.4695 | 0.4695 | Allowed |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.4641 | 0.4641 | Allowed-with-Review |
| 5 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.4554 | 0.4554 | Allowed |
| 6 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4528 | 0.4528 | Allowed |
| 7 | 775 | Missing Release of File Descriptor or Handle after Effective Lifetime | Variant | 0.4521 | 0.4521 | Allowed |
| 8 | 605 | Multiple Binds to the Same Port | Variant | 0.4498 | 0.4498 | Allowed |
| 9 | 909 | Missing Initialization of Resource | Class | 0.4494 | 0.4494 | Allowed-with-Review |
| 10 | 911 | Improper Update of Reference Count | Base | 0.4494 | 0.4494 | Allowed |
| 11 | 667 | Improper Locking | Class | 0.4463 | 0.4463 | Allowed-with-Review |
| 12 | 193 | Off-by-one Error | Base | 0.4411 | 0.4411 | Allowed |
| 13 | 774 | Allocation of File Descriptors or Handles Without Limits or Throttling | Variant | 0.4390 | 0.4390 | Allowed |
| 14 | 606 | Unchecked Input for Loop Condition | Base | 0.4361 | 0.4361 | Allowed |
| 15 | 170 | Improper Null Termination | Base | 0.4359 | 0.4359 | Allowed |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 415 | Double Free | 715.3360 | 715.3360 | Allowed |
| 2 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | 697.8327 | 697.8327 | Allowed-with-Review |
| 3 | 909 | Missing Initialization of Resource | 686.4173 | 686.4173 | Allowed-with-Review |
| 4 | 674 | Uncontrolled Recursion | 685.7101 | 685.7101 | Allowed-with-Review |
| 5 | 502 | Deserialization of Untrusted Data | 680.7431 | 680.7431 | Allowed |
| 6 | 401 | Missing Release of Memory after Effective Lifetime | 672.0995 | 672.0995 | Allowed |
| 7 | 667 | Improper Locking | 667.6984 | 667.6984 | Allowed-with-Review |
| 8 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 665.0799 | 665.0799 | Allowed-with-Review |
| 9 | 770 | Allocation of Resources Without Limits or Throttling | 658.5011 | 658.5011 | Allowed |
| 10 | 125 | Out-of-bounds Read | 656.8624 | 656.8624 | Allowed |
| 11 | 61 | UNIX Symbolic Link (Symlink) Following | 217.4603 | 217.4603 | Allowed |
