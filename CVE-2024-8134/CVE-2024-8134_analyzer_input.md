# Vulnerability Information: CVE-2024-8134

## Vulnerability Description
A vulnerability was found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240814. It has been rated as critical. This issue affects the function cgi_FMT_Std2R5_1st_DiskMGR of the file /cgi-bin/hd_config.cgi of the component HTTP POST Request Handler. The manipulation of the argument f_source_dev leads to **command injection**. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** D-Link DNS-120 and DNR-202L and DNS-315L and DNS-320 and DNS-320L and DNS-320LW and DNS-321 and DNR-322L and DNS-323 and DNS-325 and DNS-326 and DNS-327L and DNR-326 and DNS-340L and DNS-343 and DNS-345 and DNS-726-4 and DNS-1100-4 and DNS-1200-05 and DNS-1550-04
- **version:** up to 20240814
- **component:** cgi_FMT_Std2R5_1st_DiskMGR in /cgi-bin/hd_config.cgi

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-78

#### Top CWEs
- CWE-78 (Count: 25)
- CWE-77 (Count: 3)

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability described, which is related to the D-Link NAS devices and a command injection issue, although this specific CVE is a placeholder:

**Root Cause of Vulnerability:**

The root cause is a command injection vulnerability in the `cgi_FMT_Std2R5_1st_DiskMGR` function within the `/cgi-bin/hd_config.cgi` file of D-Link NAS devices. The vulnerability stems from the improper handling of the `f_source_dev` variable, which is passed via a POST request. This variable is directly incorporated into a system command using the `sprintf` function without proper sanitization, leading to command injection.

**Weaknesses/Vulnerabilities Present:**

- **Command Injection:** The primary vulnerability is command injection. The application constructs a system command using unsanitized user-supplied input, allowing an attacker to inject arbitrary commands.
- **Lack of Input Validation:** The application fails to validate and sanitize the `f_source_dev` parameter before using it in a system call.
- **Use of `sprintf` for command construction:** The use of `sprintf` to build commands with untrusted input is a classic and dangerous practice.

**Impact of Exploitation:**

- **Arbitrary Command Execution:** Successful exploitation allows an attacker to execute arbitrary system commands with the privileges of the web server process.
- **System Compromise:** This can lead to complete compromise of the affected device, including data theft, modification, or denial of service.
- **Malware Installation:** An attacker can install malware or backdoors on the device, gaining persistent access.

**Attack Vectors:**

- **HTTP POST Request:** The attack vector involves sending a specially crafted HTTP POST request to `/cgi-bin/hd_config.cgi`.
- **`f_source_dev` Parameter:** The attacker injects malicious commands within the `f_source_dev` parameter.

**Required Attacker Capabilities/Position:**

- **Network Access:** The attacker must have network access to the D-Link NAS device.
- **Web Interface Access:** The attacker needs to be able to send HTTP POST requests to the device's web interface.
- **Knowledge of the Vulnerable Parameter:** The attacker needs to know about the vulnerable `f_source_dev` parameter and the structure of the HTTP request.

**Additional Notes**
- The affected models are: DNS-320, DNS-320L, DNS-321, DNS-323, DNS-325, DNS-327L.
- The D-Link advisory states that all listed devices have reached their End-of-Life (EOL) or End-of-Service-Life (EOS) and recommends replacing them.
- D-Link will not be providing any firmware updates to fix this issue because these devices have reached end of life.

This information is more detailed than a typical CVE description, providing the exact vulnerable function, vulnerable parameter, and attack vector.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.745 |
| 4 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.697 |
| 5 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.695 |
| 6 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.683 |
| 7 | 341 | Predictable from Observable State | Base | Allowed | sparse | 0.667 |
| 8 | 350 | Reliance on Reverse DNS Resolution for a Security-Critical Action | Variant | Allowed | sparse | 0.664 |
| 9 | 121 | Stack-based Buffer Overflow | Variant | Allowed | dense | 0.653 |
| 10 | 804 | Guessable CAPTCHA | Base | Allowed | graph | 0.002 |

