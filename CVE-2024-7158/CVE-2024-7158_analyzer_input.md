# Vulnerability Information: CVE-2024-7158

## Vulnerability Description
A vulnerability was found in TOTOLINK A3100R 4.1.2cu.5050_B20200504. It has been declared as critical. This vulnerability affects the function setTelnetCfg of the file /cgi-bin/cstecgi.cgi of the component HTTP POST Request Handler. The manipulation of the argument telnet_enabled leads to **command injection**. The attack can be initiated remotely. The exploit has been disclosed to the public and may be used. The identifier of this vulnerability is VDB-272572. NOTE The vendor was contacted early about this disclosure but did not respond in any way.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** TOTOLINK A3100R
- **version:** 4.1.2cu.5050_B20200504
- **component:** setTelnetCfg in /cgi-bin/cstecgi.cgi

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

*   The vulnerability stems from a lack of proper input sanitization in the `setTelnetCfg` function of the TOTOLINK A3100R router's firmware. Specifically, the `telnet_enabled` parameter, which is received via a POST request, is not validated before being used.

**Weaknesses/Vulnerabilities:**

*   **Command Injection:** The primary vulnerability is command injection. The user-controlled input within `telnet_enabled` is directly used, allowing an attacker to inject arbitrary commands that will be executed by the system.
*  **Buffer Overflow:** While the primary vulnerability is command injection, the Github document also mentions a possible buffer overflow due to the uncontrolled input of the 'telnet_enabled' parameter.

**Impact of Exploitation:**

*   Successful exploitation of this vulnerability could allow an attacker to gain complete control of the affected router. This includes:
    *   Executing arbitrary system commands
    *   Modifying router configurations
    *   Potentially using the router as part of a botnet
    *   Accessing sensitive data on the network

**Attack Vectors:**

*   The vulnerability can be exploited by sending a specially crafted HTTP POST request to the `/cgi-bin/cstecgi.cgi` endpoint.
*   The attacker needs to include a `telnet_enabled` parameter within the JSON data of the POST request, with malicious commands injected into this parameter.

**Required Attacker Capabilities/Position:**

*   The attacker needs network access to the router's web interface. This can be either through local network or remotely if the router's web interface is exposed to the internet.
*   The attacker needs to be able to send HTTP POST requests.
*   The attacker can use the provided proof of concept (POC) to exploit the vulnerability.

**Additional Information:**

*   **Affected Firmware:** TOTOLINK A3100R V4.1.2cu.5050\_B20200504
*   **Vulnerable Function:** `setTelnetCfg`
*   **Vulnerable Parameter:** `telnet_enabled`
*   **Exploitation Method:** HTTP POST request to `/cgi-bin/cstecgi.cgi` with a crafted `telnet_enabled` value

This information provides a more detailed view of the vulnerability than the standard CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.592 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.556 |
| 5 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.497 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.480 |
| 7 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.466 |
| 8 | 259 | Use of Hard-coded Password | Variant | Allowed | sparse | 0.466 |
| 9 | 121 | Stack-based Buffer Overflow | Variant | Allowed | dense | 0.633 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

