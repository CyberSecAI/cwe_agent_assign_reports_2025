{
  "query": "In the Linux kernel, the following vulnerability has been resolved net vlan dont propagate flags on open With the device instance lock, there is now a possibility of a deadlock [ 1.211455] ============================================ [ 1.211571] WARNING possible recursive locking detected [ 1.211687] 6.14.0-rc5-01215-g032756b4ca7a-dirty #5 Not tainted [ 1.211823] -------------------------------------------- [ 1.211936] ip/184 is trying to acquire lock [ 1.212032] ffff8881024a4c30 (&dev->lock){+.+.}-{44}, at dev_set_allmulti+0x4e/0xb0 [ 1.212207] [ 1.212207] but task is already holding lock [ 1.212332] ffff8881024a4c30 (&dev->lock){+.+.}-{44}, at dev_open+0x50/0xb0 [ 1.212487] [ 1.212487] other info that might help us debug this [ 1.212626] Possible unsafe locking scenario [ 1.212626] [ 1.212751] CPU0 [ 1.212815] ---- [ 1.212871] lock(&dev->lock) [ 1.212944] lock(&dev->lock) [ 1.213016] [ 1.213016] *** DEADLOCK *** [ 1.213016] [ 1.213143] May be due to missing lock nesting notation [ 1.213143] [ 1.213294] 3 locks held by ip/184 [ 1.213371] #0 ffffffff838b53e0 (rtnl_mutex){+.+.}-{44}, at rtnl_nets_lock+0x1b/0xa0 [ 1.213543] #1 ffffffff84e5fc70 (&net->rtnl_mutex){+.+.}-{44}, at rtnl_nets_lock+0x37/0xa0 [ 1.213727] #2 ffff8881024a4c30 (&dev->lock){+.+.}-{44}, at dev_open+0x50/0xb0 [ 1.213895] [ 1.213895] stack backtrace [ 1.213991] CPU 0 UID 0 PID 184 Comm ip Not tainted 6.14.0-rc5-01215-g032756b4ca7a-dirty #5 [ 1.213993] Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS Arch Linux 1.16.3-1-1 04/01/2014 [ 1.213994] Call Trace [ 1.213995] [ 1.213996] dump_stack_lvl+0x8e/0xd0 [ 1.214000] print_deadlock_bug+0x28b/0x2a0 [ 1.214020] lock_acquire+0xea/0x2a0 [ 1.214027] __mutex_lock+0xbf/0xd40 [ 1.214038] dev_set_allmulti+0x4e/0xb0 # real_dev->flags & IFF_ALLMULTI [ 1.214040] vlan_dev_open+0xa5/0x170 # ndo_open on vlandev [ 1.214042] __dev_open+0x145/0x270 [ 1.214046] __dev_change_flags+0xb0/0x1e0 [ 1.214051] netif_change_flags+0x22/0x60 # IFF_UP vlandev [ 1.214053] dev_change_flags+0x61/0xb0 # for each device in group from dev->vlan_info [ 1.214055] vlan_device_event+0x766/0x7c0 # on netdevsim0 [ 1.214058] notifier_call_chain+0x78/0x120 [ 1.214062] netif_open+0x6d/0x90 [ 1.214064] dev_open+0x5b/0xb0 # locks netdevsim0 [ 1.214066] bond_enslave+0x64c/0x1230 [ 1.214075] do_set_master+0x175/0x1e0 # on netdevsim0 [ 1.214077] do_setlink+0x516/0x13b0 [ 1.214094] rtnl_newlink+0xaba/0xb80 [ 1.214132] rtnetlink_rcv_msg+0x440/0x490 [ 1.214144] netlink_rcv_skb+0xeb/0x120 [ 1.214150] netlink_unicast+0x1f9/0x320 [ 1.214153] netlink_sendmsg+0x346/0x3f0 [ 1.214157] __sock_sendmsg+0x86/0xb0 [ 1.214160] ____sys_sendmsg+0x1c8/0x220 [ 1.214164] ___sys_sendmsg+0x28f/0x2d0 [ 1.214179] __x64_sys_sendmsg+0xef/0x140 [ 1.214184] do_syscall_64+0xec/0x1d0 [ 1.214190] entry_SYSCALL_64_after_hwframe+0x77/0x7f [ 1.214191] RIP 00330x7f2d1b4a7e56 Device setup netdevsim0 (down) ^ ^ bond netdevsim1.100@netdevsim1 allmulticast=on (down) When we enslave the lower device (netdevsim0) which has a vlan, we propagate vlans allmuti/promisc flags during ndo_open. This causes (re)locking on of the real_dev. Propagate allmulti/promisc on flags change, not on the open. There is a slight semantics change that vlans that are down now propagate the flags, but this seems unlikely to result in the real issues. Reproducer echo 0 1 > /sys/bus/netdevsim/new_device dev_path=$(ls -d /sys/bus/netdevsim/devices/netdevsim0/net/*) dev=$(echo $dev_path | rev | cut -d/ -f1 | rev) ip link set dev $dev name netdevsim0 ip link set dev netdevsim0 up ip link add link netdevsim0 name netdevsim0.100 type vlan id 100 ip link set dev netdevsim0.100 allm ---truncated---",
  "keyphrases": {
    "weakness": [
      "deadlock"
    ]
  },
  "timestamp": "2025-07-12T10:16:25.872920",
  "retriever_config": {
    "weights": {
      "dense": 0.35,
      "sparse": 0.4,
      "graph": 0.25
    },
    "use_graph": true,
    "use_rag": true,
    "use_sparse": true
  },
  "raw_results": {
    "graph": [
      {
        "cwe_id": "390",
        "name": "Detection of Error Condition Without Action",
        "abstraction": "base",
        "score": 2.2100000000000004,
        "description": "CWE-390: Detection of Error Condition Without Action...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "319",
        "name": "Cleartext Transmission of Sensitive Information",
        "abstraction": "base",
        "score": 2.1189999999999998,
        "description": "CWE-319: Cleartext Transmission of Sensitive Information...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 1.686940435802287,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 1.6764065777600816,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "674",
        "name": "Uncontrolled Recursion",
        "abstraction": "class",
        "score": 1.192,
        "description": "CWE-674: Uncontrolled Recursion...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 1.0431167659261624,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "832",
        "name": "Unlock of a Resource that is not Locked",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-832: Unlock of a Resource that is not Locked...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "765",
        "name": "Multiple Unlocks of a Critical Resource",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-765: Multiple Unlocks of a Critical Resource...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "764",
        "name": "Multiple Locks of a Critical Resource",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-764: Multiple Locks of a Critical Resource...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "609",
        "name": "Double-Checked Locking",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-609: Double-Checked Locking...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "414",
        "name": "Missing Lock Check",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-414: Missing Lock Check...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "412",
        "name": "Unrestricted Externally Accessible Lock",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-412: Unrestricted Externally Accessible Lock...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1234",
        "name": "Hardware Internal or Debug Modes Allow Override of Locks",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1234: Hardware Internal or Debug Modes Allow Override of Locks...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1233",
        "name": "Security-Sensitive Hardware Controls with Missing Lock Bit Protection",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1233: Security-Sensitive Hardware Controls with Missing Lock Bit Protection...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1232",
        "name": "Improper Lock Behavior After Power State Transition",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1232: Improper Lock Behavior After Power State Transition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "776",
        "name": "Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion')",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-776: Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "917",
        "name": "Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-917: Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "88",
        "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "624",
        "name": "Executable Regular Expression Error",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-624: Executable Regular Expression Error...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1427",
        "name": "Improper Neutralization of Input Used for LLM Prompting",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1427: Improper Neutralization of Input Used for LLM Prompting...",
        "mapping_usage": "Allowed"
      }
    ],
    "dense": [
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 0.49165202803196106,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.45117274563865994,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 0.450206142587029,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "77",
        "name": "Improper Neutralization of Special Elements used in a Command ('Command Injection')",
        "abstraction": "Class",
        "score": 0.446447337659882,
        "description": "The product constructs all or part of a command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify t...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 0.4428350812207781,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 0.4387092852745784,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1331",
        "name": "Improper Isolation of Shared Resources in Network On Chip (NoC)",
        "abstraction": "Base",
        "score": 0.4381279914059606,
        "description": "The Network On Chip (NoC) does not isolate or incorrectly isolates its on-chip-fabric and internal resources such that they are shared between trusted and untrusted agents, creating timing channels....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 0.4369374743121972,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "78",
        "name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
        "abstraction": "Base",
        "score": 0.43539463193683037,
        "description": "The product constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modi...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "121",
        "name": "Stack-based Buffer Overflow",
        "abstraction": "Variant",
        "score": 0.4349896103926587,
        "description": "A stack-based buffer overflow condition is a condition where the buffer being overwritten is allocated on the stack (i.e., is a local variable or, rarely, a parameter to a function)....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "400",
        "name": "Uncontrolled Resource Consumption",
        "abstraction": "Class",
        "score": 0.4147407835136244,
        "description": "The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustio...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "696",
        "name": "Incorrect Behavior Order",
        "abstraction": "Class",
        "score": 0.4131695496982415,
        "description": "The product performs multiple related behaviors, but the behaviors are performed in the wrong order in ways which may produce resultant weaknesses....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "1250",
        "name": "Improper Preservation of Consistency Between Independent Representations of Shared State",
        "abstraction": "Base",
        "score": 0.4122665004344733,
        "description": "The product has or supports multiple distributed components or sub-systems that are each required to keep their own local copy of shared data - such as state or cache - but the product does not ensure...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "120",
        "name": "Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')",
        "abstraction": "Base",
        "score": 0.406297666557063,
        "description": "The product copies an input buffer to an output buffer without verifying that the size of the input buffer is less than the size of the output buffer, leading to a buffer overflow....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "119",
        "name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
        "abstraction": "Class",
        "score": 0.40536314617195535,
        "description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected m...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 0.4050910084830126,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "912",
        "name": "Hidden Functionality",
        "abstraction": "Class",
        "score": 0.40356943479256724,
        "description": "The product contains functionality that is not documented, not part of the specification, and not accessible through an interface or command sequence that is obvious to the product's users or administ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 0.4029356144802309,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "abstraction": "Compound",
        "score": 0.39562832631597256,
        "description": "The product, when opening a file or directory, does not sufficiently account for when the file is a symbolic link that resolves to a target outside of the intended control sphere. This could allow an ...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "Base",
        "score": 0.39193663218343566,
        "description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the in...",
        "mapping_usage": "Allowed"
      }
    ],
    "sparse": [
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 1203.336597284468,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "319",
        "name": "Cleartext Transmission of Sensitive Information",
        "abstraction": "Base",
        "score": 1123.2913298520011,
        "description": "The product transmits sensitive or security-critical data in cleartext in a communication channel that can be sniffed by unauthorized actors....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "674",
        "name": "Uncontrolled Recursion",
        "abstraction": "Class",
        "score": 1086.7991922300885,
        "description": "The product does not properly control the amount of recursion that takes place,  consuming excessive resources, such as allocated memory or the program stack....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 1043.1476472690204,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 1016.3943579200429,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "400",
        "name": "Uncontrolled Resource Consumption",
        "abstraction": "Class",
        "score": 1008.4999027809722,
        "description": "The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustio...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "Base",
        "score": 973.9077656518505,
        "description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the in...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 967.1304674464078,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "863",
        "name": "Incorrect Authorization",
        "abstraction": "Class",
        "score": 961.8321800839996,
        "description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "20",
        "name": "Improper Input Validation",
        "abstraction": "Class",
        "score": 958.7152259594719,
        "description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correct...",
        "mapping_usage": "Discouraged"
      }
    ]
  },
  "score_statistics": {
    "dense": {
      "min": 0.39193663218343566,
      "max": 0.49165202803196106,
      "mean": 0.42587354955455564,
      "median": 0.42486519695314157,
      "count": 20
    },
    "sparse": {
      "min": 958.7152259594719,
      "max": 1203.336597284468,
      "mean": 1034.3054666478324,
      "median": 1012.4471303505076,
      "count": 10
    },
    "graph": {
      "min": 1.0062,
      "max": 2.2100000000000004,
      "mean": 1.2007131889744265,
      "median": 1.0062,
      "count": 20
    }
  }
}