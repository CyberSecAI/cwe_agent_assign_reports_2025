# Vulnerability Information: CVE-2024-55563

## Vulnerability Description
Bitcoin Core through 27.2 allows transaction-relay jamming via an off-chain protocol attack, a related issue to CVE-2024-52913. For example, the outcome of an HTLC (Hashed Timelock Contract) can be changed because a flood of transaction traffic prevents propagation of certain Lightning channel transactions.

### Vulnerability Description Key Phrases
- **impact:** transaction-relay jamming
- **vector:** off-chain protocol attack
- **product:** Bitcoin Core
- **version:** through 27.2

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-55563:

**Root Cause of Vulnerability:**

The vulnerability stems from the transaction relay mechanisms in Bitcoin full nodes, specifically how they handle transaction selection, announcement, and propagation. The core issue lies in the bounded throughput of the transaction relay process, which can be exploited by an attacker to delay or prevent the propagation of specific transactions, particularly those related to time-sensitive off-chain protocols like Lightning Network.

**Weaknesses/Vulnerabilities Present:**

1.  **High-Overflow Attack:** This variant exploits the fee-rate sorting mechanism of the "forward transaction inventory" (`m_tx_inventory_to_send`) and the `INVENTORY_BROADCAST_MAX` limit. By injecting a large number of higher-fee transactions, an attacker can artificially delay the relay of lower-fee, time-sensitive transactions.

    *   **Vulnerability:** The fee-rate sorting mechanism combined with the limit on the number of transactions relayed in a single INV message (`INVENTORY_BROADCAST_MAX`) creates an exploitable weakness.
    *   **Details:**  The node sorts transactions by fee rate before including them in an INV message. An attacker can flood the node with higher-fee transactions, preventing lower-fee, but critical, transactions from being included in the INV, effectively delaying their propagation.

2.  **Low-Overflow Attack:** This variant exploits the `MAX_PEER_TX_ANNOUNCEMENTS` limit, which restricts the number of unique transactions a peer will queue after receiving an INV message. By announcing a large number of unique transactions, an attacker can cause subsequent announcements to be dropped on the floor, preventing propagation.

    *   **Vulnerability:** The limit on the number of unique transaction announcements a peer will track (`MAX_PEER_TX_ANNOUNCEMENTS`).
    *   **Details:** When a node receives an INV message, it tracks the announced transactions. If the number of unique announcements exceeds the `MAX_PEER_TX_ANNOUNCEMENTS` limit, further announcements from that peer are dropped, and thus, transactions might not propagate.

**Impact of Exploitation:**

*   **Delay or Prevention of Transaction Propagation:** An attacker can delay or completely prevent the propagation of specific transactions, particularly time-sensitive ones.
*   **Disruption of Off-Chain Protocols:** This can lead to the failure of off-chain protocols like Lightning Network, causing financial loss for users. Specifically, an attacker could cause HTLC (Hashed TimeLock Contract) timeouts and steal funds.
*   **Financial Loss:** By preventing the timely propagation of transactions that resolve channel states, an attacker can cause the victim to lose funds via timeouts.
*   **Potential for Network Partitioning:** Attackers can partition a victim's full-node mempool from the rest of the network. This prevents the overflow transactions from being added to the public mempool, therefore lowering costs for the attacker.

**Attack Vectors:**

*   **Peer-to-Peer Network:** The attacks are carried out by manipulating the transaction relay mechanism via the Bitcoin P2P network.
*   **"High Overflow":** Requires the attacker to control multiple peers connected to the victim and inject a large number of higher-fee junk transactions.
*   **"Low Overflow":** Requires the attacker to connect multiple peers to the victim and announce a large number of unique transactions to overflow the announcement tracking limit.

**Required Attacker Capabilities/Position:**

*   **Network Connectivity:** The attacker needs to be able to establish multiple connections to the targeted node.
*   **Control of Multiple Bitcoin Nodes:** The attacker needs to control enough nodes to inject a sufficient amount of transactions to overwhelm the targeted node's transaction relay buffers.
*   **Understanding of Bitcoin Transaction Relay:** A thorough understanding of the Bitcoin transaction relay mechanism and its limits is needed to execute the attack.
*   **"High-Overflow":** Requires the ability to create and broadcast higher-fee transactions (though they don't necessarily need to be confirmed and can be child-pays-for-parent transactions).
*   **"Low-Overflow":** Requires the ability to create and announce a large number of unique transactions.

**Additional Notes:**

*   The "high overflow" attack has a proof-of-concept, while the "low overflow" attack remains a subject of investigation.
*   The "high overflow" attack cost is estimated to be around $80,000 to target real-world Lightning channels with safety timelocks in the order of four dozen blocks.
*   The vulnerability affects Bitcoin Core nodes and potentially other implementations.
*   Mitigations are mainly proposed for Lightning Network and off-chain protocols as a workaround instead of a fix to the base layer protocol.

In summary, CVE-2024-55563 describes a novel transaction-relay jamming attack that can be leveraged against off-chain protocols built on top of Bitcoin, such as the Lightning Network. By exploiting the limited throughput of the Bitcoin transaction relay mechanism, an attacker can delay or prevent the propagation of time-sensitive transactions, potentially leading to theft of funds.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.072 |
| 2 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.072 |
| 3 | 1292 | Incorrect Conversion of Security Identifiers | Base | Allowed | sparse | 0.071 |
| 4 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.068 |
| 5 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.067 |
| 6 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.066 |
| 7 | 1290 | Incorrect Decoding of Security Identifiers  | Base | Allowed | sparse | 0.065 |
| 8 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.064 |
| 9 | 300 | Channel Accessible by Non-Endpoint | Class | Discouraged | dense | 0.471 |
| 10 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | graph | 0.003 |

