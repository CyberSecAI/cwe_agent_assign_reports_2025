{
  "cve_id": "CVE-2025-23394",
  "description": "A **UNIX Symbolic Link (Symlink) Following** vulnerability in openSUSE Tumbleweed cyrus-imapd allows escalation from cyrus to root.This issue affects openSUSE Tumbleweed cyrus-imapd before 3.8.4-2.1.",
  "key_phrases": {
    "rootcause": "UNIX Symbolic Link (Symlink) Following",
    "weakness": "",
    "impact": "escalation from cyrus to root",
    "vector": "",
    "attacker": "",
    "product": "openSUSE Tumbleweed cyrus-imapd",
    "version": "before 3.8.4-2.1",
    "component": ""
  },
  "reference_content": "```text\nRoot cause of vulnerability:\nThe cyrus-imapd service's daily-backup.sh script runs with root privileges.  The script operates in directories controlled by the unprivileged \"cyrus\" user, allowing for symlink manipulation.\n\nWeaknesses/vulnerabilities present:\n- Privilege escalation: The \"cyrus\" user can escalate privileges to root.\n- Symlink vulnerability: The cyrus user can create symlinks within /var/lib/imap, which the backup script follows.\n\nImpact of exploitation:\nA compromised \"cyrus\" account can achieve full local privilege escalation.\n\nAttack vectors:\nAn attacker with control of the \"cyrus\" account can exploit the symlink vulnerability.\n\nRequired attacker capabilities/position:\nThe attacker needs a compromised \"cyrus\" account.\n\nMitigation or fix:\nThe service should run with \"cyrus\" privileges from the beginning. The script should refuse to operate with full root privileges. Suggested fix:  [Service] Type=oneshot ExecStart=__LIBEXECDIR__/tools/daily-backup.sh User=cyrus Group=mail\n```",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-59 | Improper Link Resolution Before File Access ('Link Following') | 0.9 | Base | Primary | Allowed |\n| CWE-267 | Privilege Defined With Unsafe Actions | 0.7 | Base | Secondary | Allowed |\n| CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 0.6 | Base | Secondary | Allowed |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-59, which focuses on the improper handling of links. The vulnerability also involves a privilege escalation, suggesting CWE-267 (Privilege Defined With Unsafe Actions). A TOCTOU Race Condition (CWE-367) may occur if the link's target is checked before use, but changes before the actual operation.\nThe relationship to CWE-363 (Race Condition Enabling Link Following) is also relevant, as a race condition could enable the link following.\n\n```mermaid\ngraph TD\n    cwe59[\"CWE-59: Improper Link Resolution Before File Access ('Link Following')\"]\n    cwe267[\"CWE-267: Privilege Defined With Unsafe Actions\"]\n    cwe367[\"CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition\"]\n    cwe363[\"CWE-363: Race Condition Enabling Link Following\"]\n    \n    cwe363 -->|CANPRECEDE| cwe59\n    cwe367 -->|PARENTOF| cwe363\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe59 primary\n    class cwe267,cwe367,cwe363 secondary\n```\n\n## Vulnerability Chain\n1.  The `daily-backup.sh` script runs with root privileges.\n2.  The script operates in directories controlled by the unprivileged \"cyrus\" user.\n3.  The \"cyrus\" user can create symlinks within `/var/lib/imap`. (**CWE-59: Improper Link Resolution Before File Access ('Link Following')**)\n4.  The backup script follows these symlinks, potentially leading to unintended file operations.\n5.  The attacker escalates privileges from \"cyrus\" to root. (**CWE-267: Privilege Defined With Unsafe Actions**)\n6.  A **Time-of-check Time-of-use (TOCTOU) Race Condition** may occur if the link's target is checked before use, but changes before the actual operation. (**CWE-367**)\n\n## Summary of Analysis\nThe vulnerability involves a **UNIX Symbolic Link (Symlink) Following** issue where the \"cyrus\" user can manipulate symlinks that are then followed by a root-privileged script. The primary weakness is **CWE-59: Improper Link Resolution Before File Access ('Link Following')**, as the script **does not properly prevent that filename from identifying a link or shortcut that resolves to an unintended resource**. This leads to a privilege escalation, represented by **CWE-267: Privilege Defined With Unsafe Actions**, because a particular privilege, role, capability, or right can be used to perform unsafe actions that were not intended, even when it is assigned to the correct entity. Additionally, there's a potential for **CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition** if the link's target is checked before use, but changes before the actual operation.\n\nThe evidence supports the primary CWE because the CVE description clearly states a **UNIX Symbolic Link (Symlink) Following** vulnerability. The CVE Reference Links Content Summary confirms that the script operates in directories controlled by the unprivileged \"cyrus\" user, who can create symlinks, and the backup script follows them. The suggested fix also indicates that the service should run with \"cyrus\" privileges from the beginning.\n\nOther CWEs considered but not used:\n\n*   CWE-61: UNIX Symbolic Link (Symlink) Following - This is a compound CWE, and CWE-59 is more specific.\n*   CWE-64: Windows Shortcut Following (.LNK) - This is specific to Windows shortcuts, not UNIX symlinks.\n*   CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') - While path traversal could be a consequence, the root cause is the improper handling of links.",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-59 | Improper Link Resolution Before File Access ('Link Following') | 0.9 | Base | Primary | Allowed |\n| CWE-267 | Privilege Defined With Unsafe Actions | 0.7 | Base | Secondary | Allowed |\n| CWE-367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 0.6 | Base | Secondary | Allowed |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-59, which focuses on the improper handling of links. The vulnerability also involves a privilege escalation, suggesting CWE-267 (Privilege Defined With Unsafe Actions). A TOCTOU Race Condition (CWE-367) may occur if the link's target is checked before use, but changes before the actual operation.\nThe relationship to CWE-363 (Race Condition Enabling Link Following) is also relevant, as a race condition could enable the link following.\n\n```mermaid\ngraph TD\n    cwe59[\"CWE-59: Improper Link Resolution Before File Access ('Link Following')\"]\n    cwe267[\"CWE-267: Privilege Defined With Unsafe Actions\"]\n    cwe367[\"CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition\"]\n    cwe363[\"CWE-363: Race Condition Enabling Link Following\"]\n    \n    cwe363 -->|CANPRECEDE| cwe59\n    cwe367 -->|PARENTOF| cwe363\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe59 primary\n    class cwe267,cwe367,cwe363 secondary\n```\n\n## Vulnerability Chain\n1.  The `daily-backup.sh` script runs with root privileges.\n2.  The script operates in directories controlled by the unprivileged \"cyrus\" user.\n3.  The \"cyrus\" user can create symlinks within `/var/lib/imap`. (**CWE-59: Improper Link Resolution Before File Access ('Link Following')**)\n4.  The backup script follows these symlinks, potentially leading to unintended file operations.\n5.  The attacker escalates privileges from \"cyrus\" to root. (**CWE-267: Privilege Defined With Unsafe Actions**)\n6.  A **Time-of-check Time-of-use (TOCTOU) Race Condition** may occur if the link's target is checked before use, but changes before the actual operation. (**CWE-367**)\n\n## Summary of Analysis\nThe vulnerability involves a **UNIX Symbolic Link (Symlink) Following** issue where the \"cyrus\" user can manipulate symlinks that are then followed by a root-privileged script. The primary weakness is **CWE-59: Improper Link Resolution Before File Access ('Link Following')**, as the script **does not properly prevent that filename from identifying a link or shortcut that resolves to an unintended resource**. This leads to a privilege escalation, represented by **CWE-267: Privilege Defined With Unsafe Actions**, because a particular privilege, role, capability, or right can be used to perform unsafe actions that were not intended, even when it is assigned to the correct entity. Additionally, there's a potential for **CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition** if the link's target is checked before use, but changes before the actual operation.\n\nThe evidence supports the primary CWE because the CVE description clearly states a **UNIX Symbolic Link (Symlink) Following** vulnerability. The CVE Reference Links Content Summary confirms that the script operates in directories controlled by the unprivileged \"cyrus\" user, who can create symlinks, and the backup script follows them. The suggested fix also indicates that the service should run with \"cyrus\" privileges from the beginning.\n\nOther CWEs considered but not used:\n\n*   CWE-61: UNIX Symbolic Link (Symlink) Following - This is a compound CWE, and CWE-59 is more specific.\n*   CWE-64: Windows Shortcut Following (.LNK) - This is specific to Windows shortcuts, not UNIX symlinks.\n*   CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') - While path traversal could be a consequence, the root cause is the improper handling of links.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-22:**\n- 22 (Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')) - ROOT\n\n\n**Chain starting from CWE-59:**\n- 59 (Improper Link Resolution Before File Access ('Link Following')) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "source": "sparse"
      },
      "similarity": 382.2951828420622
    },
    {
      "metadata": {
        "doc_id": "59",
        "name": "Improper Link Resolution Before File Access ('Link Following')",
        "source": "sparse"
      },
      "similarity": 235.70036858503045
    },
    {
      "metadata": {
        "doc_id": "64",
        "name": "Windows Shortcut Following (.LNK)",
        "source": "sparse"
      },
      "similarity": 191.62370852744425
    },
    {
      "metadata": {
        "doc_id": "1393",
        "name": "Use of Default Password",
        "source": "sparse"
      },
      "similarity": 185.73177755573641
    },
    {
      "metadata": {
        "doc_id": "62",
        "name": "UNIX Hard Link",
        "source": "sparse"
      },
      "similarity": 174.43532542186972
    },
    {
      "metadata": {
        "doc_id": "303",
        "name": "Incorrect Implementation of Authentication Algorithm",
        "source": "sparse"
      },
      "similarity": 168.11677713424191
    },
    {
      "metadata": {
        "doc_id": "266",
        "name": "Incorrect Privilege Assignment",
        "source": "sparse"
      },
      "similarity": 152.19416248665146
    },
    {
      "metadata": {
        "doc_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "source": "sparse"
      },
      "similarity": 150.7113402825226
    },
    {
      "metadata": {
        "doc_id": "22",
        "name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
        "type": "Base",
        "original_content": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense",
            "graph"
          ],
          "retriever_count": 2,
          "normalized_scores": {
            "dense": 0.5509008068062482,
            "graph": 2.0012155583379183
          }
        }
      },
      "similarity": 0.5509008068062482
    },
    {
      "doc_id": "363",
      "text": "CWE-363: Race Condition Enabling Link Following",
      "score": 2.2100000000000004,
      "metadata": {
        "doc_id": "363",
        "name": "Race Condition Enabling Link Following",
        "type": "base",
        "original_content": "CWE-363: Race Condition Enabling Link Following",
        "relationships": [
          {
            "source_id": "363",
            "target_id": "59",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "363",
            "target_id": "367",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "59",
            "target_id": "363",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "367",
            "target_id": "363",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "59",
                  "363",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "59"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "59",
                  "363",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "59"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "363",
                  "59",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "59"
            }
          }
        },
        "position": "after",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.2100000000000004
          }
        }
      },
      "similarity": 2.2100000000000004
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-22",
      "CWE-59",
      "CWE-363",
      "CWE-64",
      "CWE-267",
      "CWE-367",
      "CWE-61"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}