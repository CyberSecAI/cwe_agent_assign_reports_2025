## Vulnerability Description
A flaw was found in Podman. This issue may allow an attacker to create a specially crafted container that, when configured to share the same IPC with at least one other container, can create a large number of IPC resources in /dev/shm. The malicious container will continue to exhaust resources until it is out-of-memory (OOM) killed. While the malicious containers cgroup will be removed, the IPC resources it created are not. Those resources are tied to the IPC namespace that will not be removed until all containers using it are stopped, and one non-malicious container is holding the namespace open. The malicious container is restarted, either automatically or by attacker control, repeating the process and increasing the amount of memory consumed. With a container configured to restart always, such as `podman run --restart=always`, this can result in a memory-based denial of service of the system.

### Vulnerability Description Key Phrases
- **impact:** denial of service
- **vector:** specially crafted container
- **attacker:** attacker
- **product:** Podman

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information related to CVE-2024-3056:

**Root Cause of Vulnerability:**
- The vulnerability stems from how shared memory resources are handled within containerized environments using shared IPC namespaces. When a container that allocates IPC resources (specifically shared memory in `/dev/shm`) is killed, its cgroup is removed, but the allocated IPC resources are not. These resources remain tied to the IPC namespace.
- If the malicious container is restarted (either automatically or through attacker control), it can allocate more IPC resources. This causes a memory leak because the old IPC resources are not cleaned up, leading to a progressive increase in memory consumption.
- The memory allocated is assigned to the container's cgroup which has a memory limit. When that limit is reached the kernel refuses to allocate more memory for the container. However, when the container exits, the shared memory is not freed and is still allocated to the first cgroup. The cgroup is no longer accessible from userspace, but it is still referenced internally in the kernel. This creates a memory leak.

**Weaknesses/Vulnerabilities Present:**
- **Resource Leak:** Shared memory resources are not properly released when a container is terminated, leading to memory leaks.
- **Cgroup Management Issue:** The kernel's cgroup management does not account for shared memory resources allocated by terminated cgroups, leaving orphaned allocations in the IPC namespace.
- **Lack of Resource Migration:** Memory allocated in the destroyed cgroup is not migrated to another cgroup using the same IPC.

**Impact of Exploitation:**
- **Denial of Service (DoS):** Repeatedly restarting a malicious container that creates IPC resources can exhaust the system's memory, leading to a denial-of-service condition.
- **System Instability:** Continuous memory exhaustion can cause system instability.

**Attack Vectors:**
- **Malicious Container:** An attacker can create a specially crafted container that exploits the shared IPC namespace vulnerability.
- **Shared IPC Namespace:** Containers must be configured to share an IPC namespace.
- **Container Restart:** The malicious container must restart either automatically or by attacker control.

**Required Attacker Capabilities/Position:**
- **Ability to Deploy Container:** The attacker needs the ability to deploy and run a malicious container in the target environment.
- **Shared IPC Namespace Configuration:** The attacker must target environments where containers are configured to share an IPC namespace.
- **Restart Control:** The attacker benefits from having the ability to cause the malicious container to restart, or relies on the container configuration (such as `podman run --restart=always`) to have it automatically restart.
- **Limited Privilege:** The vulnerability can be triggered by a container running with limited user privileges.

**Additional Notes**
- The bug report mentions that this issue is applicable to Podman, and likely also to Kubernetes, Docker, and other container runtimes that utilize shared IPC namespaces.
- NetApp has stated that it is investigating the vulnerability and does not have any affected products at this time.
- The vulnerability is triggered by a container that allocates IPC resources which are not freed when that container exits.
- The issue is related to the kernel not properly tracking and releasing the allocated IPC resources tied to the cgroup of a container that has been destroyed.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.306 |
| 2 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.299 |
| 3 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.294 |
| 4 | 668 | Exposure of Resource to Wrong Sphere | Class | Discouraged | sparse | 0.281 |
| 5 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.281 |
| 6 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.280 |
| 7 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.279 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.279 |
| 9 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | dense | 0.515 |
| 10 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-400: Uncontrolled Resource Consumption

CWE-401: Missing Release of Memory after Effective Lifetime

CWE-668: Exposure of Resource to Wrong Sphere

CWE-190: Integer Overflow or Wraparound

CWE-789: Memory Allocation with Excessive Size Value

CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer

CWE-863: Incorrect Authorization

CWE-1325: Improperly Controlled Sequential Memory Allocation

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')