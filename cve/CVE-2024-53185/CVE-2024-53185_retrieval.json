{
  "vulnerability_info": "VulnerabilityInfo(cve_id='CVE-2024-53185', description='In the Linux kernel, the following vulnerability has been resolved smb client fix **NULL ptr deref** in crypto_aead_setkey() Neither SMB3.0 or SMB3.02 supports encryption negotiate context, so when SMB2_GLOBAL_CAP_ENCRYPTION flag is set in the negotiate response, the client uses AES-128-CCM as the default cipher. See MS-SMB2 3.3.5.4. Commit b0abcd65ec54 (smb client fix UAF in async decryption) added a @server->cipher_type check to conditionally call smb3_crypto_aead_allocate(), but that check would always be false as @server->cipher_type is unset for SMB3.02. Fix the following KASAN splat by setting @server->cipher_type for SMB3.02 as well. mount.cifs //srv/share /mnt -o vers=3.02,seal,... BUG KASAN **null-ptr-deref** in crypto_aead_setkey+0x2c/0x130 Read of size 8 at addr 0000000000000020 by task mount.cifs/1095 CPU 1 UID 0 PID 1095 Comm mount.cifs Not tainted 6.12.0 #1 Hardware name QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-3.fc41 04/01/2014 Call Trace dump_stack_lvl+0x5d/0x80 ? crypto_aead_setkey+0x2c/0x130 kasan_report+0xda/0x110 ? crypto_aead_setkey+0x2c/0x130 crypto_aead_setkey+0x2c/0x130 crypt_message+0x258/0xec0 [cifs] ? __asan_memset+0x23/0x50 ? __pfx_crypt_message+0x10/0x10 [cifs] ? mark_lock+0xb0/0x6a0 ? hlock_class+0x32/0xb0 ? mark_lock+0xb0/0x6a0 smb3_init_transform_rq+0x352/0x3f0 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 smb_send_rqst+0x144/0x230 [cifs] ? __pfx_smb_send_rqst+0x10/0x10 [cifs] ? hlock_class+0x32/0xb0 ? smb2_setup_request+0x225/0x3a0 [cifs] ? __pfx_cifs_compound_last_callback+0x10/0x10 [cifs] compound_send_recv+0x59b/0x1140 [cifs] ? __pfx_compound_send_recv+0x10/0x10 [cifs] ? __create_object+0x5e/0x90 ? hlock_class+0x32/0xb0 ? do_raw_spin_unlock+0x9a/0xf0 cifs_send_recv+0x23/0x30 [cifs] SMB2_tcon+0x3ec/0xb30 [cifs] ? __pfx_SMB2_tcon+0x10/0x10 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 ? __pfx_lock_release+0x10/0x10 ? do_raw_spin_trylock+0xc6/0x120 ? lock_acquire+0x3f/0x90 ? _get_xid+0x16/0xd0 [cifs] ? __pfx_SMB2_tcon+0x10/0x10 [cifs] ? cifs_get_smb_ses+0xcdd/0x10a0 [cifs] cifs_get_smb_ses+0xcdd/0x10a0 [cifs] ? __pfx_cifs_get_smb_ses+0x10/0x10 [cifs] ? cifs_get_tcp_session+0xaa0/0xca0 [cifs] cifs_mount_get_session+0x8a/0x210 [cifs] dfs_mount_share+0x1b0/0x11d0 [cifs] ? __pfx___lock_acquire+0x10/0x10 ? __pfx_dfs_mount_share+0x10/0x10 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 ? find_held_lock+0x8a/0xa0 ? hlock_class+0x32/0xb0 ? lock_release+0x203/0x5d0 cifs_mount+0xb3/0x3d0 [cifs] ? do_raw_spin_trylock+0xc6/0x120 ? __pfx_cifs_mount+0x10/0x10 [cifs] ? lock_acquire+0x3f/0x90 ? find_nls+0x16/0xa0 ? smb3_update_mnt_flags+0x372/0x3b0 [cifs] cifs_smb3_do_mount+0x1e2/0xc80 [cifs] ? __pfx_vfs_parse_fs_string+0x10/0x10 ? __pfx_cifs_smb3_do_mount+0x10/0x10 [cifs] smb3_get_tree+0x1bf/0x330 [cifs] vfs_get_tree+0x4a/0x160 path_mount+0x3c1/0xfb0 ? kasan_quarantine_put+0xc7/0x1d0 ? __pfx_path_mount+0x10/0x10 ? kmem_cache_free+0x118/0x3e0 ? user_path_at+0x74/0xa0 __x64_sys_mount+0x1a6/0x1e0 ? __pfx___x64_sys_mount+0x10/0x10 ? mark_held_locks+0x1a/0x90 do_syscall_64+0xbb/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7f', key_phrases={'rootcause': ['Null pointer dereference', 'NULL ptr deref'], 'weakness': 'null-ptr-deref', 'impact': '', 'vector': '', 'attacker': '', 'product': 'Linux kernel', 'version': '6.12.0', 'component': ''}, reference_content=\"Based on the provided information, this content relates to CVE-2024-53185.\\n\\n**Root Cause of Vulnerability:**\\nThe vulnerability stems from a missing initialization of the `server->cipher_type` field for SMB3.02 connections within the Linux kernel's CIFS client. Specifically, when the `SMB2_GLOBAL_CAP_ENCRYPTION` flag is set in the negotiate response, the client should use AES-128-CCM as the default cipher. However, a previous fix (`b0abcd65ec54`) added a check for `server->cipher_type` before allocating resources for encryption but failed to initialize the cipher type for SMB3.02 connections.\\n\\n**Weaknesses/Vulnerabilities Present:**\\n- **NULL Pointer Dereference:** When encryption is enabled with SMB3.02, the `server->cipher_type` remains uninitialized (NULL). Consequently, when `crypto_aead_setkey` is called later to establish encryption, a null pointer dereference occurs.\\n\\n**Impact of Exploitation:**\\n- **Kernel Crash:** A successful exploitation leads to a kernel crash due to the null pointer dereference. This is evident from the KASAN report provided. The kernel crash can lead to denial of service.\\n\\n**Attack Vectors:**\\n- **Network Mount:** The attack vector involves a malicious or misconfigured SMB server that signals encryption support during negotiation with an SMB3.02 client, causing the kernel to crash when it attempts to initialize the encryption mechanism.\\n- **Mount Command:** The vulnerability is triggered when mounting a CIFS share using the `mount.cifs` command with the `vers=3.02` option and the `seal` option (enabling encryption).\\n\\n**Required Attacker Capabilities/Position:**\\n- **Network Access:** The attacker needs to be able to set up an SMB server and be reachable by the vulnerable client. The attacker has to control the SMB server's responses during negotiation.\\n- **Mount Trigger:** The attacker does not need any specific local capability. A user on a local system with the ability to mount network shares can trigger the vulnerability.\\n\\nThe provided patches correct the issue by explicitly setting the `server->cipher_type` to `SMB2_ENCRYPTION_AES128_CCM` for SMB3.02 connections in addition to SMB3.0 connections, thus preventing the null pointer dereference.\", similar_info={'cwe_distribution': {}, 'cwe_consensus': '', 'similarity_stats': {'thresholds': [], 'total_samples_by_threshold': {}, 'top_cwes_by_threshold': {}}}, similarity_summary=SimilarityInsight(consensus_cwe='', top_cwes=[], confidence_levels={}, total_samples=0), analysis='', analysis_with_relationships='', criticism='', resolution='', relevant_cwes=[{'metadata': {'doc_id': '266', 'name': 'Incorrect Privilege Assignment', 'source': 'sparse', 'original_content': 'A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor.', 'keyphrase_sources': [{'id': 'rootcause:Null pointer dereference', 'keyphrase': 'Null pointer dereference', 'type': 'rootcause'}, {'id': 'rootcause:NULL ptr deref', 'keyphrase': 'NULL ptr deref', 'type': 'rootcause'}, {'id': 'weakness:null-ptr-deref', 'keyphrase': 'null-ptr-deref', 'type': 'weakness'}, {'id': 'product:Linux kernel', 'keyphrase': 'Linux kernel', 'type': 'product'}, {'id': 'version:6.12.0', 'keyphrase': '6.12.0', 'type': 'version'}]}, 'similarity': np.float64(1032.5797750526797)}, {'metadata': {'doc_id': '532', 'name': 'Insertion of Sensitive Information into Log File', 'source': 'sparse', 'original_content': 'The product writes sensitive information to a log file.', 'keyphrase_sources': [{'id': 'rootcause:Null pointer dereference', 'keyphrase': 'Null pointer dereference', 'type': 'rootcause'}, {'id': 'rootcause:NULL ptr deref', 'keyphrase': 'NULL ptr deref', 'type': 'rootcause'}, {'id': 'weakness:null-ptr-deref', 'keyphrase': 'null-ptr-deref', 'type': 'weakness'}, {'id': 'product:Linux kernel', 'keyphrase': 'Linux kernel', 'type': 'product'}, {'id': 'version:6.12.0', 'keyphrase': '6.12.0', 'type': 'version'}]}, 'similarity': np.float64(712.0596951914792)}, {'metadata': {'doc_id': '88', 'name': \"Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')\", 'source': 'sparse', 'original_content': 'The product constructs a string for a command to be executed by a separate component\\nin another control sphere, but it does not properly delimit the\\nintended arguments, options, or switches within that command string.', 'keyphrase_sources': [{'id': 'rootcause:Null pointer dereference', 'keyphrase': 'Null pointer dereference', 'type': 'rootcause'}, {'id': 'rootcause:NULL ptr deref', 'keyphrase': 'NULL ptr deref', 'type': 'rootcause'}, {'id': 'weakness:null-ptr-deref', 'keyphrase': 'null-ptr-deref', 'type': 'weakness'}, {'id': 'product:Linux kernel', 'keyphrase': 'Linux kernel', 'type': 'product'}, {'id': 'version:6.12.0', 'keyphrase': '6.12.0', 'type': 'version'}]}, 'similarity': np.float64(703.8876378667655)}, {'metadata': {'doc_id': '476', 'name': 'NULL Pointer Dereference', 'source': 'sparse', 'original_content': 'The product dereferences a pointer that it expects to be valid but is NULL.', 'keyphrase_sources': [{'id': 'rootcause:Null pointer dereference', 'keyphrase': 'Null pointer dereference', 'type': 'rootcause'}, {'id': 'rootcause:NULL ptr deref', 'keyphrase': 'NULL ptr deref', 'type': 'rootcause'}, {'id': 'weakness:null-ptr-deref', 'keyphrase': 'null-ptr-deref', 'type': 'weakness'}]}, 'similarity': np.float64(661.3035142526962)}, {'metadata': {'doc_id': '327', 'name': 'Use of a Broken or Risky Cryptographic Algorithm', 'source': 'sparse', 'original_content': 'The product uses a broken or risky cryptographic algorithm or protocol.', 'keyphrase_sources': [{'id': 'rootcause:Null pointer dereference', 'keyphrase': 'Null pointer dereference', 'type': 'rootcause'}, {'id': 'rootcause:NULL ptr deref', 'keyphrase': 'NULL ptr deref', 'type': 'rootcause'}, {'id': 'weakness:null-ptr-deref', 'keyphrase': 'null-ptr-deref', 'type': 'weakness'}, {'id': 'product:Linux kernel', 'keyphrase': 'Linux kernel', 'type': 'product'}, {'id': 'version:6.12.0', 'keyphrase': '6.12.0', 'type': 'version'}]}, 'similarity': np.float64(592.7329495604877)}, {'metadata': {'doc_id': '125', 'name': 'Out-of-bounds Read', 'source': 'sparse', 'original_content': 'The product reads data past the end, or before the beginning, of the intended buffer.', 'keyphrase_sources': [{'id': 'product:Linux kernel', 'keyphrase': 'Linux kernel', 'type': 'product'}, {'id': 'version:6.12.0', 'keyphrase': '6.12.0', 'type': 'version'}]}, 'similarity': np.float64(194.33029749769747)}], identified_cwes={'analyzer': [], 'critic_additional': []})",
  "retrieval_results": {
    "has_multiple_keyphrases": true,
    "keyphrase_cwe_sets": {
      "rootcause:Null pointer dereference": {
        "keyphrase": "Null pointer dereference",
        "type": "rootcause",
        "cwes": [
          {
            "metadata": {
              "doc_id": "266",
              "name": "Incorrect Privilege Assignment",
              "source": "sparse",
              "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor.",
              "keyphrase_sources": [
                {
                  "id": "rootcause:Null pointer dereference",
                  "keyphrase": "Null pointer dereference",
                  "type": "rootcause"
                },
                {
                  "id": "rootcause:NULL ptr deref",
                  "keyphrase": "NULL ptr deref",
                  "type": "rootcause"
                },
                {
                  "id": "weakness:null-ptr-deref",
                  "keyphrase": "null-ptr-deref",
                  "type": "weakness"
                },
                {
                  "id": "product:Linux kernel",
                  "keyphrase": "Linux kernel",
                  "type": "product"
                },
                {
                  "id": "version:6.12.0",
                  "keyphrase": "6.12.0",
                  "type": "version"
                }
              ]
            },
            "similarity": 1032.5797750526797
          },
          {
            "metadata": {
              "doc_id": "532",
              "name": "Insertion of Sensitive Information into Log File",
              "source": "sparse",
              "original_content": "The product writes sensitive information to a log file.",
              "keyphrase_sources": [
                {
                  "id": "rootcause:Null pointer dereference",
                  "keyphrase": "Null pointer dereference",
                  "type": "rootcause"
                },
                {
                  "id": "rootcause:NULL ptr deref",
                  "keyphrase": "NULL ptr deref",
                  "type": "rootcause"
                },
                {
                  "id": "weakness:null-ptr-deref",
                  "keyphrase": "null-ptr-deref",
                  "type": "weakness"
                },
                {
                  "id": "product:Linux kernel",
                  "keyphrase": "Linux kernel",
                  "type": "product"
                },
                {
                  "id": "version:6.12.0",
                  "keyphrase": "6.12.0",
                  "type": "version"
                }
              ]
            },
            "similarity": 712.0596951914792
          },
          {
            "metadata": {
              "doc_id": "88",
              "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
              "source": "sparse",
              "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string.",
              "keyphrase_sources": [
                {
                  "id": "rootcause:Null pointer dereference",
                  "keyphrase": "Null pointer dereference",
                  "type": "rootcause"
                },
                {
                  "id": "rootcause:NULL ptr deref",
                  "keyphrase": "NULL ptr deref",
                  "type": "rootcause"
                },
                {
                  "id": "weakness:null-ptr-deref",
                  "keyphrase": "null-ptr-deref",
                  "type": "weakness"
                },
                {
                  "id": "product:Linux kernel",
                  "keyphrase": "Linux kernel",
                  "type": "product"
                },
                {
                  "id": "version:6.12.0",
                  "keyphrase": "6.12.0",
                  "type": "version"
                }
              ]
            },
            "similarity": 703.8876378667655
          },
          {
            "metadata": {
              "doc_id": "476",
              "name": "NULL Pointer Dereference",
              "source": "sparse",
              "original_content": "The product dereferences a pointer that it expects to be valid but is NULL.",
              "keyphrase_sources": [
                {
                  "id": "rootcause:Null pointer dereference",
                  "keyphrase": "Null pointer dereference",
                  "type": "rootcause"
                },
                {
                  "id": "rootcause:NULL ptr deref",
                  "keyphrase": "NULL ptr deref",
                  "type": "rootcause"
                },
                {
                  "id": "weakness:null-ptr-deref",
                  "keyphrase": "null-ptr-deref",
                  "type": "weakness"
                }
              ]
            },
            "similarity": 661.3035142526962
          },
          {
            "metadata": {
              "doc_id": "327",
              "name": "Use of a Broken or Risky Cryptographic Algorithm",
              "source": "sparse",
              "original_content": "The product uses a broken or risky cryptographic algorithm or protocol.",
              "keyphrase_sources": [
                {
                  "id": "rootcause:Null pointer dereference",
                  "keyphrase": "Null pointer dereference",
                  "type": "rootcause"
                },
                {
                  "id": "rootcause:NULL ptr deref",
                  "keyphrase": "NULL ptr deref",
                  "type": "rootcause"
                },
                {
                  "id": "weakness:null-ptr-deref",
                  "keyphrase": "null-ptr-deref",
                  "type": "weakness"
                },
                {
                  "id": "product:Linux kernel",
                  "keyphrase": "Linux kernel",
                  "type": "product"
                },
                {
                  "id": "version:6.12.0",
                  "keyphrase": "6.12.0",
                  "type": "version"
                }
              ]
            },
            "similarity": 592.7329495604877
          }
        ]
      },
      "rootcause:NULL ptr deref": {
        "keyphrase": "NULL ptr deref",
        "type": "rootcause",
        "cwes": [
          {
            "metadata": {
              "doc_id": "266",
              "name": "Incorrect Privilege Assignment",
              "source": "sparse",
              "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor."
            },
            "similarity": 1032.5797750526797
          },
          {
            "metadata": {
              "doc_id": "532",
              "name": "Insertion of Sensitive Information into Log File",
              "source": "sparse",
              "original_content": "The product writes sensitive information to a log file."
            },
            "similarity": 712.0596951914792
          },
          {
            "metadata": {
              "doc_id": "88",
              "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
              "source": "sparse",
              "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string."
            },
            "similarity": 703.8876378667655
          },
          {
            "metadata": {
              "doc_id": "476",
              "name": "NULL Pointer Dereference",
              "source": "sparse",
              "original_content": "The product dereferences a pointer that it expects to be valid but is NULL."
            },
            "similarity": 628.2099230401872
          },
          {
            "metadata": {
              "doc_id": "327",
              "name": "Use of a Broken or Risky Cryptographic Algorithm",
              "source": "sparse",
              "original_content": "The product uses a broken or risky cryptographic algorithm or protocol."
            },
            "similarity": 592.7329495604877
          }
        ]
      },
      "weakness:null-ptr-deref": {
        "keyphrase": "null-ptr-deref",
        "type": "weakness",
        "cwes": [
          {
            "metadata": {
              "doc_id": "266",
              "name": "Incorrect Privilege Assignment",
              "source": "sparse",
              "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor."
            },
            "similarity": 963.741123382501
          },
          {
            "metadata": {
              "doc_id": "532",
              "name": "Insertion of Sensitive Information into Log File",
              "source": "sparse",
              "original_content": "The product writes sensitive information to a log file."
            },
            "similarity": 664.5890488453805
          },
          {
            "metadata": {
              "doc_id": "88",
              "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
              "source": "sparse",
              "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string."
            },
            "similarity": 656.9617953423144
          },
          {
            "metadata": {
              "doc_id": "476",
              "name": "NULL Pointer Dereference",
              "source": "sparse",
              "original_content": "The product dereferences a pointer that it expects to be valid but is NULL."
            },
            "similarity": 586.3292615041747
          },
          {
            "metadata": {
              "doc_id": "327",
              "name": "Use of a Broken or Risky Cryptographic Algorithm",
              "source": "sparse",
              "original_content": "The product uses a broken or risky cryptographic algorithm or protocol."
            },
            "similarity": 553.2174195897884
          }
        ]
      },
      "product:Linux kernel": {
        "keyphrase": "Linux kernel",
        "type": "product",
        "cwes": [
          {
            "metadata": {
              "doc_id": "266",
              "name": "Incorrect Privilege Assignment",
              "source": "sparse",
              "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor."
            },
            "similarity": 344.19325835089325
          },
          {
            "metadata": {
              "doc_id": "532",
              "name": "Insertion of Sensitive Information into Log File",
              "source": "sparse",
              "original_content": "The product writes sensitive information to a log file."
            },
            "similarity": 240.92089179313405
          },
          {
            "metadata": {
              "doc_id": "88",
              "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
              "source": "sparse",
              "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string."
            },
            "similarity": 232.11374365208007
          },
          {
            "metadata": {
              "doc_id": "327",
              "name": "Use of a Broken or Risky Cryptographic Algorithm",
              "source": "sparse",
              "original_content": "The product uses a broken or risky cryptographic algorithm or protocol."
            },
            "similarity": 198.63377798776423
          },
          {
            "metadata": {
              "doc_id": "125",
              "name": "Out-of-bounds Read",
              "source": "sparse",
              "original_content": "The product reads data past the end, or before the beginning, of the intended buffer.",
              "keyphrase_sources": [
                {
                  "id": "product:Linux kernel",
                  "keyphrase": "Linux kernel",
                  "type": "product"
                },
                {
                  "id": "version:6.12.0",
                  "keyphrase": "6.12.0",
                  "type": "version"
                }
              ]
            },
            "similarity": 194.33029749769747
          }
        ]
      },
      "version:6.12.0": {
        "keyphrase": "6.12.0",
        "type": "version",
        "cwes": [
          {
            "metadata": {
              "doc_id": "266",
              "name": "Incorrect Privilege Assignment",
              "source": "sparse",
              "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor."
            },
            "similarity": 347.4321522776741
          },
          {
            "metadata": {
              "doc_id": "532",
              "name": "Insertion of Sensitive Information into Log File",
              "source": "sparse",
              "original_content": "The product writes sensitive information to a log file."
            },
            "similarity": 246.09170612976942
          },
          {
            "metadata": {
              "doc_id": "88",
              "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
              "source": "sparse",
              "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string."
            },
            "similarity": 237.3045632828916
          },
          {
            "metadata": {
              "doc_id": "327",
              "name": "Use of a Broken or Risky Cryptographic Algorithm",
              "source": "sparse",
              "original_content": "The product uses a broken or risky cryptographic algorithm or protocol."
            },
            "similarity": 206.0633468483672
          },
          {
            "metadata": {
              "doc_id": "125",
              "name": "Out-of-bounds Read",
              "source": "sparse",
              "original_content": "The product reads data past the end, or before the beginning, of the intended buffer."
            },
            "similarity": 191.58103827290017
          }
        ]
      }
    },
    "keyphrase_mapping": {
      "266": [
        {
          "id": "rootcause:Null pointer dereference",
          "keyphrase": "Null pointer dereference",
          "type": "rootcause"
        },
        {
          "id": "rootcause:NULL ptr deref",
          "keyphrase": "NULL ptr deref",
          "type": "rootcause"
        },
        {
          "id": "weakness:null-ptr-deref",
          "keyphrase": "null-ptr-deref",
          "type": "weakness"
        },
        {
          "id": "product:Linux kernel",
          "keyphrase": "Linux kernel",
          "type": "product"
        },
        {
          "id": "version:6.12.0",
          "keyphrase": "6.12.0",
          "type": "version"
        }
      ],
      "532": [
        {
          "id": "rootcause:Null pointer dereference",
          "keyphrase": "Null pointer dereference",
          "type": "rootcause"
        },
        {
          "id": "rootcause:NULL ptr deref",
          "keyphrase": "NULL ptr deref",
          "type": "rootcause"
        },
        {
          "id": "weakness:null-ptr-deref",
          "keyphrase": "null-ptr-deref",
          "type": "weakness"
        },
        {
          "id": "product:Linux kernel",
          "keyphrase": "Linux kernel",
          "type": "product"
        },
        {
          "id": "version:6.12.0",
          "keyphrase": "6.12.0",
          "type": "version"
        }
      ],
      "88": [
        {
          "id": "rootcause:Null pointer dereference",
          "keyphrase": "Null pointer dereference",
          "type": "rootcause"
        },
        {
          "id": "rootcause:NULL ptr deref",
          "keyphrase": "NULL ptr deref",
          "type": "rootcause"
        },
        {
          "id": "weakness:null-ptr-deref",
          "keyphrase": "null-ptr-deref",
          "type": "weakness"
        },
        {
          "id": "product:Linux kernel",
          "keyphrase": "Linux kernel",
          "type": "product"
        },
        {
          "id": "version:6.12.0",
          "keyphrase": "6.12.0",
          "type": "version"
        }
      ],
      "476": [
        {
          "id": "rootcause:Null pointer dereference",
          "keyphrase": "Null pointer dereference",
          "type": "rootcause"
        },
        {
          "id": "rootcause:NULL ptr deref",
          "keyphrase": "NULL ptr deref",
          "type": "rootcause"
        },
        {
          "id": "weakness:null-ptr-deref",
          "keyphrase": "null-ptr-deref",
          "type": "weakness"
        }
      ],
      "327": [
        {
          "id": "rootcause:Null pointer dereference",
          "keyphrase": "Null pointer dereference",
          "type": "rootcause"
        },
        {
          "id": "rootcause:NULL ptr deref",
          "keyphrase": "NULL ptr deref",
          "type": "rootcause"
        },
        {
          "id": "weakness:null-ptr-deref",
          "keyphrase": "null-ptr-deref",
          "type": "weakness"
        },
        {
          "id": "product:Linux kernel",
          "keyphrase": "Linux kernel",
          "type": "product"
        },
        {
          "id": "version:6.12.0",
          "keyphrase": "6.12.0",
          "type": "version"
        }
      ],
      "125": [
        {
          "id": "product:Linux kernel",
          "keyphrase": "Linux kernel",
          "type": "product"
        },
        {
          "id": "version:6.12.0",
          "keyphrase": "6.12.0",
          "type": "version"
        }
      ]
    },
    "relevant_cwes": [
      {
        "metadata": {
          "doc_id": "266",
          "name": "Incorrect Privilege Assignment",
          "source": "sparse",
          "original_content": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor.",
          "keyphrase_sources": [
            {
              "id": "rootcause:Null pointer dereference",
              "keyphrase": "Null pointer dereference",
              "type": "rootcause"
            },
            {
              "id": "rootcause:NULL ptr deref",
              "keyphrase": "NULL ptr deref",
              "type": "rootcause"
            },
            {
              "id": "weakness:null-ptr-deref",
              "keyphrase": "null-ptr-deref",
              "type": "weakness"
            },
            {
              "id": "product:Linux kernel",
              "keyphrase": "Linux kernel",
              "type": "product"
            },
            {
              "id": "version:6.12.0",
              "keyphrase": "6.12.0",
              "type": "version"
            }
          ]
        },
        "similarity": 1032.5797750526797
      },
      {
        "metadata": {
          "doc_id": "532",
          "name": "Insertion of Sensitive Information into Log File",
          "source": "sparse",
          "original_content": "The product writes sensitive information to a log file.",
          "keyphrase_sources": [
            {
              "id": "rootcause:Null pointer dereference",
              "keyphrase": "Null pointer dereference",
              "type": "rootcause"
            },
            {
              "id": "rootcause:NULL ptr deref",
              "keyphrase": "NULL ptr deref",
              "type": "rootcause"
            },
            {
              "id": "weakness:null-ptr-deref",
              "keyphrase": "null-ptr-deref",
              "type": "weakness"
            },
            {
              "id": "product:Linux kernel",
              "keyphrase": "Linux kernel",
              "type": "product"
            },
            {
              "id": "version:6.12.0",
              "keyphrase": "6.12.0",
              "type": "version"
            }
          ]
        },
        "similarity": 712.0596951914792
      },
      {
        "metadata": {
          "doc_id": "88",
          "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
          "source": "sparse",
          "original_content": "The product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string.",
          "keyphrase_sources": [
            {
              "id": "rootcause:Null pointer dereference",
              "keyphrase": "Null pointer dereference",
              "type": "rootcause"
            },
            {
              "id": "rootcause:NULL ptr deref",
              "keyphrase": "NULL ptr deref",
              "type": "rootcause"
            },
            {
              "id": "weakness:null-ptr-deref",
              "keyphrase": "null-ptr-deref",
              "type": "weakness"
            },
            {
              "id": "product:Linux kernel",
              "keyphrase": "Linux kernel",
              "type": "product"
            },
            {
              "id": "version:6.12.0",
              "keyphrase": "6.12.0",
              "type": "version"
            }
          ]
        },
        "similarity": 703.8876378667655
      },
      {
        "metadata": {
          "doc_id": "476",
          "name": "NULL Pointer Dereference",
          "source": "sparse",
          "original_content": "The product dereferences a pointer that it expects to be valid but is NULL.",
          "keyphrase_sources": [
            {
              "id": "rootcause:Null pointer dereference",
              "keyphrase": "Null pointer dereference",
              "type": "rootcause"
            },
            {
              "id": "rootcause:NULL ptr deref",
              "keyphrase": "NULL ptr deref",
              "type": "rootcause"
            },
            {
              "id": "weakness:null-ptr-deref",
              "keyphrase": "null-ptr-deref",
              "type": "weakness"
            }
          ]
        },
        "similarity": 661.3035142526962
      },
      {
        "metadata": {
          "doc_id": "327",
          "name": "Use of a Broken or Risky Cryptographic Algorithm",
          "source": "sparse",
          "original_content": "The product uses a broken or risky cryptographic algorithm or protocol.",
          "keyphrase_sources": [
            {
              "id": "rootcause:Null pointer dereference",
              "keyphrase": "Null pointer dereference",
              "type": "rootcause"
            },
            {
              "id": "rootcause:NULL ptr deref",
              "keyphrase": "NULL ptr deref",
              "type": "rootcause"
            },
            {
              "id": "weakness:null-ptr-deref",
              "keyphrase": "null-ptr-deref",
              "type": "weakness"
            },
            {
              "id": "product:Linux kernel",
              "keyphrase": "Linux kernel",
              "type": "product"
            },
            {
              "id": "version:6.12.0",
              "keyphrase": "6.12.0",
              "type": "version"
            }
          ]
        },
        "similarity": 592.7329495604877
      },
      {
        "metadata": {
          "doc_id": "125",
          "name": "Out-of-bounds Read",
          "source": "sparse",
          "original_content": "The product reads data past the end, or before the beginning, of the intended buffer.",
          "keyphrase_sources": [
            {
              "id": "product:Linux kernel",
              "keyphrase": "Linux kernel",
              "type": "product"
            },
            {
              "id": "version:6.12.0",
              "keyphrase": "6.12.0",
              "type": "version"
            }
          ]
        },
        "similarity": 194.33029749769747
      }
    ],
    "enhanced_query": "# Vulnerability Description\n\n    In the Linux kernel, the following vulnerability has been resolved smb client fix **NULL ptr deref** in crypto_aead_setkey() Neither SMB3.0 or SMB3.02 supports encryption negotiate context, so when SMB2_GLOBAL_CAP_ENCRYPTION flag is set in the negotiate response, the client uses AES-128-CCM as the default cipher. See MS-SMB2 3.3.5.4. Commit b0abcd65ec54 (smb client fix UAF in async decryption) added a @server->cipher_type check to conditionally call smb3_crypto_aead_allocate(), but that check would always be false as @server->cipher_type is unset for SMB3.02. Fix the following KASAN splat by setting @server->cipher_type for SMB3.02 as well. mount.cifs //srv/share /mnt -o vers=3.02,seal,... BUG KASAN **null-ptr-deref** in crypto_aead_setkey+0x2c/0x130 Read of size 8 at addr 0000000000000020 by task mount.cifs/1095 CPU 1 UID 0 PID 1095 Comm mount.cifs Not tainted 6.12.0 #1 Hardware name QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-3.fc41 04/01/2014 Call Trace dump_stack_lvl+0x5d/0x80 ? crypto_aead_setkey+0x2c/0x130 kasan_report+0xda/0x110 ? crypto_aead_setkey+0x2c/0x130 crypto_aead_setkey+0x2c/0x130 crypt_message+0x258/0xec0 [cifs] ? __asan_memset+0x23/0x50 ? __pfx_crypt_message+0x10/0x10 [cifs] ? mark_lock+0xb0/0x6a0 ? hlock_class+0x32/0xb0 ? mark_lock+0xb0/0x6a0 smb3_init_transform_rq+0x352/0x3f0 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 smb_send_rqst+0x144/0x230 [cifs] ? __pfx_smb_send_rqst+0x10/0x10 [cifs] ? hlock_class+0x32/0xb0 ? smb2_setup_request+0x225/0x3a0 [cifs] ? __pfx_cifs_compound_last_callback+0x10/0x10 [cifs] compound_send_recv+0x59b/0x1140 [cifs] ? __pfx_compound_send_recv+0x10/0x10 [cifs] ? __create_object+0x5e/0x90 ? hlock_class+0x32/0xb0 ? do_raw_spin_unlock+0x9a/0xf0 cifs_send_recv+0x23/0x30 [cifs] SMB2_tcon+0x3ec/0xb30 [cifs] ? __pfx_SMB2_tcon+0x10/0x10 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 ? __pfx_lock_release+0x10/0x10 ? do_raw_spin_trylock+0xc6/0x120 ? lock_acquire+0x3f/0x90 ? _get_xid+0x16/0xd0 [cifs] ? __pfx_SMB2_tcon+0x10/0x10 [cifs] ? cifs_get_smb_ses+0xcdd/0x10a0 [cifs] cifs_get_smb_ses+0xcdd/0x10a0 [cifs] ? __pfx_cifs_get_smb_ses+0x10/0x10 [cifs] ? cifs_get_tcp_session+0xaa0/0xca0 [cifs] cifs_mount_get_session+0x8a/0x210 [cifs] dfs_mount_share+0x1b0/0x11d0 [cifs] ? __pfx___lock_acquire+0x10/0x10 ? __pfx_dfs_mount_share+0x10/0x10 [cifs] ? lock_acquire.part.0+0xf4/0x2a0 ? find_held_lock+0x8a/0xa0 ? hlock_class+0x32/0xb0 ? lock_release+0x203/0x5d0 cifs_mount+0xb3/0x3d0 [cifs] ? do_raw_spin_trylock+0xc6/0x120 ? __pfx_cifs_mount+0x10/0x10 [cifs] ? lock_acquire+0x3f/0x90 ? find_nls+0x16/0xa0 ? smb3_update_mnt_flags+0x372/0x3b0 [cifs] cifs_smb3_do_mount+0x1e2/0xc80 [cifs] ? __pfx_vfs_parse_fs_string+0x10/0x10 ? __pfx_cifs_smb3_do_mount+0x10/0x10 [cifs] smb3_get_tree+0x1bf/0x330 [cifs] vfs_get_tree+0x4a/0x160 path_mount+0x3c1/0xfb0 ? kasan_quarantine_put+0xc7/0x1d0 ? __pfx_path_mount+0x10/0x10 ? kmem_cache_free+0x118/0x3e0 ? user_path_at+0x74/0xa0 __x64_sys_mount+0x1a6/0x1e0 ? __pfx___x64_sys_mount+0x10/0x10 ? mark_held_locks+0x1a/0x90 do_syscall_64+0xbb/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7f\n\n    # Keyphrase-Specific CWE Analysis\n    This vulnerability contains multiple keyphrases that may map to different CWEs. \n    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.\n\n    ## ROOTCAUSE: 'Null pointer dereference'\n\nRelevant CWEs for this ROOTCAUSE:\n\n### 1. CWE-266: Incorrect Privilege Assignment (Score: 1032.58)\n\nA product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....\n\n### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 712.06)\n\nThe product writes sensitive information to a log file....\n\n### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 703.89)\n\nThe product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string....\n\n### 4. CWE-476: NULL Pointer Dereference (Score: 661.30)\n\nThe product dereferences a pointer that it expects to be valid but is NULL....\n\n### 5. CWE-327: Use of a Broken or Risky Cryptographic Algorithm (Score: 592.73)\n\nThe product uses a broken or risky cryptographic algorithm or protocol....\n\n## ROOTCAUSE: 'NULL ptr deref'\n\nRelevant CWEs for this ROOTCAUSE:\n\n### 1. CWE-266: Incorrect Privilege Assignment (Score: 1032.58)\n\nA product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....\n\n### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 712.06)\n\nThe product writes sensitive information to a log file....\n\n### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 703.89)\n\nThe product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string....\n\n### 4. CWE-476: NULL Pointer Dereference (Score: 661.30)\n\nThe product dereferences a pointer that it expects to be valid but is NULL....\n\n### 5. CWE-327: Use of a Broken or Risky Cryptographic Algorithm (Score: 592.73)\n\nThe product uses a broken or risky cryptographic algorithm or protocol....\n\n## WEAKNESS: 'null-ptr-deref'\n\nRelevant CWEs for this WEAKNESS:\n\n### 1. CWE-266: Incorrect Privilege Assignment (Score: 1032.58)\n\nA product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....\n\n### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 712.06)\n\nThe product writes sensitive information to a log file....\n\n### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 703.89)\n\nThe product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string....\n\n### 4. CWE-476: NULL Pointer Dereference (Score: 661.30)\n\nThe product dereferences a pointer that it expects to be valid but is NULL....\n\n### 5. CWE-327: Use of a Broken or Risky Cryptographic Algorithm (Score: 592.73)\n\nThe product uses a broken or risky cryptographic algorithm or protocol....\n\n## PRODUCT: 'Linux kernel'\n\nRelevant CWEs for this PRODUCT:\n\n### 1. CWE-266: Incorrect Privilege Assignment (Score: 1032.58)\n\nA product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....\n\n### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 712.06)\n\nThe product writes sensitive information to a log file....\n\n### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 703.89)\n\nThe product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string....\n\n### 4. CWE-327: Use of a Broken or Risky Cryptographic Algorithm (Score: 592.73)\n\nThe product uses a broken or risky cryptographic algorithm or protocol....\n\n### 5. CWE-125: Out-of-bounds Read (Score: 194.33)\n\nThe product reads data past the end, or before the beginning, of the intended buffer....\n\n## VERSION: '6.12.0'\n\nRelevant CWEs for this VERSION:\n\n### 1. CWE-266: Incorrect Privilege Assignment (Score: 1032.58)\n\nA product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....\n\n### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 712.06)\n\nThe product writes sensitive information to a log file....\n\n### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 703.89)\n\nThe product constructs a string for a command to be executed by a separate component\nin another control sphere, but it does not properly delimit the\nintended arguments, options, or switches within that command string....\n\n### 4. CWE-327: Use of a Broken or Risky Cryptographic Algorithm (Score: 592.73)\n\nThe product uses a broken or risky cryptographic algorithm or protocol....\n\n### 5. CWE-125: Out-of-bounds Read (Score: 194.33)\n\nThe product reads data past the end, or before the beginning, of the intended buffer....\n\n\n    # Analysis Instructions\n    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.\n    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.\n    3. Provide a final determination of primary CWE(s) and any secondary CWEs.\n    4. Format your response using the standard analysis template.\n\n    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.\n    "
  },
  "retrieval_time": 2.1800906658172607
}