# Vulnerability Information: CVE-2024-8130

## Vulnerability Description
A vulnerability has been found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240814 and classified as critical. Affected by this vulnerability is the function cgi_s3 of the file /cgi-bin/s3.cgi of the component HTTP POST Request Handler. The manipulation of the argument f_a_key leads to **command injection**. The attack can be launched remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** D-Link DNS-120 and DNR-202L and DNS-315L and DNS-320 and DNS-320L and DNS-320LW and DNS-321 and DNR-322L and DNS-323 and DNS-325 and DNS-326 and DNS-327L and DNR-326 and DNS-340L and DNS-343 and DNS-345 and DNS-726-4 and DNS-1100-4 and DNS-1200-05 and DNS-1550-04
- **version:** up to 20240814
- **component:** /cgi-bin/s3.cgi

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**CVE ID:** CVE-2024-8130 (Note: This CVE ID is not mentioned in the provided documents, but the extracted vulnerability information is relevant and possibly related to other similar CVEs)

**Root Cause of Vulnerability:**

*   **Command Injection:** The vulnerability stems from a command injection flaw in the `cgi_s3` function within the `/cgi-bin/s3.cgi` file. Specifically, the `f_a_key` variable, received through a POST request, is used in a `snprintf` function to construct a command. This command is then executed using the `system` command.

**Weaknesses/Vulnerabilities Present:**

*   **Unsanitized Input:** The primary weakness is the lack of proper sanitization or validation of the `f_a_key` variable. This allows an attacker to inject arbitrary shell commands into the string that is passed to the `system` command.
*   **Insecure System Call:** The use of the `system` function without proper input validation is inherently risky, as it directly executes shell commands, making it a prime target for command injection attacks.
*   **Vulnerable CGI Script:** The CGI script `/cgi-bin/s3.cgi` is vulnerable because it directly processes unsanitized user input to execute system commands.

**Impact of Exploitation:**

*   **Arbitrary Command Execution:** A successful exploit allows the attacker to execute arbitrary commands on the device's operating system with the privileges of the webserver process.
*   **Complete System Compromise:** The ability to execute arbitrary commands can lead to a complete compromise of the device, allowing an attacker to gain control, potentially install malware, exfiltrate data, or disrupt services.

**Attack Vectors:**

*   **HTTP POST Request:** The attack is performed by sending a crafted HTTP POST request to `/cgi-bin/s3.cgi` with a malicious payload in the `f_a_key` parameter.
*   **Web Interface:** The vulnerability is exposed through the web configuration interface.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to have network access to the vulnerable device to send the malicious HTTP POST request.
*   **Knowledge of Vulnerable Endpoint:** The attacker needs to know the location of the vulnerable CGI script (`/cgi-bin/s3.cgi`) and the affected parameter (`f_a_key`).

**Additional Notes:**

*   The vulnerability affects several D-Link NAS devices, including DNS-320, DNS-320L, DNS-321, DNS-323, DNS-325, and DNS-327L.
*   The vulnerable devices have reached their End of Life (EOL)/End of Service Life (EOS), meaning D-Link no longer provides software updates or security patches for these devices.

**Summary of relevant information:**

*   **Vulnerability:** Command Injection
*   **Location:** `/cgi-bin/s3.cgi`
*   **Parameter:** `f_a_key`
*   **Affected Products:** D-Link DNS-320, DNS-320L, DNS-321, DNS-323, DNS-325, and DNS-327L NAS devices
*   **Impact:** Arbitrary command execution, potential system compromise
*   **Mitigation:** D-Link recommends retiring and replacing the affected devices as they are no longer supported.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.767 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.712 |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.699 |
| 6 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.695 |
| 7 | 341 | Predictable from Observable State | Base | Allowed | sparse | 0.689 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.683 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.636 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |

