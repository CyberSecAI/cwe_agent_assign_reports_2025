## Vulnerability Description
**Insecure creation of temporary files** allows local users on systems with non-default configurations to cause denial of service or set the encryption key for a filesystem

### Vulnerability Description Key Phrases
- **rootcause:** **Insecure creation of temporary files**
- **impact:** denial of service or set the encryption key for a filesystem
- **attacker:** local users on systems with non-default configurations

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

*   The `aeon-check` script uses a fixed path `/tmp/aeon-check-keyfile` to create a temporary keyfile. This file is used to add a key to LUKS2 encryption.

**Weaknesses/Vulnerabilities:**

*   **Predictable File Location:** Using a fixed path in `/tmp` makes the file susceptible to symlink attacks and pre-creation attacks.
*   **Symlink Attack:** An attacker could create a symlink at `/tmp/aeon-check-keyfile` pointing to an arbitrary file. When the script executes `chmod 400` and overwrites the file, it would affect the target of the symlink, potentially causing a denial of service (DoS) by modifying system files.
*   **Pre-creation Attack:** An unprivileged attacker could pre-create the `/tmp/aeon-check-keyfile`. Even after the `chmod` operation, the attacker remains the owner and can still read or overwrite its content, compromising the temporary keyfile used for LUKS encryption.

**Impact of Exploitation:**

*   **Local DoS:** By exploiting the symlink vulnerability, an attacker could overwrite important system files, leading to a DoS.
*   **Key Compromise:** By pre-creating the keyfile, the attacker can compromise the temporary key used in the LUKS encryption process, potentially allowing access to encrypted data.

**Attack Vectors:**

*   **Local Access:** The vulnerability can be exploited by an attacker with local access to the system.

**Required Attacker Capabilities/Position:**

*   The attacker needs to have the ability to create files and symlinks in the `/tmp` directory.
*   The attacker needs to be a local user on the system.

**Mitigation:**

*   The issue was resolved by using `mktemp` to create temporary files securely.
*   It was also suggested that placing the temporary keyfile on a tmpfs like XDG_RUNTIME_DIR, would be an improvement.

**Additional Details**
* The bug report mentions that the vulnerability is mitigated on Tumbleweed due to the `protected_symlinks` and `protected_regular` sysctl settings.

* The fix was implemented in aeon-check version 1.0.2 and tik version 1.2.4.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | sparse | 0.254 |
| 2 | 378 | Creation of Temporary File With Insecure Permissions | Base | Allowed | sparse | 0.241 |
| 3 | 377 | Insecure Temporary File | Class | Allowed-with-Review | sparse | 0.233 |
| 4 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.219 |
| 5 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.204 |
| 6 | 277 | Insecure Inherited Permissions | Variant | Allowed | sparse | 0.193 |
| 7 | 453 | Insecure Default Variable Initialization | Variant | Allowed | sparse | 0.191 |
| 8 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.190 |
| 9 | 1386 | Insecure Operation on Windows Junction / Mount Point | Base | Allowed | dense | 0.555 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-379: Creation of Temporary File in Directory with Insecure Permissions

CWE-378: Creation of Temporary File With Insecure Permissions

CWE-377: Insecure Temporary File

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-732: Incorrect Permission Assignment for Critical Resource

CWE-277: Insecure Inherited Permissions

CWE-453: Insecure Default Variable Initialization

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-1386: Insecure Operation on Windows Junction / Mount Point

CWE-363: Race Condition Enabling Link Following