## Vulnerability Description
SPIP before 4.3.2, 4.2.16, and 4.1.18 is vulnerable to a **command injection** issue. A remote and unauthenticated attacker can execute arbitrary operating system commands by sending a crafted multipart file upload HTTP request.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **impact:** execute arbitrary operating system commands
- **vector:** crafted multipart file upload HTTP request
- **attacker:** remote and unauthenticated attacker
- **product:** SPIP
- **version:** before 4.3.2, 4.2.16, and 4.1.18

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability described:

**Root Cause of Vulnerability:**

The vulnerability lies in the `extraire_fichiers_valides` function within the Bigup plugin of SPIP. This function uses `eval` to dynamically construct and execute PHP code based on user-controlled input from the `$_FILES` array, specifically when handling complex file upload field names. The function is intended to extract valid uploaded files from the `$_FILES` array. However, the function uses `eval` to dynamically access array keys within `$_FILES`.

**Weaknesses/Vulnerabilities Present:**

1.  **Unsafe Use of `eval`:** The primary vulnerability is the use of `eval` with user-controlled input. The code constructs a string representing array access to `$_FILES` based on the `name` parameter of the uploaded file, and then evaluates this string. This allows an attacker to inject arbitrary PHP code into the evaluated string.
2.  **Inadequate Input Sanitization:** There is insufficient sanitization or validation of the input used to construct the dynamic array access string, allowing the injection of single quotes and other characters that can break the context of the evaluated string, and ultimately, execute arbitrary PHP code.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** Successful exploitation allows an attacker to execute arbitrary PHP code on the server. This can lead to complete compromise of the affected SPIP instance, including data theft, modification, and further attacks on the server and network.
*   **Full System Compromise:** The attacker can potentially use the RCE to gain full control of the underlying server operating system.

**Attack Vectors:**

*   **HTTP POST Request:** The vulnerability is triggered via a specially crafted HTTP POST request to a SPIP page that handles form submissions. This request includes a malicious file upload with a crafted `name` parameter that contains PHP code. The vulnerability is triggered by the `bigup_formulaire_receptionner` pipeline, which is executed before form validation, making the exploit pre-authentication.
*   **Multipart Form Data:** The malicious payload is sent within a multipart/form-data request, which is commonly used for file uploads.
*   **Vulnerable Parameter: `name` attribute**: The `name` parameter of a file upload field is abused to inject arbitrary php code. The code expects the `name` attribute to be of the form `champ[tons][][sous][la][pluie][]`, however, the array keys are not validated.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable SPIP instance.
*   **No Authentication Required (Pre-Auth):** The vulnerability can be exploited without prior authentication to the SPIP system.
*   **Crafting Malicious Request:** The attacker needs to be able to craft a multipart/form-data POST request containing the malicious `name` parameter in the file upload.

**Additional Details:**

*   The vulnerability affects versions of SPIP up to and including 4.3.1, 4.2.15, and all versions before 4.1.18.
*   The vulnerable code is located in `plugins-dist/bigup/inc/Bigup/Files.php`, specifically the `extraire_fichiers_valides` function.
*   The vulnerability was discovered by Vozec (Arthur Deloffre) and subsequently made pre-authentication with help from Laluka (Jacques-Chevallier Louka).
*   The blog posts and writeups provide detailed explanations of the vulnerability, including code snippets, request examples, and exploit scripts.

The provided content gives a detailed explanation of the vulnerability, how it was found, and how it can be exploited. This is more comprehensive than a typical CVE description and provides ample details for understanding and mitigating the issue.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.237 |
| 4 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.232 |
| 5 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.231 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.231 |
| 7 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.226 |
| 8 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.225 |
| 9 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | dense | 0.544 |
| 10 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | graph | 0.002 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-138: Improper Neutralization of Special Elements

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-20: Improper Input Validation

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')