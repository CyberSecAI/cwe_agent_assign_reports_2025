## Vulnerability Description
In PHP versions 8.1.* before 8.1.31, 8.2.* before 8.2.26, 8.3.* before 8.3.14, when using streams with configured proxy and request_fulluri option, the URI is not properly sanitized which can lead to **HTTP request smuggling** and allow the attacker to use the proxy to perform arbitrary HTTP requests originating from the server, thus potentially gaining access to resources not normally available to the external user.

### Vulnerability Description Key Phrases
- **rootcause:** **improper URI sanitization**
- **weakness:** **HTTP request smuggling**
- **impact:** arbitrary HTTP request execution
- **product:** PHP
- **version:** 8.1.* before 8.1.31, 8.2.* before 8.2.26, 8.3.* before 8.3.14
- **component:** streams with configured proxy and request_fulluri option

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The vulnerability lies in the implementation of the `request_fulluri` parameter in PHP's stream context, which inserts the raw URI into the HTTP request line without proper sanitization, bypassing the usual control character checks. This allows for CRLF injection.
- **Weaknesses/vulnerabilities present:**
    - CRLF injection vulnerability in HTTP request line.
    - Lack of sanitization of user-controlled URI when `request_fulluri` is enabled.
    - Automatic enabling of `request_fulluri` for non-HTTP streams when a proxy is set.
- **Impact of exploitation:**
    - HTTP request smuggling attacks.
    - Server Side Request Forgery (SSRF), allowing attackers to bypass security controls and access internal endpoints.
    - Ability to control the Host header and potentially access different hosts.
    - Possibility to inject arbitrary HTTP methods and headers, including sensitive headers.
    - In certain setups, the attacker might be able to read the HTTP responses of smuggled requests.
- **Attack vectors:**
    - An attacker can inject CRLF characters into the URI when the `request_fulluri` context parameter is true, either through HTTP or FTP streams that have a proxy configured.
- **Required attacker capabilities/position:**
    - Partial control over the resource URI being requested.
    - Ability to influence the stream context and set the `request_fulluri` parameter either directly or through proxy settings.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 444 | Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.418 |
| 3 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.417 |
| 4 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.411 |
| 5 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.409 |
| 6 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | sparse | 0.406 |
| 7 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.403 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.396 |
| 9 | 473 | PHP External Variable Modification | Variant | Allowed | dense | 0.512 |
| 10 | 1275 | Sensitive Cookie with Improper SameSite Attribute | Variant | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-444: Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')

CWE-863: Incorrect Authorization

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-138: Improper Neutralization of Special Elements

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')

CWE-116: Improper Encoding or Escaping of Output

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-473: PHP External Variable Modification

CWE-1275: Sensitive Cookie with Improper SameSite Attribute