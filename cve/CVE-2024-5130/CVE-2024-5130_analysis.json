{
  "cve_id": "CVE-2024-5130",
  "description": "An **Incorrect Authorization** vulnerability exists in lunary-ai/lunary versions up to and including 1.2.2, which allows unauthenticated users to delete any dataset. The vulnerability is due to the **lack of proper authorization checks** in the dataset deletion endpoint. Specifically, the endpoint does not verify if the provided project ID belongs to the current user, thereby allowing any dataset to be deleted without proper authentication. This issue was fixed in version 1.2.8.",
  "key_phrases": {
    "rootcause": [
      "Incorrect Authorization",
      "lack of proper authorization checks"
    ],
    "weakness": "",
    "impact": "delete any dataset",
    "vector": "",
    "attacker": "unauthenticated users",
    "product": "lunary-ai/lunary",
    "version": "up to and including 1.2.2",
    "component": "dataset deletion endpoint"
  },
  "reference_content": "The provided content relates to a commit that fixes an authorization issue in the `lunary-ai/lunary` repository. The commit addresses a vulnerability related to dataset deletion.\n\n**Root cause of vulnerability:**\nThe original code for deleting a dataset lacked proper authorization checks. It allowed deletion of a dataset based solely on the provided `id`, without verifying if the user had the required permission and if the dataset belonged to the user's project.\n\n**Weaknesses/vulnerabilities present:**\n- **Insecure direct object reference (IDOR):** An attacker could potentially delete a dataset belonging to another user by simply knowing the dataset's ID.\n- **Missing authorization check:** The code didn't verify if the user attempting the deletion had the necessary permission to perform the action.\n\n**Impact of exploitation:**\nAn attacker could potentially delete arbitrary datasets within the application, leading to data loss and potentially disrupting the application's functionality.\n\n**Attack vectors:**\n- The vulnerability could be exploited by sending a malicious DELETE request to the `/datasets/:id` endpoint with a target dataset ID.\n\n**Required attacker capabilities/position:**\n- The attacker would need to be an authenticated user of the application.\n- The attacker would need to know or guess the ID of the dataset they want to delete.\n\n**Additional details from the provided content:**\n- The fix involves adding a check `and projectId = ${projectId}` to ensure that only datasets belonging to the user's project can be deleted.\n- The vulnerable code was located in the file `packages/backend/src/api/v1/datasets/index.ts`\n- The commit message mentions \"fix: authorization delete dataset\" and references pull request #204.",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID  | CWE Name                                                  | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n| :-------- | :-------------------------------------------------------- | :---------- | :-------------------- | :------------------------------ | :------------------------------ |\n| CWE-862   | Missing Authorization                                     | 0.9         | Class                 | Primary                         | Allowed-with-Review           |\n| CWE-306   | Missing Authentication for Critical Function            | 0.7         | Base                  | Secondary                       | Allowed                       |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship is between CWE-862 (Missing Authorization) and its child CWEs, and also considers CWE-306 (Missing Authentication for Critical Function). CWE-862 is a class-level CWE, and there might be more specific base-level CWEs. However, the description focuses on the absence of authorization checks, making CWE-862 appropriate. CWE-306 could be a related weakness given unauthenticated users were able to delete data sets, meaning there was missing authentication.\n\n```mermaid\ngraph TD\n    cwe862[\"CWE-862: Missing Authorization\"]\n    cwe306[\"CWE-306: Missing Authentication for Critical Function\"]\n    cwe284[\"CWE-284: Improper Access Control\"]\n\n    cwe862 -->|CHILDOF| cwe284\n    cwe306 -->|CHILDOF| cwe287\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe862 primary\n    class cwe306 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **lack of proper authorization checks** (CWE-862), which allows unauthenticated users (CWE-306) to delete any dataset, leading to a data integrity issue.\n\n## Summary of Analysis\nThe initial analysis focused on the **Incorrect Authorization** and **lack of proper authorization checks** key phrases in the vulnerability description. The primary weakness is the **lack of proper authorization checks** (CWE-862), as the endpoint doesn't verify if the provided project ID belongs to the current user. The fact that 'unauthenticated users' were able to exploit this weakness leads to a secondary weakness of CWE-306.\n\nThe selection of CWE-862 is based on the description stating the **lack of proper authorization checks** in the dataset deletion endpoint. This aligns directly with the definition of CWE-862: \"The product does not perform an authorization check when an actor attempts to access a resource or perform an action.\"\n\nCWE-306 applies because the vulnerability description mentions \"unauthenticated users\" being able to delete datasets. This indicates a **missing authentication** problem for a critical function.\n\nOther CWEs were considered but deemed less appropriate:\n\n*   CWE-863 (**Incorrect Authorization**): This CWE implies that an authorization check is performed but is done incorrectly. The description states that authorization checks were missing.\n*   CWE-285 (**Improper Authorization**): Similar to CWE-863, this suggests that there was an authorization check, but it was done improperly.\n*   CWE-639 (**Authorization Bypass Through User-Controlled Key**): This CWE involves modifying a key value to gain unauthorized access. The vulnerability description doesn't mention anything related to manipulating key values.\n\nThe selected CWEs are at an appropriate level of specificity. CWE-862 is a class-level CWE, but it directly captures the essence of the vulnerability, which is a missing authorization check.\nCWE-306 is a Base level CWE, and it directly captures the fact that the vulnerability was exploited by unauthenticated users.",
  "analysis_with_relationships": "# Summary\n| CWE ID  | CWE Name                                                  | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n| :-------- | :-------------------------------------------------------- | :---------- | :-------------------- | :------------------------------ | :------------------------------ |\n| CWE-862   | Missing Authorization                                     | 0.9         | Class                 | Primary                         | Allowed-with-Review           |\n| CWE-306   | Missing Authentication for Critical Function            | 0.7         | Base                  | Secondary                       | Allowed                       |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship is between CWE-862 (Missing Authorization) and its child CWEs, and also considers CWE-306 (Missing Authentication for Critical Function). CWE-862 is a class-level CWE, and there might be more specific base-level CWEs. However, the description focuses on the absence of authorization checks, making CWE-862 appropriate. CWE-306 could be a related weakness given unauthenticated users were able to delete data sets, meaning there was missing authentication.\n\n```mermaid\ngraph TD\n    cwe862[\"CWE-862: Missing Authorization\"]\n    cwe306[\"CWE-306: Missing Authentication for Critical Function\"]\n    cwe284[\"CWE-284: Improper Access Control\"]\n\n    cwe862 -->|CHILDOF| cwe284\n    cwe306 -->|CHILDOF| cwe287\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    class cwe862 primary\n    class cwe306 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **lack of proper authorization checks** (CWE-862), which allows unauthenticated users (CWE-306) to delete any dataset, leading to a data integrity issue.\n\n## Summary of Analysis\nThe initial analysis focused on the **Incorrect Authorization** and **lack of proper authorization checks** key phrases in the vulnerability description. The primary weakness is the **lack of proper authorization checks** (CWE-862), as the endpoint doesn't verify if the provided project ID belongs to the current user. The fact that 'unauthenticated users' were able to exploit this weakness leads to a secondary weakness of CWE-306.\n\nThe selection of CWE-862 is based on the description stating the **lack of proper authorization checks** in the dataset deletion endpoint. This aligns directly with the definition of CWE-862: \"The product does not perform an authorization check when an actor attempts to access a resource or perform an action.\"\n\nCWE-306 applies because the vulnerability description mentions \"unauthenticated users\" being able to delete datasets. This indicates a **missing authentication** problem for a critical function.\n\nOther CWEs were considered but deemed less appropriate:\n\n*   CWE-863 (**Incorrect Authorization**): This CWE implies that an authorization check is performed but is done incorrectly. The description states that authorization checks were missing.\n*   CWE-285 (**Improper Authorization**): Similar to CWE-863, this suggests that there was an authorization check, but it was done improperly.\n*   CWE-639 (**Authorization Bypass Through User-Controlled Key**): This CWE involves modifying a key value to gain unauthorized access. The vulnerability description doesn't mention anything related to manipulating key values.\n\nThe selected CWEs are at an appropriate level of specificity. CWE-862 is a class-level CWE, but it directly captures the essence of the vulnerability, which is a missing authorization check.\nCWE-306 is a Base level CWE, and it directly captures the fact that the vulnerability was exploited by unauthenticated users.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-863:**\n- 863 (Incorrect Authorization) - ROOT\n\n\n**Chain starting from CWE-862:**\n- 862 (Missing Authorization) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "863",
        "name": "Incorrect Authorization",
        "source": "sparse",
        "original_content": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check.",
        "keyphrase_sources": [
          {
            "id": "rootcause:Incorrect Authorization",
            "keyphrase": "Incorrect Authorization",
            "type": "rootcause"
          },
          {
            "id": "rootcause:lack of proper authorization checks",
            "keyphrase": "lack of proper authorization checks",
            "type": "rootcause"
          },
          {
            "id": "impact:delete any dataset",
            "keyphrase": "delete any dataset",
            "type": "impact"
          },
          {
            "id": "attacker:unauthenticated users",
            "keyphrase": "unauthenticated users",
            "type": "attacker"
          },
          {
            "id": "product:lunary-ai/lunary",
            "keyphrase": "lunary-ai/lunary",
            "type": "product"
          },
          {
            "id": "version:up to and including 1.2.2",
            "keyphrase": "up to and including 1.2.2",
            "type": "version"
          },
          {
            "id": "component:dataset deletion endpoint",
            "keyphrase": "dataset deletion endpoint",
            "type": "component"
          }
        ]
      },
      "similarity": 492.9187450876684
    },
    {
      "metadata": {
        "doc_id": "285",
        "name": "Improper Authorization",
        "source": "sparse",
        "original_content": "The product does not perform or incorrectly performs an authorization check when an actor attempts to access a resource or perform an action.",
        "keyphrase_sources": [
          {
            "id": "rootcause:Incorrect Authorization",
            "keyphrase": "Incorrect Authorization",
            "type": "rootcause"
          },
          {
            "id": "rootcause:lack of proper authorization checks",
            "keyphrase": "lack of proper authorization checks",
            "type": "rootcause"
          },
          {
            "id": "impact:delete any dataset",
            "keyphrase": "delete any dataset",
            "type": "impact"
          },
          {
            "id": "attacker:unauthenticated users",
            "keyphrase": "unauthenticated users",
            "type": "attacker"
          },
          {
            "id": "product:lunary-ai/lunary",
            "keyphrase": "lunary-ai/lunary",
            "type": "product"
          },
          {
            "id": "version:up to and including 1.2.2",
            "keyphrase": "up to and including 1.2.2",
            "type": "version"
          },
          {
            "id": "component:dataset deletion endpoint",
            "keyphrase": "dataset deletion endpoint",
            "type": "component"
          }
        ]
      },
      "similarity": 480.77028326789804
    },
    {
      "metadata": {
        "doc_id": "639",
        "name": "Authorization Bypass Through User-Controlled Key",
        "source": "sparse",
        "original_content": "The system's authorization functionality does not prevent one user from gaining access to another user's data or record by modifying the key value identifying the data.",
        "keyphrase_sources": [
          {
            "id": "rootcause:Incorrect Authorization",
            "keyphrase": "Incorrect Authorization",
            "type": "rootcause"
          },
          {
            "id": "rootcause:lack of proper authorization checks",
            "keyphrase": "lack of proper authorization checks",
            "type": "rootcause"
          },
          {
            "id": "impact:delete any dataset",
            "keyphrase": "delete any dataset",
            "type": "impact"
          },
          {
            "id": "attacker:unauthenticated users",
            "keyphrase": "unauthenticated users",
            "type": "attacker"
          },
          {
            "id": "product:lunary-ai/lunary",
            "keyphrase": "lunary-ai/lunary",
            "type": "product"
          },
          {
            "id": "version:up to and including 1.2.2",
            "keyphrase": "up to and including 1.2.2",
            "type": "version"
          },
          {
            "id": "component:dataset deletion endpoint",
            "keyphrase": "dataset deletion endpoint",
            "type": "component"
          }
        ]
      },
      "similarity": 460.6014432420694
    },
    {
      "metadata": {
        "doc_id": "862",
        "name": "Missing Authorization",
        "source": "sparse",
        "original_content": "The product does not perform an authorization check when an actor attempts to access a resource or perform an action.",
        "keyphrase_sources": [
          {
            "id": "rootcause:Incorrect Authorization",
            "keyphrase": "Incorrect Authorization",
            "type": "rootcause"
          },
          {
            "id": "rootcause:lack of proper authorization checks",
            "keyphrase": "lack of proper authorization checks",
            "type": "rootcause"
          },
          {
            "id": "impact:delete any dataset",
            "keyphrase": "delete any dataset",
            "type": "impact"
          },
          {
            "id": "attacker:unauthenticated users",
            "keyphrase": "unauthenticated users",
            "type": "attacker"
          },
          {
            "id": "product:lunary-ai/lunary",
            "keyphrase": "lunary-ai/lunary",
            "type": "product"
          },
          {
            "id": "version:up to and including 1.2.2",
            "keyphrase": "up to and including 1.2.2",
            "type": "version"
          },
          {
            "id": "component:dataset deletion endpoint",
            "keyphrase": "dataset deletion endpoint",
            "type": "component"
          }
        ]
      },
      "similarity": 456.1127185337389
    },
    {
      "metadata": {
        "doc_id": "620",
        "name": "Unverified Password Change",
        "source": "sparse",
        "original_content": "When setting a new password for a user, the product does not require knowledge of the original password, or using another form of authentication.",
        "keyphrase_sources": [
          {
            "id": "rootcause:Incorrect Authorization",
            "keyphrase": "Incorrect Authorization",
            "type": "rootcause"
          },
          {
            "id": "rootcause:lack of proper authorization checks",
            "keyphrase": "lack of proper authorization checks",
            "type": "rootcause"
          },
          {
            "id": "impact:delete any dataset",
            "keyphrase": "delete any dataset",
            "type": "impact"
          },
          {
            "id": "attacker:unauthenticated users",
            "keyphrase": "unauthenticated users",
            "type": "attacker"
          },
          {
            "id": "product:lunary-ai/lunary",
            "keyphrase": "lunary-ai/lunary",
            "type": "product"
          }
        ]
      },
      "similarity": 445.98447058736235
    },
    {
      "metadata": {
        "doc_id": "306",
        "name": "Missing Authentication for Critical Function",
        "source": "sparse",
        "original_content": "The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.",
        "keyphrase_sources": [
          {
            "id": "version:up to and including 1.2.2",
            "keyphrase": "up to and including 1.2.2",
            "type": "version"
          },
          {
            "id": "component:dataset deletion endpoint",
            "keyphrase": "dataset deletion endpoint",
            "type": "component"
          }
        ]
      },
      "similarity": 166.6067699689877
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-863",
      "CWE-862",
      "CWE-639",
      "CWE-306",
      "CWE-285",
      "CWE-284"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {
    "863": [
      {
        "id": "rootcause:Incorrect Authorization",
        "keyphrase": "Incorrect Authorization",
        "type": "rootcause"
      },
      {
        "id": "rootcause:lack of proper authorization checks",
        "keyphrase": "lack of proper authorization checks",
        "type": "rootcause"
      },
      {
        "id": "impact:delete any dataset",
        "keyphrase": "delete any dataset",
        "type": "impact"
      },
      {
        "id": "attacker:unauthenticated users",
        "keyphrase": "unauthenticated users",
        "type": "attacker"
      },
      {
        "id": "product:lunary-ai/lunary",
        "keyphrase": "lunary-ai/lunary",
        "type": "product"
      },
      {
        "id": "version:up to and including 1.2.2",
        "keyphrase": "up to and including 1.2.2",
        "type": "version"
      },
      {
        "id": "component:dataset deletion endpoint",
        "keyphrase": "dataset deletion endpoint",
        "type": "component"
      }
    ],
    "285": [
      {
        "id": "rootcause:Incorrect Authorization",
        "keyphrase": "Incorrect Authorization",
        "type": "rootcause"
      },
      {
        "id": "rootcause:lack of proper authorization checks",
        "keyphrase": "lack of proper authorization checks",
        "type": "rootcause"
      },
      {
        "id": "impact:delete any dataset",
        "keyphrase": "delete any dataset",
        "type": "impact"
      },
      {
        "id": "attacker:unauthenticated users",
        "keyphrase": "unauthenticated users",
        "type": "attacker"
      },
      {
        "id": "product:lunary-ai/lunary",
        "keyphrase": "lunary-ai/lunary",
        "type": "product"
      },
      {
        "id": "version:up to and including 1.2.2",
        "keyphrase": "up to and including 1.2.2",
        "type": "version"
      },
      {
        "id": "component:dataset deletion endpoint",
        "keyphrase": "dataset deletion endpoint",
        "type": "component"
      }
    ],
    "639": [
      {
        "id": "rootcause:Incorrect Authorization",
        "keyphrase": "Incorrect Authorization",
        "type": "rootcause"
      },
      {
        "id": "rootcause:lack of proper authorization checks",
        "keyphrase": "lack of proper authorization checks",
        "type": "rootcause"
      },
      {
        "id": "impact:delete any dataset",
        "keyphrase": "delete any dataset",
        "type": "impact"
      },
      {
        "id": "attacker:unauthenticated users",
        "keyphrase": "unauthenticated users",
        "type": "attacker"
      },
      {
        "id": "product:lunary-ai/lunary",
        "keyphrase": "lunary-ai/lunary",
        "type": "product"
      },
      {
        "id": "version:up to and including 1.2.2",
        "keyphrase": "up to and including 1.2.2",
        "type": "version"
      },
      {
        "id": "component:dataset deletion endpoint",
        "keyphrase": "dataset deletion endpoint",
        "type": "component"
      }
    ],
    "862": [
      {
        "id": "rootcause:Incorrect Authorization",
        "keyphrase": "Incorrect Authorization",
        "type": "rootcause"
      },
      {
        "id": "rootcause:lack of proper authorization checks",
        "keyphrase": "lack of proper authorization checks",
        "type": "rootcause"
      },
      {
        "id": "impact:delete any dataset",
        "keyphrase": "delete any dataset",
        "type": "impact"
      },
      {
        "id": "attacker:unauthenticated users",
        "keyphrase": "unauthenticated users",
        "type": "attacker"
      },
      {
        "id": "product:lunary-ai/lunary",
        "keyphrase": "lunary-ai/lunary",
        "type": "product"
      },
      {
        "id": "version:up to and including 1.2.2",
        "keyphrase": "up to and including 1.2.2",
        "type": "version"
      },
      {
        "id": "component:dataset deletion endpoint",
        "keyphrase": "dataset deletion endpoint",
        "type": "component"
      }
    ],
    "620": [
      {
        "id": "rootcause:Incorrect Authorization",
        "keyphrase": "Incorrect Authorization",
        "type": "rootcause"
      },
      {
        "id": "rootcause:lack of proper authorization checks",
        "keyphrase": "lack of proper authorization checks",
        "type": "rootcause"
      },
      {
        "id": "impact:delete any dataset",
        "keyphrase": "delete any dataset",
        "type": "impact"
      },
      {
        "id": "attacker:unauthenticated users",
        "keyphrase": "unauthenticated users",
        "type": "attacker"
      },
      {
        "id": "product:lunary-ai/lunary",
        "keyphrase": "lunary-ai/lunary",
        "type": "product"
      }
    ],
    "306": [
      {
        "id": "version:up to and including 1.2.2",
        "keyphrase": "up to and including 1.2.2",
        "type": "version"
      },
      {
        "id": "component:dataset deletion endpoint",
        "keyphrase": "dataset deletion endpoint",
        "type": "component"
      }
    ]
  }
}