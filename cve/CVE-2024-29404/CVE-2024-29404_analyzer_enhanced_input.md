## Vulnerability Description
An issue in Razer Synapse 3 v.3.9.131.20813 and Synapse 3 App v.20240213 allows a local attacker to execute arbitrary code via the export parameter of the Chroma Effects function in the Profiles component.

### Vulnerability Description Key Phrases
- **impact:** execute arbitrary code
- **vector:** export parameter
- **attacker:** local attacker
- **product:** Razer Synapse 3 and Synapse 3 App
- **version:** v.3.9.131.20813 and v.20240213
- **component:** Chroma Effects function in Profiles component

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability information related to CVE-2024-29404:

**Summary:**

The provided content relates to CVE-2024-29404, which involves an Elevation of Privilege (EoP) vulnerability in Razer Synapse 3, specifically within the "Chroma Effects" functionality. This vulnerability stems from an arbitrary file/folder removal issue. The root cause of this is how Razer Synapse 3 handles file operations, allowing an attacker to manipulate the system state by exploiting the Windows Installer service. The attacker can leverage an arbitrary file/folder deletion vulnerability to achieve privilege escalation. The provided content also details additional techniques for exploiting weaker primitives such as folder content deletion.

**Root Cause of Vulnerability:**

*   The vulnerability originates from how Razer Synapse 3 handles file operations related to Chroma Effects.
*   It abuses the Windows Installer service to achieve privilege escalation by manipulating rollback procedures.
*   The core issue is the ability to delete or manipulate system files and folders, specifically `C:\Config.Msi` and its contents, combined with the installer service trusting the existence of the registry value corresponding to this folder.

**Weaknesses/Vulnerabilities Present:**

*   **Arbitrary File/Folder Deletion:** The primary vulnerability is the ability to delete arbitrary files or folders via Razer Synapse 3. The attacker can use this to delete the `C:\Config.Msi` folder. This folder is created by Windows Installer service during installations and uninstalls.
*   **Windows Installer Manipulation:** Attackers can manipulate the Windows Installer service by recreating `C:\Config.Msi` with a weak DACL after deleting a legitimate one, then forcing rollbacks and dropping malicious files using specifically crafted `.rbs` (rollback script) and `.rbf` (rollback file) files.
*   **Insecure DACLs:** The vulnerability exploits the Windows Installer service's mechanism to handle rollback operations, specifically, the ability to manipulate the permissions (DACLs) on the `C:\Config.Msi` directory after deleting it and recreating it.
*   **Oplock Abuse**: A secondary vector is described where attackers can use oplocks to hold file handles open while manipulating symlinks or junctions in the filesystem. This helps manipulate the targets of file operations in the vulnerable process.
*   **Object Namespace Symlink/Junction Abuse:** The attacker uses techniques for abusing symlinks and junctions to redirect deletion requests from one file/folder to another, allowing for indirect manipulation of the system. This is used in the 'Folder Contents Delete' vector of attack, allowing for a 'contents delete' vulnerability to delete an arbitrary folder like `C:\Config.Msi`

**Impact of Exploitation:**

*   **Elevation of Privilege (EoP):** Successful exploitation allows an attacker to escalate privileges to `NT AUTHORITY\SYSTEM`, effectively gaining complete control over the affected system.
*   **Arbitrary Code Execution:** By manipulating the Windows Installer service, an attacker can execute arbitrary code by placing malicious DLLs in the `C:\Config.Msi` directory and forcing the system to load them during rollback operations.
*   **Denial of Service (DoS):** An attacker can create a folder at a critical system location like `C:\Windows\System32\cng.sys`, disrupting the Windows boot process and leading to a permanent DoS. Additionally a file delete on a critical system file, even without content control, can result in permanent DoS.

**Attack Vectors:**

*   **Razer Synapse 3:** The initial attack vector is the vulnerable Razer Synapse 3 software, specifically its "Chroma Effects" functionality. The arbitrary file delete primitive exists within the Synapse software.
*   **Windows Installer Service:** The attacker leverages the Windows Installer service to perform malicious actions during install/uninstall and rollback procedures by using specially crafted `.msi` files.

**Required Attacker Capabilities/Position:**

*   **Ability to Trigger Arbitrary File/Folder Deletion:** The attacker must be able to trigger an arbitrary file or folder delete through the vulnerable Razer Synapse 3 software.
*   **Ability to Run MSI installers:** The attacker must have the ability to execute MSI installers, which will be used to manipulate the Windows Installer Service.
*   **Control over the filesystem**: The attacker needs to have the ability to recreate files and folders on the filesystem, or use weaker primitives to achieve the same effect using techniques such as symlinks and junctions.
*   **Standard User Privileges (Initially):** The attacker does not need to be an admin initially, as the vulnerability allows a standard user to escalate to SYSTEM via a crafted MSI installer. The attacker must be able to write to specific folders to create the necessary file system objects.

**Additional Details:**

*   The content includes a detailed explanation of the Windows Installer service's operation and how the transactionality is enforced using `.rbs` and `.rbf` files.
*   It also details a more reliable EoP method that involves preventing the deletion of `C:\Config.Msi` during uninstallation by holding a file handle open, then exploiting an arbitrary folder delete after the installer completes, allowing for an attacker to manipulate the system state on rollback.
*   The content further describes a method for turning an arbitrary file delete primitive into a folder delete primitive using NTFS alternate data streams. It shows how the delete operation for `C:\Config.Msi::$INDEX_ALLOCATION` can achieve the same result as a folder delete operation on `C:\Config.Msi`.
*   The blog also details additional techniques using oplocks and symlinks/junctions for exploiting a "folder contents delete" primitive.

The github content is related because it is a proof of concept exploit repository for this CVE, containing a video of an exploit being performed.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.069 |
| 2 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.067 |
| 3 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.065 |
| 4 | 130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | sparse | 0.063 |
| 5 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.063 |
| 6 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.062 |
| 7 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.062 |
| 8 | 939 | Improper Authorization in Handler for Custom URL Scheme | Base | Allowed | sparse | 0.062 |
| 9 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | dense | 0.512 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-427: Uncontrolled Search Path Element

CWE-121: Stack-based Buffer Overflow

CWE-130: Improper Handling of Length Parameter Inconsistency

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-532: Insertion of Sensitive Information into Log File

CWE-790: Improper Filtering of Special Elements

CWE-939: Improper Authorization in Handler for Custom URL Scheme

CWE-732: Incorrect Permission Assignment for Critical Resource

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')