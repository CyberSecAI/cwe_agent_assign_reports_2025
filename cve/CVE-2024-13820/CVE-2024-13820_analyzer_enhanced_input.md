## Vulnerability Description
The Melhor Envio plugin for WordPress is vulnerable to **Sensitive Information Exposure** in all versions up to, and including, 2.15.9 via the run function, which uses a **hardcoded hash**. This makes it possible for unauthenticated attackers to extract sensitive data including environment information, plugin tokens, shipping configurations, and limited vendor information.

### Vulnerability Description Key Phrases
- **rootcause:** **hardcoded hash**
- **weakness:** **Sensitive Information Exposure**
- **impact:** extract sensitive data
- **attacker:** unauthenticated attackers
- **product:** Melhor Envio plugin for WordPress
- **version:** up to and including 2.15.9
- **component:** run function

## CVE Reference Links Content Summary
The provided content relates to a PHP file `TestService.php` within the `wp-melhorenvio-v2` repository. It appears to be a testing or debugging service for a WooCommerce plugin called "Melhor Envio". Here's a breakdown of the relevant information:

**Root cause of vulnerability:**

The code contains a hardcoded SHA512 hash used for authorization:

```php
if (hash('sha512', SanitizeHelper::apply($_GET['hash'])) != 'd4ccf2fcc3a14764698d9b2fea940c9d42c5dfe6002f20df995b09590b39f83f1ec1712d506d51ca47648f77d0ae1caf25c85c042275422582fe067622e6d208') {
    return wp_send_json(
        array(
            'message' => 'Acesso n√£o autorizado',
        ),
        ResponseStatus::HTTP_UNAUTHORIZED
    );
}
```

**Weaknesses/vulnerabilities present:**

*   **Hardcoded Credentials:** The use of a hardcoded SHA512 hash as a form of authentication is a significant security vulnerability. If this hash is discovered, anyone can bypass the access control by providing the correct hash value in the `hash` GET parameter.
*   **Lack of Proper Authentication:** The code checks for the presence of a `hash` parameter and verifies it against a hardcoded value, but it doesn't implement any robust authentication mechanism (e.g., user login, API keys, or secure tokens).
*   **Insufficient Authorization:** Even with the `current_user_can('melhor_envio_debug')` check, the hardcoded hash bypasses any meaningful authorization.

**Impact of exploitation:**

*   **Unauthorized Access:** An attacker can gain unauthorized access to the debugging functionality of the plugin, potentially exposing sensitive information or allowing them to manipulate data.
*   **Information Disclosure:** The `run()` function retrieves and returns various information, including PHP version, environment details, user data (potentially including email), plugin paths, and options. An attacker could exploit this to gather information about the server and the plugin's configuration.

**Attack vectors:**

*   **Direct Hash Submission:** An attacker can simply submit a GET request to the `TestService.php` script with the correct hash value in the `hash` parameter.
*   **Man-in-the-Middle (MitM) Attack:** If the communication between the client and the server is not encrypted (e.g., using HTTPS), an attacker could intercept the request and steal the hash value.

**Required attacker capabilities/position:**

*   **Knowledge of the Hash:** The attacker needs to know the hardcoded SHA512 hash value.
*   **Network Access:** The attacker needs network access to the server hosting the WordPress site with the plugin installed.

**Mitigation or fix:**

*   **Remove Hardcoded Hash:** The hardcoded hash should be removed immediately.
*   **Implement Secure Authentication:** Implement a proper authentication mechanism, such as user login with strong passwords, API keys, or secure tokens (e.g., JWT).
*   **Role-Based Access Control:** Implement role-based access control to restrict access to sensitive functionality based on user roles and permissions.
*   **HTTPS:** Ensure that all communication between the client and the server is encrypted using HTTPS.
*   **Input Validation:** Properly validate and sanitize all user inputs to prevent injection attacks.

This content provides significantly more detail than the official CVE description would likely contain, as it shows the actual vulnerable code.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 259 | Use of Hard-coded Password | Variant | Allowed | sparse | 0.316 |
| 2 | 798 | Use of Hard-coded Credentials | Base | Allowed | sparse | 0.306 |
| 3 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.300 |
| 4 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.293 |
| 5 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.290 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.289 |
| 7 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.287 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.285 |
| 9 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | dense | 0.551 |
| 10 | 321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-259: Use of Hard-coded Password

CWE-798: Use of Hard-coded Credentials

CWE-522: Insufficiently Protected Credentials

CWE-863: Incorrect Authorization

CWE-532: Insertion of Sensitive Information into Log File

CWE-306: Missing Authentication for Critical Function

CWE-862: Missing Authorization

CWE-502: Deserialization of Untrusted Data

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-321: Use of Hard-coded Cryptographic Key