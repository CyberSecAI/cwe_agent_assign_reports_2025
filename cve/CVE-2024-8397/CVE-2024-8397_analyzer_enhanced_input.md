## Vulnerability Description
The webtoffee-gdpr-cookie-consent WordPress plugin before 2.6.1 **does not properly sanitize and escape the IP headers** when logging them, allowing visitors to conduct Stored **Cross-Site Scripting** attacks. The payload gets triggered when an admin visits the Consent report page and the malicious script is executed in the admin context.

### Vulnerability Description Key Phrases
- **rootcause:** **does not properly sanitize and escape the IP headers**
- **weakness:** **Cross-Site Scripting**
- **impact:** Stored Cross-Site Scripting attacks
- **product:** webtoffee-gdpr-cookie-consent WordPress plugin
- **version:** before 2.6.1

## CVE Reference Links Content Summary
## CVE-2024-8397 Analysis

The provided content is **RELATED** to CVE-2024-8397 and provides more detail than the official CVE description. Here's an extraction of the relevant information:

**Root cause of vulnerability:**

The plugin does not properly sanitize and escape the IP headers when logging them.

**Weaknesses/vulnerabilities present:**

*   Stored Cross-Site Scripting (XSS)
*   Improper input sanitization/escaping

**Impact of exploitation:**

Allows visitors to conduct Stored Cross-Site Scripting attacks. The payload is triggered when an admin visits the 'Consent report' page, and the malicious script is executed in the admin context.

**Attack vectors:**

*   Sending a POST request to `/wp-admin/admin-ajax.php` with a malicious payload in the `Client-Ip` header.
    *   Example curl command:
        ```
        curl -X POST -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -H "Client-Ip: <script>alert(1)</script>." --data "action=wt_log_visitor_action" "https://example.com/wp-admin/admin-ajax.php"
        ```

**Required attacker capabilities/position:**

*   Unauthenticated - No authentication is required to inject the payload.

**Mitigation or fix:**

*   Fixed in version 2.6.1

**Additional Details:**

*   **CVE ID:** CVE-2024-8397
*   **CVSS:** 8.8 (High)
*   **Researcher:** Zitec/Teodora Jilaveanu
*   **Affected Plugin:** Webtoffee GDPR Cookie Consent <= 2.6.0
*   **OWASP Top 10:** A7: Cross-Site Scripting (XSS)
*   **CWE:** CWE-79

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.428 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.380 |
| 3 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.371 |
| 4 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.360 |
| 5 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.342 |
| 6 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.320 |
| 7 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.308 |
| 8 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | sparse | 0.304 |
| 9 | 784 | Reliance on Cookies without Validation and Integrity Checking in a Security Decision | Variant | Allowed | dense | 0.540 |
| 10 | 471 | Modification of Assumed-Immutable Data (MAID) | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-116: Improper Encoding or Escaping of Output

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-138: Improper Neutralization of Special Elements

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-862: Missing Authorization

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-90: Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')

CWE-784: Reliance on Cookies without Validation and Integrity Checking in a Security Decision

CWE-471: Modification of Assumed-Immutable Data (MAID)