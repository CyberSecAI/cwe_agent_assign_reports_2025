## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved net_sched hfsc Fix a UAF vulnerability in class with netem as child qdisc As described in Gerrards report [1], we have a UAF case when an hfsc class has a netem child qdisc. The crux of the issue is that hfsc is assuming that checking for cl->qdisc->q.qlen == 0 guarantees that it hasnt inserted the class in the vttree or eltree (which is not true for the netem duplicate case). This patch checks the n_active class variable to make sure that the code wont insert the class in the vttree or eltree twice, catering for the reentrant case. [1] https//lore.kernel.org/netdev/CAHcdcOm+03OD2j6R0=YHKqmy=VgJ8xEOKuP6c7mSgnp-TEJJbw@mail.gmail.com/

### Vulnerability Description Key Phrases
- **component:** net_sched hfsc class
- **weakness:** **UAF vulnerability, use after free**
- **product:** Linux kernel

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 416 | Use After Free | Variant | Allowed | alternate_terms | 0.800 |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.547 |
| 3 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.522 |
| 4 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.521 |
| 5 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.513 |
| 6 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.511 |
| 7 | 415 | Double Free | Variant | Allowed | sparse | 0.510 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.510 |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | dense | 0.523 |
| 10 | 609 | Double-Checked Locking | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-416: Use After Free

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-1333: Inefficient Regular Expression Complexity

CWE-667: Improper Locking

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-415: Double Free

CWE-863: Incorrect Authorization

CWE-401: Missing Release of Memory after Effective Lifetime

CWE-609: Double-Checked Locking