## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved ksmbd Fix **UAF** in __close_file_table_ids A **use-after-free** is possible if one thread destroys the file via __ksmbd_close_fd while another thread holds a reference to it. The existing checks on fp->refcount are not sufficient to prevent this. The fix takes ft->lock around the section which removes the file from the file table. This prevents two threads acquiring the same file pointer via __close_file_table_ids, as well as the other functions which retrieve a file from the IDR and which already use this same lock.

### Vulnerability Description Key Phrases
- **rootcause:** **UAF**
- **weakness:** **use-after-free**
- **product:** Linux kernel
- **component:** ksmbd

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 416 | Use After Free | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.533 |
| 3 | 415 | Double Free | Variant | Allowed | sparse | 0.531 |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.520 |
| 5 | 833 | Deadlock | Base | Allowed | sparse | 0.503 |
| 6 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.475 |
| 7 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.473 |
| 8 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.471 |
| 9 | 403 | Exposure of File Descriptor to Unintended Control Sphere ('File Descriptor Leak') | Base | Allowed | dense | 0.550 |
| 10 | 123 | Write-what-where Condition | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-416: Use After Free

CWE-667: Improper Locking

CWE-415: Double Free

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-833: Deadlock

CWE-1390: Weak Authentication

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-403: Exposure of File Descriptor to Unintended Control Sphere ('File Descriptor Leak')

CWE-123: Write-what-where Condition