# Vulnerability Information: CVE-2024-36761

## Vulnerability Description
naga v0.14.0 was discovered to contain a **stack overflow** via the component /wgsl/parse/mod.rs.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **product:** naga
- **version:** v0.14.0
- **component:** /wgsl/parse/mod.rs

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**Root Cause:**
The root cause of the stack overflow vulnerability lies in the `wgsl_parser` component of the `naga` library, specifically within the parsing logic for expressions. The parser recursively calls functions while processing nested parentheses in WGSL code without proper input validation and depth checks. This allows an attacker to trigger excessive recursion, which eventually leads to a stack overflow.

**Weaknesses/Vulnerabilities Present:**
- **Stack Overflow:** The primary vulnerability is a stack overflow caused by unbounded recursion in the parsing logic when processing deeply nested expressions.
- **Lack of Input Validation:** The parser doesn't adequately restrict the depth of nested parentheses, allowing for arbitrarily deep nesting and resulting in uncontrolled growth of the call stack.

**Impact of Exploitation:**
- **Denial of Service (DoS):** Exploitation of this vulnerability leads to a crash of the parsing process due to a stack overflow, resulting in a denial-of-service condition.
- **Potential for other exploits:** While not stated, stack overflows could be exploited further if not properly handled.

**Attack Vectors:**
- **Fuzzing:** The vulnerability was discovered through fuzzing, which is a method of automated testing that provides invalid, unexpected, or random data as input.
- **Malicious Input:** By crafting a WGSL input with an excessive number of nested parentheses, an attacker can cause a stack overflow, triggering a crash.

**Required Attacker Capabilities/Position:**
- **Ability to provide input:** An attacker needs to be able to provide crafted WGSL input to the vulnerable parser. This could be achieved by providing a malicious shader in a web application or by using an API that uses the vulnerable parser.

**Technical Details:**

The vulnerability is triggered by excessive nesting of parentheses, as demonstrated in the provided crash logs.  The crash occurs in the following functions:
- `naga::front::wgsl::parse::lexer::consume_token::h909dee82bc6b69d8` (lexer.rs:48)
- `naga::front::wgsl::parse::ExpressionContext::parse_binary_op` (mod.rs:68)
- The stack trace shows deeply nested calls through multiple parsing related functions, which is a result of recursive descent parsing.

The provided crash information includes detailed stack traces that highlight the recursive calls leading to the stack overflow.  A crash sample input file with nested parenthesis was also provided.

The issue is tracked in `gfx-rs/wgpu#5757` and `gfx-rs/naga#2591`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 121 | Stack-based Buffer Overflow | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.124 |
| 4 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.124 |
| 5 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.108 |
| 6 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.108 |
| 7 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.106 |
| 8 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | sparse | 0.098 |
| 9 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | dense | 0.497 |
| 10 | 787 | Out-of-bounds Write | Base | Allowed | graph | 0.002 |

