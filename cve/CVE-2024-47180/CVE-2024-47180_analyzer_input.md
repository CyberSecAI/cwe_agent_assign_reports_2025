# Vulnerability Information: CVE-2024-47180

## Vulnerability Description
Shields.io is a service for concise, consistent, and legible badges in SVG and raster format. Shields.io and users self-hosting their own instance of shields using version < `server-2024-09-25` are vulnerable to a remote execution vulnerability via the **JSONPath library** used by the Dynamic JSON/Toml/Yaml badges. This vulnerability would allow any user with access to make a request to a URL on the instance to the ability to execute code by crafting a malicious JSONPath expression. All users who self-host an instance are vulnerable. This problem was fixed in server-2024-09-25. Those who follow the tagged releases should update to `server-2024-09-25` or later. Those who follow the rolling tag on DockerHub, `docker pull shieldsio/shieldsnext` to update to the latest version. As a workaround, blocking access to the endpoints `/badge/dynamic/json`, `/badge/dynamic/toml`, and `/badge/dynamic/yaml` (e.g via a firewall or reverse proxy in front of your instance) would prevent the exploitable endpoints from being accessed.

### Vulnerability Description Key Phrases
- **rootcause:** **JSONPath library**
- **impact:** execute code
- **vector:** malicious JSONPath expression
- **attacker:** any user with access
- **product:** Shields.io
- **version:** self-hosted instance

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-47180:

**Root Cause of Vulnerability:**
- The vulnerability stems from the usage of the `jsonpath` library in the Shields.io project's dynamic badge generation feature (JSON/TOML/YAML). The `jsonpath` library had a prototype pollution vulnerability that allowed attackers to inject malicious code via crafted JSONPath expressions.

**Weaknesses/Vulnerabilities Present:**
- **Remote Code Execution (RCE):** The core vulnerability is that malicious JSONPath expressions could be crafted to execute arbitrary code on the server hosting Shields.io or a self-hosted instance.
- **Prototype Pollution:** The underlying issue in the `jsonpath` library allows an attacker to manipulate object prototypes, which could lead to code execution or other unexpected behavior.

**Impact of Exploitation:**
- **Complete Compromise:** An attacker could achieve remote code execution on the server, potentially leading to full control of the affected system.
- **Data Exfiltration:** Attackers could potentially exfiltrate sensitive data accessible to the server, although the Shields.io instance itself is designed to minimize sensitive data.
- **Disruption of Service:** Attackers could disrupt the service by causing it to crash or become unavailable.
- **Token Exfiltration (for Shields.io users):** While the attack surface is limited, if attackers compromised the main Shields.io instance, they could potentially have exfiltrated read-only GitHub API tokens that users had donated to the platform to increase rate limits.

**Attack Vectors:**
- **Malicious JSONPath Expressions:** The primary attack vector is through crafted JSONPath expressions in the URL parameters of requests to the dynamic JSON/TOML/YAML badge endpoints.

**Required Attacker Capabilities/Position:**
- **Network Access:** Attackers must be able to send HTTP requests to the vulnerable dynamic badge endpoints.
- **Understanding of JSONPath:** The attacker needs to understand how to craft malicious JSONPath expressions to exploit the vulnerability. This includes understanding how the prototype pollution vulnerability in the vulnerable library is exploitable.

**Additional Notes:**
- **Patch Information:** The vulnerability was addressed by switching to the `jsonpath-plus` library and disabling its script expression functionality (`eval: false`).
- **Backwards Compatibility:** Switching to `jsonpath-plus` with `eval: false` disabled some query syntax previously supported by the old library, requiring users to rewrite some queries.  A detailed table of query syntax differences is provided to aid in migration.
- **Self-Hosted Instances:** Self-hosted instances are particularly vulnerable and users were advised to upgrade immediately.
- **Shields.io users:** Users of the main Shields.io instance were advised to revoke their donated GitHub tokens as a precaution.
- **Endpoints:** The vulnerable endpoints are `/badge/dynamic/json`, `/badge/dynamic/toml`, and `/badge/dynamic/yaml`.

The provided content offers more context than the initial CVE description (which was a placeholder), including the details of the vulnerable library, the patch, and the impact on both self-hosted and hosted Shields.io users.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.908 |
| 2 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.858 |
| 3 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.835 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.824 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.808 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.807 |
| 7 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.798 |
| 8 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.796 |
| 9 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | dense | 0.557 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.002 |

