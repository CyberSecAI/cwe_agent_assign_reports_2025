# Vulnerability Information: CVE-2024-10389

## Vulnerability Description
There exists a **Path Traversal vulnerability** in Safearchive on Platforms with Case-Insensitive Filesystems (e.g., NTFS). This allows Attackers to Write Arbitrary Files via Archive Extraction containing symbolic links. We recommend upgrading past commitf7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc

### Vulnerability Description Key Phrases
- **weakness:** **Path Traversal vulnerability**
- **impact:** Write Arbitrary Files
- **vector:** Archive Extraction containing symbolic links
- **attacker:** Attackers
- **product:** Safearchive

## CVE Reference Links Content Summary
The provided content is related to the fix for CVE-2024-10389.

**Root cause of vulnerability:**
The vulnerability stems from the lack of proper handling of Windows short filenames within archive paths, specifically in tar and zip archive processing. These short filenames, which can be in the format `NAME~1.EXT`, can be manipulated to bypass path traversal protections. This is because these short filenames can be used to represent the same file or directory as their longer counterparts, while not being matched by naive path sanitization rules. This could lead to path traversal if a malicious archive contains such filenames.

**Weaknesses/vulnerabilities present:**
- The primary vulnerability is the possibility of path traversal. When archive paths are not properly sanitized, especially in the context of Windows short filenames, attackers can bypass security measures and overwrite or create files outside the intended target directory.
- The code was not accounting for Windows short file names which are of the form `NAME~1.EXT` when sanitizing paths.

**Impact of exploitation:**
Successful exploitation of this vulnerability could allow an attacker to overwrite files in arbitrary locations on the filesystem, potentially leading to:
    - Arbitrary code execution
    - Data corruption or loss
    - Privilege escalation

**Attack vectors:**
- The attack vector involves crafting malicious archives (tar or zip) that contain specially crafted short filenames.
- When an application unpacks such an archive and doesn't properly sanitize the filenames before creating files on disk, an attacker could overwrite files outside of the intended extraction directory.

**Required attacker capabilities/position:**
- The attacker needs the ability to create a malicious archive with specific filenames that contain Windows short filenames.
- The attacker also needs a vector to deliver this archive to a vulnerable system where the archive is processed without sanitization.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.224 |
| 3 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.187 |
| 4 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.176 |
| 5 | 73 | External Control of File Name or Path | Base | Allowed | sparse | 0.151 |
| 6 | 41 | Improper Resolution of Path Equivalence | Base | Allowed | sparse | 0.144 |
| 7 | 178 | Improper Handling of Case Sensitivity | Base | Allowed | sparse | 0.141 |
| 8 | 36 | Absolute Path Traversal | Base | Allowed | sparse | 0.139 |
| 9 | 24 | Path Traversal: '../filedir' | Variant | Allowed | dense | 0.631 |
| 10 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | graph | 0.002 |

