## Vulnerability Description
WordPress Core is vulnerable to Stored Cross-Site Scripting via the HTML API in various versions prior to 6.5.5 due to **insufficient input sanitization and output escaping** on URLs. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient input sanitization and output escaping**
- **weakness:** **cross-site scripting**
- **impact:** inject arbitrary web scripts
- **attacker:** authenticated attackers
- **product:** WordPress Core
- **version:** prior to 6.5.5
- **component:** HTML API

## CVE Reference Links Content Summary
Based on the provided content, here's the breakdown of the vulnerability:

**CVE ID:** CVE-2024-6307

**Root Cause:** Insufficient input sanitization and output escaping of URLs within the WordPress HTML API.

**Weaknesses/Vulnerabilities Present:** Stored Cross-Site Scripting (XSS).

**Impact of Exploitation:** An attacker can inject arbitrary web scripts into pages. These scripts will execute whenever a user accesses the affected page, potentially leading to:
    *  Malicious actions performed on behalf of the victim user.
    *  Data theft or manipulation.
    *  Website defacement.
    *  Redirection to malicious sites.

**Attack Vectors:**
    *  The vulnerability is present in the WordPress HTML API.
    *  An attacker would need to inject malicious code into a URL that is processed by the vulnerable HTML API.
    *  The injected code gets stored in the database, leading to the stored XSS.

**Required Attacker Capabilities/Position:**
    *  The attacker needs to be authenticated with at least contributor-level access to the WordPress site.
    *  This level of access allows the attacker to create or modify content where they can insert malicious URLs via the HTML API.

**Additional Details:**

*   The vulnerability affects WordPress versions prior to 6.5.5, including versions 5.9 to 5.9.9, 6.0 to 6.0.8, 6.1 to 6.1.6, 6.2 to 6.2.5, 6.3 to 6.3.4, 6.4 to 6.4.4, and 6.5 to 6.5.4.
*   The fix involves running URL attributes through the `esc_url()` function during the HTML processing to ensure proper sanitization and output escaping, as shown in the provided code diffs.
*   The vulnerability was reported by Dennis Snell, Alex Concha, and Grzegorz (Greg) Ziółkowski of the WordPress security team.
*   Patched versions are 5.9.10, 6.0.9, 6.1.7, 6.2.6, 6.3.5, 6.4.5 and 6.5.5

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.478 |
| 2 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.459 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.450 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.430 |
| 5 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.357 |
| 6 | 80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | sparse | 0.356 |
| 7 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.356 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.355 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.632 |
| 10 | 494 | Download of Code Without Integrity Check | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-116: Improper Encoding or Escaping of Output

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-138: Improper Neutralization of Special Elements

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-862: Missing Authorization

CWE-80: Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS)

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-96: Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection')

CWE-494: Download of Code Without Integrity Check