# Vulnerability Information: CVE-2025-5148

## Vulnerability Description
A vulnerability was found in FunAudioLLM InspireMusic up to bf32364bcb0d136497ca69f9db622e9216b029dd. It has been classified as critical. Affected is the function load_state_dict of the file inspiremusic/cli/model.py of the component Pickle Data Handler. The manipulation leads to **deserialization**. An attack has to be approached locally. This product is using a rolling release to provide continious delivery. Therefore, no version details for affected nor updated releases are available. The name of the patch is 784cbf8dde2cf1456ff808aeba23177e1810e7a9. It is recommended to apply a patch to fix this issue.

### Vulnerability Description Key Phrases
- **weakness:** **deserialization**
- **product:** FunAudioLLM InspireMusic
- **version:** up to bf32364bcb0d136497ca69f9db622e9216b029dd
- **component:** Pickle Data Handler

## CVE Reference Links Content Summary
## CVE-2025-5148 Analysis

The provided content details a vulnerability (CVE-502 - Untrusted Data Deserialization) in the InspireMusic project on GitHub. This vulnerability is directly related to the use of `torch.load` without the `weights_only=True` parameter when loading potentially untrusted data.

**Root cause of vulnerability:**

The `torch.load` function, when used to deserialize data without specifying `weights_only=True`, can execute arbitrary code embedded within the pickled data. This occurs because the deserialization process is not restricted to loading only the model weights, allowing for the execution of potentially malicious code.

**Weaknesses/vulnerabilities present:**

*   **CWE-502: Untrusted Data Deserialization:** The core vulnerability lies in the unsafe deserialization of data using `torch.load`.
*   **Lack of Input Validation:** The code does not verify the source or integrity of the data being loaded by `torch.load`.

**Impact of exploitation:**

Successful exploitation could lead to:

*   Unauthorized access to the system.
*   Data leakage.
*   Modification of system settings.
*   Arbitrary code execution.

**Attack vectors:**

*   An attacker can craft a malicious file containing crafted pickle data.
*   The attacker provides this malicious file as input to the `llm_model` or `flow_model` parameters of the `load` function in `inspiremusic/cli/model.py`.

**Required attacker capabilities/position:**

*   The attacker needs to be able to provide a malicious file to the application that will be loaded by `torch.load`. This could involve controlling the file system or network access where the model files are stored or downloaded from.

**Mitigation or fix:**

*   Always specify `weights_only=True` when using `torch.load` to load untrusted data. This restricts the deserialization process to only loading the model weights, preventing the execution of arbitrary code.

**Relevant Code Snippets:**

The following lines in `inspiremusic/cli/model.py` are vulnerable:

```python
self.llm.load_state_dict(torch.load(llm_model, map_location=self.device))
self.flow.load_state_dict(torch.load(flow_model, map_location=self.device))
```

The suggested fix, as demonstrated in the commit history, is to modify these lines to:

```python
self.llm.load_state_dict(torch.load(llm_model, map_location=self.device, weights_only=True))
self.flow.load_state_dict(torch.load(flow_model, map_location=self.device, weights_only=True))
```

**Note:** This content provides more detail than a typical CVE description, specifically detailing the vulnerable code location and the suggested mitigation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.491 |
| 2 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.481 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.448 |
| 4 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.447 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.446 |
| 6 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.444 |
| 7 | 1241 | Use of Predictable Algorithm in Random Number Generator | Base | Allowed | sparse | 0.436 |
| 8 | 208 | Observable Timing Discrepancy | Base | Allowed | sparse | 0.428 |
| 9 | 294 | Authentication Bypass by Capture-replay | Base | Allowed | dense | 0.540 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.003 |

