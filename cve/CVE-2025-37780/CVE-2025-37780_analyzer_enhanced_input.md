# Vulnerability Description

    In the Linux kernel, the following vulnerability has been resolved isofs Prevent the use of too small fid syzbot reported a **slab-out-of-bounds Read** in isofs_fh_to_parent. [1] The handle_bytes value passed in by the reproducing program is equal to 12. In handle_to_path(), only 12 bytes of memory are allocated for the structure file_handle->f_handle member, which causes an **out-of-bounds access** when accessing the member parent_block of the structure isofs_fid in isofs, because accessing parent_block requires at least 16 bytes of f_handle. Here, fh_len is used to indirectly confirm that the value of handle_bytes is greater than 3 before accessing parent_block. [1] BUG KASAN slab-out-of-bounds in isofs_fh_to_parent+0x1b8/0x210 fs/isofs/export.c183 Read of size 4 at addr ffff0000cc030d94 by task syz-executor215/6466 CPU 1 UID 0 PID 6466 Comm syz-executor215 Not tainted 6.14.0-rc7-syzkaller-ga2392f333575 #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 02/12/2025 Call trace show_stack+0x2c/0x3c arch/arm64/kernel/stacktrace.c466 (C) __dump_stack lib/dump_stack.c94 [inline] dump_stack_lvl+0xe4/0x150 lib/dump_stack.c120 print_address_description mm/kasan/report.c408 [inline] print_report+0x198/0x550 mm/kasan/report.c521 kasan_report+0xd8/0x138 mm/kasan/report.c634 __asan_report_load4_noabort+0x20/0x2c mm/kasan/report_generic.c380 isofs_fh_to_parent+0x1b8/0x210 fs/isofs/export.c183 exportfs_decode_fh_raw+0x2dc/0x608 fs/exportfs/expfs.c523 do_handle_to_path+0xa0/0x198 fs/fhandle.c257 handle_to_path fs/fhandle.c385 [inline] do_handle_open+0x8cc/0xb8c fs/fhandle.c403 __do_sys_open_by_handle_at fs/fhandle.c443 [inline] __se_sys_open_by_handle_at fs/fhandle.c434 [inline] __arm64_sys_open_by_handle_at+0x80/0x94 fs/fhandle.c434 __invoke_syscall arch/arm64/kernel/syscall.c35 [inline] invoke_syscall+0x98/0x2b8 arch/arm64/kernel/syscall.c49 el0_svc_common+0x130/0x23c arch/arm64/kernel/syscall.c132 do_el0_svc+0x48/0x58 arch/arm64/kernel/syscall.c151 el0_svc+0x54/0x168 arch/arm64/kernel/entry-common.c744 el0t_64_sync_handler+0x84/0x108 arch/arm64/kernel/entry-common.c762 el0t_64_sync+0x198/0x19c arch/arm64/kernel/entry.S600 Allocated by task 6466 kasan_save_stack mm/kasan/common.c47 [inline] kasan_save_track+0x40/0x78 mm/kasan/common.c68 kasan_save_alloc_info+0x40/0x50 mm/kasan/generic.c562 poison_kmalloc_redzone mm/kasan/common.c377 [inline] __kasan_kmalloc+0xac/0xc4 mm/kasan/common.c394 kasan_kmalloc include/linux/kasan.h260 [inline] __do_kmalloc_node mm/slub.c4294 [inline] __kmalloc_noprof+0x32c/0x54c mm/slub.c4306 kmalloc_noprof include/linux/slab.h905 [inline] handle_to_path fs/fhandle.c357 [inline] do_handle_open+0x5a4/0xb8c fs/fhandle.c403 __do_sys_open_by_handle_at fs/fhandle.c443 [inline] __se_sys_open_by_handle_at fs/fhandle.c434 [inline] __arm64_sys_open_by_handle_at+0x80/0x94 fs/fhandle.c434 __invoke_syscall arch/arm64/kernel/syscall.c35 [inline] invoke_syscall+0x98/0x2b8 arch/arm64/kernel/syscall.c49 el0_svc_common+0x130/0x23c arch/arm64/kernel/syscall.c132 do_el0_svc+0x48/0x58 arch/arm64/kernel/syscall.c151 el0_svc+0x54/0x168 arch/arm64/kernel/entry-common.c744 el0t_64_sync_handler+0x84/0x108 arch/arm64/kernel/entry-common.c762 el0t_64_sync+0x198/0x19c arch/arm64/kernel/entry.S600

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## WEAKNESS: 'slab-out-of-bounds Read'

Relevant CWEs for this WEAKNESS:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-125: Out-of-bounds Read (Score: 992.45)

The product reads data past the end, or before the beginning, of the intended buffer....

### 4. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 5. CWE-787: Out-of-bounds Write (Score: 969.44)

The product writes data past the end, or before the beginning, of the intended buffer....

## WEAKNESS: 'out-of-bounds access'

Relevant CWEs for this WEAKNESS:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-125: Out-of-bounds Read (Score: 992.45)

The product reads data past the end, or before the beginning, of the intended buffer....

### 4. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 5. CWE-787: Out-of-bounds Write (Score: 969.44)

The product writes data past the end, or before the beginning, of the intended buffer....

## ATTACKER: 'syzbot'

Relevant CWEs for this ATTACKER:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-125: Out-of-bounds Read (Score: 992.45)

The product reads data past the end, or before the beginning, of the intended buffer....

### 4. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 5. CWE-393: Return of Wrong Status Code (Score: 332.38)

A function or operation returns an incorrect return value or status code that does not indicate an error, but causes the product to modify its behavior based on the incorrect result....

## PRODUCT: 'Linux kernel'

Relevant CWEs for this PRODUCT:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 4. CWE-392: Missing Report of Error Condition (Score: 335.51)

The product encounters an error but does not provide a status code or return value to indicate that an error has occurred....

### 5. CWE-393: Return of Wrong Status Code (Score: 332.38)

A function or operation returns an incorrect return value or status code that does not indicate an error, but causes the product to modify its behavior based on the incorrect result....

## VERSION: '6.14.0-rc7-syzkaller-ga2392f333575'

Relevant CWEs for this VERSION:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 4. CWE-787: Out-of-bounds Write (Score: 969.44)

The product writes data past the end, or before the beginning, of the intended buffer....

### 5. CWE-393: Return of Wrong Status Code (Score: 332.38)

A function or operation returns an incorrect return value or status code that does not indicate an error, but causes the product to modify its behavior based on the incorrect result....

## COMPONENT: 'isofs'

Relevant CWEs for this COMPONENT:

### 1. CWE-667: Improper Locking (Score: 1028.05)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 2. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 1019.92)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 3. CWE-125: Out-of-bounds Read (Score: 992.45)

The product reads data past the end, or before the beginning, of the intended buffer....

### 4. CWE-733: Compiler Optimization Removal or Modification of Security-critical Code (Score: 983.92)

The developer builds a security-critical protection mechanism into the software, but the compiler optimizes the program such that the mechanism is removed or modified....

### 5. CWE-393: Return of Wrong Status Code (Score: 332.38)

A function or operation returns an incorrect return value or status code that does not indicate an error, but causes the product to modify its behavior based on the incorrect result....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    

# Complete CWE Specifications

CWE-667: Improper Locking

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-125: Out-of-bounds Read

CWE-733: Compiler Optimization Removal or Modification of Security-critical Code

CWE-787: Out-of-bounds Write

CWE-392: Missing Report of Error Condition

CWE-393: Return of Wrong Status Code