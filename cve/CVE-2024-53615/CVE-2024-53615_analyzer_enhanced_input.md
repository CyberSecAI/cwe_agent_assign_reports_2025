## Vulnerability Description
A **command injection** vulnerability in the video thumbnail rendering component of Karl Wards files.gallery v0.3.0 through 0.11.0 allows remote attackers to execute arbitrary code via a crafted video file.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **impact:** execute arbitrary code
- **vector:** crafted video file
- **attacker:** remote attackers
- **product:** Karl Wards files.gallery
- **version:** v0.3.0 through 0.11.0
- **component:** video thumbnail rendering component

## CVE Reference Links Content Summary
```text
*   **Vulnerability:** Command injection vulnerability.
*   **Affected Component:** Video thumbnail rendering component in Karl Ward's `files.gallery` (versions `v0.3.0` through `0.11.0`).
*   **Root Cause:** The vulnerability lies in the way the application generates video previews, specifically in the construction of the command used to execute `ffmpeg`. The code uses the user-provided path (`$this->path`) without proper sanitization.
*   **Attack Vector:** Crafting a malicious video file with a filename containing a bash command substitution. This allows attackers to inject and execute arbitrary commands on the server.
*   **Required Attacker Capabilities/Position:**
    *   Ability to upload files to a web server running `files.gallery`.
    *   The `ffmpeg` tool must be installed in the PATH of the server.
    *   The `config.php` file must have `'allow_upload' => true`.
    *   `exec` must be enabled in the PHP configuration.
*   **Impact of Exploitation:** Allows remote attackers to execute arbitrary code via the server.
*   **Mitigation or Fix:** Not mentioned in the provided content, however, the injection occurs because of the way the file path is used within a command. To fix this, the `$this->path` variable needs to be properly sanitized, or the use of shell execution needs to be avoided.
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.168 |
| 4 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.168 |
| 5 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.167 |
| 6 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.165 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.164 |
| 8 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.162 |
| 9 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | dense | 0.553 |
| 10 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-138: Improper Neutralization of Special Elements

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-190: Integer Overflow or Wraparound

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-434: Unrestricted Upload of File with Dangerous Type