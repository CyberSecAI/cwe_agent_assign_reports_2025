# Vulnerability Information: CVE-2024-6198

## Vulnerability Description
The device exposes a web interface on ports TCP/3030 and TCP/9882. This web service runs lighttpd, which implements the SNORE interface. This interface is affected by a stack buffer overflow vulnerability due to **insecure path parsing**. An attacker with access to the LAN network interface could use a specially crafted HTTP request to exploit a buffer overflow on the modem.

### Vulnerability Description Key Phrases
- **rootcause:** **insecure path parsing**
- **vector:** specially crafted HTTP request
- **weakness:** **buffer overflow, stack buffer overflow**
- **attacker:** attacker with access to the LAN network interface

## CVE Reference Links Content Summary
## Security Advisory: Remote Code Execution on Viasat Modems (CVE-2024-6198)

**Root cause of vulnerability:**

The vulnerability is a stack buffer overflow in the `index.cgi` CGI binary located under `/usr/local/SNORE`. It's caused by an unsafe call to `sscanf` when parsing the request URI, specifically when extracting variables from the URI.

**Weaknesses/vulnerabilities present:**

*   Stack buffer overflow
*   Insecure path parsing
*   Use of unsafe function `sscanf`

**Impact of exploitation:**

An attacker with access to the LAN network interface could exploit the buffer overflow to gain control of the program registers and potentially execute arbitrary code on the system.

**Attack vectors:**

*   Crafted HTTP request to the web interface (ports TCP/3030 and TCP/9882) with a malicious URI, such as `http://192.168.100.1:9882/snore/blackboxes/AAAAAAAA[512 times]AAAAAA`.

**Required attacker capabilities/position:**

*   Access to the LAN network interface.
*   Ability to send HTTP requests.
*   Understanding of buffer overflow exploitation techniques (ROP chaining).

**Mitigation or fix:**

*   Upgrade firmware to version 3.8.0.4+ for RM4100, RM4200, EM4100 or 4.3.0.2+ for RM5110, RM5111, RG1000, RG1100, EG1000, and EG1020.
*   Ensure devices are online to receive automated updates from Viasat.

**Additional details (more than official CVE description):**

*   The vulnerable interface is called "SNORE".
*   The only binary hardening in place is the non-executable stack, which is insufficient to prevent exploitation using return-oriented programming (ROP) chaining.
*   The vulnerability was discovered through automated binary static analysis performed by ONEKEY.
*   The coordinated vulnerability disclosure process with Viasat was described, including a timeline of communication and patch deployment.
*   CVSS score: 7.7 (High) - CVSS:4.0/AV:A/AC:H/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N/RE:M/U:Red.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | alternate_terms | 1.000 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | alternate_terms | 0.700 |
| 4 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.413 |
| 5 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.401 |
| 6 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.375 |
| 7 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.375 |
| 8 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.374 |
| 9 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | dense | 0.542 |
| 10 | 128 | Wrap-around Error | Base | Allowed | graph | 0.003 |

