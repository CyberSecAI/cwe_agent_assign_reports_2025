# Vulnerability Information: CVE-2024-5931

## Vulnerability Description
BT Unchecked user input in bap_broadcast_assistant

### Vulnerability Description Key Phrases
- **rootcause:** **unchecked user input**
- **product:** BT
- **component:** bap_broadcast_assistant

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The vulnerability lies in the `parse_recv_state` function within `subsys/bluetooth/audio/bap_broadcast_assistant.c`. The function takes user-controlled input via `net_buf_simple_pull_u8()` to determine `recv_state->num_subgroups`. This value is not validated against `CONFIG_BT_BAP_BASS_MAX_SUBGROUPS` and is directly used as the loop bound in the following code:
  ```c
  for (int i = 0; i < recv_state->num_subgroups; i++) {
  	struct bt_bap_bass_subgroup *subgroup = &recv_state->subgroups[i];
  ```
  If `recv_state->num_subgroups` exceeds the size of `recv_state->subgroups`, a stack buffer overflow occurs.
- **Weaknesses/vulnerabilities present:**
    - Unchecked user input leading to a stack buffer overflow.
    - Improper bounds checking on the `num_subgroups` value read from the input buffer.
    - The `subgroups` variable is a local stack variable of limited size.
- **Impact of exploitation:** Exploitation can lead to:
    - Instability (crashes).
    - Denial-of-service (DoS).
- **Attack vectors:** The attack vector is adjacent. An attacker within the Bluetooth range can send malicious data containing an oversized `num_subgroups` value.
- **Required attacker capabilities/position:** An attacker needs to be within the Bluetooth range of the vulnerable device to send a malicious Bluetooth packet triggering the vulnerability. No user interaction or special privileges are required.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 106 | Struts: Plug-in Framework not in Use | Variant | Allowed | sparse | 0.065 |
| 2 | 252 | Unchecked Return Value | Base | Allowed | sparse | 0.062 |
| 3 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.061 |
| 4 | 690 | Unchecked Return Value to NULL Pointer Dereference | Compound | Discouraged | sparse | 0.061 |
| 5 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | sparse | 0.051 |
| 6 | 680 | Integer Overflow to Buffer Overflow | Compound | Discouraged | sparse | 0.045 |
| 7 | 606 | Unchecked Input for Loop Condition | Base | Allowed | sparse | 0.045 |
| 8 | 124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | sparse | 0.044 |
| 9 | 925 | Improper Verification of Intent by Broadcast Receiver | Variant | Allowed | dense | 0.471 |
| 10 | 1339 | Insufficient Precision or Accuracy of a Real Number | Base | Allowed | graph | 0.002 |

