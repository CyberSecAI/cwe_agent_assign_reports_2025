# Vulnerability Information: CVE-2024-45302

## Vulnerability Description
RestSharp is a Simple REST and HTTP API Client for .NET. The second argument to `RestRequest.AddHeader` (the header value) is vulnerable to **CRLF injection**. The same applies to `RestRequest.AddOrUpdateHeader` and `RestClient.AddDefaultHeader`. The way HTTP headers are added to a request is via the `HttpHeaders.TryAddWithoutValidation` method which does not check for CRLF characters in the header value. This means that any headers from a `RestSharp.RequestHeaders` object are added to the request in such a way that they are vulnerable to CRLF-injection. In general, CRLF-injection into a HTTP header (when using HTTP/1.1) means that one can inject additional HTTP headers or smuggle whole HTTP requests. If an application using the RestSharp library passes a user-controllable value through to a header, then that application becomes vulnerable to CRLF-injection. This is not necessarily a security issue for a command line application like the one above, but if such code were present in a web application then it becomes vulnerable to request splitting (as shown in the PoC) and thus Server Side Request Forgery. Strictly speaking this is a potential vulnerability in applications using RestSharp, not in RestSharp itself, but I would argue that at the very least there needs to be a warning about this behaviour in the RestSharp documentation. RestSharp has addressed this issue in version 112.0.0. All users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **RestSharp's handling of header values**
- **weakness:** **CRLF injection**
- **impact:** inject additional HTTP headers and smuggle whole HTTP requests and server-side request forgery
- **product:** RestSharp
- **version:** prior to 112.0.0
- **component:** RestRequest.AddHeader and RestRequest.AddOrUpdateHeader and RestClient.AddDefaultHeader

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-45302:

**Root Cause of Vulnerability:**
The vulnerability stems from the `HttpHeaders.TryAddWithoutValidation` method not sanitizing header values for Carriage Return (CR) and Line Feed (LF) characters. This allows an attacker to inject CRLF sequences into HTTP headers.

**Weaknesses/Vulnerabilities Present:**
- **CRLF Injection:** The primary vulnerability is the lack of CRLF character validation in header values. This enables an attacker to inject arbitrary headers or even complete HTTP requests.
- **`RestRequest.AddHeader`, `RestRequest.AddOrUpdateHeader` & `RestClient.AddDefaultHeader`:** These methods are vulnerable, as they pass unsanitized user input to the underlying `TryAddWithoutValidation` method.

**Impact of Exploitation:**
- **HTTP Request Smuggling/Splitting:** By injecting CRLF sequences, an attacker can split a single HTTP request into multiple requests, potentially leading to:
  - **Server-Side Request Forgery (SSRF):** An attacker could force the server to make requests to internal or external resources, bypassing security measures.
  - **Header Injection:** An attacker can inject arbitrary headers, potentially altering the behavior of the application.
  - **Cache Poisoning:** Manipulating responses that are cached can lead to further security issues.
- **Information Disclosure:** Depending on the injected headers and requests, an attacker could gain access to sensitive information.

**Attack Vectors:**
- **User-Controlled Input:** The vulnerability is triggered when an application uses a user-controllable value to populate a header through `RestRequest.AddHeader`, `RestRequest.AddOrUpdateHeader`, or `RestClient.AddDefaultHeader`.
- **HTTP Request:** The attack vector involves crafting a malicious header value containing CRLF characters within an HTTP request.

**Required Attacker Capabilities/Position:**
- **Ability to control header values:** An attacker must be able to control the input that goes into header values when using `RestSharp` methods. This often involves exploiting input parameters in an API or form field.
- **Network Access:**  The attacker needs to be able to send an HTTP request to the vulnerable application.

**Additional Details from the provided content:**
- The vulnerability was fixed in version 112.0.0 of RestSharp.
- The provided PoC code demonstrates how to inject CRLF characters, resulting in an HTTP request split and the server receiving and processing two separate requests.
- CVSS score for this vulnerability is 6.1 which is Moderate.

In summary, CVE-2024-45302 highlights a classic CRLF injection vulnerability in RestSharp due to insufficient header value sanitization. This can lead to severe security issues such as request smuggling, SSRF, and data breaches. Applications using RestSharp and allowing user input in headers need to update to the patched version and implement appropriate input validation to mitigate this risk.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | sparse | 1.550 |
| 2 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 1.529 |
| 3 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 1.342 |
| 4 | 444 | Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling') | Base | Allowed | sparse | 1.335 |
| 5 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 1.314 |
| 6 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 1.308 |
| 7 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 1.299 |
| 8 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 1.294 |
| 9 | 644 | Improper Neutralization of HTTP Headers for Scripting Syntax | Variant | Allowed | dense | 0.522 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.002 |

