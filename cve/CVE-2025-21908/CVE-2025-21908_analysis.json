{
  "cve_id": "CVE-2025-21908",
  "description": "In the Linux kernel, the following vulnerability has been resolved NFS fix nfs_release_folio() to not deadlock via kcompactd writeback Add PF_KCOMPACTD flag and current_is_kcompactd() helper to check for it so nfs_release_folio() can skip calling nfs_wb_folio() from kcompactd. Otherwise NFS can deadlock waiting for kcompactd enduced writeback which recurses back to NFS (which triggers writeback to NFSD via NFS loopback mount on the same host, NFSD blocks waiting for XFSs call to __filemap_get_folio) 6070.550357] INFO task kcompactd058 blocked for more than 4435 seconds. {--- [58] kcompactd0 [] folio_wait_bit+0xe8/0x200 [] folio_wait_writeback+0x2b/0x80 [] nfs_wb_folio+0x80/0x1b0 [nfs] [] nfs_release_folio+0x68/0x130 [nfs] [] split_huge_page_to_list_to_order+0x362/0x840 [] migrate_pages_batch+0x43d/0xb90 [] migrate_pages_sync+0x9a/0x240 [] migrate_pages+0x93c/0x9f0 [] compact_zone+0x8e2/0x1030 [] compact_node+0xdb/0x120 [] kcompactd+0x121/0x2e0 [] kthread+0xcf/0x100 [] ret_from_fork+0x31/0x40 [] ret_from_fork_asm+0x1a/0x30 ---} [akpm@linux-foundation.org fix build]",
  "key_phrases": {
    "rootcause": "",
    "weakness": "",
    "impact": "deadlock",
    "vector": "NFS loopback mount",
    "attacker": "kcompactd",
    "product": "Linux kernel",
    "version": "",
    "component": "NFS fix nfs_release_folio()"
  },
  "reference_content": null,
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-833 | Deadlock | 1.0 | Base | Allowed | Primary CWE |\n| CWE-667 | Improper Locking | 0.7 | Class | Allowed-with-Review | Secondary Candidate |\n| CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 0.6 | Class | Allowed-with-Review | Secondary Candidate |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-833, which is at the Base level. CWE-667 and CWE-362 are Class-level CWEs, which are parents of more specific Base-level CWEs. The vulnerability description points to a **deadlock** issue due to improper synchronization, but doesn't provide enough detail to pinpoint a specific type of improper locking or race condition.\n\n```mermaid\ngraph TD\n    cwe833[\"CWE-833: Deadlock\"]\n    cwe667[\"CWE-667: Improper Locking\"]\n    cwe362[\"CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\"]\n    \n    cwe833 \n    cwe667 \n    cwe362 \n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe833 primary\n    class cwe667,cwe362 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with a recursion from `kcompactd` to NFS, triggering writeback to NFSD via an NFS loopback mount. This causes NFSD to block waiting for an XFS call, ultimately leading to a **deadlock**. The root cause is the lack of proper handling of the recursive call from `kcompactd` within the NFS subsystem, which results in the **deadlock**.\n\n## Summary of Analysis\nThe primary weakness is CWE-833 **Deadlock**. The vulnerability description clearly states a **deadlock** situation in the Linux kernel due to NFS waiting for `kcompactd` induced writeback, which recurses back to NFS. The fix involves skipping the call to `nfs_wb_folio()` from `kcompactd` to avoid the recursion.\n\nThe evidence is strong, as the description provides a call trace and explicitly mentions the **deadlock**. The Retriever Results also list CWE-833 as a potential match.\n\nCWE-667 **Improper Locking** and CWE-362 **Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')** are considered as secondary candidates because the **deadlock** is a consequence of some form of improper locking or synchronization issue, but the description doesn't provide enough detail to pinpoint the exact nature of the locking problem or race condition.\n\nThe selected CWEs are at the optimal level of specificity based on the provided information. CWE-833 directly addresses the **deadlock** condition, while CWE-667 and CWE-362 represent potential underlying causes but lack sufficient detail for definitive mapping.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-833: Deadlock\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in **deadlock**.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n**Justification for Use**: The vulnerability description explicitly describes a **deadlock** scenario. The fix implemented addresses this **deadlock** by preventing a recursive call. The description aligns perfectly with the definition of CWE-833.\n\n## CWE-667: Improper Locking\n**Abstraction Level**: Class\n**Similarity Score**: 0.74\n**Source**: dense\n\n**Description**:\nThe product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors.\n\n**Mapping Guidance**:\n- Usage: Allowed-with-Review\n- Rationale: This CWE entry is a Class and might have Base-level children that would be more appropriate\n\n**Justification for Consideration but Not Use as Primary**: While a **deadlock** often stems from **improper locking**, the description doesn't specify the exact locking mechanism that's failing. Therefore, CWE-667 is a potential contributing factor but not the most precise classification.\n\n## CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\n**Abstraction Level**: Class\n**Similarity Score**: 0.71\n**Source**: dense\n\n**Description**:\nThe product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently.\n\n**Mapping Guidance**:\n- Usage: Allowed-with-Review\n- Rationale: This CWE entry is a Class and might have Base-level children that would be more appropriate\n\n**Justification for Consideration but Not Use as Primary**: The **deadlock** could be caused by a race condition, but the description doesn't provide sufficient evidence to confirm this. Therefore, it is less accurate than CWE-833.\n\n## Other CWEs Considered and Rejected:\n\n*   CWE-61, CWE-59, CWE-62, CWE-73: These CWEs relate to symlink/hard link issues, which are not present in the vulnerability description.\n*   CWE-835: Loop with Unreachable Exit Condition ('Infinite Loop'): While related to potential resource exhaustion, the primary issue is a **deadlock**, not an infinite loop.\n*   CWE-390, CWE-392: Detection/Missing Report of Error Condition: The issue is not about error reporting but rather a **deadlock** scenario.\n*   CWE-401: Missing Release of Memory after Effective Lifetime: Memory leaks are not mentioned in the description.\n*   CWE-703, CWE-755: Improper Handling of Exceptional Conditions: Too generic and doesn't describe the specific **deadlock** issue.\n*   CWE-363: Race Condition Enabling Link Following: Involves race conditions with link following, which is not relevant here.\n*   CWE-1322: Use of Blocking Code in Single-threaded, Non-blocking Context: While blocking is involved, the main problem is the **deadlock**, not the blocking itself.\n*   CWE-386: Symbolic Name not Mapping to Correct Object: Not related to the described vulnerability.\n*   CWE-416: Use After Free: No evidence of use-after-free issues in the description.",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-833 | Deadlock | 1.0 | Base | Allowed | Primary CWE |\n| CWE-667 | Improper Locking | 0.7 | Class | Allowed-with-Review | Secondary Candidate |\n| CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 0.6 | Class | Allowed-with-Review | Secondary Candidate |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.9\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-833, which is at the Base level. CWE-667 and CWE-362 are Class-level CWEs, which are parents of more specific Base-level CWEs. The vulnerability description points to a **deadlock** issue due to improper synchronization, but doesn't provide enough detail to pinpoint a specific type of improper locking or race condition.\n\n```mermaid\ngraph TD\n    cwe833[\"CWE-833: Deadlock\"]\n    cwe667[\"CWE-667: Improper Locking\"]\n    cwe362[\"CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\"]\n    \n    cwe833 \n    cwe667 \n    cwe362 \n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe833 primary\n    class cwe667,cwe362 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with a recursion from `kcompactd` to NFS, triggering writeback to NFSD via an NFS loopback mount. This causes NFSD to block waiting for an XFS call, ultimately leading to a **deadlock**. The root cause is the lack of proper handling of the recursive call from `kcompactd` within the NFS subsystem, which results in the **deadlock**.\n\n## Summary of Analysis\nThe primary weakness is CWE-833 **Deadlock**. The vulnerability description clearly states a **deadlock** situation in the Linux kernel due to NFS waiting for `kcompactd` induced writeback, which recurses back to NFS. The fix involves skipping the call to `nfs_wb_folio()` from `kcompactd` to avoid the recursion.\n\nThe evidence is strong, as the description provides a call trace and explicitly mentions the **deadlock**. The Retriever Results also list CWE-833 as a potential match.\n\nCWE-667 **Improper Locking** and CWE-362 **Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')** are considered as secondary candidates because the **deadlock** is a consequence of some form of improper locking or synchronization issue, but the description doesn't provide enough detail to pinpoint the exact nature of the locking problem or race condition.\n\nThe selected CWEs are at the optimal level of specificity based on the provided information. CWE-833 directly addresses the **deadlock** condition, while CWE-667 and CWE-362 represent potential underlying causes but lack sufficient detail for definitive mapping.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-833: Deadlock\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in **deadlock**.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n**Justification for Use**: The vulnerability description explicitly describes a **deadlock** scenario. The fix implemented addresses this **deadlock** by preventing a recursive call. The description aligns perfectly with the definition of CWE-833.\n\n## CWE-667: Improper Locking\n**Abstraction Level**: Class\n**Similarity Score**: 0.74\n**Source**: dense\n\n**Description**:\nThe product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors.\n\n**Mapping Guidance**:\n- Usage: Allowed-with-Review\n- Rationale: This CWE entry is a Class and might have Base-level children that would be more appropriate\n\n**Justification for Consideration but Not Use as Primary**: While a **deadlock** often stems from **improper locking**, the description doesn't specify the exact locking mechanism that's failing. Therefore, CWE-667 is a potential contributing factor but not the most precise classification.\n\n## CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\n**Abstraction Level**: Class\n**Similarity Score**: 0.71\n**Source**: dense\n\n**Description**:\nThe product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently.\n\n**Mapping Guidance**:\n- Usage: Allowed-with-Review\n- Rationale: This CWE entry is a Class and might have Base-level children that would be more appropriate\n\n**Justification for Consideration but Not Use as Primary**: The **deadlock** could be caused by a race condition, but the description doesn't provide sufficient evidence to confirm this. Therefore, it is less accurate than CWE-833.\n\n## Other CWEs Considered and Rejected:\n\n*   CWE-61, CWE-59, CWE-62, CWE-73: These CWEs relate to symlink/hard link issues, which are not present in the vulnerability description.\n*   CWE-835: Loop with Unreachable Exit Condition ('Infinite Loop'): While related to potential resource exhaustion, the primary issue is a **deadlock**, not an infinite loop.\n*   CWE-390, CWE-392: Detection/Missing Report of Error Condition: The issue is not about error reporting but rather a **deadlock** scenario.\n*   CWE-401: Missing Release of Memory after Effective Lifetime: Memory leaks are not mentioned in the description.\n*   CWE-703, CWE-755: Improper Handling of Exceptional Conditions: Too generic and doesn't describe the specific **deadlock** issue.\n*   CWE-363: Race Condition Enabling Link Following: Involves race conditions with link following, which is not relevant here.\n*   CWE-1322: Use of Blocking Code in Single-threaded, Non-blocking Context: While blocking is involved, the main problem is the **deadlock**, not the blocking itself.\n*   CWE-386: Symbolic Name not Mapping to Correct Object: Not related to the described vulnerability.\n*   CWE-416: Use After Free: No evidence of use-after-free issues in the description.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-390:**\n- 390 (Detection of Error Condition Without Action) - ROOT\n\n\n**Chain starting from CWE-392:**\n- 392 (Missing Report of Error Condition) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "source": "sparse"
      },
      "similarity": 123.89511858617897
    },
    {
      "metadata": {
        "doc_id": "833",
        "name": "Deadlock",
        "source": "sparse"
      },
      "similarity": 123.88240678697468
    },
    {
      "metadata": {
        "doc_id": "392",
        "name": "Missing Report of Error Condition",
        "source": "sparse"
      },
      "similarity": 117.72678146029459
    },
    {
      "metadata": {
        "doc_id": "62",
        "name": "UNIX Hard Link",
        "source": "sparse"
      },
      "similarity": 112.1082733917903
    },
    {
      "metadata": {
        "doc_id": "667",
        "name": "Improper Locking",
        "source": "sparse"
      },
      "similarity": 111.66173697265008
    },
    {
      "metadata": {
        "doc_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "source": "sparse"
      },
      "similarity": 107.36191208853373
    },
    {
      "metadata": {
        "doc_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "source": "sparse"
      },
      "similarity": 106.66432188257794
    },
    {
      "metadata": {
        "doc_id": "59",
        "name": "Improper Link Resolution Before File Access ('Link Following')",
        "source": "sparse"
      },
      "similarity": 106.44172923535312
    },
    {
      "metadata": {
        "doc_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "type": "Base",
        "original_content": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop.",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense",
            "graph"
          ],
          "retriever_count": 2,
          "normalized_scores": {
            "dense": 0.49707415937521915,
            "graph": 1.4979619135427302
          }
        }
      },
      "similarity": 0.49707415937521915
    },
    {
      "doc_id": "390",
      "text": "CWE-390: Detection of Error Condition Without Action",
      "score": 2.2100000000000004,
      "metadata": {
        "doc_id": "390",
        "name": "Detection of Error Condition Without Action",
        "type": "base",
        "original_content": "CWE-390: Detection of Error Condition Without Action",
        "relationships": [
          {
            "source_id": "390",
            "target_id": "401",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "390",
            "target_id": "755",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "81",
            "target_id": "390",
            "label": "CANALSOBE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "755",
            "target_id": "390",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "600",
            "target_id": "390",
            "label": "PEEROF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "401",
            "target_id": "390",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "401",
                  "390",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "401"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "401",
                  "390",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "401"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "390",
                  "401",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "401"
            }
          }
        },
        "position": "before",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.2100000000000004
          }
        }
      },
      "similarity": 2.2100000000000004
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-390",
      "CWE-392",
      "CWE-416",
      "CWE-62",
      "CWE-59",
      "CWE-667",
      "CWE-833",
      "CWE-73",
      "CWE-401",
      "CWE-1322",
      "CWE-835",
      "CWE-363",
      "CWE-386",
      "CWE-362",
      "CWE-755",
      "CWE-703",
      "CWE-61"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}