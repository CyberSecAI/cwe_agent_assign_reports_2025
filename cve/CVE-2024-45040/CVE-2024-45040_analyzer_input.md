# Vulnerability Information: CVE-2024-45040

## Vulnerability Description
gnark is a fast zk-SNARK library that offers a high-level API to design circuits. Prior to version 0.11.0, commitments to private witnesses in Groth16 as implemented break the zero-knowledge property. The vulnerability affects only Groth16 proofs with commitments. Notably, PLONK proofs are not affected. The vulnerability affects the zero-knowledge property of the proofs - in case the witness (secret or internal) values are small, then the attacker may be able to enumerate all possible choices to deduce the actual value. If the possible choices for the variables to be committed is large or there are many values committed, then it would be computationally infeasible to enumerate all valid choices. It doesnt affect the completeness/soundness of the proofs. The vulnerability has been fixed in version 0.11.0. The patch to fix the issue is to add additional randomized value to the list of committed value at proving time to mask the rest of the values which were committed. As a workaround, the user can manually commit to a randomized value.

### Vulnerability Description Key Phrases
- **impact:** break the zero-knowledge property
- **product:** gnark
- **version:** Prior to version 0.11.0

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**Root Cause:**
The vulnerability stems from the way commitments to private witnesses are handled in the Groth16 proving system within the `gnark` library. The commitment is calculated as a linear combination of the witness values and basis points from the proving key. This approach, while binding, does not provide hiding, as the basis points are public knowledge from the proving key. An attacker can iterate through possible witness values, recompute the commitment, and compare it to the actual commitment, revealing the private witness if the range of possible values is small enough.

**Weaknesses/Vulnerabilities:**
- **Lack of Hiding:** The core weakness is the lack of a random masking term in the commitment calculation, making the commitment non-hiding. The Groth16 commitment scheme, when used with private witnesses, does not properly conceal the witness values. This violates the zero-knowledge property.
- **Predictable Commitments:** The commitments become predictable because they are a linear combination of the private witness and publicly known basis points.

**Impact of Exploitation:**
- **Loss of Zero-Knowledge:**  The primary impact is the loss of the zero-knowledge property of the Groth16 proofs. This means that an attacker can potentially learn information about the private witnesses by analyzing the commitments.
- **Private Witness Exposure:** For small witness values, an attacker can enumerate and test possible values to deduce the actual private witness.
- **Compromised Confidentiality:** The vulnerability can lead to a loss of confidentiality of the committed private witnesses, even though soundness and completeness are unaffected.

**Attack Vectors:**
- **Network:** The vulnerability is present in the construction of the proofs, which can be transmitted over the network. The attacker needs the commitment and access to the proving key.

**Required Attacker Capabilities/Position:**
- **Knowledge of Proving Key:** The attacker needs access to the proving key, since the commitment basis points are part of it.
- **Commitment Value:** The attacker requires the commitment generated by the prover for the private witnesses.
- **Enumeration Capability:** If the private witnesses are small enough, the attacker must be able to enumerate possibilities and compare them to the commitment value.

**Additional details from the provided content:**

- **Mitigation:** The vulnerability is fixed by adding a random mask to the commitment, effectively blinding the witness values. The fix introduces a new random variable within the commitment to hide the original committed values.
- **Affected Versions:** The vulnerability affects `gnark` versions v0.10.0 and earlier.
- **Patched Versions:** The vulnerability is resolved in version v0.11.0 and later.
- **CVSS Score:** A CVSS v3 base score of 5.9 is assigned, with a High Confidentiality impact.

The provided content offers more insight than the initial CVE description placeholder. It clarifies that the vulnerability is present specifically when commitments are used with private witnesses in Groth16 and is resolved by adding a random blinding term to the commitment calculation. It also clearly points to the patch implementation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.297 |
| 2 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.296 |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.294 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.292 |
| 5 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.291 |
| 6 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.291 |
| 7 | 407 | Inefficient Algorithmic Complexity | Class | Allowed-with-Review | sparse | 0.290 |
| 8 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.290 |
| 9 | 194 | Unexpected Sign Extension | Variant | Allowed | dense | 0.404 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.003 |

