## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved block initialize integrity buffer to zero before writing it to media Metadata added by bio_integrity_prep is using plain kmalloc, which leads to random kernel memory being written media. For PI metadata this is limited to the app tag that isnt used by kernel generated metadata, but for non-PI metadata the entire buffer leaks kernel memory. Fix this by adding the __GFP_ZERO flag to allocations for writes.

### Vulnerability Description Key Phrases
- **impact:** integrity and kernel memory leak
- **product:** Linux kernel

## CVE Reference Links Content Summary
The provided content relates to a vulnerability in the Linux kernel's block layer data integrity support.

**Root cause of vulnerability:**
- The `bio_integrity_prep` function allocates memory for metadata using `kmalloc` without initializing it to zero. This results in uninitialized kernel memory being written to the storage media.

**Weaknesses/vulnerabilities present:**
- **Information Leak:** Uninitialized kernel memory, which could contain sensitive data, is written to the disk.
- This is present both for PI (Protection Information) metadata and non-PI metadata, with the leak being limited to the app tag for PI but affecting the entire buffer for non-PI.

**Impact of exploitation:**
- **Information Disclosure:** An attacker could potentially read the leaked kernel memory from the storage media.

**Attack vectors:**
- The vulnerability can be triggered by any operation that uses the block layer's data integrity feature, which involves writing to a block device.

**Required attacker capabilities/position:**
- The attacker would need the ability to read data written to block devices where data integrity metadata is being used.
- This could be achieved via physical access to the storage media or logical access if the attacker can read the block device.

**More Detail than CVE description:**
- The provided commit messages and diffs offer specific details including the affected function (`bio_integrity_prep`), the allocation type `kmalloc`, and the fix implemented by adding `__GFP_ZERO` to the allocation flags. The text also makes the distinction between the impact on PI and non-PI metadata, with PI leaks limited to the app tag only.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 156 | Improper Neutralization of Whitespace | Variant | Allowed | alternate_terms | 0.700 |
| 2 | 183 | Permissive List of Allowed Inputs | Base | Allowed | alternate_terms | 0.700 |
| 3 | 197 | Numeric Truncation Error | Base | Allowed | sparse | 0.133 |
| 4 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.132 |
| 5 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | sparse | 0.131 |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.129 |
| 7 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.129 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.128 |
| 9 | 126 | Buffer Over-read | Variant | Allowed | dense | 0.520 |
| 10 | 908 | Use of Uninitialized Resource | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-156: Improper Neutralization of Whitespace

CWE-183: Permissive List of Allowed Inputs

CWE-197: Numeric Truncation Error

CWE-125: Out-of-bounds Read

CWE-909: Missing Initialization of Resource

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-126: Buffer Over-read

CWE-908: Use of Uninitialized Resource