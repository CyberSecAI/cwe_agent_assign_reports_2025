# Retrieval Query for CVE-2024-50151

# Vulnerability Description

    In the Linux kernel, the following vulnerability has been resolved smb client fix OOBs when building SMB2_IOCTL request When using encryption, either enforced by the server or when using seal mount option, the client will squash all compound request buffers down for encryption into a single iov in smb2_set_next_command(). SMB2_ioctl_init() allocates a small buffer (448 bytes) to hold the SMB2_IOCTL request in the first iov, **and if the user passes an input buffer that is greater than 328 bytes**, **smb2_set_next_command() will end up writing off the end of @rqst->iov[0].iov_base** as shown below mount.cifs //srv/share /mnt -o ...,seal ln -s $(perl -e print(a)for 1..1024) /mnt/link BUG KASAN **slab-out-of-bounds** in smb2_set_next_command.cold+0x1d6/0x24c [cifs] Write of size 4116 at addr ffff8881148fcab8 by task ln/859 CPU 1 UID 0 PID 859 Comm ln Not tainted 6.12.0-rc3 #1 Hardware name QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-2.fc40 04/01/2014 Call Trace dump_stack_lvl+0x5d/0x80 ? smb2_set_next_command.cold+0x1d6/0x24c [cifs] print_report+0x156/0x4d9 ? smb2_set_next_command.cold+0x1d6/0x24c [cifs] ? __virt_addr_valid+0x145/0x310 ? __phys_addr+0x46/0x90 ? smb2_set_next_command.cold+0x1d6/0x24c [cifs] kasan_report+0xda/0x110 ? smb2_set_next_command.cold+0x1d6/0x24c [cifs] kasan_check_range+0x10f/0x1f0 __asan_memcpy+0x3c/0x60 smb2_set_next_command.cold+0x1d6/0x24c [cifs] smb2_compound_op+0x238c/0x3840 [cifs] ? kasan_save_track+0x14/0x30 ? kasan_save_free_info+0x3b/0x70 ? vfs_symlink+0x1a1/0x2c0 ? do_symlinkat+0x108/0x1c0 ? __pfx_smb2_compound_op+0x10/0x10 [cifs] ? kmem_cache_free+0x118/0x3e0 ? cifs_get_writable_path+0xeb/0x1a0 [cifs] smb2_get_reparse_inode+0x423/0x540 [cifs] ? __pfx_smb2_get_reparse_inode+0x10/0x10 [cifs] ? rcu_is_watching+0x20/0x50 ? __kmalloc_noprof+0x37c/0x480 ? smb2_create_reparse_symlink+0x257/0x490 [cifs] ? smb2_create_reparse_symlink+0x38f/0x490 [cifs] smb2_create_reparse_symlink+0x38f/0x490 [cifs] ? __pfx_smb2_create_reparse_symlink+0x10/0x10 [cifs] ? find_held_lock+0x8a/0xa0 ? hlock_class+0x32/0xb0 ? __build_path_from_dentry_optional_prefix+0x19d/0x2e0 [cifs] cifs_symlink+0x24f/0x960 [cifs] ? __pfx_make_vfsuid+0x10/0x10 ? __pfx_cifs_symlink+0x10/0x10 [cifs] ? make_vfsgid+0x6b/0xc0 ? generic_permission+0x96/0x2d0 vfs_symlink+0x1a1/0x2c0 do_symlinkat+0x108/0x1c0 ? __pfx_do_symlinkat+0x10/0x10 ? strncpy_from_user+0xaa/0x160 __x64_sys_symlinkat+0xb9/0xf0 do_syscall_64+0xbb/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7f RIP 00330x7f08d75c13bb

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## ROOTCAUSE: 'The client will squash all compound request buffers down for encryption into a single iov in smb2_set_next_command(). SMB2_ioctl_init() allocates a small buffer (448 bytes) to hold the SMB2_IOCTL request in the first iov'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-789: Memory Allocation with Excessive Size Value (Score: 927.75)

The product allocates memory based on an untrusted, large size value, but it does not ensure that the size is within expected limits, allowing arbitrary amounts of memory to be allocated....

### 4. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 926.51)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

### 5. CWE-226: Sensitive Information in Resource Not Removed Before Reuse (Score: 922.59)

The product releases a resource such as memory or a file so that it can be made available for reuse, but it does not clear or "zeroize" the information contained in the resource before the product performs a critical state transition or makes the resource available for reuse by other entities....

## ROOTCAUSE: 'and if the user passes an input buffer that is greater than 328 bytes'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-1284: Improper Validation of Specified Quantity in Input (Score: 766.24)

The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....

## ROOTCAUSE: 'smb2_set_next_command() will end up writing off the end of @rqst->iov[0].iov_base'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-400: Uncontrolled Resource Consumption (Score: 716.49)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

## WEAKNESS: 'Out-of-bounds write vulnerability in smb2_set_next_command function'

Relevant CWEs for this WEAKNESS:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer (Score: 665.88)

The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data....

## WEAKNESS: 'slab-out-of-bounds'

Relevant CWEs for this WEAKNESS:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer (Score: 665.88)

The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data....

## IMPACT: 'Kernel memory corruption'

Relevant CWEs for this IMPACT:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer (Score: 665.88)

The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data....

## IMPACT: 'potentially leading to system crash or arbitrary code execution'

Relevant CWEs for this IMPACT:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer (Score: 665.88)

The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data....

## VECTOR: 'Mounting a CIFS share with seal option and creating a symbolic link with a large target'

Relevant CWEs for this VECTOR:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 926.51)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

### 4. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 5. CWE-61: UNIX Symbolic Link (Symlink) Following (Score: 284.26)

The product, when opening a file or directory, does not sufficiently account for when the file is a symbolic link that resolves to a target outside of the intended control sphere. This could allow an attacker to cause the product to operate on unauthorized files....

## ATTACKER: 'Local user'

Relevant CWEs for this ATTACKER:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-400: Uncontrolled Resource Consumption (Score: 716.49)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

## PRODUCT: 'Linux Kernel'

Relevant CWEs for this PRODUCT:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer (Score: 665.88)

The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data....

## VERSION: '6.12.0-rc3'

Relevant CWEs for this VERSION:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 926.51)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

### 4. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 5. CWE-400: Uncontrolled Resource Consumption (Score: 716.49)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

## COMPONENT: 'cifs'

Relevant CWEs for this COMPONENT:

### 1. CWE-266: Incorrect Privilege Assignment (Score: 1036.08)

A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....

### 2. CWE-532: Insertion of Sensitive Information into Log File (Score: 929.48)

The product writes sensitive information to a log file....

### 3. CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') (Score: 820.97)

The product constructs a string for a command to be executed by a separate component
in another control sphere, but it does not properly delimit the
intended arguments, options, or switches within that command string....

### 4. CWE-125: Out-of-bounds Read (Score: 796.75)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-400: Uncontrolled Resource Consumption (Score: 716.49)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    