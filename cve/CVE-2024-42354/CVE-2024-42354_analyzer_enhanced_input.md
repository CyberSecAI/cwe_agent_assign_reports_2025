## Vulnerability Description
Shopware is an open commerce platform. The store-API works with regular entities and not expose all fields for the public API fields need to be marked as ApiAware in the EntityDefinition. So only ApiAware fields of the EntityDefinition will be encoded to the final JSON. Prior to versions 6.6.5.1 and 6.5.8.13, the processing of the Criteria did not considered ManyToMany associations and so they were not considered properly and the protections didnt get used. This issue cannot be reproduced with the default entities by Shopware, but can be triggered with extensions. Update to Shopware 6.6.5.1 or 6.5.8.13 to receive a patch. For older versions of 6.2, 6.3, and 6.4, corresponding security measures are also available via a plugin.

### Vulnerability Description Key Phrases
- **rootcause:** **improper processing of ManyToMany associations**
- **product:** Shopware
- **version:** prior to versions 6.6.5.1 and 6.5.8.13

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The store-API was not properly considering ManyToMany associations when processing criteria, leading to potential exposure of non-ApiAware fields.",
    "weaknesses": [
      "Improper Access Control (CWE-284)"
    ],
    "impact": "Unauthorized access to sensitive data through the store-API by exposing fields that are not marked as ApiAware in the EntityDefinition.",
    "attack_vectors": "Network access to the store-API endpoint.",
    "required_capabilities": "An attacker would need to craft specific requests to the store-API to exploit this vulnerability. No specific privileges are required, but the attacker requires some user interaction.",
    "details": "The store-API uses regular entities and only exposes fields marked as `ApiAware` in the `EntityDefinition`. However, the processing of criteria did not correctly consider `ManyToMany` associations. As a result, protections intended for `ApiAware` fields were bypassed, potentially exposing sensitive data when extensions introduced custom entities with `ManyToMany` relationships."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.763 |
| 2 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.752 |
| 3 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.749 |
| 4 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.744 |
| 5 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.733 |
| 6 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.723 |
| 7 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.717 |
| 8 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.714 |
| 9 | 1023 | Incomplete Comparison with Missing Factors | Class | Allowed-with-Review | dense | 0.399 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-863: Incorrect Authorization

CWE-200: Exposure of Sensitive Information to an Unauthorized Actor

CWE-116: Improper Encoding or Escaping of Output

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-1333: Inefficient Regular Expression Complexity

CWE-285: Improper Authorization

CWE-1023: Incomplete Comparison with Missing Factors

CWE-184: Incomplete List of Disallowed Inputs