## Vulnerability Description
streamlit-geospatial is a streamlit multipage app for geospatial applications. Prior to commit c4f81d9616d40c60584e36abb15300853a66e489, the palette variable in `pages/1__Timelapse.py` takes user input, which is later used in the `eval()` function on line 380, leading to remote code execution. Commit c4f81d9616d40c60584e36abb15300853a66e489 fixes this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input sanitization**
- **weakness:** **eval() injection**
- **impact:** remote code execution
- **vector:** palette variable containing user input
- **product:** streamlit-geospatial
- **version:** prior to commit c4f81d9616d40c60584e36abb15300853a66e489
- **component:** pages/1__Timelapse.py

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-NVD-noinfo

#### Top CWEs
- CWE-NVD-noinfo (Count: 34)
- CWE-918 (Count: 4)

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-41112:

**Verification:**

The provided content from `securitylab.github.com` directly references `CVE-2024-41112` and identifies it as `GHSL-2024-100`. The identified vulnerability is a Remote Code Execution (RCE) in `pages/1_ðŸ“·_Timelapse.py` related to the `palette` variable when using the `Any Earth Engine ImageCollection` option. This confirms the content is directly related to the CVE.

**Vulnerability Details:**

*   **Root Cause:** The vulnerability stems from the use of the `eval()` function on user-provided input within the `palette` variable in `pages/1_ðŸ“·_Timelapse.py`. Specifically, lines 373-376 define a text area for user input of a palette and this input is then evaluated using the `eval()` function.
*   **Weakness:** The primary weakness is the unsafe use of the `eval()` function. This function executes arbitrary Python code passed to it as a string. Since user input is directly passed to this function, it becomes a prime target for injection attacks.
*   **Impact:** Successful exploitation of this vulnerability allows for arbitrary code execution on the server running the Streamlit application. An attacker could gain full control over the server, potentially leading to data breaches, system compromise, and other malicious activities.
*   **Attack Vector:** The attack vector is through the web interface of the Streamlit application. Specifically, the attacker needs to access the ðŸ“· Timelapse tab, select the `Any Earth Engine Image Collection` option, enter a valid `ee.ImageCollection` id and then inject malicious python code into the `Enter a custom palette` text area.
*   **Required Attacker Capabilities/Position:** The attacker needs to be able to access the Streamlit application's web interface and be able to provide user input to the `palette` variable within the `Any Earth Engine Image Collection` option of the Timelapse tab.

**Technical Details:**

The vulnerable code snippet from `pages/1_ðŸ“·_Timelapse.py` is:

```python
palette = st.text_area(
    "Enter a custom palette:",
    palette_values,
)
st.write(
    cm.plot_colormap(cmap=palette_options, return_fig=True)
)
st.session_state["palette"] = eval(palette)
```

The Proof of Concept (PoC) provided demonstrates the vulnerability by injecting the following malicious code:

```python
__import__('code').InteractiveInterpreter().runsource('import os;os.system(\"echo $(uname -a) > foobar.txt\")')
```

This code uses `__import__('code').InteractiveInterpreter().runsource()` to execute the `os.system()` command. This command is used to execute shell commands, creating a text file `foobar.txt` with the output of the `uname -a` command.

**Additional Notes:**

The provided github.com content shows the code before and after the fix. The fix replaces the use of `eval()` with `json.loads()`, which prevents the execution of arbitrary code and handles the string as a json object for palette configuration.

```python
st.session_state["palette"] = json.loads(
    palette.replace("'", '"')
)
```

**Summary of findings:**

-   **CVE ID:** CVE-2024-41112
-   **Root Cause:** Unsafe use of `eval()` on user-supplied input in the `palette` variable.
-   **Vulnerability:** Remote Code Execution.
-  **Impact:** Complete server compromise
-   **Attack Vector:** Web interface, requiring access to the Timelapse tab, selection of `Any Earth Engine Image Collection` and a malicious payload in the `Enter a custom palette` text area.
-   **Attacker Capabilities:** Access to the web interface of the Streamlit application.

The content from `securitylab.github.com` provides more detail than a typical CVE description, including a clear PoC and the specific line numbers where the vulnerability resides.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.259 |
| 2 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | sparse | 0.241 |
| 3 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.227 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.226 |
| 5 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.224 |
| 6 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.219 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.212 |
| 8 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.208 |
| 9 | 1287 | Improper Validation of Specified Type of Input | Base | Allowed | dense | 0.380 |
| 10 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-917: Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection')

CWE-116: Improper Encoding or Escaping of Output

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-138: Improper Neutralization of Special Elements

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-1287: Improper Validation of Specified Type of Input

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine