## Vulnerability Description
ICG.AspNetCore.Utilities.CloudStorage is a collection of cloud storage utilities to assist with the management of files for cloud upload. Users of this library that set a duration for a SAS Uri with a value other than 1 hour may have generated a URL with a duration that is longer, or shorter than desired. Users not implemented SAS Uris are unaffected. This issue was resolved in version 8.0.0 of the library.

### Vulnerability Description Key Phrases
- **rootcause:** **improper SAS Uri duration setting**
- **impact:** generate URL with unexpected duration
- **product:** ICG.AspNetCore.Utilities.CloudStorage
- **version:** prior to 8.0.0

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-50353:

**Root Cause of Vulnerability:**

The vulnerability stems from an issue in how the `ICG.AspNetCore.Utilities.CloudStorage` library generates Shared Access Signature (SAS) URLs for Azure Blob Storage. The library was incorrectly setting the expiration time for SAS tokens. Instead of using the specified `tokenDuration` (in minutes), the code was hardcoded to add 1 hour.

**Weaknesses/Vulnerabilities Present:**

*   **Incorrect SAS Token Duration:** The primary vulnerability is that the generated SAS URLs had an expiration time that was either longer or shorter than intended by the user. This means that a token could be valid for more or less time than the user expected, leading to potential unintended access to resources.
*   **Authorization Bypass:** While the issue is with the duration and not authorization itself, an attacker could potentially exploit the vulnerability if the generated SAS token has excessive validity period compared to the intention and use that longer time period to gain access to the resource

**Impact of Exploitation:**

*   **Unauthorized Access:** An attacker could potentially gain unauthorized access to the Azure Blob Storage resources if they were able to obtain an SAS URL with an extended validity period.
*   **Data Exposure:** If an attacker obtained an SAS URL that was valid for a longer time, they could potentially access and download or modify sensitive data.
*   **Unpredictable Access:** Since the duration could be shorter than expected too, it could potentially interrupt the intended usage.

**Attack Vectors:**

*   **Network:** The attack vector is network-based, as an attacker would need to obtain a crafted SAS URL to exploit the vulnerability.

**Required Attacker Capabilities/Position:**

*   The attacker needs to be in a position where they can obtain a SAS URL generated by the vulnerable library (ICG.AspNetCore.Utilities.CloudStorage version < 8.0.0).
* No specific level of privilege required since the vulnerability is exploitable through generated URL if the duration is longer.
* No user interaction is required, attacker can exploit it if they have URL

**Additional Details:**

*   The vulnerability is present in versions prior to 8.0.0 of the library.
*   The issue was fixed in version 8.0.0 by using AddMinutes(tokenDuration) instead of AddHours(1).
*   The CVSS score is 5.3, classified as "Moderate," with a CVSS vector of CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N.
*   The weakness is categorized as CWE-284 (Improper Access Control).

In summary, the vulnerability is related to the improper handling of token duration for SAS URLs, which could lead to unintended access to Azure Blob Storage resources, with network based attack vector.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.423 |
| 2 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.405 |
| 3 | 267 | Privilege Defined With Unsafe Actions | Base | Allowed | sparse | 0.404 |
| 4 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.402 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.400 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.399 |
| 7 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.397 |
| 8 | 276 | Incorrect Default Permissions | Base | Allowed | sparse | 0.396 |
| 9 | 922 | Insecure Storage of Sensitive Information | Class | Allowed-with-Review | dense | 0.353 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-267: Privilege Defined With Unsafe Actions

CWE-918: Server-Side Request Forgery (SSRF)

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-287: Improper Authentication

CWE-276: Incorrect Default Permissions

CWE-922: Insecure Storage of Sensitive Information

CWE-226: Sensitive Information in Resource Not Removed Before Reuse