# Vulnerability Information: CVE-2024-56602

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved net ieee802154 do not leave a dangling sk pointer in ieee802154_create() sock_init_data() attaches the allocated sk object to the provided sock object. If ieee802154_create() fails later, the allocated sk object is freed, but the dangling pointer remains in the provided sock object, which may allow **use-after-free**. Clear the sk pointer in the sock object on error.

### Vulnerability Description Key Phrases
- **weakness:** **use-after-free**
- **product:** Linux kernel
- **component:** net ieee802154

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
- The vulnerability stems from how the `ieee802154_create()` function in the Linux kernel's IEEE 802.15.4 networking stack handles errors during socket creation.
- The `sock_init_data()` function attaches an allocated `sk` (socket buffer) object to the provided `sock` object.
- If `ieee802154_create()` fails after `sock_init_data()` (e.g., during hash or init operations on the `sk` object), the allocated `sk` object is freed using `sk_common_release(sk)`.
- However, the pointer to the freed `sk` object within the `sock` object is not cleared, resulting in a dangling pointer.

**Weaknesses/Vulnerabilities:**
- **Use-After-Free (UAF):** The primary vulnerability is a use-after-free. If a subsequent operation tries to use the dangling `sk` pointer in the `sock` object, it will attempt to access freed memory, leading to a crash, arbitrary code execution, or other undefined behavior.

**Impact of Exploitation:**
- Exploiting this UAF can lead to:
    - Kernel crash (denial of service)
    - Potential arbitrary code execution in the kernel context
    - Other undefined behavior, depending on how the freed memory is used subsequently.

**Attack Vectors:**
- The vulnerability is triggered during the creation of an IEEE 802.15.4 socket.
- A local attacker could trigger this vulnerability by creating a socket, which fails in `ieee802154_create` leading to a dangling pointer in socket structure, then attempt to use the socket object again.

**Required Attacker Capabilities/Position:**
- The attacker needs the capability to create an IEEE 802.15.4 socket that triggers a failure in `ieee802154_create()`.
- Local access to the system is needed to perform socket operations.

**Mitigation:**
- The provided patches address this vulnerability by clearing the `sk` pointer in the `sock` object before exiting the `ieee802154_create()` function in an error condition.  Specifically, when a failure occurs during the hash or init operations, the code now calls `sock->sk = NULL;` after releasing the socket, preventing a use-after-free condition from occuring.

In summary, the vulnerability is a use-after-free in the Linux kernel's IEEE 802.15.4 networking stack, triggered during socket creation failures. The provided patches correctly mitigate the vulnerability by ensuring that a dangling pointer is not left behind after a socket allocation failure.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 416 | Use After Free | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 415 | Double Free | Variant | Allowed | sparse | 0.410 |
| 3 | 911 | Improper Update of Reference Count | Base | Allowed | sparse | 0.386 |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.371 |
| 5 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.370 |
| 6 | 825 | Expired Pointer Dereference | Base | Allowed | sparse | 0.342 |
| 7 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.327 |
| 8 | 823 | Use of Out-of-range Pointer Offset | Base | Allowed | sparse | 0.325 |
| 9 | 775 | Missing Release of File Descriptor or Handle after Effective Lifetime | Variant | Allowed | dense | 0.464 |
| 10 | 123 | Write-what-where Condition | Base | Allowed | graph | 0.003 |

