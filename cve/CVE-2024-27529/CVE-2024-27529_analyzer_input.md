# Vulnerability Information: CVE-2024-27529

## Vulnerability Description
wasm3 139076a contains **memory leaks** in Read_utf8.

### Vulnerability Description Key Phrases
- **weakness:** **memory leaks**
- **product:** wasm3
- **version:** 139076a
- **component:** Read_utf8

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-27529:

**Root Cause of Vulnerability:**
- The vulnerability stems from memory leaks within the `Read_utf8` function in the `wasm3` project. Specifically, memory allocated for UTF-8 strings during parsing is not always freed, particularly when parsing import sections of a WebAssembly module fails. The `memoryImport` field within the `M3Module` structure is not released in certain error paths, leading to these leaks.

**Weaknesses/Vulnerabilities Present:**
- **Memory Leak:** Unreleased memory allocated by `calloc` in the `Read_utf8` function during the parsing of wasm files. This occurs specifically during the parsing of imports, where `memoryImport` is set but not subsequently freed if parsing fails.

**Impact of Exploitation:**
- **Denial of Service (DoS):**  The memory leaks can lead to a denial of service by exhausting available memory. This is because, with a specially crafted wasm file, the `Read_utf8` function can be repeatedly called and allocate memory without freeing it.
- The advisory mentions that the "whole wasm3 runtime is affected".

**Attack Vectors:**
- The attack vector is a crafted WebAssembly (wasm) file.

**Required Attacker Capabilities/Position:**
- An attacker needs the ability to supply the vulnerable `wasm3` runtime with a malicious wasm file. This could be done locally or remotely, as stated in the advisory.

**Additional Details from the Content:**
- The issue was identified using AddressSanitizer (ASAN), which detected the memory leaks.
- The problematic code was found in `m3_core.c` in the `Read_utf8` function, and also in the `m3_parse.c` file during parsing of import sections in the `ParseSection_Import` function.
- The fix involved ensuring that the `memoryImport` field of the `M3Module` is freed in error scenarios, as indicated by commit `10ea64470542c133c6c9d502135a9a250d4aaa90` and pull request #490.
- The provided Proof of Concept (PoC) is a wasm file that triggers the memory leak by providing an invalid function signature count.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | alternate_terms | 0.800 |
| 2 | 1295 | Debug Messages Revealing Unnecessary Information | Base | Allowed | sparse | 0.054 |
| 3 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.051 |
| 4 | 1258 | Exposure of Sensitive System Information Due to Uncleared Debug Information | Base | Allowed | sparse | 0.049 |
| 5 | 665 | Improper Initialization | Class | Discouraged | sparse | 0.045 |
| 6 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.042 |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.042 |
| 8 | 598 | Use of GET Request Method With Sensitive Query Strings | Variant | Allowed | sparse | 0.040 |
| 9 | 126 | Buffer Over-read | Variant | Allowed | dense | 0.483 |
| 10 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | graph | 0.003 |

