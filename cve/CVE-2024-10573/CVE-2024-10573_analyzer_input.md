# Vulnerability Information: CVE-2024-10573

## Vulnerability Description
An **out-of-bounds write** flaw was found in mpg123 when handling crafted streams. When decoding PCM, the libmpg123 may write past the end of a heap-located buffer. Consequently, heap corruption may happen, and arbitrary code execution is not discarded. The complexity required to exploit this flaw is considered high as the payload must be validated by the MPEG decoder and the PCM synth before execution. Additionally, to successfully execute the attack, the user must scan through the stream, making web live stream content (such as web radios) a very unlikely attack vector.

### Vulnerability Description Key Phrases
- **rootcause:** **out-of-bounds write**
- **impact:** arbitrary code execution and heap corruption
- **vector:** crafted streams
- **product:** mpg123
- **component:** libmpg123

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability related to CVE-2024-10573:

**1. Root Cause:**

*   The vulnerability is a buffer overflow that occurs during the decoding of PCM samples in `libmpg123`.
*   The root cause is an inconsistency in how stream properties are stored and applied, particularly when dealing with streams that change output properties. This leads to writing decoded PCM data beyond the allocated buffer.
*   The issue is triggered by "Frankenstein streams," which are concatenated audio files, streams with varying formats, or those with leading info frames beyond the first track.

**2. Weaknesses/Vulnerabilities Present:**

*   **Out-of-bounds write:** The core vulnerability is that `libmpg123` writes data beyond the boundaries of a heap-allocated buffer.
*   **Heap corruption:** This out-of-bounds write can lead to heap corruption, potentially affecting other parts of the application's memory.
*   **Inconsistent stream property handling:** The parser stores certain stream properties prematurely before confirming corresponding MPEG frame data.

**3. Impact of Exploitation:**

*   **Heap corruption:** At a minimum, successful exploitation can lead to heap corruption.
*   **Arbitrary code execution:** While not easily achievable, the possibility of arbitrary code execution is not ruled out. The exploit payload must pass validation by the MPEG decoder and the PCM synthesizer.
*   **Denial of Service:** Crashing the application

**4. Attack Vectors:**

*   **Crafted MP3 streams:** The vulnerability is triggered by specific types of malformed or crafted MP3 streams. These include:
    *   Concatenated files with varying formats
    *   Streams with leading info frames past the first track
    *   Streams that change output properties
*   **Local Files:** Local MP3 files processed by the vulnerable software

**5. Required Attacker Capabilities/Position:**

*   **Malicious MP3 stream creation:** Attackers need to create a specifically crafted MP3 stream that triggers the vulnerability.
*   **User interaction:** Exploitation requires a user to process the malicious MP3 stream using the vulnerable software. The user must seek through the stream, so simply playing a stream is not enough.
*   **Local access:** The attacker needs the ability to get the crafted MP3 stream processed by the vulnerable library, such as having the user open a local malicious MP3 file.

**Additional Details:**

*   **Complexity:** The complexity to exploit the vulnerability is considered high, as the payload has to be validated by both the MPEG decoder and the PCM synth before it can be executed.
*   **Unlikely attack vector:**  Web radio streams are considered an unlikely attack vector due to the requirement for the user to seek around in the stream.
*   **Mitigation:** The issue can be avoided by using the `MPG123_NO_FRANKENSTEIN` flag or the `--no-frankenstein` option, which disables support for "Frankenstein streams."
*   **Affected Versions:** All versions of mpg123 before 1.32.8 are vulnerable, including the 1.26.x and 1.31.x release lines.
*   **Patched Versions:** The vulnerability is addressed in versions 1.32.8 and later, as well as backported fixes in the 1.26 and 1.31 branches.

This vulnerability is present in the `mpg123` library when decoding a crafted MP3 stream. By strategically modifying the streamâ€™s properties, an attacker can trigger a heap buffer overflow, potentially leading to arbitrary code execution.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.617 |
| 2 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.576 |
| 3 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.575 |
| 4 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.564 |
| 5 | 197 | Numeric Truncation Error | Base | Allowed | sparse | 0.538 |
| 6 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | sparse | 0.533 |
| 7 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.525 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.524 |
| 9 | 126 | Buffer Over-read | Variant | Allowed | dense | 0.601 |
| 10 | 823 | Use of Out-of-range Pointer Offset | Base | Allowed | graph | 0.003 |

