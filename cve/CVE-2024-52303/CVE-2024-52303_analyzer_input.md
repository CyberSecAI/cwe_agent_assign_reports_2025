# Vulnerability Information: CVE-2024-52303

## Vulnerability Description
aiohttp is an asynchronous HTTP client/server framework for asyncio and Python. In versions starting with 3.10.6 and prior to 3.10.11, a **memory leak** can occur when a request produces a MatchInfoError. This was caused by adding an entry to a cache on each request, due to the building of each MatchInfoError producing a unique cache entry. An attacker may be able to exhaust the memory resources of a server by sending a substantial number (100,000s to millions) of such requests. Those who use any middlewares with aiohttp.web should upgrade to version 3.10.11 to receive a patch.

### Vulnerability Description Key Phrases
- **weakness:** **memory leak**
- **impact:** exhaust memory resources
- **vector:** MatchInfoError producing unique cache entry
- **attacker:** attacker
- **product:** aiohttp
- **version:** 3.10.6 to 3.10.11

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**Root Cause:**

- A memory leak occurs because the `_build_middlewares` function, which constructs middleware pipelines for requests, was being cached even when `MatchInfoError` was raised.
- The issue stems from the fact that `MatchInfoError` handlers are built dynamically for each request, creating a new unique cache entry for each error. This results in uncontrolled growth of the cache with each request that produces a `MatchInfoError`.

**Weaknesses/Vulnerabilities:**

- **Uncontrolled Resource Consumption (CWE-772):** The vulnerability is a memory leak, which falls under the category of uncontrolled resource consumption. The middleware cache grows indefinitely if the application has system routes that cause `MatchInfoError`

**Impact of Exploitation:**

- **Denial of Service (DoS):** An attacker can exhaust the memory resources of a server by sending a large number of requests that generate `MatchInfoError` responses. This can lead to a denial of service, making the server unavailable.

**Attack Vectors:**

- **Network Requests:** The attack vector is through sending HTTP requests that would result in the server returning a `MatchInfoError` response.

**Required Attacker Capabilities/Position:**

- The attacker needs to be able to send network requests to the vulnerable server.
- The attacker does not need any prior authentication or privileges

**Additional Details:**

- The vulnerability affects `aiohttp` versions `3.10.6` and later, but is fixed in `3.10.11`.
- The patch, commit `bc15db6`, addresses the vulnerability by not caching the middleware building for `SystemRoute` instances. This prevents the cache from growing indefinitely.
- The vulnerability is triggered when the user is making use of any middleware with `aiohttp.web`.
- The patch also includes a test case to prevent future regressions of the memory leak.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.581 |
| 3 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.557 |
| 4 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.557 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.549 |
| 6 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.542 |
| 7 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.540 |
| 8 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.539 |
| 9 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | dense | 0.364 |
| 10 | 476 | NULL Pointer Dereference | Base | Allowed | graph | 0.002 |

