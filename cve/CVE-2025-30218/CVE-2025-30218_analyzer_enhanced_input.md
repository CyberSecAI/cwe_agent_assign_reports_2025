## Vulnerability Description
Next.js is a React framework for building full-stack web applications. To mitigate CVE-2025-29927, Next.js validated the x-middleware-subrequest-id which persisted across multiple incoming requests. However, this subrequest ID is sent to all requests, even if the destination is not the same host as the Next.js application. Initiating a fetch request to a third-party within Middleware will send the x-middleware-subrequest-id to that third party. This vulnerability is fixed in 12.3.6, 13.5.10, 14.2.26, and 15.2.4.

### Vulnerability Description Key Phrases
- **rootcause:** **validated x-middleware-subrequest-id persisting across multiple incoming requests**
- **impact:** send subrequest ID to third party
- **product:** Next.js

## CVE Reference Links Content Summary
## CVE-2025-30218 - x-middleware-subrequest-id may be leaked to external hosts

**Root cause of vulnerability:**

The `x-middleware-subrequest-id` is sent to all requests, even those destined for hosts different from the Next.js application. This occurs because the subrequest ID is set globally and included in headers for all outgoing requests within Middleware.

**Weaknesses/vulnerabilities present:**

*   Information leakage: The `x-middleware-subrequest-id` can be exposed to third-party hosts when a fetch request is initiated to them within Middleware.

**Impact of exploitation:**

While exploitation is considered unlikely (requiring attacker control of the third-party), the vulnerability allows for potential information leakage.

**Attack vectors:**

*   A Next.js application using Middleware that makes fetch requests to external hosts.

**Required attacker capabilities/position:**

*   An attacker would need control over the third-party host to fully exploit the information leakage.

**Mitigation or fix:**

*   The vulnerability has been patched in Next.js versions 12.3.6, 13.5.10, 14.2.26, and 15.2.4.
*   Vercel customers are protected by mitigations implemented within their platform.
*   The recursion prevention logic that caused this issue is being removed from Middleware.

**Additional Details (more than official CVE description):**

*   The vulnerability was discovered during remediation of CVE-2025-29927.
*   The fix was expedited due to this discovery and a change to the LTS policy.
*   Credit is given to Jinseo Kim (kjsman) and RyotaK for responsible disclosure.
*   The issue is specific to Vercel's implementation of recursion protection and does not impact other infrastructure providers hosting Next.js applications.
*   The vulnerable code snippet is provided:

```
 const randomBytes = new Uint8Array(8)  crypto.getRandomValues(randomBytes)  const middlewareSubrequestId = Buffer.from(randomBytes).toString('hex')  ;(globalThis as any)[Symbol.for('@next/middleware-subrequest-id')] =    middlewareSubrequestId
```

```
 init.headers.set(    'x-middleware-subrequest-id',    (globalThis as any)[Symbol.for('@next/middleware-subrequest-id')]  )
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.544 |
| 2 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.523 |
| 3 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.514 |
| 4 | 319 | Cleartext Transmission of Sensitive Information | Base | Allowed | sparse | 0.501 |
| 5 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.500 |
| 6 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.499 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.497 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.496 |
| 9 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | dense | 0.445 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-1390: Weak Authentication

CWE-319: Cleartext Transmission of Sensitive Information

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-400: Uncontrolled Resource Consumption

CWE-863: Incorrect Authorization

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-918: Server-Side Request Forgery (SSRF)

CWE-226: Sensitive Information in Resource Not Removed Before Reuse