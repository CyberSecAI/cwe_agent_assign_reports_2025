# Vulnerability Description

    In the Linux kernel, the following vulnerability has been resolved net dsa mv88e6xxx fix -ENOENT when deleting VLANs and MST is unsupported Russell King reports that on the ZII dev rev B, deleting a bridge VLAN from a user port fails with -ENOENT https//lore.kernel.org/netdev/Z_lQXNP0s5-IiJzd@shell.armlinux.org.uk/ This comes from mv88e6xxx_port_vlan_leave() -> mv88e6xxx_mst_put(), which tries to find an MST entry in &chip->msts associated with the SID, but fails and returns -ENOENT as such. But we know that this chip does not support MST at all, so that is not surprising. The question is why does the guard in mv88e6xxx_mst_put() not exit early if (!sid) return 0 And the answer seems to be simple the sid comes from vlan.sid which supposedly was previously populated by mv88e6xxx_vtu_get(). But some chip->info->ops->vtu_getnext() implementations do not populate vlan.sid, for example see mv88e6185_g1_vtu_getnext(). In that case, later in mv88e6xxx_port_vlan_leave() we are using a **garbage sid** which is just residual stack memory. Testing for sid == 0 covers all cases of a non-bridge VLAN or a bridge VLAN mapped to the default MSTI. For some chips, SID 0 is valid and installed by mv88e6xxx_stu_setup(). A chip which does not support the STU would implicitly only support mapping all VLANs to the default MSTI, so although SID 0 is not valid, it would be sufficient, if we were to zero-initialize the vlan structure, to fix the bug, due to the coincidence that a test for vlan.sid == 0 already exists and leads to the same (correct) behavior. Another option which would be sufficient would be to add a test for mv88e6xxx_has_stu() inside mv88e6xxx_mst_put(), symmetric to the one which already exists in mv88e6xxx_mst_get(). But that placement means the caller will have to dereference vlan.sid, which means it will access **uninitialized memory**, which is not nice even if it ignores it later. So we end up making both modifications, in order to not rely just on the sid == 0 coincidence, but also to avoid having uninitialized structure fields which might get temporarily accessed.

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## ROOTCAUSE: 'uninitialized memory'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-476: NULL Pointer Dereference (Score: 1485.00)

The product dereferences a pointer that it expects to be valid but is NULL....

### 5. CWE-125: Out-of-bounds Read (Score: 1483.94)

The product reads data past the end, or before the beginning, of the intended buffer....

## ROOTCAUSE: 'garbage sid'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-923: Improper Restriction of Communication Channel to Intended Endpoints (Score: 1481.99)

The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....

### 5. CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer (Score: 1461.82)

The product stores, transfers, or shares a resource that contains sensitive information, but it does not properly remove that information before the product makes the resource available to unauthorized actors....

## WEAKNESS: 'uninitialized stack memory'

Relevant CWEs for this WEAKNESS:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-125: Out-of-bounds Read (Score: 1483.94)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-1284: Improper Validation of Specified Quantity in Input (Score: 1389.28)

The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....

## IMPACT: '-ENOENT when deleting VLANs'

Relevant CWEs for this IMPACT:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-923: Improper Restriction of Communication Channel to Intended Endpoints (Score: 1481.99)

The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....

### 5. CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer (Score: 1461.82)

The product stores, transfers, or shares a resource that contains sensitive information, but it does not properly remove that information before the product makes the resource available to unauthorized actors....

## PRODUCT: 'Linux kernel'

Relevant CWEs for this PRODUCT:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-125: Out-of-bounds Read (Score: 1483.94)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-923: Improper Restriction of Communication Channel to Intended Endpoints (Score: 1481.99)

The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....

## COMPONENT: 'net dsa mv88e6xxx'

Relevant CWEs for this COMPONENT:

### 1. CWE-824: Access of Uninitialized Pointer (Score: 1557.26)

The product accesses or uses a pointer that has not been initialized....

### 2. CWE-863: Incorrect Authorization (Score: 1535.91)

The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check....

### 3. CWE-909: Missing Initialization of Resource (Score: 1530.11)

The product does not initialize a critical resource....

### 4. CWE-125: Out-of-bounds Read (Score: 1483.94)

The product reads data past the end, or before the beginning, of the intended buffer....

### 5. CWE-923: Improper Restriction of Communication Channel to Intended Endpoints (Score: 1481.99)

The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    

# Complete CWE Specifications

CWE-824: Access of Uninitialized Pointer

CWE-863: Incorrect Authorization

CWE-909: Missing Initialization of Resource

CWE-476: NULL Pointer Dereference

CWE-125: Out-of-bounds Read

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer

CWE-1284: Improper Validation of Specified Quantity in Input