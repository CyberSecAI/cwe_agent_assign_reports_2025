## Vulnerability Description
Jellyfin is an open source self hosted media server. The Jellyfin user profile image upload accepts SVG files, allowing for a **stored XSS attack** against an admin user via a specially crafted malicious SVG file. When viewed by an admin outside of the Jellyfin Web UI (e.g. via view image in a browser), this malicious SVG file could interact with the browsers LocalStorage and retrieve an AccessToken, which in turn can be used in an API call to elevate the target user to a Jellyfin administrator. The actual attack vector is unlikely to be exploited, as it requires specific actions by the administrator to view the SVG image outside of Jellyfins WebUI, i.e. it is not a passive attack. The underlying exploit mechanism is solved by PR #12490, which forces attached images (including the potential malicious SVG) to be treated as attachments and thus downloaded by browsers, rather than viewed. This prevents exploitation of the LocalStorage of the browser. This PR has been merged and the relevant code changes are included in release version 10.9.10. All users are advised to upgrade.

### Vulnerability Description Key Phrases
- **weakness:** **stored XSS attack**
- **impact:** access the AccessToken
- **vector:** specially crafted malicious SVG file
- **attacker:** Jellyfin user
- **product:** Jellyfin
- **version:** before 10.9.10
- **component:** user profile image upload

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability described in CVE-2024-43801:

**Root Cause of Vulnerability:**

*   The Jellyfin user profile image upload functionality accepts SVG files without proper validation. This allows an attacker to upload a malicious SVG file containing JavaScript code.

**Weaknesses/Vulnerabilities Present:**

*   **Stored Cross-Site Scripting (XSS):** Malicious JavaScript code embedded within a crafted SVG file is stored on the server. When this SVG is viewed, the JavaScript executes.
*   **Insufficient Input Validation:** The server doesn't properly sanitize or validate SVG files, allowing for the inclusion of executable script tags.
*   **Insecure Storage of Access Tokens:** Access tokens are stored in the browser's `localStorage` instead of using secure HTTP-only cookies. This makes them accessible to client-side JavaScript.
*   **Lack of Proper Access Control for Privileged Actions**: Administrative actions, such as adding plugin repositories, installing plugins, or modifying user privileges, do not require additional re-authentication.

**Impact of Exploitation:**

*   **Privilege Escalation:** An attacker can exploit the XSS vulnerability to steal an administrator's access token. They can then use this token to elevate their own user account to administrator privileges.
*  **Arbitrary Code Execution:** By adding a malicious plugin repository and installing a malicious plugin, an attacker can achieve arbitrary code execution on the host server. This allows the attacker to execute operating system commands.
*   **Full System Compromise**: By achieving RCE the attacker effectively compromises the underlying system.

**Attack Vectors:**

*   **Malicious SVG Upload:** A low-privileged user uploads a specially crafted SVG file as their profile picture.
*   **Social Engineering/Direct Access:** An administrator views the malicious SVG file directly (e.g., by opening the image in a new browser tab or being sent the URL to it). This can be achieved by an attacker sending the URL to their profile picture to an administrator.
*   **XSS Execution:** When the administrator views the image, the embedded JavaScript executes.
*   **API Exploitation:** The attacker's JavaScript retrieves the admin's access token from `localStorage`. This token is then used to make API calls to escalate the low-privileged attacker user to admin status and install malicious plugins.

**Required Attacker Capabilities/Position:**

*   **Low-Privileged User Account:** The attacker needs a valid user account on the Jellyfin server to upload the malicious SVG.
*   **Administrator Interaction:** The attacker needs an administrator to view the malicious SVG file directly for the exploit to work.
*   **Network Access (for RCE):** For RCE, the attacker needs a web server where the malicious plugin manifest and DLL are hosted and accessible to the Jellyfin server.

**Additional Information:**

*   The vulnerability affects Jellyfin versions 10.8.0 and later up to 10.9.9.
*   The vulnerability is fixed in version 10.9.10 and later.
*   The fix implemented forces browsers to download the images rather than rendering them to prevent the XSS.
*   The exploit chain detailed in the blog goes beyond a simple stored XSS by adding in privilege escalation and RCE using a malicious plugin.
*   The blog post suggests best practice such as implementing `content-disposition: attachment` header, sanitizing SVG upon upload, implementing a content security policy, and requiring re-authentication for privileged functionality.

The provided content offers more technical details and a comprehensive explanation of the exploit chain than the typical CVE description would provide. It also includes a detailed timeline of the vulnerability discovery and disclosure process.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 611 | Improper Restriction of XML External Entity Reference | Base | Allowed | sparse | 0.978 |
| 3 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.970 |
| 4 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.930 |
| 5 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.915 |
| 6 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.890 |
| 7 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.885 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.884 |
| 9 | 82 | Improper Neutralization of Script in Attributes of IMG Tags in a Web Page | Variant | Allowed | dense | 0.503 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-611: Improper Restriction of XML External Entity Reference

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-23: Relative Path Traversal

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-522: Insufficiently Protected Credentials

CWE-863: Incorrect Authorization

CWE-82: Improper Neutralization of Script in Attributes of IMG Tags in a Web Page

CWE-184: Incomplete List of Disallowed Inputs