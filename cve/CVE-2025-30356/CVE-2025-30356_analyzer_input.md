# Vulnerability Information: CVE-2025-30356

## Vulnerability Description
CryptoLib provides a software-only solution using the CCSDS Space Data Link Security Protocol - Extended Procedures (SDLS-EP) to secure communications between a spacecraft running the core Flight System (cFS) and a ground station. In 1.3.3 and earlier, a **heap buffer overflow** vulnerability persists in the Crypto_TC_ApplySecurity function due to an **incomplete validation check** on the fl (frame length) field. Although CVE-2025-29912 addressed an underflow issue involving fl, the patch fails to fully prevent unsafe calculations. As a result, an attacker can still craft malicious frames that cause a negative tf_payload_len, which is then interpreted as a large unsigned value, leading to a **heap buffer overflow** in a memcpy call.

### Vulnerability Description Key Phrases
- **rootcause:** **incomplete validation check**
- **weakness:** **heap buffer overflow**
- **impact:** overflow
- **vector:** malicious frames
- **product:** CryptoLib
- **version:** 1.3.3 and earlier
- **component:** Crypto_TC_ApplySecurity function

## CVE Reference Links Content Summary
```
Root cause of vulnerability:
*   An incomplete validation check on the `fl` (frame length) field in the `Crypto_TC_ApplySecurity` function.
*   The existing check only verifies `fl <= constant`, which is insufficient to prevent an underflow in the `tf_payload_len` calculation.
*   The `tf_payload_len` calculation can result in a negative value, which, when cast to `uint16_t`, becomes a large positive value, leading to a heap buffer overflow.

Weaknesses/vulnerabilities present:
*   Heap buffer overflow (CWE-787)
*   Integer underflow (CWE-191)

Impact of exploitation:
*   Denial of Service (DoS) due to corrupted heap.
*   Potential Remote Code Execution (RCE) under certain memory layouts and protections.

Attack vectors:
*   Crafting malicious frames with a specific `fl` value.

Required attacker capabilities/position:
*   Ability to send crafted frames to the vulnerable function.

Mitigation or fix:
*   Replace the existing check with a safer version that validates the result of the `tf_payload_len` calculation.
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | alternate_terms | 0.800 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.638 |
| 4 | 193 | Off-by-one Error | Base | Allowed | sparse | 0.608 |
| 5 | 681 | Incorrect Conversion between Numeric Types | Base | Allowed | sparse | 0.603 |
| 6 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.592 |
| 7 | 191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | sparse | 0.587 |
| 8 | 126 | Buffer Over-read | Variant | Allowed | sparse | 0.584 |
| 9 | 122 | Heap-based Buffer Overflow | Variant | Allowed | dense | 0.586 |
| 10 | 1339 | Insufficient Precision or Accuracy of a Real Number | Base | Allowed | graph | 0.003 |

