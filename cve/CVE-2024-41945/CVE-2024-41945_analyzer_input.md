# Vulnerability Information: CVE-2024-41945

## Vulnerability Description
fuels-ts is a library for interacting with Fuel v2. The typescript SDK has no awareness of to-be-spent transactions causing some transactions to fail or silently get pruned as they are funded with already used UTXOs. The problem occurs, because the `fund` function in `fuels-ts/packages/account/src/account.ts` gets the needed ressources statelessly with the function `getResourcesToSpend` without taking into consideration already used UTXOs. This issue will lead to unexpected SDK behaviour, such as a transaction not getting included in the `txpool` / in a block or a previous transaction silently getting removed from the `txpool` and replaced with a new one.

### Vulnerability Description Key Phrases
- **rootcause:** **statelessness of fund function in fuels-ts**
- **weakness:** **does not consider already used UTXOs**
- **impact:** transaction failure or pruning
- **product:** Fuel v2 typescript SDK
- **component:** fund function in fuels-ts/packages/account/src/account.ts

## CVE Reference Links Content Summary
- **Root cause of vulnerability**: The `fund` function in the `fuels-ts/packages/account/src/account.ts` file retrieves UTXOs statelessly using `getResourcesToSpend` without considering already used UTXOs within the same block. This can lead to the same UTXO being used in multiple transactions within the same block.
- **Weaknesses/vulnerabilities present**: The primary weakness is the lack of state management for UTXOs used in pending transactions. The `getResourcesToSpend` function does not exclude UTXOs that have already been used in other transactions that have not yet been included in a block.
- **Impact of exploitation**: This can cause transactions to fail or be silently pruned from the transaction pool, resulting in unexpected SDK behavior. Specifically:
    - Transactions may not be included in the `txpool` or a block.
    - A previous transaction can be silently removed from the `txpool` and replaced by a new transaction using the same UTXO.
- **Attack vectors**: An attacker could exploit this vulnerability by submitting multiple transactions within the same block that rely on the same UTXO. This can be achieved through a series of rapid transaction submissions.
- **Required attacker capabilities/position**: The attacker needs to be able to submit multiple transactions to the Fuel network using the affected SDK version. No special privileges are required beyond being a regular user of the `fuels-ts` SDK. The attacker needs to be able to generate multiple transactions using the vulnerable `fund` function.

The provided content offers a detailed explanation of the vulnerability and includes a proof-of-concept (PoC). This information is more detailed than a standard CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 754 | Improper Check for Unusual or Exceptional Conditions | Class | Allowed-with-Review | sparse | 0.513 |
| 2 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.512 |
| 3 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.506 |
| 4 | 1321 | Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution') | Variant | Allowed | sparse | 0.502 |
| 5 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.496 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.493 |
| 7 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.484 |
| 8 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.484 |
| 9 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | dense | 0.350 |
| 10 | 476 | NULL Pointer Dereference | Base | Allowed | graph | 0.002 |

