# Raw Retriever Results for CVE-2024-42472

# Raw Retriever Results for CVE-2024-42472
## Query
Flatpak is a Linux application sandboxing and distribution framework. Prior to versions 1.14.0 and 1.15.10, a malicious or compromised Flatpak app using persistent directories could access and write files outside of what it would otherwise have access to, which is an attack on integrity and confidentiality. When `persistent=subdir` is used in the application permissions (represented as `--persist=subdir` in the command-line interface), that means that an application which otherwise doesnt have access to the real user home directory will see an empty home directory with a writeable subdirectory `subdir`. Behind the scenes, this directory is actually a bind mount and the data is stored in the per-application directory as `~/.var/app/$APPID/subdir`. This allows existing apps that are not aware of the per-application directory to still work as intended without general home directory access. However, the application does have write access to the application directory `~/.var/app/$APPID` where this directory is stored. If the source directory for the `persistent`/`--persist` option is replaced by a symlink, then the next time the application is started, the bind mount will follow the symlink and mount whatever it points to into the sandbox. Partial protection against this vulnerability can be provided by patching Flatpak using the patches in commits ceec2ffc and 98f79773. However, this leaves a race condition that could be exploited by two instances of a malicious app running i

## Keyphrases
- **rootcause**: 'race condition'
- **weakness**: 'symlink following'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.3798 | 0.4527 | 0.4051 | 0.3995 | 20 |
| Sparse | 405.2822 | 1340.2738 | 1102.3291 | 1240.7495 | 14 |
| Graph | 1.3600 | 2.8652 | 1.9202 | 1.7680 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 363 | Race Condition Enabling Link Following | base | 2.8652 | Allowed |
| 2 | 386 | Symbolic Name not Mapping to Correct Object | base | 2.7950 | Allowed |
| 3 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | base | 2.7742 | Allowed |
| 4 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | 2.5251 | Allowed |
| 5 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | 2.5106 | Allowed |
| 6 | 609 | Double-Checked Locking | base | 2.2100 | Allowed |
| 7 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | variant | 2.0856 | Allowed |
| 8 | 73 | External Control of File Name or Path | Base | 1.9315 | Allowed |
| 9 | 434 | Unrestricted Upload of File with Dangerous Type | base | 1.7680 | Allowed |
| 10 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 11 | 476 | NULL Pointer Dereference | base | 1.7680 | Allowed |
| 12 | 416 | Use After Free | variant | 1.6320 | Allowed |
| 13 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | class | 1.6016 | Allowed-with-Review |
| 14 | 99 | Improper Control of Resource Identifiers ('Resource Injection') | class | 1.5952 | Allowed-with-Review |
| 15 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | 1.5922 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 277 | Insecure Inherited Permissions | Variant | 0.4527 | 0.4527 | Allowed |
| 2 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | 0.4453 | 0.4453 | Allowed |
| 3 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | 0.4438 | 0.4438 | Allowed |
| 4 | 427 | Uncontrolled Search Path Element | Base | 0.4390 | 0.4390 | Allowed |
| 5 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | 0.4309 | 0.4309 | Allowed |
| 6 | 1386 | Insecure Operation on Windows Junction / Mount Point | Base | 0.4094 | 0.4094 | Allowed |
| 7 | 378 | Creation of Temporary File With Insecure Permissions | Base | 0.4079 | 0.4079 | Allowed |
| 8 | 184 | Incomplete List of Disallowed Inputs | Base | 0.4060 | 0.4060 | Allowed |
| 9 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | 0.4056 | 0.4056 | Allowed |
| 10 | 552 | Files or Directories Accessible to External Parties | Base | 0.4031 | 0.4031 | Allowed |
| 11 | 24 | Path Traversal: '../filedir' | Variant | 0.3960 | 0.3960 | Allowed |
| 12 | 36 | Absolute Path Traversal | Base | 0.3906 | 0.3906 | Allowed |
| 13 | 73 | External Control of File Name or Path | Base | 0.3874 | 0.3874 | Allowed |
| 14 | 26 | Path Traversal: '/dir/../filename' | Variant | 0.3868 | 0.3868 | Allowed |
| 15 | 526 | Cleartext Storage of Sensitive Information in an Environment Variable | Variant | 0.3861 | 0.3861 | Allowed |

## Sparse Retriever Results (14)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 1340.2738 | 1340.2738 | Allowed |
| 2 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | 1297.8222 | 1297.8222 | Allowed |
| 3 | 61 | UNIX Symbolic Link (Symlink) Following | 1296.4289 | 1296.4289 | Allowed |
| 4 | 59 | Improper Link Resolution Before File Access ('Link Following') | 1280.4556 | 1280.4556 | Allowed |
| 5 | 99 | Improper Control of Resource Identifiers ('Resource Injection') | 1269.6288 | 1269.6288 | Allowed-with-Review |
| 6 | 184 | Incomplete List of Disallowed Inputs | 1266.2066 | 1266.2066 | Allowed |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1242.3129 | 1242.3129 | Allowed-with-Review |
| 8 | 277 | Insecure Inherited Permissions | 1239.1860 | 1239.1860 | Allowed |
| 9 | 732 | Incorrect Permission Assignment for Critical Resource | 1230.0926 | 1230.0926 | Allowed-with-Review |
| 10 | 427 | Uncontrolled Search Path Element | 1218.7616 | 1218.7616 | Allowed |
| 11 | 23 | Relative Path Traversal | 1140.4118 | 1140.4118 | Allowed |
| 12 | 64 | Windows Shortcut Following (.LNK) | 800.0000 | 800.0000 | Allowed |
| 13 | 863 | Incorrect Authorization | 405.7444 | 405.7444 | Allowed-with-Review |
| 14 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | 405.2822 | 405.2822 | Allowed-with-Review |
