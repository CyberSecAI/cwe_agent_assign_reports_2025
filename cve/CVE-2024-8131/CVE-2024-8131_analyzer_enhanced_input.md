## Vulnerability Description
A vulnerability was found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240814 and classified as critical. Affected by this issue is the function module_enable_disable of the file /cgi-bin/apkg_mgr.cgi of the component HTTP POST Request Handler. The manipulation of the argument f_module_name leads to **command injection**. The attack may be launched remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** D-Link DNS-120 and DNR-202L and DNS-315L and DNS-320 and DNS-320L and DNS-320LW and DNS-321 and DNR-322L and DNS-323 and DNS-325 and DNS-326 and DNS-327L and DNR-326 and DNS-340L and DNS-343 and DNS-345 and DNS-726-4 and DNS-1100-4 and DNS-1200-05 and DNS-1550-04
- **version:** up to 20240814
- **component:** /cgi-bin/apkg_mgr.cgi

## CVE Reference Links Content Summary
```
{
  "vulnerability_details": [
    {
      "cve_id": "CVE-2024-8131",
      "description": "The DLINK nas DNS-320/320L/321/323/325/327L all firmware version has a command injection vulnerability in module\_enable\_disable function of the file /cgi-bin/apkg\_mgr.cgi. The variable f\_module\_name is passed from a POST request and is assigned to v4 via the snprintf function at line 49 and invoked by the system command, it can lead to command execution.",
      "root_cause": "The vulnerability exists due to improper handling of user-supplied input within the `module_enable_disable` function in the `/cgi-bin/apkg_mgr.cgi` script. Specifically, the `f_module_name` parameter from a POST request is incorporated into a command string without proper sanitization.",
      "weaknesses": [
        "Command Injection",
        "Insufficient Input Validation"
      ],
      "impact": "Successful exploitation allows an attacker to execute arbitrary system commands on the affected device.",
       "attack_vector": "The vulnerability is triggered via a crafted POST request to the `/cgi-bin/apkg_mgr.cgi` endpoint, specifically targeting the `module_enable_disable` function with a malicious payload in the `f_module_name` parameter.",
      "attacker_capabilities": "The attacker needs to be able to send HTTP POST requests to the affected device's web interface."
    }
  ],
    "affected_products": [
        "D-Link DNS-320",
        "D-Link DNS-320L",
        "D-Link DNS-321",
        "D-Link DNS-323",
        "D-Link DNS-325",
        "D-Link DNS-327L"
    ]
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.762 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.712 |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.698 |
| 6 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.696 |
| 7 | 341 | Predictable from Observable State | Base | Allowed | sparse | 0.687 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.681 |
| 9 | 121 | Stack-based Buffer Overflow | Variant | Allowed | dense | 0.646 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-346: Origin Validation Error

CWE-330: Use of Insufficiently Random Values

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-359: Exposure of Private Personal Information to an Unauthorized Actor

CWE-341: Predictable from Observable State

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-121: Stack-based Buffer Overflow

CWE-322: Key Exchange without Entity Authentication