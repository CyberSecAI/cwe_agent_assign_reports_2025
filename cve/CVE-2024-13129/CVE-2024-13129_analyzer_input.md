# Vulnerability Information: CVE-2024-13129

## Vulnerability Description
A vulnerability was found in Roxy-WI up to 8.1.3. It has been declared as critical. Affected by this vulnerability is the function action_service of the file app/modules/roxywi/roxy.py. The manipulation of the argument action/service leads to **os command injection**. The attack can be launched remotely. The exploit has been disclosed to the public and may be used. Upgrading to version 8.1.4 is able to address this issue. The identifier of the patch is 32313928eb9ce906887b8a30bf7b9a3d5c0de1be. It is recommended to upgrade the affected component.

### Vulnerability Description Key Phrases
- **weakness:** **os command injection**
- **product:** Roxy-WI
- **version:** up to 8.1.3
- **component:** action_service function in app/modules/roxywi/roxy.py

## CVE Reference Links Content Summary
Based on the provided content, here's the vulnerability information:

**Root cause of vulnerability:**
The vulnerability lies in the lack of proper sanitization of user-provided input in the `action_service` function within the `roxy.py` module. Specifically, the `service` parameter, which is taken from user input, is directly incorporated into a system command executed using `os.system`.

**Weaknesses/vulnerabilities present:**
- **OS Command Injection:** The most significant vulnerability is the OS command injection. Since the `service` parameter is not validated or sanitized, an attacker can inject arbitrary commands into the system.
- **Lack of input sanitization:** The code does not filter or validate the `service` parameter before using it in a system command.

**Impact of exploitation:**
- **Remote Code Execution:** Successful exploitation allows an attacker to execute arbitrary code on the server, potentially leading to complete system compromise, data breaches, and other malicious activities.

**Attack vectors:**
- The attack vector is through the `/tools/update/<service>` endpoint, where `<service>` is a parameter that the attacker controls.
- The service parameter is then passed to `action_service` function.

**Required attacker capabilities/position:**
- **Authentication:** The attacker needs to be authenticated as an admin on the Roxy-WI server.
- **Network access:** The attacker needs to be able to make requests to the server's web interface.

**Additional details:**
- The vulnerability is present in premium Roxy-WI servers.
- The provided PoC demonstrates how a simple `sleep` command can be injected via URL encoding to confirm the vulnerability.
- A fix was implemented that uses a regular expression to validate the `service` parameter in the `action_service` function.

```python
if not re.match(r'^[a-zA-Z0-9\.\-]+$', service):
    return f"Invalid service name: {service}. Only alphanumeric characters, dots, and hyphens are allowed."
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 0.800 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.629 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.621 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.547 |
| 6 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.522 |
| 7 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.519 |
| 8 | 99 | Improper Control of Resource Identifiers ('Resource Injection') | Class | Allowed-with-Review | sparse | 0.518 |
| 9 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | dense | 0.567 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

