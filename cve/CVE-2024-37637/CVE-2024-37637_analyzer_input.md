# Vulnerability Information: CVE-2024-37637

## Vulnerability Description
TOTOLINK A3700R V9.1.2u.6165_20211012 was discovered to contain a **stack overflow** via ssid5g in the function setWizardCfg.

### Vulnerability Description Key Phrases
- **weakness:** **stack overflow**
- **product:** TOTOLINK A3700R
- **version:** V9.1.2u.6165_20211012
- **component:** setWizardCfg function

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-787

#### Top CWEs
- CWE-787 (Count: 133)
- CWE-120 (Count: 8)

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-37637

**Root Cause:**
- The vulnerability lies in the `setWizardCfg` function of the TOTOLINK A3700R router's firmware.
- Specifically, the `urldecode` function is used to process user-supplied input from the `ssid5g` field.
- The processed output is then stored on the stack without proper bounds checking.

**Weaknesses/Vulnerabilities:**
- **Stack Buffer Overflow:** The lack of length validation before writing the `urldecode` output to the stack allows an attacker to overwrite adjacent memory regions on the stack.

**Impact of Exploitation:**
- **Program Hijacking:** By carefully crafting the input string, attackers can overwrite return addresses and other critical stack data, potentially gaining control of the program flow.
- **Denial of Service (DoS):** The stack overflow could also cause the application to crash, leading to a denial of service.

**Attack Vectors:**
- **HTTP POST Request:** The vulnerability can be exploited by sending a crafted HTTP POST request to `/cgi-bin/cstecgi.cgi`.
- **`ssid5g` Parameter:** The malicious payload is delivered via the `ssid5g` parameter within the POST request.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker needs to be able to send HTTP requests to the router's web interface, implying they need to have network access to the device, whether from the LAN or a vulnerable WAN interface.
- **No Authentication Required:** Based on the provided PoC, it appears this vulnerability might be exploitable without prior authentication

**Technical Details:**
- **Vulnerable Function:** `setWizardCfg`
- **Input Field:** `ssid5g`
- **Vulnerable Processing:** `urldecode` without bounds checking
- **Firmware Version:** TOTOLINK A3700R V9.1.2u.6165_20211012

**PoC:**

The provided PoC demonstrates the vulnerability with an oversized string for the `ssid5g` parameter within the HTTP POST request:

```
POST /cgi-bin/cstecgi.cgi HTTP/1.1

Host: 127.0.0.1

...

Content-Length: 539

...

{"topicurl":"setWizardCfg","ssid5g":"aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaae"}

```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 121 | Stack-based Buffer Overflow | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.126 |
| 4 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.114 |
| 5 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.111 |
| 6 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | sparse | 0.111 |
| 7 | 193 | Off-by-one Error | Base | Allowed | sparse | 0.106 |
| 8 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.103 |
| 9 | 259 | Use of Hard-coded Password | Variant | Allowed | dense | 0.587 |
| 10 | 128 | Wrap-around Error | Base | Allowed | graph | 0.002 |

