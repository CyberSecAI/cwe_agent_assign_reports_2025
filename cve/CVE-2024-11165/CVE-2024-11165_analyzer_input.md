# Vulnerability Information: CVE-2024-11165

## Vulnerability Description
An **information disclosure vulnerability** exists in the backup configuration process where the SAS token is not masked in the configuration response. This oversight results in sensitive information leakage within the yb_backup log files, exposing the SAS token in plaintext. The leakage occurs during the backup procedure, leading to potential unauthorized access to resources associated with the SAS token.This issue affects YugabyteDB Anywhere from 2.20.0.0 before 2.20.7.0, from 2.23.0.0 before 2.23.1.0, from 2024.1.0.0 before 2024.1.3.0.

### Vulnerability Description Key Phrases
- **weakness:** **information disclosure vulnerability**
- **impact:** expose SAS token in plaintext and information disclosure
- **product:** YugabyteDB Anywhere
- **version:** 2.20.0.0 before 2.20.7.0 and from 2.23.0.0 before 2.23.1.0 and from 2024.1.0.0 before 2024.1.3.0
- **component:** backup configuration process

## CVE Reference Links Content Summary
The provided content is related to a commit that addresses the masking of SAS tokens in backup configurations and logs, which is a security measure to prevent exposure of sensitive information. While not directly a CVE, it indicates a potential vulnerability that could have been exploited by revealing SAS tokens.

Here's a breakdown based on the provided commit:

**Root cause of vulnerability:**
- SAS tokens, which contain sensitive information including a signature (`sig` parameter), were being logged and exposed in backup responses and v1 backup logs without redaction.

**Weaknesses/vulnerabilities present:**
- Exposure of SAS tokens in logs and responses.
- Lack of redaction of sensitive query parameters in log outputs.
- Potentially exposing the `sig` parameter in the SAS token, which could be used to gain unauthorized access if intercepted.

**Impact of exploitation:**
- Unauthorized access to resources associated with the exposed SAS token.
- Potential compromise of backup data or other resources accessible using the token.

**Attack vectors:**
- Log files and backup responses containing the unredacted SAS token are the primary attack vector.
- An attacker with access to these logs/responses could potentially extract the SAS token.

**Required attacker capabilities/position:**
- The attacker needs access to the system where logs are stored or access to the backup responses.
- No specific privileged position is explicitly mentioned, but access to logs could be an indicator.

**Technical Details**
- The commit introduces a `RedactingService` with a list of `SECRET_QUERY_PARAMS_FOR_LOGS` that includes "sig", indicating that this specific parameter is considered sensitive.
- The `redactQueryParams` method in `RedactingService` is used to replace the value of sensitive parameters (e.g., sig) in a query string with a replacement value.
-  The `ShellProcessHandler` class is modified to use `redactQueryParams` on log output.
- `CommonUtils` class is updated to add `SAS_TOKEN` as a sensitive field.

This commit focuses on preventing the exposure of SAS tokens, which is a crucial aspect of securing cloud resources and their backups, even though it's not a fix for an exploited CVE.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | alternate_terms | 0.800 |
| 2 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.429 |
| 3 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.427 |
| 4 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.426 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.422 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.409 |
| 7 | 208 | Observable Timing Discrepancy | Base | Allowed | sparse | 0.409 |
| 8 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.409 |
| 9 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | dense | 0.559 |
| 10 | 613 | Insufficient Session Expiration | Base | Allowed | graph | 0.002 |

