# Vulnerability Information: CVE-2025-25186

## Vulnerability Description
NetIMAP implements Internet Message Access Protocol (IMAP) client functionality in Ruby. Starting in version 0.3.2 and prior to versions 0.3.8, 0.4.19, and 0.5.6, there is a possibility for denial of service by **memory exhaustion** in `net-imap`s response parser. At any time while the client is connected, a malicious server can send can send highly compressed `uid-set` data which is automatically read by the clients receiver thread. The response parser uses `Range#to_a` to convert the `uid-set` data into arrays of integers, with no limitation on the expanded size of the ranges. Versions 0.3.8, 0.4.19, 0.5.6, and higher fix this issue. Additional details for proper configuration of fixed versions and backward compatibility are available in the GitHub Security Advisory.

### Vulnerability Description Key Phrases
- **weakness:** **memory exhaustion**
- **impact:** denial of service
- **vector:** highly compressed uid-set data
- **attacker:** malicious server
- **product:** net-imap
- **version:** 0.3.2 to 0.3.8, 0.4.19, 0.5.6
- **component:** response parser

## CVE Reference Links Content Summary
Here's an analysis of the provided content related to CVE-2025-25186:

**Overall:** The content from multiple GitHub commits (`github.com_4cd5e39e_20250624_193547.html`, `github.com_60bedfa5_20250624_193542.html`, `github.com_dc9ced4d_20250624_193539.html`, and `github.com_fd654db6_20250624_193545.html`) contains information about a denial-of-service vulnerability in the `net-imap` Ruby library. This content directly relates to the vulnerability described in the CVE description.

**Relevant Content Extraction (Combined from multiple sources):**

*   **Root cause of vulnerability:** The vulnerability lies in the `net-imap`'s response parser, specifically when handling `uid-set` data within `APPENDUID` or `COPYUID` responses. The parser uses `Range#to_a` to convert the `uid-set` data into arrays of integers without limiting the size of the expanded ranges.
*   **Weaknesses/vulnerabilities present:** Denial of service (DoS) due to memory exhaustion. A malicious IMAP server can send specially crafted `APPENDUID` or `COPYUID` responses with very large `uid-set` ranges, causing the client to allocate excessive memory.
    *   CWE-400: Uncontrolled Resource Consumption
    *   CWE-405: Uncontrolled Consumption of Memory
    *   CWE-409: Missing Synchronization
    *   CWE-770: Allocation of excessive memory
    *   CWE-789: Use of unbound memory
    *   CWE-1287: Improper Input Validation
*   **Impact of exploitation:** Denial of service, specifically memory exhaustion, which can crash the client application. The exploit can be triggered even if the client doesn't handle `APPENDUID` or `COPYUID` responses directly.
*   **Attack vectors:**
    *   A malicious IMAP server sends a crafted `APPENDUID` or `COPYUID` response with a large `uid-set` range.
*   **Required attacker capabilities/position:** The attacker needs to control or compromise an IMAP server that the vulnerable client connects to.
*   **Mitigation or fix:**
    *   **Preferred Fix (minor API changes):** Upgrade to v0.4.19, v0.5.6, or higher, and configure the following in `net-imap`:
        ```ruby
        # globally
        Net::IMAP.config.parser_use_deprecated_uidplus_data = false
        # per-client
        imap = Net::IMAP.new(hostname, ssl: true,
                                   parser_use_deprecated_uidplus_data: false)
        imap.config.parser_use_deprecated_uidplus_data = false
        ```
        This replaces `UIDPlusData` with `AppendUIDData` and `CopyUIDData`.
    *   **Mitigation (backward compatible API):** Upgrade to v0.3.8, v0.4.19, v0.5.6, or higher.
        *   Assign `config.parser_max_deprecated_uidplus_data_size` to set the maximum `UIDPlusData` UID set size.
        *   When `config.parser_use_deprecated_uidplus_data == true`, larger sets will raise `Net::IMAP::ResponseParseError`.
        *   When `config.parser_use_deprecated_uidplus_data == :up_to_max_size`, larger sets will use `AppendUIDData` or `CopyUIDData`.
        *   For v0.3.8, this limit is *hard-coded* to 10,000, and larger sets will always raise `Net::IMAP::ResponseParseError`.
        *   For v0.4.19, the limit defaults to 1000.
        *   For v0.5.6, the limit defaults to 100.
        *   For v0.6.0, the limit will be ignored *(`UIDPlusData` will be removed from v0.6)*.
    *   **Please Note: unhandled responses:** If the client does not add response handlers to prune unhandled responses, a malicious server can still eventually exhaust all client memory, by repeatedly sending malicious responses. However, `net-imap` has always retained unhandled responses, and it has always been necessary for long-lived connections to prune these responses.
    *   The commits also include a Proof of Concept (PoC) that demonstrates the vulnerability.

**More Detail than Official CVE Description:** The provided content gives more detail than a typical CVE description by providing:

*   Specific code examples demonstrating the vulnerability and its exploitation.
*   Version-specific configuration options for mitigation.
*   A PoC to reproduce the vulnerability.
*   Detailed explanations of the internal workings and the specific functions involved.
*   CVSS v4 base metrics.
*   Specific weaknesses the vulnerability introduces.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.673 |
| 2 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.672 |
| 3 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.647 |
| 4 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.639 |
| 5 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.626 |
| 6 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.608 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.606 |
| 8 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.605 |
| 9 | 409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | Allowed | dense | 0.408 |
| 10 | 476 | NULL Pointer Dereference | Base | Allowed | graph | 0.002 |

