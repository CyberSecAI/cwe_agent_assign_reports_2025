# Vulnerability Information: CVE-2024-7715

## Vulnerability Description
** UNSUPPORTED WHEN ASSIGNED ** A vulnerability was found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240812. It has been classified as critical. This affects the function sprintf of the file /cgi-bin/photocenter_mgr.cgi. The manipulation of the argument filter leads to **command injection**. It is possible to initiate the attack remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **vector:** manipulation of the argument filter
- **product:** D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04
- **version:** up to 20240812
- **component:** /cgi-bin/photocenter_mgr.cgi

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**Root Cause of Vulnerability:**
- The vulnerability lies in the `cgi_photo_search` function within the `/cgi-bin/photocenter_mgr.cgi` file of D-Link NAS devices (DNS-320/320L/321/323/325/327L).
- The `filter` variable, received via a POST request, is passed to the `sprintf` function without proper sanitization.
- The output of `sprintf` is then passed to the `system` command, leading to command injection.
- The `SpecSymbol2BackSlash` function, intended to prevent command injection, does not function correctly.

**Weaknesses/Vulnerabilities Present:**
- Command Injection: The primary vulnerability is the ability to inject arbitrary system commands through the `filter` variable.
- Insufficient Input Sanitization: The `filter` variable is not properly sanitized before being passed to `sprintf` and subsequently the `system` command.
- Non-Functional Protection Mechanism: The `SpecSymbol2BackSlash` function fails to prevent command injection.

**Impact of Exploitation:**
- Arbitrary Command Execution: Successful exploitation allows an attacker to execute arbitrary system commands on the affected D-Link NAS device.
- Complete System Compromise: This could potentially lead to complete compromise of the device and the data stored on it.

**Attack Vectors:**
- Network-based attack: The vulnerability is exploitable via a POST request to the vulnerable CGI script (`/cgi-bin/photocenter_mgr.cgi`).
- Web Interface: The vulnerable function is accessible through the web interface of the NAS device.

**Required Attacker Capabilities/Position:**
- Network Access: The attacker needs to be able to send a POST request to the NAS device, implying they must be on the same network or have access to the device through the network.
- Knowledge of the vulnerable endpoint: The attacker must know that the `/cgi-bin/photocenter_mgr.cgi` endpoint and the POST parameter 'filter' are vulnerable.
- No Authentication Required: The provided information does not explicitly state if authentication is required to exploit this vulnerability, however it is common for these devices to be vulnerable to unauthenticated command injection.

**Additional Details:**
- The vulnerability affects multiple D-Link NAS models (DNS-320, DNS-320L, DNS-321, DNS-323, DNS-325, DNS-327L) with firmware version <= v1.1.
- The vulnerability was reported by BuaaIOTTeam.
- The issue resides in the `sprintf` function and the usage of the `system` command without proper sanitization.
- D-Link recommends that devices that have reached End of Life (EOL)/End of Service Life (EOS) should be retired and replaced.
- The D-Link advisory references CVE-2024-3272 and CVE-2024-3273, which are also related to command injection vulnerabilities in D-Link NAS devices. The D-Link advisory lists that this is one of three reports about similar vulnerabilities.
- The advisory notes that "all firmware development for these products cease", meaning a patch for this vulnerability is highly unlikely.

The information provided gives more details than a standard CVE description which is just a placeholder for now.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.734 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.705 |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.681 |
| 6 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.671 |
| 7 | 350 | Reliance on Reverse DNS Resolution for a Security-Critical Action | Variant | Allowed | sparse | 0.670 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.668 |
| 9 | 121 | Stack-based Buffer Overflow | Variant | Allowed | dense | 0.658 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |

