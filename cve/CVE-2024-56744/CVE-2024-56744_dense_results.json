{
  "query": "In the Linux kernel, the following vulnerability has been resolved f2fs fix to avoid potential deadlock in f2fs_record_stop_reason() syzbot reports deadlock issue of f2fs as below ====================================================== WARNING possible circular locking dependency detected 6.12.0-rc3-syzkaller-00087-gc964ced77262 #0 Not tainted ------------------------------------------------------ kswapd0/79 is trying to acquire lock ffff888011824088 (&sbi->sb_lock){++++}-{33}, at f2fs_down_write fs/f2fs/f2fs.h2199 [inline] ffff888011824088 (&sbi->sb_lock){++++}-{33}, at f2fs_record_stop_reason+0x52/0x1d0 fs/f2fs/super.c4068 but task is already holding lock ffff88804bd92610 (sb_internal#2){.+.+}-{00}, at f2fs_evict_inode+0x662/0x15c0 fs/f2fs/inode.c842 which lock already depends on the new lock. the existing dependency chain (in reverse order) is -> #2 (sb_internal#2){.+.+}-{00} lock_acquire+0x1ed/0x550 kernel/locking/lockdep.c5825 percpu_down_read include/linux/percpu-rwsem.h51 [inline] __sb_start_write include/linux/fs.h1716 [inline] sb_start_intwrite+0x4d/0x1c0 include/linux/fs.h1899 f2fs_evict_inode+0x662/0x15c0 fs/f2fs/inode.c842 evict+0x4e8/0x9b0 fs/inode.c725 f2fs_evict_inode+0x1a4/0x15c0 fs/f2fs/inode.c807 evict+0x4e8/0x9b0 fs/inode.c725 dispose_list fs/inode.c774 [inline] prune_icache_sb+0x239/0x2f0 fs/inode.c963 super_cache_scan+0x38c/0x4b0 fs/super.c223 do_shrink_slab+0x701/0x1160 mm/shrinker.c435 shrink_slab+0x1093/0x14d0 mm/shrinker.c662 shrink_one+0x43b/0x850 mm/vmscan.c4818 shrink_many mm/vmscan.c4879 [inline] lru_gen_shrink_node mm/vmscan.c4957 [inline] shrink_node+0x3799/0x3de0 mm/vmscan.c5937 kswapd_shrink_node mm/vmscan.c6765 [inline] balance_pgdat mm/vmscan.c6957 [inline] kswapd+0x1ca3/0x3700 mm/vmscan.c7226 kthread+0x2f0/0x390 kernel/kthread.c389 ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c147 ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S244 -> #1 (fs_reclaim){+.+.}-{00} lock_acquire+0x1ed/0x550 kernel/locking/lockdep.c5825 __fs_reclaim_acquire mm/page_alloc.c3834 [inline] fs_reclaim_acquire+0x88/0x130 mm/page_alloc.c3848 might_alloc include/linux/sched/mm.h318 [inline] prepare_alloc_pages+0x147/0x5b0 mm/page_alloc.c4493 __alloc_pages_noprof+0x16f/0x710 mm/page_alloc.c4722 alloc_pages_mpol_noprof+0x3e8/0x680 mm/mempolicy.c2265 alloc_pages_noprof mm/mempolicy.c2345 [inline] folio_alloc_noprof+0x128/0x180 mm/mempolicy.c2352 filemap_alloc_folio_noprof+0xdf/0x500 mm/filemap.c1010 do_read_cache_folio+0x2eb/0x850 mm/filemap.c3787 read_mapping_folio include/linux/pagemap.h1011 [inline] f2fs_commit_super+0x3c0/0x7d0 fs/f2fs/super.c4032 f2fs_record_stop_reason+0x13b/0x1d0 fs/f2fs/super.c4079 f2fs_handle_critical_error+0x2ac/0x5c0 fs/f2fs/super.c4174 f2fs_write_inode+0x35f/0x4d0 fs/f2fs/inode.c785 write_inode fs/fs-writeback.c1503 [inline] __writeback_single_inode+0x711/0x10d0 fs/fs-writeback.c1723 writeback_single_inode+0x1f3/0x660 fs/fs-writeback.c1779 sync_inode_metadata+0xc4/0x120 fs/fs-writeback.c2849 f2fs_release_file+0xa8/0x100 fs/f2fs/file.c1941 __fput+0x23f/0x880 fs/file_table.c431 task_work_run+0x24f/0x310 kernel/task_work.c228 resume_user_mode_work include/linux/resume_user_mode.h50 [inline] exit_to_user_mode_loop kernel/entry/common.c114 [inline] exit_to_user_mode_prepare include/linux/entry-common.h328 [inline] __syscall_exit_to_user_mode_work kernel/entry/common.c207 [inline] syscall_exit_to_user_mode+0x168/0x370 kernel/entry/common.c218 do_syscall_64+0x100/0x230 arch/x86/entry/common.c89 entry_SYSCALL_64_after_hwframe+0x77/0x7f ---truncated---",
  "count": 20,
  "results": [
    {
      "cwe_id": "833",
      "name": "Deadlock",
      "abstraction": "Base",
      "score": 0.5962838812060179,
      "original_score": 0.5962838812060179,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "667",
      "name": "Improper Locking",
      "abstraction": "Class",
      "score": 0.595183244980609,
      "original_score": 0.595183244980609,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "abstraction": "Class",
      "score": 0.578603998153264,
      "original_score": 0.578603998153264,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "909",
      "name": "Missing Initialization of Resource",
      "abstraction": "Class",
      "score": 0.5487051140123889,
      "original_score": 0.5487051140123889,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "1285",
      "name": "Improper Validation of Specified Index, Position, or Offset in Input",
      "abstraction": "Base",
      "score": 0.538943624379518,
      "original_score": 0.538943624379518,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "367",
      "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
      "abstraction": "Base",
      "score": 0.534531036388254,
      "original_score": 0.534531036388254,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "416",
      "name": "Use After Free",
      "abstraction": "Variant",
      "score": 0.5330034716761809,
      "original_score": 0.5330034716761809,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "908",
      "name": "Use of Uninitialized Resource",
      "abstraction": "Base",
      "score": 0.5291885155099877,
      "original_score": 0.5291885155099877,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "190",
      "name": "Integer Overflow or Wraparound",
      "abstraction": "Base",
      "score": 0.5286337402114625,
      "original_score": 0.5286337402114625,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "835",
      "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
      "abstraction": "Base",
      "score": 0.5284324091898994,
      "original_score": 0.5284324091898994,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "191",
      "name": "Integer Underflow (Wrap or Wraparound)",
      "abstraction": "Base",
      "score": 0.5263434796952681,
      "original_score": 0.5263434796952681,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "366",
      "name": "Race Condition within a Thread",
      "abstraction": "Base",
      "score": 0.5250448801081685,
      "original_score": 0.5250448801081685,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "911",
      "name": "Improper Update of Reference Count",
      "abstraction": "Base",
      "score": 0.5249816474089369,
      "original_score": 0.5249816474089369,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "119",
      "name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
      "abstraction": "Class",
      "score": 0.5207612513889344,
      "original_score": 0.5207612513889344,
      "mapping_usage": "Discouraged"
    },
    {
      "cwe_id": "126",
      "name": "Buffer Over-read",
      "abstraction": "Variant",
      "score": 0.5206063055686577,
      "original_score": 0.5206063055686577,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1284",
      "name": "Improper Validation of Specified Quantity in Input",
      "abstraction": "Base",
      "score": 0.5187028419866668,
      "original_score": 0.5187028419866668,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "122",
      "name": "Heap-based Buffer Overflow",
      "abstraction": "Variant",
      "score": 0.5184404449881207,
      "original_score": 0.5184404449881207,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "476",
      "name": "NULL Pointer Dereference",
      "abstraction": "Base",
      "score": 0.5175189573374832,
      "original_score": 0.5175189573374832,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "125",
      "name": "Out-of-bounds Read",
      "abstraction": "Base",
      "score": 0.5172716614145079,
      "original_score": 0.5172716614145079,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "131",
      "name": "Incorrect Calculation of Buffer Size",
      "abstraction": "Base",
      "score": 0.5170284063395478,
      "original_score": 0.5170284063395478,
      "mapping_usage": "Allowed"
    }
  ],
  "statistics": {
    "min": 0.5170284063395478,
    "max": 0.5962838812060179,
    "mean": 0.5359104455971937,
    "median": 0.5273879444425837,
    "count": 20
  }
}