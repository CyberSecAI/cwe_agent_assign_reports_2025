# Raw Retriever Results for CVE-2025-22030

# Raw Retriever Results for CVE-2025-22030
## Query
In the Linux kernel, the following vulnerability has been resolved mm zswap fix crypto_free_acomp() deadlock in zswap_cpu_comp_dead() Currently, zswap_cpu_comp_dead() calls crypto_free_acomp() while holding the per-CPU acomp_ctx mutex. crypto_free_acomp() then holds scomp_lock (through crypto_exit_scomp_ops_async()). On the other hand, crypto_alloc_acomp_node() holds the scomp_lock (through crypto_scomp_init_tfm()), and then allocates memory. If the allocation results in reclaim, we may attempt to hold the per-CPU acomp_ctx mutex. The above dependencies can cause an ABBA deadlock. For example in the following scenario (1) Task A running on CPU #1 crypto_alloc_acomp_node() Holds scomp_lock Enters reclaim Reads per_cpu_ptr(pool->acomp_ctx, 1) (2) Task A is descheduled (3) CPU #1 goes offline zswap_cpu_comp_dead(CPU #1) Holds per_cpu_ptr(pool->acomp_ctx, 1)) Calls crypto_free_acomp() Waits for scomp_lock (4) Task A running on CPU #2 Waits for per_cpu_ptr(pool->acomp_ctx, 1) // Read on CPU #1 DEADLOCK Since there is no requirement to call crypto_free_acomp() with the per-CPU acomp_ctx mutex held in zswap_cpu_comp_dead(), move it after the mutex is unlocked. Also move the acomp_request_free() and kfree() calls for consistency and to avoid any potential sublte locking dependencies in the future. With this, only setting acomp_ctx fields to NULL occurs with the mutex held. This is similar to how zswap_cpu_comp_prepare() only initializes acomp_ctx fields with the mutex held, after performing all allocations before holding the mutex. Opportunistically, move the NULL check on acomp_ctx so that it takes place before the mutex dereference.

## Keyphrases
- **rootcause**: 'lock ordering dependency'
- **weakness**: 'deadlock'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4145 | 0.5147 | 0.4380 | 0.4322 | 20 |
| Sparse | 809.0299 | 1164.7295 | 914.7883 | 880.1960 | 11 |
| Graph | 1.7096 | 2.4232 | 2.0619 | 2.2100 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 2.4232 | Allowed-with-Review |
| 2 | 123 | Write-what-where Condition | base | 2.4232 | Allowed |
| 3 | 125 | Out-of-bounds Read | base | 2.2568 | Allowed |
| 4 | 1257 | Improper Access Control Applied to Mirrored or Aliased Memory Regions | base | 2.2100 | Allowed |
| 5 | 1322 | Use of Blocking Code in Single-threaded, Non-blocking Context | base | 2.2100 | Allowed |
| 6 | 1339 | Insufficient Precision or Accuracy of a Real Number | base | 2.2100 | Allowed |
| 7 | 190 | Integer Overflow or Wraparound | base | 2.2100 | Allowed |
| 8 | 128 | Wrap-around Error | base | 2.2100 | Allowed |
| 9 | 193 | Off-by-one Error | base | 2.2100 | Allowed |
| 10 | 839 | Numeric Range Comparison Without Minimum Check | base | 2.2100 | Allowed |
| 11 | 843 | Access of Resource Using Incompatible Type ('Type Confusion') | base | 2.2100 | Allowed |
| 12 | 129 | Improper Validation of Array Index | variant | 2.0400 | Allowed |
| 13 | 195 | Signed to Unsigned Conversion Error | variant | 2.0400 | Allowed |
| 14 | 823 | Use of Out-of-range Pointer Offset | base | 1.8382 | Allowed |
| 15 | 170 | Improper Null Termination | base | 1.7680 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 833 | Deadlock | Base | 0.5147 | 0.5147 | Allowed |
| 2 | 667 | Improper Locking | Class | 0.4911 | 0.4911 | Allowed-with-Review |
| 3 | 1252 | CPU Hardware Not Configured to Support Exclusivity of Write and Execute Operations | Base | 0.4616 | 0.4616 | Allowed |
| 4 | 909 | Missing Initialization of Resource | Class | 0.4531 | 0.4531 | Allowed-with-Review |
| 5 | 1264 | Hardware Logic with Insecure De-Synchronization between Control and Data Channels | Base | 0.4467 | 0.4467 | Allowed |
| 6 | 413 | Improper Resource Locking | Base | 0.4459 | 0.4459 | Allowed |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.4432 | 0.4432 | Allowed-with-Review |
| 8 | 765 | Multiple Unlocks of a Critical Resource | Base | 0.4347 | 0.4347 | Allowed |
| 9 | 366 | Race Condition within a Thread | Base | 0.4341 | 0.4341 | Allowed |
| 10 | 409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | 0.4331 | 0.4331 | Allowed |
| 11 | 1281 | Sequence of Processor Instructions Leads to Unexpected Behavior | Base | 0.4312 | 0.4312 | Allowed |
| 12 | 1037 | Processor Optimization Removal or Modification of Security-critical Code | Base | 0.4273 | 0.4273 | Allowed |
| 13 | 1260 | Improper Handling of Overlap Between Protected Memory Ranges | Base | 0.4210 | 0.4210 | Allowed |
| 14 | 832 | Unlock of a Resource that is not Locked | Base | 0.4196 | 0.4196 | Allowed |
| 15 | 662 | Improper Synchronization | Class | 0.4195 | 0.4195 | Discouraged |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 667 | Improper Locking | 1164.7295 | 1164.7295 | Allowed-with-Review |
| 2 | 833 | Deadlock | 1039.2035 | 1039.2035 | Allowed |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 907.0818 | 907.0818 | Allowed-with-Review |
| 4 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | 893.8036 | 893.8036 | Discouraged |
| 5 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | 889.0237 | 889.0237 | Allowed |
| 6 | 400 | Uncontrolled Resource Consumption | 880.1960 | 880.1960 | Discouraged |
| 7 | 407 | Inefficient Algorithmic Complexity | 875.4714 | 875.4714 | Allowed-with-Review |
| 8 | 125 | Out-of-bounds Read | 869.1987 | 869.1987 | Allowed |
| 9 | 1284 | Improper Validation of Specified Quantity in Input | 867.5636 | 867.5636 | Allowed |
| 10 | 770 | Allocation of Resources Without Limits or Throttling | 867.3696 | 867.3696 | Allowed |
| 11 | 662 | Improper Synchronization | 809.0299 | 809.0299 | Discouraged |
