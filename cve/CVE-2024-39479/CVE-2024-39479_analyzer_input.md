# Vulnerability Information: CVE-2024-39479

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved drm/i915/hwmon Get rid of devm When both hwmon and hwmon drvdata (on which hwmon depends) are device managed resources, the expectation, on device unbind, is that hwmon will be released before drvdata. However, in i915 there are two separate code paths, which both release either drvdata or hwmon and either can be released before the other. These code paths (for device unbind) are as follows (see also the bug referenced below) Call Trace release_nodes+0x11/0x70 devres_release_group+0xb2/0x110 component_unbind_all+0x8d/0xa0 component_del+0xa5/0x140 intel_pxp_tee_component_fini+0x29/0x40 [i915] intel_pxp_fini+0x33/0x80 [i915] i915_driver_remove+0x4c/0x120 [i915] i915_pci_remove+0x19/0x30 [i915] pci_device_remove+0x32/0xa0 device_release_driver_internal+0x19c/0x200 unbind_store+0x9c/0xb0 and Call Trace release_nodes+0x11/0x70 devres_release_all+0x8a/0xc0 device_unbind_cleanup+0x9/0x70 device_release_driver_internal+0x1c1/0x200 unbind_store+0x9c/0xb0 This means that in i915, if use devm, we cannot gurantee that hwmon will always be released before drvdata. Which means that we have a uaf if hwmon sysfs is accessed when drvdata has been released but hwmon hasnt. The only way out of this seems to be do get rid of devm_ and release/free everything explicitly during device unbind. v2 Change commit message and other minor code changes v3 Cleanup from i915_hwmon_register on error (Armin Wolf) v4 Eliminate

### Vulnerability Description Key Phrases
- **weakness:** **Use-After-Free**
- **impact:** information disclosure
- **product:** Linux kernel
- **component:** drm/i915/hwmon

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-39479.

**Root cause of vulnerability:**
The vulnerability stems from a use-after-free (UAF) condition in the Intel i915 graphics driver's hardware monitoring (hwmon) subsystem. This occurs because the hwmon and its associated driver data (drvdata) are both device-managed resources, but the order in which they are released during device unbind is not guaranteed. Two separate code paths can release either drvdata or hwmon first, leading to a scenario where hwmon sysfs is accessed after drvdata has been released, resulting in a UAF.

**Weaknesses/vulnerabilities present:**
- Use-after-free (UAF): The core vulnerability is a UAF that arises when the hwmon sysfs interface is accessed after the underlying drvdata has been freed.
- Race condition on resource release: The issue occurs during device unbind, where two separate code paths can potentially release the driver's resources in the wrong order. This race condition leads to the UAF.

**Impact of exploitation:**
- A successful exploitation could lead to a system crash, denial of service, or potentially arbitrary code execution.

**Attack vectors:**
- The vulnerability is triggered during the device unbind process, specifically in the i915 graphics driver. An attacker could exploit this by triggering device unbind through various mechanisms, like unloading and reloading the driver.
- The access of hwmon sysfs after drvdata has been released is the key to triggering the vulnerability

**Required attacker capabilities/position:**
- An attacker would need the ability to trigger the device unbind process of an i915 graphics device and access the hwmon sysfs interface.
- This typically requires root privileges or the ability to interact with device driver interfaces, making it a local privilege escalation vulnerability.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 416 | Use After Free | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.680 |
| 3 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.665 |
| 4 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.663 |
| 5 | 415 | Double Free | Variant | Allowed | sparse | 0.660 |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.652 |
| 7 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.652 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.646 |
| 9 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | dense | 0.478 |
| 10 | 123 | Write-what-where Condition | Base | Allowed | graph | 0.003 |

