{
  "query": "In the Linux kernel, the following vulnerability has been resolved Bluetooth iso Fix circular lock in iso_conn_big_sync This fixes the circular locking dependency warning below, by reworking iso_sock_recvmsg, to ensure that the socket lock is always released before calling a function that locks hdev. [ 561.670344] ====================================================== [ 561.670346] WARNING possible circular locking dependency detected [ 561.670349] 6.12.0-rc6+ #26 Not tainted [ 561.670351] ------------------------------------------------------ [ 561.670353] iso-tester/3289 is trying to acquire lock [ 561.670355] ffff88811f600078 (&hdev->lock){+.+.}-{33}, at iso_conn_big_sync+0x73/0x260 [bluetooth] [ 561.670405] but task is already holding lock [ 561.670407] ffff88815af58258 (sk_lock-AF_BLUETOOTH){+.+.}-{00}, at iso_sock_recvmsg+0xbf/0x500 [bluetooth] [ 561.670450] which lock already depends on the new lock. [ 561.670452] the existing dependency chain (in reverse order) is [ 561.670453] -> #2 (sk_lock-AF_BLUETOOTH){+.+.}-{00} [ 561.670458] lock_acquire+0x7c/0xc0 [ 561.670463] lock_sock_nested+0x3b/0xf0 [ 561.670467] bt_accept_dequeue+0x1a5/0x4d0 [bluetooth] [ 561.670510] iso_sock_accept+0x271/0x830 [bluetooth] [ 561.670547] do_accept+0x3dd/0x610 [ 561.670550] __sys_accept4+0xd8/0x170 [ 561.670553] __x64_sys_accept+0x74/0xc0 [ 561.670556] x64_sys_call+0x17d6/0x25f0 [ 561.670559] do_syscall_64+0x87/0x150 [ 561.670563] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670567] -> #1 (sk_lock-AF_BLUETOOTH-BTPROTO_ISO){+.+.}-{00} [ 561.670571] lock_acquire+0x7c/0xc0 [ 561.670574] lock_sock_nested+0x3b/0xf0 [ 561.670577] iso_sock_listen+0x2de/0xf30 [bluetooth] [ 561.670617] __sys_listen_socket+0xef/0x130 [ 561.670620] __x64_sys_listen+0xe1/0x190 [ 561.670623] x64_sys_call+0x2517/0x25f0 [ 561.670626] do_syscall_64+0x87/0x150 [ 561.670629] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670632] -> #0 (&hdev->lock){+.+.}-{33} [ 561.670636] __lock_acquire+0x32ad/0x6ab0 [ 561.670639] lock_acquire.part.0+0x118/0x360 [ 561.670642] lock_acquire+0x7c/0xc0 [ 561.670644] __mutex_lock+0x18d/0x12f0 [ 561.670647] mutex_lock_nested+0x1b/0x30 [ 561.670651] iso_conn_big_sync+0x73/0x260 [bluetooth] [ 561.670687] iso_sock_recvmsg+0x3e9/0x500 [bluetooth] [ 561.670722] sock_recvmsg+0x1d5/0x240 [ 561.670725] sock_read_iter+0x27d/0x470 [ 561.670727] vfs_read+0x9a0/0xd30 [ 561.670731] ksys_read+0x1a8/0x250 [ 561.670733] __x64_sys_read+0x72/0xc0 [ 561.670736] x64_sys_call+0x1b12/0x25f0 [ 561.670738] do_syscall_64+0x87/0x150 [ 561.670741] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670744] other info that might help us debug this [ 561.670745] Chain exists of &hdev->lock --> sk_lock-AF_BLUETOOTH-BTPROTO_ISO --> sk_lock-AF_BLUETOOTH [ 561.670751] Possible unsafe locking scenario [ 561.670753] CPU0 CPU1 [ 561.670754] ---- ---- [ 561.670756] lock(sk_lock-AF_BLUETOOTH) [ 561.670758] lock(sk_lock AF_BLUETOOTH-BTPROTO_ISO) [ 561.670761] lock(sk_lock-AF_BLUETOOTH) [ 561.670764] lock(&hdev->lock) [ 561.670767] *** DEADLOCK ***",
  "keyphrases": {
    "rootcause": [
      "circular locking dependency"
    ]
  },
  "timestamp": "2025-07-13T22:33:31.502905",
  "retriever_config": {
    "weights": {
      "dense": 0.35,
      "sparse": 0.4,
      "graph": 0.25
    },
    "use_graph": true,
    "use_rag": true,
    "use_sparse": true
  },
  "raw_results": {
    "graph": [
      {
        "cwe_id": "561",
        "name": "Dead Code",
        "abstraction": "base",
        "score": 4.329000000000001,
        "description": "CWE-561: Dead Code...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "571",
        "name": "Expression is Always True",
        "abstraction": "base",
        "score": 4.329000000000001,
        "description": "CWE-571: Expression is Always True...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "570",
        "name": "Expression is Always False",
        "abstraction": "base",
        "score": 4.329000000000001,
        "description": "CWE-570: Expression is Always False...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "120",
        "name": "Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "123",
        "name": "Write-what-where Condition",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-123: Write-what-where Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "364",
        "name": "Signal Handler Race Condition",
        "abstraction": "base",
        "score": 1.7550000000000001,
        "description": "CWE-364: Signal Handler Race Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 1.717545198346004,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 1.7101880621965286,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1325",
        "name": "Improperly Controlled Sequential Memory Allocation",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-1325: Improperly Controlled Sequential Memory Allocation...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1265",
        "name": "Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-1265: Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "386",
        "name": "Symbolic Name not Mapping to Correct Object",
        "abstraction": "base",
        "score": 1.6744000000000003,
        "description": "CWE-386: Symbolic Name not Mapping to Correct Object...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "662",
        "name": "Improper Synchronization",
        "abstraction": "class",
        "score": 1.6736000000000002,
        "description": "CWE-662: Improper Synchronization...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 1.6172692258869223,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "abstraction": "compound",
        "score": 1.61,
        "description": "CWE-61: UNIX Symbolic Link (Symlink) Following...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "476",
        "name": "NULL Pointer Dereference",
        "abstraction": "Base",
        "score": 1.5324600874073204,
        "description": "The product dereferences a pointer that it expects to be valid but is NULL....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "129",
        "name": "Improper Validation of Array Index",
        "abstraction": "variant",
        "score": 1.51536,
        "description": "CWE-129: Improper Validation of Array Index...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "416",
        "name": "Use After Free",
        "abstraction": "Variant",
        "score": 1.430759789837363,
        "description": "The product reuses or references memory after it has been freed. At some point afterward, the memory may be allocated again and saved in another pointer, while the original pointer references a locati...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1164",
        "name": "Irrelevant Code",
        "abstraction": "class",
        "score": 1.4080000000000001,
        "description": "CWE-1164: Irrelevant Code...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "705",
        "name": "Incorrect Control Flow Scoping",
        "abstraction": "class",
        "score": 1.3648,
        "description": "CWE-705: Incorrect Control Flow Scoping...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "170",
        "name": "Improper Null Termination",
        "abstraction": "base",
        "score": 1.3010400000000002,
        "description": "CWE-170: Improper Null Termination...",
        "mapping_usage": "Allowed"
      }
    ],
    "dense": [
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 0.5520837026690233,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 0.5508821733553512,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 0.5415993519467279,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 0.5251422550618572,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 0.504601362906121,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.5030909634339935,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 0.5001899601960473,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 0.49226394928498185,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "908",
        "name": "Use of Uninitialized Resource",
        "abstraction": "Base",
        "score": 0.49202604482762513,
        "description": "The product uses or accesses a resource that has not been initialized....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "820",
        "name": "Missing Synchronization",
        "abstraction": "Base",
        "score": 0.4898965921440567,
        "description": "The product utilizes a shared resource in a concurrent manner but does not attempt to synchronize access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "367",
        "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
        "abstraction": "Base",
        "score": 0.48959430537101534,
        "description": "The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can ca...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "277",
        "name": "Insecure Inherited Permissions",
        "abstraction": "Variant",
        "score": 0.48813490226942846,
        "description": "A product defines a set of insecure permissions that are inherited by objects that are created by the program....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "366",
        "name": "Race Condition within a Thread",
        "abstraction": "Base",
        "score": 0.48665874079010013,
        "description": "If two threads of execution use a resource simultaneously, there exists the possibility that resources may be used while invalid, in turn making the state of execution undefined....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "131",
        "name": "Incorrect Calculation of Buffer Size",
        "abstraction": "Base",
        "score": 0.4857760483246023,
        "description": "The product does not correctly calculate the size to be used when allocating a buffer, which could lead to a buffer overflow....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "126",
        "name": "Buffer Over-read",
        "abstraction": "Variant",
        "score": 0.4821632980131843,
        "description": "The product reads from a buffer using buffer access mechanisms such as indexes or pointers that reference memory locations after the targeted buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "416",
        "name": "Use After Free",
        "abstraction": "Variant",
        "score": 0.48095318467235815,
        "description": "The product reuses or references memory after it has been freed. At some point afterward, the memory may be allocated again and saved in another pointer, while the original pointer references a locati...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "606",
        "name": "Unchecked Input for Loop Condition",
        "abstraction": "Base",
        "score": 0.4754376014251213,
        "description": "The product does not properly check inputs that are used for loop conditions, potentially leading to a denial of service or other consequences because of excessive looping....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1284",
        "name": "Improper Validation of Specified Quantity in Input",
        "abstraction": "Base",
        "score": 0.4748922847300062,
        "description": "The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "190",
        "name": "Integer Overflow or Wraparound",
        "abstraction": "Base",
        "score": 0.4709349356783582,
        "description": "The product performs a calculation that can\n         produce an integer overflow or wraparound when the logic\n         assumes that the resulting value will always be larger than\n         the original...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "476",
        "name": "NULL Pointer Dereference",
        "abstraction": "Base",
        "score": 0.47046390679769756,
        "description": "The product dereferences a pointer that it expects to be valid but is NULL....",
        "mapping_usage": "Allowed"
      }
    ],
    "sparse": [
      {
        "cwe_id": "561",
        "name": "Dead Code",
        "abstraction": "Base",
        "score": 1684.4987269681742,
        "description": "The product contains dead code, which can never be executed....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "570",
        "name": "Expression is Always False",
        "abstraction": "Base",
        "score": 1453.7471908244997,
        "description": "The product contains an expression that will always evaluate to false....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "571",
        "name": "Expression is Always True",
        "abstraction": "Base",
        "score": 1453.7471908244997,
        "description": "The product contains an expression that will always evaluate to true....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1164",
        "name": "Irrelevant Code",
        "abstraction": "Class",
        "score": 1422.1800614840035,
        "description": "The product contains code that is not essential for execution,\n\t     i.e. makes no state changes and has no side effects that alter\n\t     data or control flow, such that removal of the code would have...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "705",
        "name": "Incorrect Control Flow Scoping",
        "abstraction": "Class",
        "score": 1408.2390899200727,
        "description": "The product does not properly return control flow to the proper location after it has completed a task or detected an unusual condition....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "393",
        "name": "Return of Wrong Status Code",
        "abstraction": "Base",
        "score": 1371.8232209597147,
        "description": "A function or operation returns an incorrect return value or status code that does not indicate an error, but causes the product to modify its behavior based on the incorrect result....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "300",
        "name": "Channel Accessible by Non-Endpoint",
        "abstraction": "Class",
        "score": 1245.4077628106807,
        "description": "The product does not adequately verify the identity of actors at both ends of a communication channel, or does not adequately ensure the integrity of the channel, in a way that allows the channel to b...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "691",
        "name": "Insufficient Control Flow Management",
        "abstraction": "Pillar",
        "score": 1121.3962049223137,
        "description": "The code does not sufficiently manage its control flow during execution, creating conditions in which the control flow can be modified in unexpected ways....",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "923",
        "name": "Improper Restriction of Communication Channel to Intended Endpoints",
        "abstraction": "Class",
        "score": 838.3553902305005,
        "description": "The product establishes a communication channel to (or from) an endpoint for privileged or protected operations, but it does not properly ensure that it is communicating with the correct endpoint....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "295",
        "name": "Improper Certificate Validation",
        "abstraction": "Base",
        "score": 822.3172096341411,
        "description": "The product does not validate, or incorrectly validates, a certificate....",
        "mapping_usage": "Allowed"
      }
    ]
  },
  "score_statistics": {
    "dense": {
      "min": 0.47046390679769756,
      "max": 0.5520837026690233,
      "mean": 0.4978392781948828,
      "median": 0.489745448757536,
      "count": 20
    },
    "sparse": {
      "min": 822.3172096341411,
      "max": 1684.4987269681742,
      "mean": 1282.1712048578602,
      "median": 1390.0311554398936,
      "count": 10
    },
    "graph": {
      "min": 1.3010400000000002,
      "max": 4.329000000000001,
      "mean": 2.0101511181837073,
      "median": 1.6796000000000002,
      "count": 20
    }
  }
}