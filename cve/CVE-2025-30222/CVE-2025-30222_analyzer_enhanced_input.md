## Vulnerability Description
Shescape is a simple shell escape library for JavaScript. Versions 1.7.2 through 2.1.1 are vulnerable to potential environment variable exposure on Windows with CMD. This impact users of Shescape on Windows that explicitly configure `shell cmd.exe` or `shell true` using any of `quote`/`quoteAll`/`escape`/`escapeAll`. An attacker may be able to get read-only access to environment variables. This bug has been patched in v2.1.2. For those who are already using v2 of Shescape, no further changes are required. Those who are are using v1 of Shescape should follow the migration guide to upgrade to v2. There is no plan to release a patch compatible with v1 of Shescape. As a workaround, users can remove all instances of `%` from user input before using Shescape.

### Vulnerability Description Key Phrases
- **impact:** potential environment variable exposure
- **product:** Shescape
- **version:** 1.7.2 through 2.1.1

## CVE Reference Links Content Summary
```text
Root cause of vulnerability:
The vulnerability lies in the way Shescape, a library for escaping shell arguments, handles the escaping of the percent (%) character when used with `cmd.exe` on Windows. Specifically, the incorrect escaping of the % character allows for the exposure of environment variables.

Weaknesses/vulnerabilities present:
*   CWE-200: Information Exposure.
*   Shescape incorrectly handles escaping of special characters (specifically %) in `cmd.exe`.

Impact of exploitation:
An attacker can read-only access environment variables by injecting a crafted payload containing % characters. This could lead to information disclosure.

Attack vectors:
The attack vector is injecting a payload containing "%" characters into the `shescape.quote()`, `shescape.quoteAll()`, `shescape.escape()`, or `shescape.escapeAll()` functions when the shell is configured as `'cmd.exe'` or `true` and the user input is passed to `cp.execSync`.

Required attacker capabilities/position:
The attacker needs to be able to inject malicious input into the `shescape` functions, specifically including percent signs.

Mitigation or fix:
The vulnerability is patched in version 2.1.2 of Shescape. Users should upgrade to this version. Alternatively, users can remove all instances of the percent (%) character from user input before using Shescape.
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 156 | Improper Neutralization of Whitespace | Variant | Allowed | sparse | 0.283 |
| 2 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.251 |
| 3 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.248 |
| 4 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.235 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.230 |
| 6 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | sparse | 0.224 |
| 7 | 668 | Exposure of Resource to Wrong Sphere | Class | Discouraged | sparse | 0.224 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.221 |
| 9 | 150 | Improper Neutralization of Escape, Meta, or Control Sequences | Variant | Allowed | dense | 0.501 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-156: Improper Neutralization of Whitespace

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-1333: Inefficient Regular Expression Complexity

CWE-116: Improper Encoding or Escaping of Output

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-184: Incomplete List of Disallowed Inputs

CWE-668: Exposure of Resource to Wrong Sphere

CWE-863: Incorrect Authorization

CWE-150: Improper Neutralization of Escape, Meta, or Control Sequences

CWE-117: Improper Output Neutralization for Logs