## Vulnerability Description
Gogs is an open source self-hosted Git service. A malicious user is able to commit and edit a crafted symlink file to a repository to gain SSH access to the server. The vulnerability is fixed in 0.13.1.

### Vulnerability Description Key Phrases
- **impact:** SSH access
- **vector:** crafted symlink file
- **attacker:** malicious user
- **product:** Gogs

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-54148:

**Root cause of vulnerability:**

The vulnerability stems from a lack of proper validation when editing files in the Gogs repository web editor. Specifically, the system failed to prevent the modification of symbolic links, especially during a file rename operation.

**Weaknesses/vulnerabilities present:**

- **Path Traversal:** The core issue was the ability to manipulate symbolic links to point to arbitrary files on the server's file system. This allowed an attacker to bypass intended access restrictions.
- **Improper Input Validation:** The system did not adequately validate file paths, especially when renaming files, which made it possible to manipulate symlinks.
- **Unrestricted File Modification:**  The web editor allowed a user to edit the content of a symlink, and also change the symlink target by modifying the filename.

**Impact of exploitation:**

- **Remote Command Execution (RCE):** By creating and modifying a symbolic link to a critical file, such as a `.git/config` file, a malicious user could inject arbitrary commands. This would be executed when other users interact with the repository, leading to remote command execution. In the provided proof of concept, the attacker is able to write to the /tmp/poc file.
- **Arbitrary File Access/Modification:** Exploitation could lead to unauthorized access to sensitive files, modification of configuration files, or other harmful actions.
- **Server Compromise:** In the worst case, successful exploitation could lead to complete compromise of the server running Gogs.

**Attack vectors:**

- **Web Interface:** The primary attack vector is through the Gogs web interface.
- **File Editing:** The vulnerability is triggered when a malicious user edits a file (specifically a symlink), or renames a file which is also a symlink through the web editor.

**Required attacker capabilities/position:**

- **Gogs User Account:** An attacker needs a valid user account with the ability to commit to a Gogs repository.
- **Repository Write Access:** The attacker needs write access to at least one repository to introduce the malicious symlink.

**Additional details:**

- The vulnerability is described as "Path Traversal in file editing UI and API"
- The fix was implemented in pull request #7857, which disallows editing symlinks while changing the file name.
-  A secondary fix was implemented in pull request #7859, which cleans the file path when updating repo contents via the API.
- The vulnerability was assigned two GHSA ids: GHSA-r7j8-5h9c-f6fx and GHSA-qf5v-rp47-55gg.
- The vulnerability is rated as Critical severity.
- The fix was included in version 0.13.1 of Gogs.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.085 |
| 2 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.084 |
| 3 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.082 |
| 4 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.082 |
| 5 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.081 |
| 6 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.080 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.080 |
| 8 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.080 |
| 9 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | dense | 0.467 |
| 10 | 73 | External Control of File Name or Path | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-61: UNIX Symbolic Link (Symlink) Following

CWE-285: Improper Authorization

CWE-862: Missing Authorization

CWE-918: Server-Side Request Forgery (SSRF)

CWE-863: Incorrect Authorization

CWE-1390: Weak Authentication

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-73: External Control of File Name or Path