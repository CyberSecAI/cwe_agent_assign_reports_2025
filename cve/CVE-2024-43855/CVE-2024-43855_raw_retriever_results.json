{
  "query": "In the Linux kernel, the following vulnerability has been resolved md fix deadlock between mddev_suspend and flush bio Deadlock occurs when mddev is being suspended while some flush bio is in progress. It is a complex issue. T1. the first flush is at the ending stage, it clears mddev->flush_bio and tries to submit data, but is blocked because mddev is suspended by T4. T2. the second flush sets mddev->flush_bio, and attempts to queue md_submit_flush_data(), which is already running (T1) and wont execute again if on the same CPU as T1. T3. the third flush inc active_io and tries to flush, but is blocked because mddev->flush_bio is not NULL (set by T2). T4. mddev_suspend() is called and waits for active_io dec to 0 which is inc by T3. T1T2T3T4 (flush 1)(flush 2)(third 3)(suspend) md_submit_flush_data mddev->flush_bio = NULL . . md_flush_request . mddev->flush_bio = bio . queue submit_flushes . . . .md_handle_request . . active_io + 1 . . md_flush_request . . wait !mddev->flush_bio . . . .mddev_suspend . . wait !active_io . . . submit_flushes . queue_work md_submit_flush_data . //md_submit_flush_data is already running (T1) . md_handle_request wait resume The root issue is non-atomic inc/dec of active_io during flush process. active_io is dec before md_submit_flush_data is queued, and inc soon after md_submit_flush_data() run. md_flush_request active_io + 1 sub",
  "keyphrases": {
    "rootcause": [
      "non-atomic inc",
      "dec of active_io during flush process"
    ]
  },
  "timestamp": "2025-07-13T15:18:01.225155",
  "retriever_config": {
    "weights": {
      "dense": 0.35,
      "sparse": 0.4,
      "graph": 0.25
    },
    "use_graph": true,
    "use_rag": true,
    "use_sparse": true
  },
  "raw_results": {
    "graph": [
      {
        "cwe_id": "367",
        "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
        "abstraction": "base",
        "score": 3.055,
        "description": "CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "609",
        "name": "Double-Checked Locking",
        "abstraction": "base",
        "score": 2.8651999999999997,
        "description": "CWE-609: Double-Checked Locking...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "427",
        "name": "Uncontrolled Search Path Element",
        "abstraction": "base",
        "score": 2.1189999999999998,
        "description": "CWE-427: Uncontrolled Search Path Element...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 1.6923938614840766,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 1.6659945744746212,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1264",
        "name": "Hardware Logic with Insecure De-Synchronization between Control and Data Channels",
        "abstraction": "Base",
        "score": 1.5808897370084751,
        "description": "The hardware logic for error handling and security checks can incorrectly forward data before the security check is complete....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1250",
        "name": "Improper Preservation of Consistency Between Independent Representations of Shared State",
        "abstraction": "Base",
        "score": 1.575834631958498,
        "description": "The product has or supports multiple distributed components or sub-systems that are each required to keep their own local copy of shared data - such as state or cache - but the product does not ensure...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "426",
        "name": "Untrusted Search Path",
        "abstraction": "base",
        "score": 1.521,
        "description": "CWE-426: Untrusted Search Path...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "386",
        "name": "Symbolic Name not Mapping to Correct Object",
        "abstraction": "base",
        "score": 1.521,
        "description": "CWE-386: Symbolic Name not Mapping to Correct Object...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1037",
        "name": "Processor Optimization Removal or Modification of Security-critical Code",
        "abstraction": "base",
        "score": 1.521,
        "description": "CWE-1037: Processor Optimization Removal or Modification of Security-critical Code...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1190",
        "name": "DMA Device Enabled Too Early in Boot Phase",
        "abstraction": "Base",
        "score": 1.4530856509980452,
        "description": "The product enables a Direct Memory Access (DMA) capable device before the security configuration settings are established, which allows an attacker to extract data from or gain privileges on the prod...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "412",
        "name": "Unrestricted Externally Accessible Lock",
        "abstraction": "base",
        "score": 1.1466,
        "description": "CWE-412: Unrestricted Externally Accessible Lock...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "98",
        "name": "Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')",
        "abstraction": "variant",
        "score": 1.0584,
        "description": "CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "486",
        "name": "Comparison of Classes by Name",
        "abstraction": "variant",
        "score": 1.0584,
        "description": "CWE-486: Comparison of Classes by Name...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 1.0320607433715185,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "1251",
        "name": "Mirrored Regions with Different Values",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1251: Mirrored Regions with Different Values...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1249",
        "name": "Application-Level Admin Tool with Inconsistent View of Underlying Operating System",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1249: Application-Level Admin Tool with Inconsistent View of Underlying Operating System...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "832",
        "name": "Unlock of a Resource that is not Locked",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-832: Unlock of a Resource that is not Locked...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "414",
        "name": "Missing Lock Check",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-414: Missing Lock Check...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1234",
        "name": "Hardware Internal or Debug Modes Allow Override of Locks",
        "abstraction": "base",
        "score": 1.0062,
        "description": "CWE-1234: Hardware Internal or Debug Modes Allow Override of Locks...",
        "mapping_usage": "Allowed"
      }
    ],
    "dense": [
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 0.4751903237840246,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 0.4158351382300569,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "1190",
        "name": "DMA Device Enabled Too Early in Boot Phase",
        "abstraction": "Base",
        "score": 0.4138462574500851,
        "description": "The product enables a Direct Memory Access (DMA) capable device before the security configuration settings are established, which allows an attacker to extract data from or gain privileges on the prod...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1264",
        "name": "Hardware Logic with Insecure De-Synchronization between Control and Data Channels",
        "abstraction": "Base",
        "score": 0.4107522215946394,
        "description": "The hardware logic for error handling and security checks can incorrectly forward data before the security check is complete....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "413",
        "name": "Improper Resource Locking",
        "abstraction": "Base",
        "score": 0.4101752188807999,
        "description": "The product does not lock or does not correctly lock a resource when the product must have exclusive access to the resource....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1342",
        "name": "Information Exposure through Microarchitectural State after Transient Execution",
        "abstraction": "Base",
        "score": 0.40644917144781156,
        "description": "The processor does not properly clear microarchitectural state after incorrect microcode assists or speculative execution, resulting in transient execution....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 0.4062263845192346,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "765",
        "name": "Multiple Unlocks of a Critical Resource",
        "abstraction": "Base",
        "score": 0.4032284192521401,
        "description": "The product unlocks a critical resource more times than intended, leading to an unexpected state in the system....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 0.400939609585255,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 0.39801202933949864,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "775",
        "name": "Missing Release of File Descriptor or Handle after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.3887376055089908,
        "description": "The product does not release a file descriptor or handle after its effective lifetime has ended, i.e., after the file descriptor/handle is no longer needed....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.3886513453010617,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1250",
        "name": "Improper Preservation of Consistency Between Independent Representations of Shared State",
        "abstraction": "Base",
        "score": 0.38711244707625725,
        "description": "The product has or supports multiple distributed components or sub-systems that are each required to keep their own local copy of shared data - such as state or cache - but the product does not ensure...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1272",
        "name": "Sensitive Information Uncleared Before Debug/Power State Transition",
        "abstraction": "Base",
        "score": 0.3856032080975082,
        "description": "The product performs a power or debug state transition, but it does not clear sensitive information that should no longer be accessible due to changes to information access restrictions....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "764",
        "name": "Multiple Locks of a Critical Resource",
        "abstraction": "Base",
        "score": 0.3833058776876543,
        "description": "The product locks a critical resource more times than intended, leading to an unexpected state in the system....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "Base",
        "score": 0.3823527305078668,
        "description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the in...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "773",
        "name": "Missing Reference to Active File Descriptor or Handle",
        "abstraction": "Variant",
        "score": 0.38135898712428135,
        "description": "The product does not properly maintain references to a file descriptor or handle, which prevents that file descriptor/handle from being reclaimed....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 0.381242767317418,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "459",
        "name": "Incomplete Cleanup",
        "abstraction": "Base",
        "score": 0.38010124627881836,
        "description": "The product does not properly \"clean up\" and remove temporary or supporting resources after they have been used....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "126",
        "name": "Buffer Over-read",
        "abstraction": "Variant",
        "score": 0.37655507569899566,
        "description": "The product reads from a buffer using buffer access mechanisms such as indexes or pointers that reference memory locations after the targeted buffer....",
        "mapping_usage": "Allowed"
      }
    ],
    "sparse": [
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 820.4759585916788,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "1250",
        "name": "Improper Preservation of Consistency Between Independent Representations of Shared State",
        "abstraction": "Base",
        "score": 758.3380959670068,
        "description": "The product has or supports multiple distributed components or sub-systems that are each required to keep their own local copy of shared data - such as state or cache - but the product does not ensure...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "367",
        "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
        "abstraction": "Base",
        "score": 732.8654602091935,
        "description": "The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can ca...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "427",
        "name": "Uncontrolled Search Path Element",
        "abstraction": "Base",
        "score": 716.8647242865098,
        "description": "The product uses a fixed or controlled search path to find resources, but one or more locations in that path can be under the control of unintended actors....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "833",
        "name": "Deadlock",
        "abstraction": "Base",
        "score": 715.5138340560738,
        "description": "The product contains multiple threads or executable segments that are waiting for each other to release a necessary lock, resulting in deadlock....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "364",
        "name": "Signal Handler Race Condition",
        "abstraction": "Base",
        "score": 712.4664416375069,
        "description": "The product uses a signal handler that introduces a race condition....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1390",
        "name": "Weak Authentication",
        "abstraction": "Class",
        "score": 708.7374247208131,
        "description": "The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "732",
        "name": "Incorrect Permission Assignment for Critical Resource",
        "abstraction": "Class",
        "score": 703.7734192010689,
        "description": "The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "Base",
        "score": 703.5028854221559,
        "description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the in...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "59",
        "name": "Improper Link Resolution Before File Access ('Link Following')",
        "abstraction": "Base",
        "score": 693.9824438911219,
        "description": "The product attempts to access a file based on the filename, but it does not properly prevent that filename from identifying a link or shortcut that resolves to an unintended resource....",
        "mapping_usage": "Allowed"
      }
    ]
  },
  "score_statistics": {
    "dense": {
      "min": 0.37655507569899566,
      "max": 0.4751903237840246,
      "mean": 0.3987838032341199,
      "median": 0.39337481742424474,
      "count": 20
    },
    "sparse": {
      "min": 693.9824438911219,
      "max": 820.4759585916788,
      "mean": 726.6520687983129,
      "median": 713.9901378467904,
      "count": 10
    },
    "graph": {
      "min": 1.0062,
      "max": 3.055,
      "mean": 1.4948429599647617,
      "median": 1.4870428254990227,
      "count": 20
    }
  }
}