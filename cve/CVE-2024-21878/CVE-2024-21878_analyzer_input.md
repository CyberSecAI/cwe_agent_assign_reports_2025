# Vulnerability Information: CVE-2024-21878

## Vulnerability Description
**Improper Neutralization of Special Elements used in a Command (Command Injection)** vulnerability in Enphase IQ Gateway (formerly known as Envoy) allows **OS Command Injection**. This vulnerability is present in an internal script.This issue affects Envoy from 4.x up to and including 8.x and is currently unpatched.

### Vulnerability Description Key Phrases
- **rootcause:** **Improper Neutralization of Special Elements used in a Command (Command Injection)**
- **weakness:** **OS Command Injection**
- **product:** Enphase IQ Gateway (formerly known as Envoy)
- **version:** 4.x up to and including 8.x
- **component:** internal script

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**
*   The vulnerability is due to "Improper Neutralization of Special Elements used in a Command ('Command Injection')" in an internal script within the Enphase IQ Gateway. Specifically, the vulnerability is related to unsafe file name evaluation.

**Weaknesses/Vulnerabilities:**
*   **OS Command Injection:** The core vulnerability is an OS command injection flaw. This means that a malicious actor can inject and execute arbitrary operating system commands on the affected device.
*   **Unsafe File Name Evaluation:** The vulnerability is present in an internal script that doesn't properly sanitize or validate file names, leading to the potential for command injection.

**Impact of Exploitation:**
*   Successful exploitation allows an attacker to execute arbitrary OS commands on the Enphase IQ Gateway. This could lead to:
    *   Complete control of the device.
    *   Data exfiltration from the device or connected networks.
    *   Disruption of service for the device and potentially other devices on the same network.
    *   Further attacks on connected devices within the network.

**Attack Vectors:**
*   The vulnerability is triggered when the IQ Gateway is modified to obtain a public IP address and connect to the public internet. This is not the default configuration, meaning that this vulnerability is not exploitable in a default setup.

**Required Attacker Capabilities/Position:**
*   **Network Access:** The attacker needs network access to the Enphase IQ Gateway.
*   **Public IP Address Configuration:** The IQ Gateway must be configured to obtain a public IP address and connect to the public internet. This is not the default setup, therefore, this attack vector is not exploitable in the default configuration.
*   **Knowledge of the Vulnerability:** The attacker needs knowledge of the specific vulnerability in the internal script in order to successfully exploit it.

**Additional Notes:**
*   The vulnerability affects Enphase IQ Gateway versions 4.x through 8.2.4224.
*   The fix is to upgrade to version 8.2.4225 or newer.
*   A temporary workaround is to ensure that the IQ Gateway is not exposed to the public internet. This mitigates the exploit vector by preventing external access.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 0.800 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 1.000 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.394 |
| 4 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.394 |
| 5 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.376 |
| 6 | 1236 | Improper Neutralization of Formula Elements in a CSV File | Base | Allowed | sparse | 0.366 |
| 7 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.359 |
| 8 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.356 |
| 9 | 943 | Improper Neutralization of Special Elements in Data Query Logic | Class | Allowed-with-Review | dense | 0.569 |
| 10 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | graph | 0.002 |

