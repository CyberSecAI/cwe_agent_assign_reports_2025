# Vulnerability Information: CVE-2024-54140

## Vulnerability Description
sigstore-java is a sigstore java client for interacting with sigstore infrastructure. sigstore-java has **insufficient verification** for a situation where a bundle provides a invalid signature for a checkpoint. This bug impacts clients using any variation of KeylessVerifier.verify(). Currently checkpoints are only used to ensure the root hash of an inclusion proof was provided by the log in question. Failing to validate that means a bundle may provide an inclusion proof that doesnt actually correspond to the log in question. This may eventually lead a monitor/witness being unable to detect when a compromised logs are providing different views of themselves to different clients. There are other mechanisms right now that mitigate this, such as the signed entry timestamp. Sigstore-java currently requires a valid signed entry timestamp. By correctly verifying the signed entry timestamp we can make certain assertions about the log signing the log entry (like the log was aware of the artifact signing event and signed it). Therefore the impact on clients that are not monitors/witnesses is very low. This vulnerability is fixed in 1.2.0.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient verification**
- **impact:** provide an inclusion proof that doesnt actually correspond to the log in question
- **product:** sigstore-java
- **version:** before 1.2.0
- **component:** KeylessVerifier.verify()

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-54140

**Root Cause of Vulnerability:**
The `sigstore-java` library, specifically in versions prior to 1.2.0, had insufficient verification of checkpoint signatures within a bundle. It was not properly verifying the signature of the checkpoint, which is part of the inclusion proof received from the transparency log.

**Weaknesses/Vulnerabilities Present:**
- **Insufficient Verification:** The primary weakness is the lack of proper verification of the checkpoint signature. This means that the library would accept a bundle even if the checkpoint signature was invalid.

**Impact of Exploitation:**
- **Compromised Inclusion Proofs:** An attacker could provide a bundle with a manipulated checkpoint signature. This could lead to clients accepting inclusion proofs that do not correspond to the log in question, potentially allowing for a compromised log to provide different views to different clients without detection.
- **Impact on Monitors/Witnesses:** This is especially concerning for monitors/witnesses because they rely on checkpoint verification to detect inconsistencies in the transparency log.
- **Low impact on non-monitoring clients:** Because the signed entry timestamp is still verified, and the cryptographic materials are verified, the impact is considered low for clients that are not monitors/witnesses.
- **No impact on signing:** The vulnerability does not impact signing functionality.

**Attack Vectors:**
- **Manipulated Bundles:** An attacker could craft a malicious bundle, modifying the checkpoint signature within it.
- **Supply Chain Attack:** An attacker could potentially compromise a transparency log and then manipulate the checkpoint for that log. This would be a more complex attack, but the vulnerability provides an opening for it.

**Required Attacker Capabilities/Position:**
- **Ability to Modify Bundles:** The attacker needs the ability to modify a `sigstore` bundle (specifically the signature of the checkpoint) and deliver it to a client using `sigstore-java`.
- **No special position required:** This can be exploited by an attacker who can influence the bundle provided to a `sigstore-java` client.

**Additional Details:**
- **Patch:** The vulnerability is patched in version 1.2.0 of `sigstore-java`.
- **Workaround:** A manual verification of the checkpoint after the `KeylessVerifier.verify()` method has been run can mitigate the vulnerability. The provided workaround includes code to manually verify the checkpoint signature.
- **Conformance Tests:** Conformance tests were added in `sigstore/sigstore-conformance#139` to ensure proper verification in the future.
- **Reproducing steps:** The provided steps outline how to reproduce the issue by modifying a bundle and demonstrating that the `sigstore-cli` in version `1.1.0` does not throw errors, thus confirming the improper checkpoint verification.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 1.021 |
| 2 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.888 |
| 3 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 0.885 |
| 4 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.876 |
| 5 | 345 | Insufficient Verification of Data Authenticity | Class | Discouraged | sparse | 0.871 |
| 6 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.864 |
| 7 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.863 |
| 8 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.856 |
| 9 | 297 | Improper Validation of Certificate with Host Mismatch | Variant | Allowed | dense | 0.453 |
| 10 | 370 | Missing Check for Certificate Revocation after Initial Check | Variant | Allowed | graph | 0.002 |

