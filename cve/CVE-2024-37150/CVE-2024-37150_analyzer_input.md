# Vulnerability Information: CVE-2024-37150

## Vulnerability Description
An issue in `.npmrc` support in Deno 1.44.0 was discovered where Deno would send `.npmrc` credentials for the scope to the tarball URL when the registry provided URLs for a tarball on a different domain. All users relying on .npmrc are potentially affected by this vulnerability if their private registry references tarball URLs at a different domain. This includes usage of deno install subcommand, auto-install for npm specifiers and LSP usage. It is recommended to upgrade to Deno 1.44.1 and if your private registry ever serves tarballs at a different domain to rotate your registry credentials.

### Vulnerability Description Key Phrases
- **weakness:** **send .npmrc credentials to tarball URL**
- **product:** Deno
- **version:** 1.44.0
- **component:** .npmrc support

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-37150:

**Root Cause of Vulnerability:**

The vulnerability stems from how Deno 1.44.0 handled `.npmrc` configuration when downloading npm package tarballs. Specifically, Deno was incorrectly using the authentication credentials associated with the npm registry URL for the scope of the package, instead of using the credentials associated with the specific URL of the tarball itself. This is a deviation from how npm itself handles authentication.

**Weaknesses/Vulnerabilities Present:**

*   **Incorrect Authentication Scope:** The primary vulnerability is that Deno used the credentials for the registry URL to download the tarball, even if the tarball was hosted on a different domain.
*   **Credential Exposure:** This could lead to credentials being sent to unintended domains, potentially exposing them to malicious actors or unauthorized servers if a private registry was configured with tarball URLs hosted on a different domain.

**Impact of Exploitation:**

*   **Credential Exposure:** An attacker, by controlling a server that serves tarballs, could potentially receive authentication tokens intended for a private npm registry if a user's `.npmrc` was configured to use such private registry but the tarball url pointed to an attacker-controlled server.
*   **Supply Chain Attack (Potential):** If an attacker gained access to credentials, they might be able to modify packages in the private registry.

**Attack Vectors:**

*   **Man-in-the-Middle (MitM) attack:** An attacker could potentially intercept requests to a legitimate registry, and then serve packages that use tarball URLs on different domains which the attacker controls.
*   **Compromised registry:** If the user used a malicious or compromised registry which serves tarball urls from a different domain controlled by the attacker, then this vulnerability would be triggered.

**Required Attacker Capabilities/Position:**

*   **Control Over a Server:** The attacker needs to have control over a server that can serve tarballs for npm packages.
*   **Ability to Redirect/Serve Modified Registry Data:** The attacker needs to be able to either redirect a legitimate registry or to serve their own malicious registry which specifies tarball urls from a different domain controlled by the attacker.
*   **User Interaction:** The user has to be using Deno and have their `.npmrc` configured to use a private registry with tarball URLs hosted on a different domain than the registry itself. The user also must be using one of the affected features (deno install, auto-install for npm, or LSP).

**Additional Details:**

*   The vulnerability is specific to Deno version 1.44.0 and was fixed in version 1.44.1.
*   The fix addresses the incorrect credential handling by ensuring the tarball URL is used to determine the authentication scope, rather than just the scope defined in the `.npmrc` file.
*   The fix also includes error handling to detect if there's no authentication for the tarball URI and auth is present for the scope.
*   The github content also mentions a relevant npm cli wiki page: `https://github.com/npm/cli/wiki/%22No-auth-for-URI,-but-auth-present-for-scoped-registry%22` which provides additional details about the vulnerability.
* The vulnerability is triggered when using `deno install`, auto-install for npm specifiers, and LSP usage.

In summary, CVE-2024-37150 is a vulnerability in Deno that could expose npm registry credentials if the user's private npm registry is configured in a certain way. It's a high-severity vulnerability due to the potential for credential exposure.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.498 |
| 2 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.485 |
| 3 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.478 |
| 4 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.471 |
| 5 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.470 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.470 |
| 7 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.468 |
| 8 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.467 |
| 9 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | dense | 0.485 |
| 10 | 41 | Improper Resolution of Path Equivalence | Base | Allowed | graph | 0.002 |

