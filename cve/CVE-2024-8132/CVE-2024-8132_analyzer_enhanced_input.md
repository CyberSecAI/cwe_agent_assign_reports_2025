## Vulnerability Description
A vulnerability was found in D-Link DNS-120, DNR-202L, DNS-315L, DNS-320, DNS-320L, DNS-320LW, DNS-321, DNR-322L, DNS-323, DNS-325, DNS-326, DNS-327L, DNR-326, DNS-340L, DNS-343, DNS-345, DNS-726-4, DNS-1100-4, DNS-1200-05 and DNS-1550-04 up to 20240814. It has been classified as critical. This affects the function webdav_mgr of the file /cgi-bin/webdav_mgr.cgi of the component HTTP POST Request Handler. The manipulation of the argument f_path leads to **command injection**. It is possible to initiate the attack remotely. The exploit has been disclosed to the public and may be used. NOTE This vulnerability only affects products that are no longer supported by the maintainer. NOTE Vendor was contacted early and confirmed that the product is end-of-life. It should be retired and replaced.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **vector:** manipulation of f_path argument
- **product:** D-Link DNS-120 and DNR-202L and DNS-315L and DNS-320 and DNS-320L and DNS-320LW and DNS-321 and DNR-322L and DNS-323 and DNS-325 and DNS-326 and DNS-327L and DNR-326 and DNS-340L and DNS-343 and DNS-345 and DNS-726-4 and DNS-1100-4 and DNS-1200-05 and DNS-1550-04
- **version:** up to 20240814
- **component:** /cgi-bin/webdav_mgr.cgi

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of the vulnerability:

**CVE ID:** CVE-2024-8132 (Note: the provided information does not directly reference this CVE ID, but it details a similar command injection vulnerability. The information does relate to the vulnerabilities described in the security advisory which mentions CVE-2024-3272 and CVE-2024-3273)

**Root Cause of Vulnerability:**
- The root cause is a command injection vulnerability present in the `webdav_mgr` function within the `/cgi-bin/webdav_mgr.cgi` file of various D-Link NAS devices.
- The vulnerability stems from improper handling of user-supplied input. Specifically, the `f_path` variable received through a POST request is directly incorporated into a system command via `sprintf` without sufficient sanitization or validation.

**Weaknesses/Vulnerabilities Present:**
- **Command Injection:** The primary weakness is the ability to inject arbitrary operating system commands by manipulating the `f_path` variable.
- **Lack of Input Sanitization:** The web application fails to properly sanitize or validate the user-supplied `f_path` parameter before using it in a system command.

**Impact of Exploitation:**
- **Arbitrary Command Execution:** An attacker can execute arbitrary commands on the underlying operating system of the affected D-Link NAS device.
- **Full System Compromise:** Successful exploitation could lead to complete control of the device, allowing attackers to steal data, install malware, or cause denial of service.

**Attack Vectors:**
- **HTTP POST Request:** The attack vector involves sending a crafted HTTP POST request to the `/cgi-bin/webdav_mgr.cgi` endpoint.
- **`f_path` Parameter:** The malicious commands are injected through the `f_path` parameter of the POST request.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker must be able to send HTTP requests to the affected device, typically requiring network connectivity to the vulnerable device.
- **Knowledge of Vulnerable Endpoint:** The attacker needs to know the location of the vulnerable script (/cgi-bin/webdav_mgr.cgi) and the vulnerable parameter (`f_path`).

**Additional Information:**
- The vulnerability affects multiple D-Link NAS models, including DNS-320, DNS-320L, DNS-321, DNS-323, DNS-325, and DNS-327L.
- The affected devices have reached their End of Service Life (EOS) and are no longer receiving security updates from D-Link.
- D-Link recommends that users retire and replace these vulnerable devices.
- A similar command injection vulnerability was found in the `cgi_create_playlist` script.
- There are also reports of information disclosure vulnerabilities on these devices.
- The vulnerability was discovered and reported by multiple third parties, including BuaaIOTTeam.

**In summary**, this is a command injection vulnerability due to insufficient input validation which could allow remote attackers to execute arbitrary commands with elevated privileges. It is exacerbated by the EOL status of the affected devices, which will not receive firmware updates.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 346 | Origin Validation Error | Class | Allowed-with-Review | sparse | 0.759 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.710 |
| 5 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | sparse | 0.696 |
| 6 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.695 |
| 7 | 341 | Predictable from Observable State | Base | Allowed | sparse | 0.687 |
| 8 | 941 | Incorrectly Specified Destination in a Communication Channel | Base | Allowed | sparse | 0.685 |
| 9 | 306 | Missing Authentication for Critical Function | Base | Allowed | dense | 0.650 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-346: Origin Validation Error

CWE-330: Use of Insufficiently Random Values

CWE-359: Exposure of Private Personal Information to an Unauthorized Actor

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-341: Predictable from Observable State

CWE-941: Incorrectly Specified Destination in a Communication Channel

CWE-306: Missing Authentication for Critical Function

CWE-184: Incomplete List of Disallowed Inputs