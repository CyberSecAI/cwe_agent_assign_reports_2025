## Vulnerability Description
A Denial of Service (DoS) condition has been discovered in GitLab CE/EE affecting all versions starting with 12.6 before 17.0.6, 17.1 prior to 17.1.4, and 17.2 prior to 17.2.2. It is possible for an attacker to cause a denial of service using crafted adoc files.

### Vulnerability Description Key Phrases
- **impact:** Denial of Service (DoS)
- **vector:** crafted adoc files
- **product:** GitLab CE/EE
- **version:** all versions starting with 12.6 before 17.0.6, 17.1 prior to 17.1.4, and 17.2 prior to 17.2.2

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The vulnerability stems from the `Gitlab::Asciidoc::IncludeProcessor` not properly handling recursive includes using the `include::` directive in AsciiDoc files. Specifically, the `:include_allowed?` method doesn't prevent cyclic imports, leading to an infinite loop when two files include each other.

- **Weaknesses/vulnerabilities present:**
    -  Unrestricted recursive includes in AsciiDoc processing.
    -  Lack of proper cycle detection in the `Gitlab::Asciidoc::IncludeProcessor`.
    -  Inefficient processing of nested includes leading to resource exhaustion.

- **Impact of exploitation:**
    - Denial of Service (DoS): The infinite loop caused by recursive includes leads to excessive CPU consumption, eventually causing the request to timeout after 60 seconds and potentially affecting the entire site.
    - Resource Exhaustion: The server's CPU is heavily utilized due to the infinite loop.

- **Attack vectors:**
    -  Uploading specially crafted AsciiDoc files that include each other recursively using the `include::` directive.
    -  Accessing these malicious files through the web interface which triggers the `Gitlab::Asciidoc::IncludeProcessor`.

- **Required attacker capabilities/position:**
    - The attacker needs to be able to create or modify AsciiDoc files within a GitLab repository.
    - The attacker needs to have access to the GitLab instance (user account) to exploit this vulnerability

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.130 |
| 2 | 696 | Incorrect Behavior Order | Class | Allowed-with-Review | sparse | 0.126 |
| 3 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.119 |
| 4 | 755 | Improper Handling of Exceptional Conditions | Class | Discouraged | sparse | 0.118 |
| 5 | 1286 | Improper Validation of Syntactic Correctness of Input | Base | Allowed | sparse | 0.115 |
| 6 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.114 |
| 7 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.114 |
| 8 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.114 |
| 9 | 863 | Incorrect Authorization | Class | Allowed-with-Review | dense | 0.500 |
| 10 | 390 | Detection of Error Condition Without Action | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-400: Uncontrolled Resource Consumption

CWE-696: Incorrect Behavior Order

CWE-401: Missing Release of Memory after Effective Lifetime

CWE-755: Improper Handling of Exceptional Conditions

CWE-1286: Improper Validation of Syntactic Correctness of Input

CWE-285: Improper Authorization

CWE-121: Stack-based Buffer Overflow

CWE-1333: Inefficient Regular Expression Complexity

CWE-863: Incorrect Authorization

CWE-390: Detection of Error Condition Without Action