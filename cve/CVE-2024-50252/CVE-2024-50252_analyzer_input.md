# Vulnerability Information: CVE-2024-50252

# Vulnerability Description

    In the Linux kernel, the following vulnerability has been resolved mlxsw spectrum_ipip Fix **memory leak** when changing remote IPv6 address The device stores IPv6 addresses that are used for encapsulation in linear memory that is managed by the driver. Changing the remote address of an ip6gre net device never worked properly, but since cited commit the following reproducer [1] would result in a warning [2] and a **memory leak** [3]. The problem is that the new remote address is never added by the driver to its hash table (and therefore the device) and the old address is never removed from it. Fix by programming the new address when the configuration of the ip6gre net device changes and removing the old one. If the address did not change, then the above would result in increasing the reference count of the address and then decreasing it. [1] # ip link add name bla up type ip6gre local 2001db811 remote 2001db821 tos inherit ttl inherit # ip link set dev bla type ip6gre remote 2001db831 # ip link del dev bla # devlink dev reload pci/00000100.0 [2] WARNING CPU 0 PID 1682 at drivers/net/ethernet/mellanox/mlxsw/spectrum.c3002 mlxsw_sp_ipv6_addr_put+0x140/0x1d0 Modules linked in CPU 0 UID 0 PID 1682 Comm ip Not tainted 6.12.0-rc3-custom-g86b5b55bc835 #151 Hardware name Nvidia SN5600/VMOD0013, BIOS 5.13 05/31/2023 RIP 0010mlxsw_sp_ipv6_addr_put+0x140/0x1d0 [...] Call Trace mlxsw_sp_router_netdevice_event+0x55f/0x1240 notifier_call_chain+0x5a/0xd0 call_netdevice_notifiers_info+0x39/0x90 unregister_netdevice_many_notify+0x63e/0x9d0 rtnl_dellink+0x16b/0x3a0 rtnetlink_rcv_msg+0x142/0x3f0 netlink_rcv_skb+0x50/0x100 netlink_unicast+0x242/0x390 netlink_sendmsg+0x1de/0x420 ____sys_sendmsg+0x2bd/0x320 ___sys_sendmsg+0x9a/0xe0 __sys_sendmsg+0x7a/0xd0 do_syscall_64+0x9e/0x1a0 entry_SYSCALL_64_after_hwframe+0x77/0x7f [3] unreferenced object 0xffff898081f597a0 (size 32) comm ip, pid 1626, jiffies 4294719324 hex dump (first 32 bytes) 20 01 0d b8 00 02 00 00 00 00 00 00 00 00 00 01 ............... 21 49 61 83 80 89 ff ff 00 00 00 00 01 00 00 00 !Ia............. backtrace (crc fd9be911) [] __kmalloc_cache_noprof+0x1da/0x260 [] mlxsw_sp_ipv6_addr_kvdl_index_get+0x281/0x340 [] mlxsw_sp_router_netdevice_event+0x47b/0x1240 [] notifier_call_chain+0x5a/0xd0 [] call_netdevice_notifiers_info+0x39/0x90 [] register_netdevice+0x5f7/0x7a0 [] ip6gre_newlink_common.isra.0+0x65/0x130 [] ip6gre_newlink+0x72/0x120 [] rtnl_newlink+0x471/0xa20 [] rtnetlink_rcv_msg+0x142/0x3f0 [] netlink_rcv_skb+0x50/0x100 [] netlink_unicast+0x242/0x390 [] netlink_sendmsg+0x1de/0x420 [] ____sys_sendmsg+0x2bd/0x320 [] ___sys_sendmsg+0x9a/0xe0 [] __sys_sendmsg+0x7a/0xd0

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## ROOTCAUSE: 'The driver does not correctly manage IPv6 addresses used for encapsulation when changing the remote address of an ip6gre net device. The old address is not removed from the hash table'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 1383.52)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

## ROOTCAUSE: 'and the new address is not added'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 1383.52)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

## ROOTCAUSE: 'leading to a memory leak.'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-125: Out-of-bounds Read (Score: 1145.42)

The product reads data past the end, or before the beginning, of the intended buffer....

## WEAKNESS: 'Improper management of dynamically allocated memory for IPv6 addresses during network device configuration changes.'

Relevant CWEs for this WEAKNESS:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-20: Improper Input Validation (Score: 1101.04)

The product receives input or data, but it does
        not validate or incorrectly validates that the input has the
        properties that are required to process the data safely and
        correctly....

## WEAKNESS: 'memory leak'

Relevant CWEs for this WEAKNESS:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-125: Out-of-bounds Read (Score: 1145.42)

The product reads data past the end, or before the beginning, of the intended buffer....

## IMPACT: 'Memory leak'

Relevant CWEs for this IMPACT:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-125: Out-of-bounds Read (Score: 1145.42)

The product reads data past the end, or before the beginning, of the intended buffer....

## IMPACT: 'which can eventually lead to system instability or denial of service.'

Relevant CWEs for this IMPACT:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-770: Allocation of Resources Without Limits or Throttling (Score: 1383.52)

The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor....

## VECTOR: 'Changing the remote IPv6 address of an ip6gre network device through the ip link command.'

Relevant CWEs for this VECTOR:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-20: Improper Input Validation (Score: 1101.04)

The product receives input or data, but it does
        not validate or incorrectly validates that the input has the
        properties that are required to process the data safely and
        correctly....

## ATTACKER: 'A local user with the capability to configure network devices can trigger the vulnerability.'

Relevant CWEs for this ATTACKER:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-20: Improper Input Validation (Score: 1101.04)

The product receives input or data, but it does
        not validate or incorrectly validates that the input has the
        properties that are required to process the data safely and
        correctly....

### 5. CWE-288: Authentication Bypass Using an Alternate Path or Channel (Score: 411.24)

The product requires authentication, but the product has an alternate path or channel that does not require authentication....

## PRODUCT: 'Linux Kernel'

Relevant CWEs for this PRODUCT:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-732: Incorrect Permission Assignment for Critical Resource (Score: 364.28)

The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors....

## VERSION: '6.12.0-rc3 and potentially earlier versions'

Relevant CWEs for this VERSION:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-288: Authentication Bypass Using an Alternate Path or Channel (Score: 411.24)

The product requires authentication, but the product has an alternate path or channel that does not require authentication....

## COMPONENT: 'mlxsw spectrum driver'

Relevant CWEs for this COMPONENT:

### 1. CWE-306: Missing Authentication for Critical Function (Score: 1465.15)

The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources....

### 2. CWE-400: Uncontrolled Resource Consumption (Score: 1447.17)

The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources....

### 3. CWE-294: Authentication Bypass by Capture-replay (Score: 1401.81)

A capture-replay flaw exists when the design of the product makes it possible for a malicious user to sniff network traffic and bypass authentication by replaying it to the server in question to the same effect as the original message (or with minor changes)....

### 4. CWE-657: Violation of Secure Design Principles (Score: 1384.27)

The product violates well-established principles for secure design....

### 5. CWE-732: Incorrect Permission Assignment for Critical Resource (Score: 364.28)

The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    