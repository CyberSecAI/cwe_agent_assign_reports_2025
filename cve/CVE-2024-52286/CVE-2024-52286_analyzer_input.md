# Vulnerability Information: CVE-2024-52286

## Vulnerability Description
Stirling-PDF is a locally hosted web application that allows you to perform various operations on PDF files. In affected versions the Merge functionality takes untrusted user input (file name) and uses it directly in the creation of HTML pages allowing any unauthenticated to execute JavaScript code in the context of the user. The issue stems to the code starting at `Line 24` in `src/main/resources/static/js/merge.js`. The file name is directly being input into InnerHTML with no sanitization on the file name, allowing a malicious user to be able to upload files with names containing HTML tags. As HTML tags can include JavaScript code, this can be used to execute JavaScript code in the context of the user. This is a self-injection style attack and relies on a user uploading the malicious file themselves and it impact only them, not other users. A user might be social engineered into running this to launch a phishing attack. Nevertheless, this breaks the expected security restrictions in place by the application. This issue has been addressed in version 0.32.0 and all users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input sanitization**
- **impact:** execute JavaScript code and phishing attack and upload files
- **attacker:** unauthenticated user
- **product:** Stirling-PDF
- **version:** before 0.32.0
- **component:** Merge functionality

## CVE Reference Links Content Summary
The provided content is related to CVE-2024-52286.

**Root cause of vulnerability:**
The Merge functionality in Stirling-PDF takes user-provided file names and uses them directly in the creation of HTML pages without sanitization.

**Weaknesses/vulnerabilities present:**
- Improper input handling
- Lack of sanitization of user-supplied data
- Cross-Site Scripting (XSS) vulnerability

**Impact of exploitation:**
An attacker can execute arbitrary JavaScript code in the context of the user who uploads a malicious file. This can potentially lead to:
- Displaying of arbitrary HTML, including iframes, to change the look of the page.
- Displaying sensitive information, like session cookies.
- Potentially launching phishing attacks

**Attack vectors:**
- Uploading a file with a malicious filename containing HTML tags, such as `<img src=x onerror=alert(1)>.pdf`.
- Navigating to the Merge PDF page and uploading the malicious file.

**Required attacker capabilities/position:**
- Ability to upload files to the Stirling-PDF application through the merge functionality.
- No authentication required.

**Additional details:**
- The vulnerability exists in the `src/main/resources/static/js/merge.js` file, specifically at line 24.
- The fix involves using `textContent` instead of `innerHTML` when displaying the file name and creating elements using javascript and setting `textContent` for the file name and page counts to avoid any html injection.
- The provided proof of concept demonstrates the injection of JavaScript code and cookie access.
- The vulnerability is considered a self-injection style attack, meaning the attacker needs to trick the victim to upload a malicious file themselves.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 1.210 |
| 2 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 1.146 |
| 3 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 1.111 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 1.101 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 1.040 |
| 6 | 1321 | Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution') | Variant | Allowed | sparse | 1.040 |
| 7 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 1.038 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 1.032 |
| 9 | 830 | Inclusion of Web Functionality from an Untrusted Source | Variant | Allowed | dense | 0.529 |
| 10 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | graph | 0.003 |

