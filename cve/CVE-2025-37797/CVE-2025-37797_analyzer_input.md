# Vulnerability Information: CVE-2025-37797

# Vulnerability Description

    In the Linux kernel, the following vulnerability has been resolved net_sched hfsc Fix a UAF vulnerability in class handling This patch fixes a ****Use-After-Free** vulnerability** in the HFSC qdisc class handling. The issue occurs due to a **time-of-check/time-of-use condition** in hfsc_change_class() when working with certain child qdiscs like netem or codel. The vulnerability works as follows 1. hfsc_change_class() checks if a class has packets (q.qlen != 0) 2. It then calls qdisc_peek_len(), which for certain qdiscs (e.g., codel, netem) might drop packets and empty the queue 3. The code continues assuming the queue is still non-empty, adding the class to vttree 4. This breaks HFSC scheduler assumptions that only non-empty classes are in vttree 5. Later, when the class is destroyed, this can lead to a **Use-After-Free** The fix adds a second queue length check after qdisc_peek_len() to verify the queue wasnt emptied.

    # Keyphrase-Specific CWE Analysis
    This vulnerability contains multiple keyphrases that may map to different CWEs. 
    Please analyze each keyphrase separately and determine the most appropriate CWE(s) for each.

    ## ROOTCAUSE: 'time-of-check/time-of-use condition'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 853.14)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 2. CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') (Score: 843.38)

The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently....

### 3. CWE-401: Missing Release of Memory after Effective Lifetime (Score: 773.39)

The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....

### 4. CWE-754: Improper Check for Unusual or Exceptional Conditions (Score: 769.31)

The product does not check or incorrectly checks for unusual or exceptional conditions that are not expected to occur frequently during day to day operation of the product....

### 5. CWE-1390: Weak Authentication (Score: 769.24)

The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....

## ROOTCAUSE: 'Use-After-Free vulnerability'

Relevant CWEs for this ROOTCAUSE:

### 1. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 853.14)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 2. CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') (Score: 843.38)

The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently....

### 3. CWE-401: Missing Release of Memory after Effective Lifetime (Score: 773.39)

The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....

### 4. CWE-754: Improper Check for Unusual or Exceptional Conditions (Score: 769.31)

The product does not check or incorrectly checks for unusual or exceptional conditions that are not expected to occur frequently during day to day operation of the product....

### 5. CWE-667: Improper Locking (Score: 734.52)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

## WEAKNESS: 'Use-After-Free'

Relevant CWEs for this WEAKNESS:

### 1. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 853.14)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 2. CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') (Score: 843.38)

The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently....

### 3. CWE-401: Missing Release of Memory after Effective Lifetime (Score: 773.39)

The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....

### 4. CWE-754: Improper Check for Unusual or Exceptional Conditions (Score: 769.31)

The product does not check or incorrectly checks for unusual or exceptional conditions that are not expected to occur frequently during day to day operation of the product....

### 5. CWE-667: Improper Locking (Score: 734.52)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

## PRODUCT: 'Linux kernel'

Relevant CWEs for this PRODUCT:

### 1. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 853.14)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 2. CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') (Score: 843.38)

The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently....

### 3. CWE-401: Missing Release of Memory after Effective Lifetime (Score: 773.39)

The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....

### 4. CWE-667: Improper Locking (Score: 734.52)

The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....

### 5. CWE-789: Memory Allocation with Excessive Size Value (Score: 239.41)

The product allocates memory based on an untrusted, large size value, but it does not ensure that the size is within expected limits, allowing arbitrary amounts of memory to be allocated....

## COMPONENT: 'net_sched hfsc'

Relevant CWEs for this COMPONENT:

### 1. CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition (Score: 853.14)

The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state....

### 2. CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') (Score: 843.38)

The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence operating concurrently....

### 3. CWE-401: Missing Release of Memory after Effective Lifetime (Score: 773.39)

The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....

### 4. CWE-754: Improper Check for Unusual or Exceptional Conditions (Score: 769.31)

The product does not check or incorrectly checks for unusual or exceptional conditions that are not expected to occur frequently during day to day operation of the product....

### 5. CWE-1390: Weak Authentication (Score: 769.24)

The product uses an authentication mechanism to restrict access to specific users or identities, but the mechanism does not sufficiently prove that the claimed identity is correct....


    # Analysis Instructions
    1. For each keyphrase, identify the most appropriate CWE(s) that represent the weakness.
    2. Consider how the different keyphrases might relate to each other in the vulnerability chain.
    3. Provide a final determination of primary CWE(s) and any secondary CWEs.
    4. Format your response using the standard analysis template.

    Please analyze how these different weaknesses interact and provide a comprehensive CWE classification.
    