## Vulnerability Description
XPixelGroup BasicSR through 1.4.2 might locally allow code execution in contrived situations where scontrol show hostname is executed in the presence of a crafted SLURM_NODELIST environment variable.

### Vulnerability Description Key Phrases
- **impact:** code execution
- **vector:** crafted SLURM_NODELIST environment variable
- **product:** XPixelGroup BasicSR
- **version:** through 1.4.2
- **component:** scontrol show hostname

## CVE Reference Links Content Summary
```text
CVE-2024-27763

Vulnerability Report: Execution of Arbitrary Code via `scontrol show hostname` Command in BasicSR

Vulnerability Overview:
An issue has been identified in BasicSR version 1.4.2 and earlier versions, maintained by XPixelGroup, which allows a local attacker to execute arbitrary code through the `scontrol show hostname` command within the `init_dist_slurm` function. This vulnerability exists due to insufficient input validation in handling environment variables used for CUDA device setup.

Vulnerability Details:

* CVE-ID: CVE-2024-27763
* CVSS Score: (Pending assessment)
* Impact: Local attackers can exploit this vulnerability to execute arbitrary code within the context of the application, potentially leading to unauthorized access, privilege escalation, or denial of service.

Affected Versions:

* BasicSR versions 1.4.2 and earlier.

Vulnerability Description:
The vulnerability arises from the following code snippet located in `basicsr/utils/dist_util.py`:

```
proc_id = int(os.environ['SLURM_PROCID'])
ntasks = int(os.environ['SLURM_NTASKS'])
node_list = os.environ['SLURM_NODELIST']
num_gpus = torch.cuda.device_count()
torch.cuda.set_device(proc_id % num_gpus)
addr = subprocess.getoutput(f'scontrol show hostname {node_list} | head -n1')
```

The `scontrol show hostname {node_list}` command retrieves the hostname from the SLURM controller based on the `SLURM_NODELIST` environment variable. The retrieved hostname is then used in subsequent operations without proper validation, allowing for potential command injection if `node_list` contains maliciously crafted input.

Mitigation:
To mitigate this vulnerability, it is recommended to:

* Input Validation: Implement strict input validation and sanitization of environment variables, especially those derived from external commands or user-controlled inputs.
* Command Execution Safeguards: Avoid using unvalidated inputs directly in command execution functions like `subprocess.getoutput`.
* Update: Upgrade to the latest version of BasicSR where this vulnerability has been patched.

References:

* GitHub Repository: [BasicSR](https://github.com/XPixelGroup/BasicSR)
* Commit: [8d56e3a045f9fb3e1d8872f92ee4a4f07f886b0a](https://github.com/XPixelGroup/BasicSR/blob/8d56e3a045f9fb3e1d8872f92ee4a4f07f886b0a/basicsr/utils/dist_util.py#L39C1-L44C82)
```

**Root cause of vulnerability:** Insufficient input validation in handling the `SLURM_NODELIST` environment variable when used in the `scontrol show hostname` command.

**Weaknesses/vulnerabilities present:** Command injection.

**Impact of exploitation:** Local attackers can execute arbitrary code within the context of the application, potentially leading to unauthorized access, privilege escalation, or denial of service.

**Attack vectors:**  A local attacker can craft a malicious `SLURM_NODELIST` environment variable to inject commands into the `scontrol show hostname` command.

**Required attacker capabilities/position:** Local access to the system running BasicSR.

**Mitigation or fix:**
* Implement strict input validation and sanitization of environment variables.
* Avoid using unvalidated inputs directly in command execution functions.
* Upgrade to the latest version of BasicSR.

The content provides more detail than the official CVE description (which was a placeholder).

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1289 | Improper Validation of Unsafe Equivalence in Input | Base | Allowed | sparse | 0.043 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.041 |
| 3 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.041 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.039 |
| 5 | 426 | Untrusted Search Path | Base | Allowed | sparse | 0.039 |
| 6 | 834 | Excessive Iteration | Class | Discouraged | sparse | 0.039 |
| 7 | 214 | Invocation of Process Using Visible Sensitive Information | Base | Allowed | sparse | 0.039 |
| 8 | 250 | Execution with Unnecessary Privileges | Base | Allowed | sparse | 0.038 |
| 9 | 1421 | Exposure of Sensitive Information in Shared Microarchitectural Structures during Transient Execution | Base | Allowed | dense | 0.459 |
| 10 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-1289: Improper Validation of Unsafe Equivalence in Input

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-427: Uncontrolled Search Path Element

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-426: Untrusted Search Path

CWE-834: Excessive Iteration

CWE-214: Invocation of Process Using Visible Sensitive Information

CWE-250: Execution with Unnecessary Privileges

CWE-1421: Exposure of Sensitive Information in Shared Microarchitectural Structures during Transient Execution

CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')