## Vulnerability Description
In invoke-ai/invokeai version v5.0.2, the web API `POST /api/v1/images/delete` is vulnerable to Arbitrary File Deletion. This vulnerability allows unauthorized attackers to delete arbitrary files on the server, potentially including critical or sensitive system files such as SSH keys, SQLite databases, and configuration files. This can impact the integrity and availability of applications relying on these files.

### Vulnerability Description Key Phrases
- **impact:** Arbitrary File Deletion and delete arbitrary files and availability and integrity
- **attacker:** unauthorized attackers
- **product:** invoke-ai/invokeai
- **version:** v5.0.2
- **component:** web API POST /api/v1/images/delete

## CVE Reference Links Content Summary
## Analysis of CVE-2024-11042 Content

Based on the provided content, this relates to a directory traversal vulnerability.

**Root cause of vulnerability:**

The vulnerability stems from insufficient validation of image names before constructing file paths. Specifically, the code previously lacked checks to prevent attackers from using directory traversal sequences (e.g., "../") within image names to access files outside the intended storage directory.

**Weaknesses/vulnerabilities present:**

*   **Directory Traversal:** The application is susceptible to directory traversal attacks due to inadequate input validation.
*   **Path Manipulation:** Attackers can manipulate the image name to construct malicious file paths.

**Impact of exploitation:**

Successful exploitation could allow an attacker to:

*   Access sensitive files outside the intended image storage directory.
*   Potentially overwrite or delete critical system files (depending on permissions).

**Attack vectors:**

*   An attacker could supply a crafted image name containing directory traversal sequences (e.g., "../evil.txt") when uploading or requesting an image.

**Required attacker capabilities/position:**

*   The attacker needs to be able to control the image name used by the application. This could be through a file upload form, an API endpoint, or any other interface where image names are accepted.

**Mitigation or fix:**

The commit message indicates a fix has been implemented:

*   The `get_path` method now includes checks to strip path information from the filename and validates that the resulting image path is relative to the base folder.
*   A `ValueError` is raised if directory traversal is detected.
*   The code now checks if the image path is outside the outputs folder, raising a `ValueError` if it is.

**More detail than official CVE description:**

Yes, the content provides significantly more detail than a typical CVE description. It includes specific code changes, explanations of the vulnerability's root cause, and details about the mitigation implemented. It also includes test cases designed to verify the fix.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.113 |
| 2 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.111 |
| 3 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.109 |
| 4 | 668 | Exposure of Resource to Wrong Sphere | Class | Discouraged | sparse | 0.109 |
| 5 | 284 | Improper Access Control | Pillar | Discouraged | sparse | 0.108 |
| 6 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.107 |
| 7 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.106 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.105 |
| 9 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | dense | 0.522 |
| 10 | 942 | Permissive Cross-domain Policy with Untrusted Domains | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-23: Relative Path Traversal

CWE-306: Missing Authentication for Critical Function

CWE-285: Improper Authorization

CWE-668: Exposure of Resource to Wrong Sphere

CWE-284: Improper Access Control

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-732: Incorrect Permission Assignment for Critical Resource

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-942: Permissive Cross-domain Policy with Untrusted Domains