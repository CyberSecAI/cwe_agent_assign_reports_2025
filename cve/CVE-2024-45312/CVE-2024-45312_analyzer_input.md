# Vulnerability Information: CVE-2024-45312

## Vulnerability Description
Overleaf is a web-based collaborative LaTeX editor. Overleaf Community Edition and Server Pro prior to version 5.0.7 (or 4.2.7 for the 4.x series) contain a vulnerability that allows an arbitrary language parameter in client spelling requests to be passed to the `aspell` executable running on the server. This causes `aspell` to attempt to load a dictionary file with an arbitrary filename. File access is limited to the scope of the overleaf server. The problem is patched in versions 5.0.7 and 4.2.7. Previous versions can be upgraded using the Overleaf toolkit `bin/upgrade` command. Users unable to upgrade may block POST requests to `/spelling/check` via a Web Application Firewall will prevent access to the vulnerable spell check feature. However, upgrading is advised.

### Vulnerability Description Key Phrases
- **impact:** arbitrary file access
- **vector:** arbitrary language parameter in client spelling requests
- **product:** Overleaf Community Edition and Server Pro
- **version:** prior to version 5.0.7 or 4.2.7

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-45312:

**Root Cause of Vulnerability:**
The vulnerability stems from insufficient input sanitization in the Overleaf Community Edition and Server Pro. Specifically, the `language` parameter in client spelling requests was not properly validated before being passed to the `aspell` executable. This allowed for arbitrary values to be passed as the language parameter.

**Weaknesses/Vulnerabilities Present:**
- **CWE-641 (Improper Neutralization of Special Elements used in a Parameter):** The application fails to properly sanitize the language parameter, which is then used to construct a command for the `aspell` executable.
- **Arbitrary Dictionary Loading:** By manipulating the `language` parameter, an attacker could force `aspell` to attempt to load a dictionary file with an arbitrary filename.

**Impact of Exploitation:**
- **Unspecified but potentially severe:** The vulnerability allows an attacker to control the dictionary file `aspell` attempts to load. This could lead to various impacts, including denial of service or other attacks depending on how `aspell` handles invalid or malicious dictionary files, potentially enabling arbitrary code execution depending on `aspell` itself

**Attack Vectors:**
- **Network-based:** The vulnerability is triggered via network requests. Specifically, by crafting a malicious POST request to the `/spelling/check` endpoint with an arbitrary `language` parameter.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to send HTTP POST requests to the `/spelling/check` endpoint of a vulnerable Overleaf instance. This implies network access to the server.
- No authentication is needed, since the authentication check happens after the vulnerable code.
- The attacker does not need any special privileges or be an authenticated user.

**Additional Notes:**
- The provided patch commit `b5e5d39` demonstrates the fix. The fix implements checks on the language code, validating it before passing it to the `aspell` executable.
- The vulnerability affects Overleaf Community Edition and Server Pro versions prior to 5.0.7 and 4.2.7 (for the 4.x series).
- The vulnerability was discovered and reported by Stefan Schiller from SonarSource.
- A workaround was provided - blocking POST requests to `/spelling/check` - but upgrading is advised

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.243 |
| 2 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.241 |
| 3 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.235 |
| 4 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.235 |
| 5 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.234 |
| 6 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.234 |
| 7 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.233 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.232 |
| 9 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | dense | 0.418 |
| 10 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | graph | 0.002 |

