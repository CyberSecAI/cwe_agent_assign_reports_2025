# Vulnerability Information: CVE-2024-39468

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved smb client fix **deadlock** in smb2_find_smb_tcon() Unlock cifs_tcp_ses_lock before calling cifs_put_smb_ses() to avoid such **deadlock**.

### Vulnerability Description Key Phrases
- **weakness:** **deadlock**
- **product:** Linux kernel
- **component:** smb client

## CVE Reference Links Content Summary
The provided content relates to the following vulnerability:

**Root cause of vulnerability:**
A deadlock can occur in the `smb2_find_smb_tcon()` function within the Linux kernel's CIFS (Common Internet File System) client. This happens because the `cifs_tcp_ses_lock` is held while calling `cifs_put_smb_ses()`, potentially leading to a deadlock scenario.

**Weaknesses/vulnerabilities present:**
- **Deadlock:**  The primary vulnerability is a deadlock. The `smb2_find_smb_tcon` function acquires the `cifs_tcp_ses_lock`, and if the required `tcon` is not found, it attempts to release the session by calling `cifs_put_smb_ses` without first releasing the lock, leading to a deadlock.

**Impact of exploitation:**
- **Denial of Service (DoS):** A deadlock can effectively freeze the CIFS client, preventing it from functioning correctly. This leads to a denial of service for SMB/CIFS functionality.

**Attack vectors:**
- An attacker would need to trigger the `smb2_find_smb_tcon` function in a way that results in a call to `cifs_put_smb_ses` when a matching tcon is not found which can cause the deadlock. 

**Required attacker capabilities/position:**
- The attacker needs to be in a position to influence the SMB/CIFS client operations to trigger the conditions that will cause the deadlock. This could involve specific network conditions, SMB requests, or server behavior that results in the `smb2_find_smb_tcon` function failing to locate a tcon.

**Mitigation:**
The provided patches fix the issue by releasing the `cifs_tcp_ses_lock` before calling `cifs_put_smb_ses`. This ensures that the lock is not held during the session release operation, thus preventing the deadlock.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.188 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.161 |
| 3 | 663 | Use of a Non-reentrant Function in a Concurrent Context | Base | Allowed | sparse | 0.124 |
| 4 | 383 | J2EE Bad Practices: Direct Use of Threads | Variant | Allowed | sparse | 0.107 |
| 5 | 1281 | Sequence of Processor Instructions Leads to Unexpected Behavior | Base | Allowed | sparse | 0.104 |
| 6 | 459 | Incomplete Cleanup | Base | Allowed | sparse | 0.103 |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.102 |
| 8 | 280 | Improper Handling of Insufficient Permissions or Privileges  | Base | Allowed | sparse | 0.098 |
| 9 | 287 | Improper Authentication | Class | Discouraged | dense | 0.476 |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | Base | Allowed | graph | 0.002 |

