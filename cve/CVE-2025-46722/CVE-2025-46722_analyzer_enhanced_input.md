## Vulnerability Description
vLLM is an inference and serving engine for large language models (LLMs). In versions starting from 0.7.0 to before 0.9.0, in the file vllm/multimodal/hasher.py, the MultiModalHasher class has a security and data integrity issue in its image hashing method. Currently, it serializes PIL.Image.Image objects using only obj.tobytes(), which returns only the raw pixel data, without including metadata such as the images shape (width, height, mode). As a result, two images of different sizes (e.g., 30x100 and 100x30) with the same pixel byte sequence could generate the same hash value. This may lead to **hash collisions**, incorrect cache hits, and even data leakage or security risks. This issue has been patched in version 0.9.0.

### Vulnerability Description Key Phrases
- **weakness:** **hash collisions**
- **impact:** data leakage or security risks and integrity
- **product:** vLLM
- **version:** 0.7.0 to before 0.9.0
- **component:** vllm/multimodal/hasher.py

## CVE Reference Links Content Summary
```text
CVE ID: CVE-2025-46722

Vulnerability: Weakness in MultiModalHasher Image/video Hashing Implementation in vLLM

Description:
The `MultiModalHasher` class in `vllm/multimodal/hasher.py` has a security and data integrity issue in its image hashing method. It serializes `PIL.Image.Image` objects using only `obj.tobytes()`, which returns only the raw pixel data, without including metadata such as the imageâ€™s shape (width, height, mode). This can lead to hash collisions, incorrect cache hits, and potential data leakage or security risks because two images of different sizes with the same pixel byte sequence could generate the same hash value.

Affected versions:
>=0.7.0

Patched versions:
0.9.0

Root cause:
The `serialize_item` method in `vllm/multimodal/hasher.py` only uses `obj.tobytes()` for hashing `Image.Image` instances, neglecting to include image metadata (size, mode, format, info).

Weaknesses/vulnerabilities present:
- Insufficient image metadata included in hash calculation.
- Potential for hash collisions between visually distinct images.

Impact of exploitation:
- Incorrect cache hits, leading to abnormal responses.
- Deliberate construction of images with different meanings but the same hash value.
- Potential data leakage.

Attack vectors:
- Network (remote attacker can potentially exploit the vulnerability).

Required attacker capabilities/position:
- Low privileges required.
- No user interaction required.

Mitigation or fix:
- In the `serialize_item` method, serialization of `Image.Image` objects should include all critical metadata (size, mode, format, info) in the hash calculation.
- Fix implemented in pull request [#17378](https://github.com/vllm-project/vllm/pull/17378).

CVSS Score: 4.2/10 (Moderate)
CVSS Vector: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:L
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 328 | Use of Weak Hash | Base | Allowed | sparse | 0.545 |
| 2 | 407 | Inefficient Algorithmic Complexity | Class | Allowed-with-Review | sparse | 0.532 |
| 3 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.514 |
| 4 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.483 |
| 5 | 345 | Insufficient Verification of Data Authenticity | Class | Discouraged | sparse | 0.482 |
| 6 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.480 |
| 7 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.475 |
| 8 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.475 |
| 9 | 1427 | Improper Neutralization of Input Used for LLM Prompting | Base | Allowed | dense | 0.407 |
| 10 | 208 | Observable Timing Discrepancy | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-328: Use of Weak Hash

CWE-407: Inefficient Algorithmic Complexity

CWE-327: Use of a Broken or Risky Cryptographic Algorithm

CWE-863: Incorrect Authorization

CWE-345: Insufficient Verification of Data Authenticity

CWE-347: Improper Verification of Cryptographic Signature

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-1390: Weak Authentication

CWE-1427: Improper Neutralization of Input Used for LLM Prompting

CWE-208: Observable Timing Discrepancy