# Vulnerability Information: CVE-2024-46946

## Vulnerability Description
langchain_experimental (aka LangChain Experimental) 0.1.17 through 0.3.0 for LangChain allows attackers to execute arbitrary code through sympy.sympify (which uses eval) in LLMSymbolicMathChain. LLMSymbolicMathChain was introduced in fcccde406dd9e9b05fc9babcbeb9ff527b0ec0c6 (2023-10-05).

### Vulnerability Description Key Phrases
- **rootcause:** **unsafe eval in sympy.sympify**
- **impact:** execute arbitrary code
- **attacker:** attackers
- **product:** langchain_experimental
- **version:** 0.1.17 through 0.3.0
- **component:** LLMSymbolicMathChain

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The vulnerability stems from the use of `sympy.sympify()` to evaluate mathematical expressions without proper input sanitization.",
    "weaknesses": [
      "Improper Input Sanitization",
      "Use of `eval()` equivalent without proper restrictions"
    ],
    "impact": "An attacker who can control the input to `SymbolicMathChain` could potentially execute arbitrary code on the system running the LangChain application, leading to full system compromise.",
    "attack_vectors": [
      "Control of input to the `SymbolicMathChain` component."
    ],
    "required_capabilities": "Attacker needs to be able to influence the input string processed by the `SymbolicMathChain`."
  },
  "additional_details": {
    "SymbolicMathChain_introduction": "The `SymbolicMathChain` class was introduced in the commit `fcccde406dd9e9b05fc9babcbeb9ff527b0ec0c6`. It uses a regular expression to match content between `text` delimiters and passes this content to `sympy.sympify()` for evaluation.",
    "sympy.sympify_vulnerability": "`sympy.sympify()` internally uses Python's `eval()` function, which can lead to arbitrary code execution if not properly restricted.",
     "poc": "The following payload demonstrates the ability to execute arbitrary system commands: `sympy.sympify(\"this.__class__.__mro__[8].__subclasses__()[154].__init__.__globals__['__builtins__']['exec']('import os;os.system(\\\"id\\\")')\")`"
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.190 |
| 2 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.163 |
| 3 | 913 | Improper Control of Dynamically-Managed Code Resources | Class | Allowed-with-Review | sparse | 0.137 |
| 4 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.135 |
| 5 | 822 | Untrusted Pointer Dereference | Base | Allowed | sparse | 0.133 |
| 6 | 250 | Execution with Unnecessary Privileges | Base | Allowed | sparse | 0.131 |
| 7 | 625 | Permissive Regular Expression | Base | Allowed | sparse | 0.127 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.127 |
| 9 | 1427 | Improper Neutralization of Input Used for LLM Prompting | Base | Allowed | dense | 0.532 |
| 10 | 787 | Out-of-bounds Write | Base | Allowed | graph | 0.003 |

