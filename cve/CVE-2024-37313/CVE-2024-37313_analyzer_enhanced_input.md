## Vulnerability Description
Nextcloud server is a self hosted personal cloud system. Under some circumstance it was possible to bypass the second factor of 2FA after successfully providing the user credentials. It is recommended that the Nextcloud Server is upgraded to 26.0.13, 27.1.8 or 28.0.4 and Nextcloud Enterprise Server is upgraded to 21.0.9.17, 22.2.10.22, 23.0.12.17, 24.0.12.13, 25.0.13.8, 26.0.13, 27.1.8 or 28.0.4.

### Vulnerability Description Key Phrases
- **impact:** bypass the second factor of 2FA
- **product:** Nextcloud Server and Nextcloud Enterprise Server

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-37313:

**Root Cause of Vulnerability:**
The vulnerability stems from a flaw in how Nextcloud handles user keys, where `array_keys` could return either string or integer types, while the API should only return string types. This inconsistency allowed for a bypass of the second factor in two-factor authentication (2FA) under specific conditions after the user had successfully entered their primary credentials.

**Weaknesses/Vulnerabilities Present:**
- **Improper Handling of Data Types**: The core issue lies in the inconsistent return type of user keys (`string[]|int[]`) compared to the expected type (`string[]`).
- **Two-Factor Authentication Bypass**: This flaw allows attackers to bypass 2FA after successful primary authentication.
- **CWE-287**:  This is the primary CWE associated with this vulnerability, which relates to improper authentication.

**Impact of Exploitation:**
- **Unauthorized Access**: Attackers can gain unauthorized access to user accounts despite 2FA being enabled.
- **Data Breach**: Once inside the account, attackers may have the ability to steal, modify or delete user's data
- **Compromised Confidentiality, Integrity, and Availability**: The vulnerability leads to low impact on these three security areas.

**Attack Vectors:**
- **Network**: The attack can be carried out over a network, implying that a remote attacker can exploit it.
- **Low complexity**: The attack is not complex
- **No User Interaction**: The attacker does not need the victim to perform any actions.

**Required Attacker Capabilities/Position:**
- **Valid User Credentials**: The attacker needs valid user credentials (username and password) to initiate the attack.
- **Network Access**: The attacker needs network access to the Nextcloud server.

**Additional Notes:**
- Patches for this vulnerability have been released in Nextcloud versions 26.0.13, 27.1.8, and 28.0.4 and Nextcloud Enterprise Server versions 21.0.9.17, 22.2.10.22, 23.0.12.17, 24.0.12.13, 25.0.13.8, 26.0.13, 27.1.8, and 28.0.4.
- A pull request ([https://github.com/nextcloud/server/pull/44276](https://github.com/nextcloud/server/pull/44276)) addresses this vulnerability by ensuring user keys are always treated as strings.
- This vulnerability is rated as "High" severity with a CVSS v3 score of 7.3.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | sparse | 0.163 |
| 2 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.150 |
| 3 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.147 |
| 4 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.144 |
| 5 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.144 |
| 6 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.144 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.138 |
| 8 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.137 |
| 9 | 308 | Use of Single-factor Authentication | Base | Allowed | dense | 0.413 |
| 10 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-209: Generation of Error Message Containing Sensitive Information

CWE-23: Relative Path Traversal

CWE-639: Authorization Bypass Through User-Controlled Key

CWE-789: Memory Allocation with Excessive Size Value

CWE-532: Insertion of Sensitive Information into Log File

CWE-1390: Weak Authentication

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-308: Use of Single-factor Authentication

CWE-1325: Improperly Controlled Sequential Memory Allocation