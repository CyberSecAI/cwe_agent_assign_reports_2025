## Vulnerability Description
CPython 3.9 and earlier doesnt disallow configuring an empty list ([]) for SSLContext.set_npn_protocols() which is an invalid value for the underlying OpenSSL API. This results in a **buffer over-read** when NPN is used (see CVE-2024-5535 for OpenSSL). This vulnerability is of low severity due to NPN being not widely used and specifying an empty list likely being uncommon in-practice (typically a protocol name would be configured).

### Vulnerability Description Key Phrases
- **weakness:** **buffer over-read**
- **product:** CPython
- **version:** 3.9 and earlier
- **component:** SSLContext.set_npn_protocols()

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-5642:

**Root Cause of Vulnerability:**
The vulnerability stems from a buffer over-read in the `SSL_select_next_proto` function within OpenSSL. CPython versions 3.9 and earlier do not prevent users from configuring an empty list for `SSLContext.set_npn_protocols()`. This empty list is an invalid input for the underlying OpenSSL API, `SSL_select_next_proto`. When this invalid input is passed, `SSL_select_next_proto` attempts to read past the buffer boundary, leading to a memory over-read.

**Weaknesses/Vulnerabilities Present:**
- **Buffer Over-read:** The primary vulnerability is a buffer over-read in OpenSSL's `SSL_select_next_proto` function when handling an empty list of protocols.
- **Improper Input Validation:** CPython failed to validate the input to `SSLContext.set_npn_protocols()`, allowing an invalid empty list to be passed to the underlying OpenSSL API.

**Impact of Exploitation:**
- **Information Disclosure:** A successful exploitation leads to the disclosure of potentially sensitive information. In the case of a client using NPN, a chunk of the client's heap memory (up to 255 bytes) is copied and sent to the server. This data is encrypted during transit but may still leak sensitive data.
- **Memory Safety Failure:** More generally, the impact of this function returning an out-of-bounds pointer is a catastrophic memory safety failure due to the incorrect memory being copied and sent to a peer.

**Attack Vectors:**
- The vulnerability is triggered when an application using affected versions of Python calls `SSLContext.set_npn_protocols()` with an empty list `[]`.
- The server must support NPN for the vulnerability to be exploitable.

**Required Attacker Capabilities/Position:**
- An attacker needs to control or influence the client-side application to provide an empty list to the `SSLContext.set_npn_protocols()` function.
- The attacker does not necessarily need to be directly in the network path to exploit the vulnerability if they can influence the client-side application behavior.
- The attacker has to be in a position where NPN is used in the communication.

**Additional Notes:**
- The severity of the vulnerability is rated as "LOW" due to the decline of NPN usage in favor of ALPN and because the configuration of an empty list of protocols is unlikely.
- The vulnerability is related to CVE-2024-5535, which describes the buffer over-read in OpenSSL's `SSL_select_next_proto` function.
- Python versions 3.10 and later removed NPN support, and are therefore not affected.
- CPython versions 3.7 to 3.9 are only affected when using OpenSSL versions < 1.1.1.
- A mitigation strategy is to upgrade to Python 3.10 or later or avoid setting an empty list as the NPN protocols. A further mitigation is to avoid the use of NPN completely.

This information is extracted from the provided text and provides details beyond the basic CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.383 |
| 2 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.365 |
| 3 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.351 |
| 4 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.346 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.344 |
| 6 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.342 |
| 7 | 126 | Buffer Over-read | Variant | Allowed | sparse | 0.340 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.331 |
| 9 | 626 | Null Byte Interaction Error (Poison Null Byte) | Variant | Allowed | dense | 0.481 |
| 10 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-125: Out-of-bounds Read

CWE-476: NULL Pointer Dereference

CWE-327: Use of a Broken or Risky Cryptographic Algorithm

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-863: Incorrect Authorization

CWE-20: Improper Input Validation

CWE-126: Buffer Over-read

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-626: Null Byte Interaction Error (Poison Null Byte)

CWE-1325: Improperly Controlled Sequential Memory Allocation