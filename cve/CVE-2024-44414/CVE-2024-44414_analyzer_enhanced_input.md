## Vulnerability Description
A vulnerability was discovered in FBM_292W-21.03.10V, which has been classified as critical. This issue affects the sub_4901E0 function in the msp_info.htm file. Manipulation of the path parameter can lead to **command injection**.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** FBM_292W
- **version:** 21.03.10V
- **component:** sub_4901E0 function in msp_info.htm

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
The root cause is improper handling of user-supplied input within the `sub_4901E0` function, specifically within the `msp_info.htm` file. The `httpd_get_parm` function retrieves a parameter which is later used in a `sprintf` function. This concatenated string is then executed by the `system` function without proper sanitization.

**Weaknesses/Vulnerabilities:**
- **Command Injection:** The primary vulnerability is command injection. An attacker can inject arbitrary shell commands via the `cmd` parameter due to the lack of input sanitization.

**Impact of Exploitation:**
- **Arbitrary Command Execution:** Successful exploitation allows an attacker to execute arbitrary commands on the underlying operating system of the device. This could lead to a variety of malicious outcomes, including:
  - **Data exfiltration**
  - **Device takeover**
  - **Malware installation**
  - **Denial of service**

**Attack Vectors:**
- **HTTP Request Parameter:** The vulnerability is triggered via a crafted HTTP GET request to the `/msp_info.htm` endpoint, specifically by manipulating the value of the `flag` parameter to `cmd`, and supplying shell commands via the `cmd` parameter.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker needs network access to the device's web interface.
- **Understanding of Vulnerable Endpoint:** The attacker needs to know the vulnerable endpoint (`/msp_info.htm`) and the required parameters (`flag=cmd` and `cmd`).
- **Ability to Send HTTP Requests:**  The attacker must be able to send HTTP requests to the device.
- **Authentication:** While the provided PoC includes cookies, the text implies that the vulnerability can be triggered by providing the required parameters, which suggests that the vulnerability is present both with and without authentication. This would need further verification.

**Technical Details:**
- The vulnerability lies in the `sub_4901E0` function of the firmware.
- The `httpd_get_parm` function retrieves the value of a parameter which is later concatenated into a string that will be passed to `system`.
- The value `cmd` is used to enable the vulnerable code path.
- The `sprintf` function concatenates user supplied data with another value, which is then executed by the `system` command.

**Firmware Version:**
- WAYOS:FBM_292W-21.03.10V

**Additional Details**
- The provided proof of concept (PoC) demonstrates how to exploit this vulnerability by sending a GET request with a malicious `cmd` parameter, which is then executed by the system. The PoC specifically shows how to use the parameter to write the results of `ps` to `a.txt`.

This analysis provides more detailed information than the official CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.241 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.214 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.213 |
| 6 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.209 |
| 7 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.204 |
| 8 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.200 |
| 9 | 912 | Hidden Functionality | Class | Allowed-with-Review | dense | 0.611 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-138: Improper Neutralization of Special Elements

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-912: Hidden Functionality

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')