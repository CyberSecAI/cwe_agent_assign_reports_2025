# Vulnerability Information: CVE-2024-6258

## Vulnerability Description
BT **Missing length checks of net_buf** in rfcomm_handle_data

### Vulnerability Description Key Phrases
- **rootcause:** **Missing length checks of net_buf**
- **product:** BT
- **component:** rfcomm_handle_data

## CVE Reference Links Content Summary
The provided content is related to CVE-2024-6258.

**Root cause of vulnerability:**
- The vulnerability lies in the `rfcomm_handle_data` function within the `subsys/bluetooth/host/rfcomm.c` file. It occurs because the code does not properly check the remaining length of the `net_buf` after the initial size check.

**Weaknesses/vulnerabilities present:**
- **Missing Length Check:** The `rfcomm_handle_data` function lacks sufficient length checks on the `net_buf` (`buf`).
- **Undefined Behavior:** The lack of proper length check before using `net_buf_pull_u8(buf)` leads to undefined behavior.
- **Potential Buffer Over-read/Underflow**: When the buffer length is exactly `sizeof(*hdr) + 1`, the subsequent `net_buf_pull_u8(buf)` will attempt to read past the end of the buffer.

**Impact of exploitation:**
- **Crash:** The immediate impact of the vulnerability is a crash due to accessing an invalid memory address.
- **Denial of Service (DoS):** Repeated exploitation can lead to denial of service attacks, rendering the affected system unusable.
- **Instability:** The overall instability of the system could be impacted by this vulnerability.

**Attack vectors:**
- The vulnerability is exploited through a crafted Bluetooth RFCOMM frame that causes the `buf` length to be equal to `sizeof(*hdr) + 1`.
- The attacker needs to send a malicious RFCOMM frame to the affected device.
- The attack vector is considered adjacent.

**Required attacker capabilities/position:**
- An attacker needs to have a low level of privileges, i.e. be able to send Bluetooth commands to the target.
- The attack complexity is low.
- The attacker needs to be within Bluetooth range of the vulnerable device.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.098 |
| 2 | 130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | sparse | 0.094 |
| 3 | 234 | Failure to Handle Missing Parameter | Variant | Discouraged | sparse | 0.081 |
| 4 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.079 |
| 5 | 353 | Missing Support for Integrity Check | Base | Allowed | sparse | 0.078 |
| 6 | 754 | Improper Check for Unusual or Exceptional Conditions | Class | Allowed-with-Review | sparse | 0.073 |
| 7 | 690 | Unchecked Return Value to NULL Pointer Dereference | Compound | Discouraged | sparse | 0.072 |
| 8 | 131 | Incorrect Calculation of Buffer Size | Base | Allowed | sparse | 0.070 |
| 9 | 805 | Buffer Access with Incorrect Length Value | Base | Allowed | dense | 0.455 |
| 10 | 354 | Improper Validation of Integrity Check Value | Base | Allowed | graph | 0.002 |

