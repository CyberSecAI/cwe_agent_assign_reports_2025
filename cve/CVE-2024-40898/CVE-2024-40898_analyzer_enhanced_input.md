## Vulnerability Description
**SSRF** in Apache HTTP Server on Windows with mod_rewrite in server/vhost context, allows to potentially leak NTML hashes to a malicious server via **SSRF** and malicious requests. Users are recommended to upgrade to version 2.4.62 which fixes this issue.

### Vulnerability Description Key Phrases
- **rootcause:** **SSRF**
- **impact:** leak NTML hashes
- **vector:** malicious requests
- **product:** Apache HTTP Server on Windows
- **component:** mod_rewrite

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-40898:

**Root Cause of Vulnerability:**

*   The vulnerability stems from a Server-Side Request Forgery (SSRF) issue within the Apache HTTP Server when running on Windows. This occurs specifically when `mod_rewrite` is used within the server or virtual host context.

**Weaknesses/Vulnerabilities Present:**

*   **SSRF:** The core vulnerability is an SSRF. The server, under specific configurations, can be tricked into making requests to arbitrary locations, as dictated by a malicious actor.
*   **NTLM Hash Leakage:** The SSRF can be exploited to potentially leak NTLM hashes. This is a critical vulnerability for Windows environments.

**Impact of Exploitation:**

*   **NTLM Hash Theft:** A successful exploit allows an attacker to potentially obtain NTLM hashes from the server by directing it to connect to a malicious server. These hashes can then be potentially cracked or reused in pass-the-hash attacks.
*   **Information Disclosure:** More broadly, SSRF vulnerabilities can lead to information disclosure about internal systems or networks that are reachable from the vulnerable server.

**Attack Vectors:**

*   **Malicious HTTP Requests:** The attack is triggered by crafting malicious HTTP requests that exploit `mod_rewrite` configurations on Windows to initiate the SSRF.
*   **`mod_rewrite` in Server/vhost context:** The vulnerability is specific to the usage of `mod_rewrite` within the server or virtual host configuration context on Windows.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable Apache server.
*   **Knowledge of mod_rewrite:** The attacker needs to be able to craft specific requests that can manipulate the server due to the use of the `mod_rewrite` module.
*   **Windows Environment:** The exploit targets Windows environments.

**Additional Notes**
*   The vulnerability is specific to Apache HTTP Server versions 2.4.0 through 2.4.61.
*   The fix for the vulnerability is included in version 2.4.62.
*   NetApp products that incorporate Apache HTTP Server may also be affected, though many products are listed as not affected or under investigation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | alternate_terms | 1.000 |
| 2 | 611 | Improper Restriction of XML External Entity Reference | Base | Allowed | sparse | 0.260 |
| 3 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.241 |
| 4 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.227 |
| 5 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.226 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.224 |
| 7 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.223 |
| 8 | 174 | Double Decoding of the Same Data | Variant | Allowed | sparse | 0.218 |
| 9 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | dense | 0.518 |
| 10 | 1275 | Sensitive Cookie with Improper SameSite Attribute | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-918: Server-Side Request Forgery (SSRF)

CWE-611: Improper Restriction of XML External Entity Reference

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-532: Insertion of Sensitive Information into Log File

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-138: Improper Neutralization of Special Elements

CWE-174: Double Decoding of the Same Data

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')

CWE-1275: Sensitive Cookie with Improper SameSite Attribute