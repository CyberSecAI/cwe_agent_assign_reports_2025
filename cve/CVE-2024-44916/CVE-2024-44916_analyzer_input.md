# Vulnerability Information: CVE-2024-44916

## Vulnerability Description
Vulnerability in admin_ip.php in Seacms v13.1, when action=set, allows attackers to control IP parameters that are written to the data/admin/ip.php file and could result in arbitrary command execution.

### Vulnerability Description Key Phrases
- **impact:** arbitrary command execution
- **attacker:** attackers
- **product:** Seacms
- **version:** v13.1
- **component:** admin_ip.php

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability described in the context of CVE-2024-44916:

**Root Cause of Vulnerability:**

The vulnerability stems from the lack of input sanitization in the `admin_ip.php` file of the SeaCMS version 13.1. Specifically, the `ip` parameter received via POST request is directly written into a PHP file (`/data/admin/ip.php`) without any filtering or validation. This allows an attacker to inject arbitrary PHP code.

**Weaknesses/Vulnerabilities Present:**

*   **Code Injection:** The primary vulnerability is code injection. The attacker can insert malicious PHP code into the `$ip` variable, which is then written to the `ip.php` file.
*   **Lack of Input Validation/Sanitization:** The code directly uses the POST parameter `$ip` without sanitizing or validating its content. This lack of input validation is the root cause of the vulnerability.
*   **Direct File Write:** The application directly writes user-provided data into a PHP file, without any checks.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** By injecting PHP code, an attacker can execute arbitrary commands on the server hosting the application. This could lead to complete compromise of the server and data.
*   **Server takeover**: Successful exploitation could grant an attacker control over the server, allowing them to steal data, modify content, or use the server for further attacks.
*   **Data Breach**: Sensitive data stored on the server could be exposed to unauthorized access.

**Attack Vectors:**

*   **HTTP POST Request:** The vulnerability is exploited through an HTTP POST request to the `/admin_ip.php` endpoint with the `action=set` parameter.
*   **Malicious `ip` Parameter:** The attacker includes PHP code within the `ip` parameter of the POST request, e.g.,  `ip=11";phpinfo();;//`.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker must have network access to the SeaCMS application.
*   **Knowledge of vulnerable endpoint:** The attacker must know the path of the vulnerable endpoint `/admin_ip.php`.
*   **Ability to send HTTP POST Requests:** The attacker needs to be able to craft and send HTTP POST requests with the malicious parameters.
*   **No authentication required:** The provided content does not indicate any authentication is required to reach the vulnerable endpoint.

**Technical Details:**

The vulnerable code snippet from `admin_ip.php` is:

```php
if($action=="set")
{
    $v= $_POST['v'];
    $ip = $_POST['ip'];
    $open=fopen("../data/admin/ip.php","w" );
    $str='<?php  ';
    $str.='$v = "';
    $str.="$v";
    $str.='"; ';
    $str.='$ip = "';
    $str.="$ip";
    $str.='"; ';
    $str.=" ?>";
    fwrite($open,$str);
    fclose($open);
    ShowMsg("成功保存设置!","admin_ip.php");
    exit;
}
```

This code takes the `v` and `ip` parameters from the POST request and writes them directly to the `ip.php` file, allowing for code injection through the `$ip` parameter.
The provided proof of concept (POC) demonstrates how to exploit this.

```
POST /p8qca/admin_ip.php?action=set HTTP/1.1
Host: seacms:8181
Content-Length: 37
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://seacms:8181
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://seacms:8181/p8qca/admin_ip.php
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=5dl35hp50uj606p52se8kg91a2; XDEBUG_SESSION=PHPSTORM; t00ls=e54285de394c4207cd521213cebab040; t00ls_s=YTozOntzOjQ6InVzZXIiO3M6MjY6InBocCB8IHBocD8gfCBwaHRtbCB8IHNodG1sIjtzOjM6ImFsbCI7aTowO3M6MzoiaHRhIjtpOjE7fQ%3D%3D
Connection: keep-alive

v=0&ip=11%22%3Bphpinfo%28%29%3B%2F%2F
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | sparse | 0.076 |
| 2 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.062 |
| 3 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.061 |
| 4 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.061 |
| 5 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.061 |
| 6 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.060 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.060 |
| 8 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.059 |
| 9 | 472 | External Control of Assumed-Immutable Web Parameter | Base | Allowed | dense | 0.548 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

