# Raw Retriever Results for CVE-2024-53052

# Raw Retriever Results for CVE-2024-53052
## Query
In the Linux kernel, the following vulnerability has been resolved io_uring/rw fix missing NOWAIT check for O_DIRECT start write When io_uring starts a write, itll call kiocb_start_write() to bump the super block rwsem, preventing any freezes from happening while that write is in-flight. The freeze side will grab that rwsem for writing, excluding any new writers from happening and waiting for existing writes to finish. But io_uring unconditionally uses kiocb_start_write(), which will block if someone is currently attempting to freeze the mount point. This causes a deadlock where freeze is waiting for previous writes to complete, but the previous writes cannot complete, as the task that is supposed to complete them is blocked waiting on starting a new write. This results in the following stuck trace showing that dependency with the write blocked starting a new write taskfio stateD stack0 pid886 tgid886 ppid876 Call trace __switch_to+0x1d8/0x348 __schedule+0x8e8/0x2248 schedule+0x110/0x3f0 percpu_rwsem_wait+0x1e8/0x3f8 __percpu_down_read+0xe8/0x500 io_write+0xbb8/0xff8 io_issue_sqe+0x10c/0x1020 io_submit_sqes+0x614/0x2110 __arm64_sys_io_uring_enter+0x524/0x1038 invoke_syscall+0x74/0x268 el0_svc_common.constprop.0+0x160/0x238 do_el0_svc+0x44/0x60 el0_svc+0x44/0xb0 el0t_64_sync_handler+0x118/0x128 el0t_64_sync+0x168/0x170 INFO task fsfreeze7364 blocked for more than 15 seconds. Not tainted 6.12.0-rc5-00063-g76aaf945701c #7963 with the attempting freezer stuck trying to grab the rwsem taskfsfreeze stateD stack0 pid7364 tgid7364 ppid995 Call trace __switch_to+0x1d8/0x348 __schedule+0x8e8/0x2248 schedule+0x110/0x3f0 percpu_down_write+0x2b0/0x680 freeze_super+0x248/0x8a8 do_vfs_ioctl+0x149c/0x1b18 __arm64_sys_ioctl+0xd0/0x1a0 invoke_syscall+0x74/0x268 el0_svc_common.constprop.0+0x160/0x238 do_el0_svc+0x44/0x60 el0_svc+0x44/0xb0 el0t_64_sync_handler+0x118/0x128 el0t_64_sync+0x168/0x170 Fix this by having the io_uring side honor IOCB_NOWAIT, and only attempt a blocking grab of the super block rwsem if it isnt set. For normal issue where IOCB_NOWAIT would always be set, this returns -EAGAIN which will have io_uring core issue a blocking attempt of the write. That will in turn also get completions run, ensuring forward progress. Since freezing requires CAP_SYS_ADMIN in the first place, this isnt something that can be triggered by a regular user.

## Keyphrases
- **rootcause**: 'missing NOWAIT check'
- **weakness**: 'deadlock'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4151 | 0.4875 | 0.4358 | 0.4280 | 20 |
| Sparse | 1026.3078 | 1096.8868 | 1056.8369 | 1047.6963 | 10 |
| Graph | 1.2240 | 2.1190 | 1.5170 | 1.4724 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 1333 | Inefficient Regular Expression Complexity | base | 2.1190 | Allowed |
| 2 | 386 | Symbolic Name not Mapping to Correct Object | base | 2.0930 | Allowed |
| 3 | 476 | NULL Pointer Dereference | base | 1.7680 | Allowed |
| 4 | 833 | Deadlock | Base | 1.6832 | Allowed |
| 5 | 413 | Improper Resource Locking | Base | 1.6766 | Allowed |
| 6 | 832 | Unlock of a Resource that is not Locked | Base | 1.6682 | Allowed |
| 7 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.6016 | Allowed-with-Review |
| 8 | 908 | Use of Uninitialized Resource | Base | 1.5061 | Allowed |
| 9 | 1322 | Use of Blocking Code in Single-threaded, Non-blocking Context | Base | 1.5025 | Allowed |
| 10 | 61 | UNIX Symbolic Link (Symlink) Following | compound | 1.4860 | Allowed |
| 11 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 1.4587 | Allowed |
| 12 | 123 | Write-what-where Condition | base | 1.3676 | Allowed |
| 13 | 384 | Session Fixation | compound | 1.3600 | Allowed |
| 14 | 662 | Improper Synchronization | class | 1.3504 | Discouraged |
| 15 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.3010 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 667 | Improper Locking | Class | 0.4875 | 0.4875 | Allowed-with-Review |
| 2 | 833 | Deadlock | Base | 0.4872 | 0.4872 | Allowed |
| 3 | 413 | Improper Resource Locking | Base | 0.4636 | 0.4636 | Allowed |
| 4 | 909 | Missing Initialization of Resource | Class | 0.4507 | 0.4507 | Allowed-with-Review |
| 5 | 832 | Unlock of a Resource that is not Locked | Base | 0.4476 | 0.4476 | Allowed |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.4461 | 0.4461 | Allowed-with-Review |
| 7 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4425 | 0.4425 | Allowed |
| 8 | 1351 | Improper Handling of Hardware Behavior in Exceptionally Cold Environments | Base | 0.4385 | 0.4385 | Allowed |
| 9 | 606 | Unchecked Input for Loop Condition | Base | 0.4354 | 0.4354 | Allowed |
| 10 | 782 | Exposed IOCTL with Insufficient Access Control | Variant | 0.4312 | 0.4312 | Allowed |
| 11 | 366 | Race Condition within a Thread | Base | 0.4247 | 0.4247 | Allowed |
| 12 | 1260 | Improper Handling of Overlap Between Protected Memory Ranges | Base | 0.4221 | 0.4221 | Allowed |
| 13 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | 0.4202 | 0.4202 | Allowed |
| 14 | 763 | Release of Invalid Pointer or Reference | Base | 0.4181 | 0.4181 | Allowed |
| 15 | 775 | Missing Release of File Descriptor or Handle after Effective Lifetime | Variant | 0.4177 | 0.4177 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 863 | Incorrect Authorization | 1096.8868 | 1096.8868 | Allowed-with-Review |
| 2 | 833 | Deadlock | 1090.1339 | 1090.1339 | Allowed |
| 3 | 61 | UNIX Symbolic Link (Symlink) Following | 1078.8385 | 1078.8385 | Allowed |
| 4 | 1333 | Inefficient Regular Expression Complexity | 1074.9085 | 1074.9085 | Allowed |
| 5 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | 1054.5528 | 1054.5528 | Allowed |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1040.8399 | 1040.8399 | Allowed-with-Review |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | 1038.6608 | 1038.6608 | Allowed |
| 8 | 184 | Incomplete List of Disallowed Inputs | 1038.2652 | 1038.2652 | Allowed |
| 9 | 667 | Improper Locking | 1028.9745 | 1028.9745 | Allowed-with-Review |
| 10 | 400 | Uncontrolled Resource Consumption | 1026.3078 | 1026.3078 | Discouraged |
