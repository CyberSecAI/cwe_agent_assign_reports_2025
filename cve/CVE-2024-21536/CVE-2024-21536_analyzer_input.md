# Vulnerability Information: CVE-2024-21536

## Vulnerability Description
Versions of the package http-proxy-middleware before 2.0.7, from 3.0.0 and before 3.0.3 are vulnerable to Denial of Service (DoS) due to an **UnhandledPromiseRejection error thrown by micromatch**. An attacker could kill the Node.js process and crash the server by making requests to certain paths.

### Vulnerability Description Key Phrases
- **rootcause:** **UnhandledPromiseRejection error thrown by micromatch**
- **impact:** Denial of Service (DoS) and crash the server
- **vector:** requests to certain paths
- **attacker:** attacker
- **product:** http-proxy-middleware
- **version:** ['before 2.0.7' and 'from 3.0.0 and before 3.0.3']

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-21536:

**Root Cause of Vulnerability:**

The vulnerability stems from how `http-proxy-middleware` handles errors within its path filtering logic. Specifically, when a user makes requests to certain paths that cause `micromatch` (used internally for path matching) to throw a `TypeError` or when the `pathFilter` function throws an error, the `http-proxy-middleware` doesn't handle this error properly, leading to an `UnhandledPromiseRejection` that crashes the Node.js process.

**Weaknesses/Vulnerabilities Present:**

1.  **Unhandled Exception/Error:** The core issue is the lack of proper error handling when `micromatch` or the custom filter function fails. This causes the Node.js server to terminate abruptly.
2.  **Incorrect Input Handling:** The vulnerability can be triggered by crafting specific URLs (like `localhost:3030//x@x`) that cause `micromatch` to throw a `TypeError`. It also occurs if the `pathFilter` function is omitted or throws an error.
3.  **Path Matching Logic Flaw:**  `matchSingleStringPath` function is vulnerable in v1 and v2 of the package when `pathFilter` is excluded, which leads to a crash due to `TypeError: Cannot read properties of null (reading 'indexOf')`.

**Impact of Exploitation:**

*   **Denial of Service (DoS):** An attacker can crash the Node.js server, making the application unavailable to legitimate users. This is a classic DoS scenario.

**Attack Vectors:**

*   **Network Requests:** Attackers can trigger the vulnerability by sending specially crafted HTTP requests to the server.
*   **Malformed URLs:** Specific URL structures (like those containing `//` and `@`) can trigger the vulnerability.
*   **Custom `pathFilter` function:** If the `pathFilter` function throws an error, it will cause the server to crash

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable server.
*   **No Special Privileges:** No specific privileges or authentication is required to trigger the vulnerability.
*   **Understanding of vulnerable request patterns:** The attacker needs to know the specific paths or request patterns (e.g. `localhost:3030//x@x`) that will trigger the vulnerability, or that they can cause the `pathFilter` to throw an error.

**Additional Details:**

*   **Affected Versions:** `http-proxy-middleware` versions `<2.0.7` and `>=3.0.0 <3.0.3` are vulnerable.
*   **Patch:** The vulnerability is addressed in versions `2.0.7` and `3.0.3` and higher by adding error handling to the `pathFilter` and context matching logic.
*   **Mitigation:** Upgrade to the patched versions of the library
*   **CVSS Score:** Snyk has rated the vulnerability as HIGH, with a CVSS score of 8.7. This indicates the potential for significant impact to application availability.

In summary, CVE-2024-21536 in `http-proxy-middleware` is a denial-of-service vulnerability caused by improper error handling during path filtering, allowing an attacker to crash the server by sending specific HTTP requests.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 248 | Uncaught Exception | Base | Allowed | sparse | 0.331 |
| 2 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.316 |
| 3 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.312 |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.308 |
| 5 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.305 |
| 6 | 755 | Improper Handling of Exceptional Conditions | Class | Discouraged | sparse | 0.300 |
| 7 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.297 |
| 8 | 431 | Missing Handler | Base | Allowed | sparse | 0.295 |
| 9 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | dense | 0.485 |
| 10 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | graph | 0.002 |

