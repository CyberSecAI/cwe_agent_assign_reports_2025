## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved RDMA/mlx5 Fix mlx5_poll_one() cur_qp update flow When cur_qp isnt NULL, in order to avoid fetching the QP from the radix tree again we check if the next cqe QP is identical to the one we already have. The bug however is that we are checking if the QP is identical by checking the QP number inside the CQE against the QP number inside the mlx5_ib_qp, but thats wrong since the QP number from the CQE is from FW so it should be matched against mlx5_core_qp which is our FW QP number. Otherwise we could use the wrong QP when handling a CQE which could cause the kernel trace below. This issue is mainly noticeable over QPs 0 & 1, since for now they are the only QPs in our driver whereas the QP number inside mlx5_ib_qp doesnt match the QP number inside mlx5_core_qp.

### Vulnerability Description Key Phrases
- **weakness:** **QP number mismatch**
- **product:** Linux kernel
- **component:** RDMA/mlx5

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 335 | Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG) | Base | Allowed | sparse | 0.704 |
| 2 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.649 |
| 3 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.616 |
| 4 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.610 |
| 5 | 130 | Improper Handling of Length Parameter Inconsistency | Base | Allowed | sparse | 0.601 |
| 6 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.599 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.599 |
| 8 | 824 | Access of Uninitialized Pointer | Base | Allowed | sparse | 0.593 |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | dense | 0.531 |
| 10 | 129 | Improper Validation of Array Index | Variant | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-335: Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG)

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-476: NULL Pointer Dereference

CWE-125: Out-of-bounds Read

CWE-130: Improper Handling of Length Parameter Inconsistency

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-863: Incorrect Authorization

CWE-824: Access of Uninitialized Pointer

CWE-1285: Improper Validation of Specified Index, Position, or Offset in Input

CWE-129: Improper Validation of Array Index