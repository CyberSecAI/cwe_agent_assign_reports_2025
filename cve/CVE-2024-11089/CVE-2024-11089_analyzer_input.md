# Vulnerability Information: CVE-2024-11089

## Vulnerability Description
The Anonymous Restricted Content plugin for WordPress is vulnerable to **Sensitive Information Exposure** in all versions up to, and including, 1.6.5 via the WordPress core search feature. This makes it possible for unauthenticated attackers to extract sensitive data from posts that have been restricted to logged-in users.

### Vulnerability Description Key Phrases
- **weakness:** **Sensitive Information Exposure**
- **impact:** extract sensitive data from restricted posts
- **attacker:** unauthenticated attackers
- **product:** Anonymous Restricted Content plugin for WordPress
- **version:** all versions up to and including 1.6.5
- **component:** WordPress core search feature

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**
The vulnerability stems from the way the Anonymous Restricted Content plugin handles content restrictions in conjunction with the WordPress core search feature. The plugin failed to properly prevent unauthenticated users from accessing restricted content when using the search functionality.

**Weaknesses/Vulnerabilities:**
- **Unauthenticated Content Restriction Bypass:** The core vulnerability is that the plugin's content restriction mechanisms could be bypassed by using the WordPress search feature. This allowed unauthenticated users to access content intended only for logged-in users.
- **Insufficient Filtering in Search Queries:** The plugin did not properly filter search results to exclude restricted content, thus exposing it to unauthorized access.

**Impact of Exploitation:**
- **Sensitive Information Exposure:** Unauthenticated attackers could gain access to sensitive data within posts that were intended to be restricted to logged-in users. This could potentially include private information, confidential data, or other content that should not be publicly visible.

**Attack Vectors:**
- **WordPress Core Search Functionality:** Attackers could exploit this vulnerability by using the WordPress search feature to query for restricted content.

**Required Attacker Capabilities/Position:**
- **Unauthenticated User:** The attacker does not need to be a logged-in user or have any special privileges on the WordPress site. They only require the ability to perform a search.

**Additional Details:**
- The vulnerability was present in all versions of the plugin up to and including 1.6.5.
- The fix was implemented in version 1.6.6.
- The fix includes changes to how queries are handled, specifically by adding meta query checks to ensure that restricted content is not included in the search results, as well as excluding restricted categories.
- The fix also modifies the REST API filtering to prevent access to restricted content for unauthenticated users.
- The `hide_restricted_in_main_query` function in `class-arc-public.php` was changed to properly exclude restricted posts and categories when the user is not logged in.
- The fix replaces the `rest_pre_echo_response` filter with `rest_request_before_callbacks` in `class-arc.php` to handle REST API content restrictions.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.313 |
| 2 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.308 |
| 3 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | Class | Discouraged | sparse | 0.307 |
| 4 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.304 |
| 5 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.298 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.297 |
| 7 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.294 |
| 8 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.291 |
| 9 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | dense | 0.538 |
| 10 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | graph | 0.002 |

