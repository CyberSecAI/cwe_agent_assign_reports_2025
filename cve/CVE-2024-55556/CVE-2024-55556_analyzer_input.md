# Vulnerability Information: CVE-2024-55556

## Vulnerability Description
A vulnerability in Crater Invoice allows an unauthenticated attacker with knowledge of the APP_KEY to achieve remote command execution on the server by manipulating the laravel_session cookie, exploiting **arbitrary deserialization** through the encrypted session data. The exploitation vector of this vulnerability relies on an attacker obtaining Laravels secret APP_KEY, which would allow them to decrypt and manipulate session cookies (laravel_session) containing serialized data. By altering this data and re-encrypting it with the APP_KEY, the attacker could trigger **arbitrary deserialization** on the server, potentially leading to remote command execution (RCE). The vulnerability is primarily exploited by accessing an exposed cookie and manipulating it using the secret key to gain malicious access to the server.

### Vulnerability Description Key Phrases
- **weakness:** **arbitrary deserialization**
- **impact:** remote command execution
- **attacker:** unauthenticated attacker
- **product:** Crater Invoice

## CVE Reference Links Content Summary
```
Root cause of vulnerability:
The vulnerability is caused by the use of the `SESSION_DRIVER=cookie` option in the default Crater `.env` file. This stores sessions as a ciphered value inside a cookie. These sessions are made from a specially crafted JSON containing serialized data which is then ciphered using Laravel's `encrypt()` function. An attacker in possession of the `APP_KEY` can decrypt the cookie and modify the serialized data to achieve arbitrary deserialization, leading to remote command execution.

Weaknesses/vulnerabilities present:
- Unauthenticated Remote Command Execution
- Arbitrary deserialization
- Laravel session cookie vulnerability

Impact of exploitation:
Remote command execution on the server.

Attack vectors:
The attack vector is to obtain the `APP_KEY`, retrieve the `laravel_session` and `DqNfdAQoevsVc3L2TmqIttblIQGIJPVdLrwoY7xT` cookies, decrypt them, modify the serialized data to include a malicious payload, re-encrypt the cookies and send the manipulated cookies to the server.

Required attacker capabilities/position:
An attacker needs to be in possession of the `APP_KEY`.

Mitigation or fix:
- Regenerate a new `APP_KEY`.
- Migrate to InvoiceShelf, a Crater invoice fork that is still maintained.
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.692 |
| 2 | 321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | sparse | 0.610 |
| 3 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.581 |
| 4 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.576 |
| 5 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.572 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.563 |
| 7 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.561 |
| 8 | 614 | Sensitive Cookie in HTTPS Session Without 'Secure' Attribute | Variant | Allowed | sparse | 0.561 |
| 9 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | dense | 0.530 |
| 10 | 259 | Use of Hard-coded Password | Variant | Allowed | graph | 0.003 |

