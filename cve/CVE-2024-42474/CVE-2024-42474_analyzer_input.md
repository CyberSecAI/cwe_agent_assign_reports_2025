# Vulnerability Information: CVE-2024-42474

## Vulnerability Description
Streamlit is a data oriented application development framework for python. Snowflake Streamlit open source addressed a security vulnerability via the static file sharing feature. Users of hosted Streamlit app(s) on Windows were vulnerable to a **path traversal vulnerability** when the static file sharing feature is enabled. An attacker could utilize the vulnerability to leak the password hash of the Windows user running Streamlit. The vulnerability was patched on Jul 25, 2024, as part of Streamlit open source version 1.37.0. The vulnerability only affects Windows.

### Vulnerability Description Key Phrases
- **weakness:** **path traversal vulnerability**
- **impact:** leak password hash
- **product:** Streamlit
- **version:** prior to 1.37.0
- **component:** static file sharing feature

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

- The vulnerability stems from improper handling of paths when serving static files in Streamlit on Windows. Specifically, a path traversal vulnerability exists due to insufficient validation of the requested file paths against the allowed static file directory.

**Weaknesses/Vulnerabilities:**

- **Path Traversal:** The primary vulnerability is a path traversal issue. By crafting malicious file paths (e.g., using `../`), an attacker can access files outside the intended static file directory.

**Impact of Exploitation:**

- **Information Disclosure:** An attacker could exploit this vulnerability to leak sensitive information, such as the password hash of the Windows user running the Streamlit application.
- **File Access:** This vulnerability allows access to arbitrary files on the server where the application is hosted, potentially leading to further malicious actions.

**Attack Vectors:**

- **Network-based:** The attack vector is network-based, meaning an attacker can exploit the vulnerability remotely by sending crafted HTTP requests to the Streamlit application.
- **Specifically targets Windows:** This vulnerability is specific to the Windows OS.

**Required Attacker Capabilities/Position:**

- **Network Access:** The attacker needs to have network access to the hosted Streamlit application.
- **Low Privileges:** The attacker does not require high privileges to exploit this vulnerability, needing only the ability to send HTTP requests.
- **Knowledge of static file serving mechanism:** The attacker needs to be aware that the static file sharing feature is enabled on the Streamlit instance.

**Additional Details:**

- The vulnerability is considered moderate in severity with a CVSS v3 base score of 5.9.
- The vulnerability was fixed in Streamlit version 1.37.0, released on July 25, 2024.
- The fix involves validating the path using Tornado before performing checks, ensuring that requested files are within the intended static file directory.
- The patch also updated unit tests to include checks for 403 responses, which should be returned for invalid requests (e.g., directories, symlinks outside the allowed directory).
- The vulnerability was reported via a bug bounty program.

**Summary of Changes from Commit:**

The commit `3a639859cfdfba2187c81897d44a3e33825eb0a3` introduces the following key changes:

- **`app_static_file_handler.py`:** Added validation using `os.path.realpath` to resolve the absolute path, prevents serving directories, and uses the parent class' `validate_absolute_path` after checks for directories
- **`app_static_file_handler_test.py`**: Updated tests to reflect 403 errors for invalid requests and 404 for non existing files.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.400 |
| 3 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.393 |
| 4 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | sparse | 0.393 |
| 5 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.392 |
| 6 | 24 | Path Traversal: '../filedir' | Variant | Allowed | sparse | 0.389 |
| 7 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.380 |
| 8 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.373 |
| 9 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | dense | 0.459 |
| 10 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | graph | 0.003 |

