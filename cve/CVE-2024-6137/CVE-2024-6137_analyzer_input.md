# Vulnerability Information: CVE-2024-6137

## Vulnerability Description
BT Classic SDP OOB access in get_att_search_list

### Vulnerability Description Key Phrases
- **impact:** OOB access
- **product:** BT Classic SDP
- **component:** get_att_search_list

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**
- The vulnerability stems from an out-of-bounds write in the `get_att_search_list` function within `subsys/bluetooth/host/sdp.c`. The function parses data elements without limiting the number it processes, which leads to an out-of-bounds write in subsequent accesses of the `filter` array.

**Weaknesses/Vulnerabilities:**
- **Out-of-bounds write:** The `filter` array, which is used to store attribute IDs, can be written beyond its allocated size due to the lack of a limit on the parsed `data_elem` count.
- **Stack overflow:** When the number of parsed `data_elem` exceeds the maximum allowed by the filter array size (`MAX_NUM_ATT_ID_FILTER`), a stack overflow occurs due to out-of-bounds writes.

**Impact of Exploitation:**
- **Instability (crash):** The out-of-bounds write can corrupt the stack and lead to a crash of the affected system.
- **Denial of Service (DoS):** By triggering the stack overflow, an attacker can render the system unusable, effectively causing a denial-of-service condition.

**Attack Vectors:**
- The attack vector is adjacent, meaning that the attacker must be within the physical or logical proximity of the vulnerable device to exploit the vulnerability. This likely refers to the Bluetooth communication range.
- The attacker needs to send a specially crafted Bluetooth SDP (Service Discovery Protocol) request with a specific number of `data_elem`.

**Required Attacker Capabilities/Position:**
- The attacker must be within the communication range of the vulnerable device, as the vulnerability is triggered through Bluetooth communication.
- No special privileges are required to exploit this vulnerability.
- No user interaction is needed.

**Additional Information:**
- The `MAX_NUM_ATT_ID_FILTER` is set to 10, which means more than 10 `data_elem` need to be included in the crafted packet.
- The vulnerable function is called by `sdp_svc_att_req` or `sdp_svc_search_att_req`.
- The `data_size` of each `data_elem` needs to be 2 or 4 to increment the `num_filter`. An example of such a data element could be `08 ff ff`

**CVE ID:**
- CVE-2024-6137

**CWE:**
- CWE-20: Improper Input Validation
- CWE-121: Stack-based Buffer Overflow
- CWE-787: Out-of-bounds Write

**Patches:**
- The fix is available in the provided pull request: [#75575](https://github.com/zephyrproject-rtos/zephyr/pull/75575)

This information aligns with and expands upon the typical information found in a CVE description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 129 | Improper Validation of Array Index | Variant | Allowed | sparse | 0.015 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.013 |
| 3 | 922 | Insecure Storage of Sensitive Information | Class | Allowed-with-Review | sparse | 0.013 |
| 4 | 694 | Use of Multiple Resources with Duplicate Identifier | Base | Allowed | sparse | 0.013 |
| 5 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.012 |
| 6 | 176 | Improper Handling of Unicode Encoding | Variant | Allowed | sparse | 0.012 |
| 7 | 405 | Asymmetric Resource Consumption (Amplification) | Class | Allowed-with-Review | sparse | 0.012 |
| 8 | 676 | Use of Potentially Dangerous Function | Base | Allowed | sparse | 0.011 |
| 9 | 1067 | Excessive Execution of Sequential Searches of Data Resource | Base | Allowed | dense | 0.328 |
| 10 | 825 | Expired Pointer Dereference | Base | Allowed | graph | 0.002 |

