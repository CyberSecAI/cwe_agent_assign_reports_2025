# Vulnerability Information: CVE-2024-8522

## Vulnerability Description
The LearnPress - WordPress LMS Plugin plugin for WordPress is vulnerable to SQL Injection via the c_only_fields parameter of the /wp-json/learnpress/v1/courses REST API endpoint in all versions up to, and including, 4.2.7 due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**. This makes it possible for unauthenticated attackers to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**
- **weakness:** **SQL injection**
- **impact:** extract sensitive information from the database
- **attacker:** unauthenticated attackers
- **product:** LearnPress - WordPress LMS Plugin
- **version:** all versions up to and including 4.2.7
- **component:** /wp-json/learnpress/v1/courses REST API endpoint

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-89

#### Top CWEs
- CWE-89 (Count: 24)

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of CVE-2024-8522:

**1. Verification:**

   - The provided content from Wordfence explicitly states that **CVE-2024-8522** is related to an **unauthenticated SQL Injection vulnerability** in the LearnPress WordPress plugin, specifically through the `c_only_fields` parameter.
   - The mentioned vulnerable code is located within the file `class-lp-rest-courses-v1-controller.php`, which is also found in the provided code diff.

**2. Root Cause of Vulnerability:**

   - The root cause is **insufficient input sanitization and lack of proper SQL query preparation** in the LearnPress plugin.
   - Specifically, the `c_only_fields` parameter within the `/wp-json/learnpress/v1/courses` REST API endpoint is not adequately sanitized before being used in an SQL query.

**3. Weaknesses/Vulnerabilities Present:**

   - **SQL Injection:** The primary vulnerability is SQL Injection, where an attacker can insert arbitrary SQL code into the query via the `c_only_fields` parameter.

**4. Impact of Exploitation:**

   - **Sensitive Data Exposure:** Successful exploitation could allow an attacker to extract sensitive information from the database. This could include user data, course information, or other confidential data stored within the WordPress database.
   - **Potential for Data Manipulation/Destruction**: While not specifically mentioned in this vulnerability description, SQL injection can also potentially lead to data modification or deletion if the injected SQL is crafted to do so.

**5. Attack Vectors:**

   - **HTTP Request:** The attack vector is a malicious HTTP request to the `/wp-json/learnpress/v1/courses` REST API endpoint.
   - **Parameter Manipulation:** The attacker manipulates the `c_only_fields` parameter within the request to inject SQL code.

**6. Required Attacker Capabilities/Position:**

   - **Unauthenticated Access:** The vulnerability is exploitable by unauthenticated attackers, meaning no prior access or privileges on the target system are necessary.
   - **Network Access:** The attacker must have network access to the target WordPress site in order to make HTTP requests.

**Technical Details:**

- The code diff shows a change around line 435 in `class-lp-rest-courses-v1-controller.php` where the following line was commented out, likely where the vulnerability existed:
`//$params['c_only_fields'] = empty( $params['c_only_fields'] ) ? '' : explode( ',', $params['c_only_fields'] );`
- The vulnerability exists in versions of the LearnPress plugin up to and including 4.2.7. It was fixed in version 4.2.7.1.
- The vulnerability is present because the `c_only_fields` parameter was used directly in an SQL query without proper sanitization.

In summary, this SQL injection vulnerability allows an unauthenticated attacker to extract sensitive data from the WordPress database by injecting malicious SQL code through the `c_only_fields` parameter of the LearnPress plugin's REST API.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.595 |
| 3 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.552 |
| 4 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.545 |
| 5 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.525 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.525 |
| 7 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.523 |
| 8 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | sparse | 0.518 |
| 9 | 943 | Improper Neutralization of Special Elements in Data Query Logic | Class | Allowed-with-Review | dense | 0.502 |
| 10 | 613 | Insufficient Session Expiration | Base | Allowed | graph | 0.002 |

