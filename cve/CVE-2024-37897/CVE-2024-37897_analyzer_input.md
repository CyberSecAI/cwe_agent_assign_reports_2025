# Vulnerability Information: CVE-2024-37897

## Vulnerability Description
SFTPGo is a full-featured and highly configurable SFTP, HTTP/S, FTP/S and WebDAV server - S3, Google Cloud Storage, Azure Blob. SFTPGo WebAdmin and WebClient support password reset. This feature is disabled in the default configuration. In SFTPGo versions prior to v2.6.1, if the feature is enabled, even users with access restrictions (e.g. expired) can reset their password and log in. Users are advised to upgrade to version 2.6.1. Users unable to upgrade may keep the password reset feature disabled or set a blank email address for users and admins with access restrictions so they cannot receive the email with the reset code and exploit the vulnerability.

### Vulnerability Description Key Phrases
- **weakness:** **password reset for restricted users**
- **vector:** access password reset feature
- **attacker:** users with access restrictions
- **product:** SFTPGo
- **version:** prior to v2.6.1
- **component:** WebAdmin and WebClient

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root cause of vulnerability:**
- Insufficient access control during the password reset process.

**Weaknesses/vulnerabilities present:**
-  Users with access restrictions (e.g., expired accounts) could still reset their passwords if the password reset feature is enabled.

**Impact of exploitation:**
- Attackers can bypass access restrictions by resetting the password for restricted user accounts, leading to unauthorized access.

**Attack vectors:**
- Exploitation requires the password reset feature to be enabled in SFTPGo.
- An attacker would need to initiate a password reset process.

**Required attacker capabilities/position:**
- The attacker must have knowledge of a restricted user's account and their username to initiate a password reset process and gain access using the reset.
- The attacker must have the ability to receive the reset code via the configured email address for that restricted user.

**Additional Notes:**
- This vulnerability affects SFTPGo versions prior to v2.6.1.
- The vulnerability is identified as CVE-2024-37897
- The official fix was implemented in version 2.6.1.
- The advisory mentions two workarounds: disabling the password reset feature or setting blank email addresses for restricted users.
- The vulnerability is classified as "Moderate" severity.
- The identified weakness is that even restricted users were allowed to reset their password and log in.

The provided commit diffs show that the fix involved invalidating the user's token after a password change to prevent using the old token with the new password.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 256 | Plaintext Storage of a Password | Base | Allowed | sparse | 0.642 |
| 2 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 0.637 |
| 3 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.618 |
| 4 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.601 |
| 5 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.583 |
| 6 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.579 |
| 7 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.574 |
| 8 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.563 |
| 9 | 640 | Weak Password Recovery Mechanism for Forgotten Password | Base | Allowed-with-Review | dense | 0.435 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.002 |

