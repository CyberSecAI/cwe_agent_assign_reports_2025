# Vulnerability Information: CVE-2024-44953

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolvedscsi ufs core Fix deadlock during RTC updateThere is a deadlock when runtime suspend waits for the flush of RTC work,and the RTC work calls ufshcd_rpm_get_sync() to wait for runtime resume.Here is deadlock backtracekworker/01 D 4892.876354 10 10971 4859 0x4208060 0x8 10 0 120 670730152367ptr f0ffff80c2e40000 0 1 0x00000001 0x000000ff 0x000000ff 0x000000ff __switch_to+0x1a8/0x2d4 __schedule+0x684/0xa98 schedule+0x48/0xc8 schedule_timeout+0x48/0x170 do_wait_for_common+0x108/0x1b0 wait_for_completion+0x44/0x60 __flush_work+0x39c/0x424 __cancel_work_sync+0xd8/0x208 cancel_delayed_work_sync+0x14/0x28 __ufshcd_wl_suspend+0x19c/0x480 ufshcd_wl_runtime_suspend+0x3c/0x1d4 scsi_runtime_suspend+0x78/0xc8 __rpm_callback+0x94/0x3e0 rpm_suspend+0x2d4/0x65c __pm_runtime_suspend+0x80/0x114 scsi_runtime_idle+0x38/0x6c rpm_idle+0x264/0x338 __pm_runtime_idle+0x80/0x110 ufshcd_rtc_work+0x128/0x1e4 process_one_work+0x26c/0x650 worker_thread+0x260/0x3d8 kthread+0x110/0x134 ret_from_fork+0x10/0x20Skip updating RTC if RPM state is not RPM_ACTIVE.

### Vulnerability Description Key Phrases
- **rootcause:** **A deadlock occurs when runtime suspend waits for the flush of RTC work, and the RTC work calls ufshcd_rpm_get_sync() to wait for runtime resume.**
- **weakness:** **Deadlock during runtime suspend and resume operations related to RTC updates in the UFS subsystem.**
- **impact:** System hangs/unresponsive due to deadlock.
- **vector:** The vulnerability is triggered when the system enters a runtime suspend state while an RTC update is pending.
- **attacker:** An attacker can cause a denial of service by triggering runtime suspend while an RTC update is in progress
- **product:** Linux Kernel
- **version:** Not specified
- **component:** scsi ufs core

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** A deadlock occurs in the UFS driver when the runtime suspend process waits for the RTC work to complete, and the RTC work itself calls `ufshcd_rpm_get_sync()` which waits for the runtime resume, creating a circular dependency.

- **Weaknesses/vulnerabilities present:** The vulnerability lies in the incorrect handling of power management and Real-Time Clock (RTC) update within the UFS driver, specifically the usage of `ufshcd_rpm_get_sync()` during RTC work. The RTC update was not checking the current power management state.

- **Impact of exploitation:** The deadlock can lead to a system freeze or unresponsiveness.

- **Attack vectors:** This is not a remote attack vector. This vulnerability is triggered by the device going into runtime suspend, while the RTC work is pending.

- **Required attacker capabilities/position:** An attacker does not have to have special capabilities or a specific position to trigger this bug. The condition can arise normally by a system undergoing runtime suspend, with an RTC update pending.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 833 | Deadlock | Base | Allowed | sparse | 0.445 |
| 2 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.421 |
| 3 | 337 | Predictable Seed in Pseudo-Random Number Generator (PRNG) | Variant | Allowed | sparse | 0.358 |
| 4 | 663 | Use of a Non-reentrant Function in a Concurrent Context | Base | Allowed | sparse | 0.310 |
| 5 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.310 |
| 6 | 345 | Insufficient Verification of Data Authenticity | Class | Discouraged | sparse | 0.307 |
| 7 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.307 |
| 8 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.306 |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | dense | 0.540 |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | Base | Allowed | graph | 0.002 |

