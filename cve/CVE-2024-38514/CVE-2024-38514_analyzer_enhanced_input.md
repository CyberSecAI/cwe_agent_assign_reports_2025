## Vulnerability Description
NextChat is a cross-platform ChatGPT/Gemini UI. There is a Server-Side Request Forgery (SSRF) vulnerability due to a lack of validation of the `endpoint` GET parameter on the WebDav API endpoint. This SSRF can be used to perform arbitrary HTTPS request from the vulnerable instance (MKCOL, PUT and GET methods supported), or to target NextChat users and make them execute arbitrary JavaScript code in their browser. This vulnerability has been patched in version 2.12.4.

### Vulnerability Description Key Phrases
- **rootcause:** **lack of validation of the endpoint GET parameter on the WebDav API endpoint**
- **weakness:** **server-side request forgery**
- **impact:** execute arbitrary JavaScript code in browser
- **product:** NextChat
- **version:** prior to 2.12.4
- **component:** WebDav API endpoint

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from an insufficient validation of the `endpoint` GET parameter within the WebDav API endpoint. The application uses `startsWith()` to check if the provided URL matches a list of allowed domains. This check is inadequate because it does not enforce a trailing slash or specific folder within the allowed domains, allowing an attacker to bypass the SSRF protection.

**Weaknesses/Vulnerabilities:**

*   **Server-Side Request Forgery (SSRF):** The application makes HTTP requests to a URL specified by the user without proper validation, leading to an SSRF vulnerability.
*   **Cross-Site Scripting (XSS):** The ability to make arbitrary HTTPS requests, combined with a lack of output sanitization, allows attackers to inject and execute arbitrary JavaScript code.

**Impact of Exploitation:**

*   **Arbitrary HTTPS Requests:** Attackers can force the server to make requests to any URL, potentially exposing internal resources or interacting with other services on the network.
*   **Cross-Site Scripting (XSS):** By hosting malicious JavaScript code on an attacker-controlled server, the attacker can inject and execute arbitrary JavaScript code in the user's browser within the vulnerable instance's context.

**Attack Vectors:**

*   The vulnerability is triggered by sending a GET request to the `/api/webdav/[...path]/route.ts` endpoint with a crafted `endpoint` parameter.

**Required Attacker Capabilities/Position:**

*   The attacker needs to be able to send HTTP requests to the vulnerable server.
*   The attacker needs to control a server to host a payload for XSS.

**Additional Details:**
*   The application checks if a given URL starts with an allowed domain, but this check is not sufficient to prevent SSRF due to the lack of trailing slash enforcement.
*   The vulnerability exists in versions <= 2.12.3 of `chatgpt-next-web`.
*   The vulnerability is fixed in version 2.12.4 by implementing more robust URL validation.

**Code Snippets:**
*   **Vulnerable Code:** The vulnerability lies in the endpoint validation logic within `app/api/webdav/[...path]/route.ts`. The code uses a `startsWith()` check against a list of allowed domains.
*   **Allowed Domains:** The list of allowed WebDav domains is defined in `app/constant.ts`.

**CVSS Metrics:**
*   CVSS Score: 7.4 (High)
*   CVSS Vector: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N

**CWEs:**
*   CWE-79: Cross-site Scripting
*   CWE-918: Server-Side Request Forgery

This information is more detailed than a typical CVE description and provides specific code locations and attack vectors.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.594 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.533 |
| 3 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.529 |
| 4 | 611 | Improper Restriction of XML External Entity Reference | Base | Allowed | sparse | 0.523 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.522 |
| 6 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.521 |
| 7 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.521 |
| 8 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.519 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.532 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-918: Server-Side Request Forgery (SSRF)

CWE-116: Improper Encoding or Escaping of Output

CWE-306: Missing Authentication for Critical Function

CWE-611: Improper Restriction of XML External Entity Reference

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-790: Improper Filtering of Special Elements

CWE-117: Improper Output Neutralization for Logs