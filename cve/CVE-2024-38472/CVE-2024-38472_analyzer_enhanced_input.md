## Vulnerability Description
**SSRF** in Apache HTTP Server on Windows allows to potentially leak NTML hashes to a malicious server via **SSRF** and malicious requests or content Users are recommended to upgrade to version 2.4.60 which fixes this issue. Note Existing configurations that access UNC paths will have to configure new directive UNCList to allow access during request processing.

### Vulnerability Description Key Phrases
- **weakness:** **SSRF**
- **impact:** leak NTML hashes
- **vector:** SSRF and malicious requests or content
- **product:** Apache HTTP Server
- **version:** prior to 2.4.60

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-38472

**Description:**
The vulnerability is a Server-Side Request Forgery (SSRF) in the Apache HTTP Server on Windows. It allows an attacker to potentially leak NTLM hashes to a malicious server via SSRF using malicious requests or content.

**Root Cause:**
The vulnerability arises from how the Apache HTTP Server on Windows handles requests involving UNC (Universal Naming Convention) paths. The server is vulnerable to being tricked into making requests to attacker-controlled UNC paths, leading to the leakage of NTLM hashes.

**Weaknesses/Vulnerabilities Present:**
- **SSRF (Server-Side Request Forgery):** The core weakness is the server's ability to be coerced into making requests to arbitrary locations.
- **NTLM Hash Leakage:** The SSRF can be exploited to force the server to authenticate to a malicious server using NTLM, potentially leaking the server's NTLM hash.

**Impact of Exploitation:**
- **NTLM Hash Theft:** Successful exploitation allows an attacker to obtain NTLM hashes from the vulnerable server. These hashes can then be cracked to gain further access or used in pass-the-hash attacks.
- **Potential for Further Compromise:** Leaked credentials can potentially be used to pivot to other resources accessible by the compromised server.

**Attack Vectors:**
- **Malicious Requests:** Attackers can craft malicious requests that manipulate the server into accessing attacker-controlled UNC paths.
- **Malicious Content:** Exploitation can occur by serving malicious content that causes the server to initiate an SSRF request upon processing.

**Required Attacker Capabilities/Position:**
- **Network Access:** The attacker needs to be able to send requests to the vulnerable server.
- **Knowledge of UNC Paths:** An understanding of how UNC paths function within the Windows environment is required to properly construct the malicious requests.

**Additional Details (from the provided content):**

- The vulnerability affects Apache HTTP Server versions 2.4.0 through 2.4.59.
- The fix is available in version 2.4.60.
- A new directive, `UNCList`, was introduced in the fix, requiring existing configurations that access UNC paths to configure this directive to allow access during request processing.
- The vulnerability was found by Orange Tsai (@orange_8361) from DEVCORE.
- NetApp products are also affected, specifically ONTAP 9.
- The CVE score is 7.5 (HIGH) with vector CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N

This vulnerability allows for the potential theft of sensitive NTLM hashes, emphasizing the importance of promptly updating to the fixed version.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | alternate_terms | 1.000 |
| 2 | 611 | Improper Restriction of XML External Entity Reference | Base | Allowed | sparse | 0.311 |
| 3 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.306 |
| 4 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.272 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.270 |
| 6 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.269 |
| 7 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.264 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.260 |
| 9 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | dense | 0.541 |
| 10 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-918: Server-Side Request Forgery (SSRF)

CWE-611: Improper Restriction of XML External Entity Reference

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-532: Insertion of Sensitive Information into Log File

CWE-306: Missing Authentication for Critical Function

CWE-138: Improper Neutralization of Special Elements

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')