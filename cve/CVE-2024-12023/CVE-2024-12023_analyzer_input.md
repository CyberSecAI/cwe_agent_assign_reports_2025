# Vulnerability Information: CVE-2024-12023

## Vulnerability Description
The FULL Cliente plugin for WordPress is vulnerable to SQL Injection via the formId parameter in all versions 3.1.5 to 3.1.25 due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**. This makes it possible for authenticated attackers, with Subscriber-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database. This is only exploitable when the PRO version of the plugin is activated, along with Elementor Pro and Elementor CRM.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**
- **weakness:** **SQL injection, SQL injection via the formId parameter**
- **product:** FULL Cliente plugin for WordPress
- **impact:** extract sensitive information from the database
- **attacker:** authenticated attackers
- **version:** all versions 3.1.5 to 3.1.25

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-12023. The code snippets show the `Hooks.php` file from the `full-customer/tags/3.1.25` and `full-customer/tags/3.1.26` versions.  The code handles AJAX requests for CRM form data, including getting leads and form fields.

**Root cause of vulnerability:**

The vulnerability lies in the `getFormFields()` function (lines 181-215 in 3.1.25 and 181-215 in 3.1.26). Specifically, the code constructs a SQL query using user-supplied input (`$formId`) without proper sanitization before including it in the `LIKE` clause.  While the code does sanitize the `$formId` with `sanitize_text_field`, this is insufficient to prevent SQL injection because it's used within a `LIKE` clause with wildcard characters.

**Weaknesses/vulnerabilities present:**

*   **SQL Injection:** The lack of proper sanitization of the `$formId` parameter in the `getFormFields()` function allows an attacker to inject malicious SQL code.

**Impact of exploitation:**

*   **Data Breach:** An attacker could potentially extract sensitive data from the WordPress database, including form submissions, user information, and other application data.
*   **Data Modification:** An attacker could modify or delete data in the database.
*   **Denial of Service:** An attacker could potentially disrupt the application's functionality.

**Attack vectors:**

*   An attacker can send a crafted AJAX request to the `getFormFields()` endpoint with a malicious `$formId` parameter.

**Required attacker capabilities/position:**

*   The attacker needs to be able to send AJAX requests to the WordPress site. This could be an authenticated user (with appropriate permissions) or, potentially, an unauthenticated attacker if the endpoint is not properly protected.

**Mitigation or fix:**

*   **Prepared Statements:** Use prepared statements with bound parameters to prevent SQL injection. This is the most effective mitigation.
*   **Input Validation:**  Strictly validate the `$formId` parameter to ensure it conforms to the expected format (e.g., only alphanumeric characters and hyphens).
*   **Escaping:** If prepared statements are not feasible, properly escape the `$formId` parameter using `esc_sql()` before including it in the SQL query. However, prepared statements are strongly recommended.

**More detail than official CVE description:**

Yes, the code provides specific details about the vulnerable function (`getFormFields()`) and the exact location of the vulnerability within the code. It also shows how the user-supplied input is used in the SQL query, making it easier to understand the attack vector. The code also shows the attempted sanitization and why it is insufficient.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.668 |
| 3 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | sparse | 0.629 |
| 4 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.608 |
| 5 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.607 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.600 |
| 7 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.597 |
| 8 | 284 | Improper Access Control | Pillar | Discouraged | sparse | 0.586 |
| 9 | 472 | External Control of Assumed-Immutable Web Parameter | Base | Allowed | dense | 0.490 |
| 10 | 613 | Insufficient Session Expiration | Base | Allowed | graph | 0.002 |

