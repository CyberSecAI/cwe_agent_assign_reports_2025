## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved Revert media v4l2-ctrls show all owned controls in log_status This reverts commit 9801b5b28c6929139d6fceeee8d739cc67bb2739. This patch introduced a potential deadlock scenario [Wed May 8 100206 2024] Possible **unsafe locking scenario** [Wed May 8 100206 2024] CPU0 CPU1 [Wed May 8 100206 2024] ---- ---- [Wed May 8 100206 2024] lock(vivid_ctrls1620(hdl_vid_cap)->_lock) [Wed May 8 100206 2024] lock(vivid_ctrls1608(hdl_user_vid)->_lock) [Wed May 8 100206 2024] lock(vivid_ctrls1620(hdl_vid_cap)->_lock) [Wed May 8 100206 2024] lock(vivid_ctrls1608(hdl_user_vid)->_lock) For now just revert.

### Vulnerability Description Key Phrases
- **weakness:** **unsafe locking scenario**
- **impact:** potential deadlock
- **vector:** show all owned controls
- **product:** Linux kernel
- **component:** media v4l2-ctrls

## CVE Reference Links Content Summary
The provided content relates to a patch that reverts a previous commit due to a potential deadlock scenario in the Linux kernel's v4l2-ctrls subsystem, specifically in the `v4l2_ctrl_handler_log_status` function. This vulnerability is indirectly related to CVE-2024-36976 as it addresses a specific issue in the Linux Kernel, but there is no direct link to the CVE description.

**Root cause of vulnerability:**
The vulnerability stems from an unsafe locking scenario introduced by the commit being reverted. The `log_status` function, when logging all owned controls, would attempt to lock each control individually, while another thread could be holding a lock on the control handler. This creates a deadlock if the order of locks is reversed in different threads.

**Weaknesses/vulnerabilities present:**
- Potential deadlock in the `v4l2_ctrl_handler_log_status` function.
- Incorrect locking order when logging owned controls.

**Impact of exploitation:**
- The primary impact is a denial-of-service (DoS) condition due to the deadlock. The system may become unresponsive when this deadlock occurs in the kernel.

**Attack vectors:**
- The attack vector would involve triggering the logging of v4l2 control status while another thread is holding locks on the same control handler, creating the deadlock scenario.

**Required attacker capabilities/position:**
- An attacker would need to be able to trigger the `v4l2_ctrl_handler_log_status` function while other threads are accessing the same control handler, which would likely require some level of control over system resources and the ability to interact with video devices and their controls.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.353 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.314 |
| 3 | 1427 | Improper Neutralization of Input Used for LLM Prompting | Base | Allowed | sparse | 0.262 |
| 4 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.259 |
| 5 | 663 | Use of a Non-reentrant Function in a Concurrent Context | Base | Allowed | sparse | 0.257 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.252 |
| 7 | 267 | Privilege Defined With Unsafe Actions | Base | Allowed | sparse | 0.246 |
| 8 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.245 |
| 9 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | dense | 0.541 |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-667: Improper Locking

CWE-833: Deadlock

CWE-1427: Improper Neutralization of Input Used for LLM Prompting

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-663: Use of a Non-reentrant Function in a Concurrent Context

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-267: Privilege Defined With Unsafe Actions

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-1265: Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls