# Vulnerability Information: CVE-2025-27399

## Vulnerability Description
Mastodon is a self-hosted, federated microblogging platform. In versions prior to 4.1.23, 4.2.16, and 4.3.4, when the visibility for domain blocks/reasons is set to users (localized English string To logged-in users), users that are not yet approved can view the block reasons. Instance admins that do not want their domain blocks to be public are impacted. Versions 4.1.23, 4.2.16, and 4.3.4 fix the issue.

### Vulnerability Description Key Phrases
- **impact:** users that are not yet approved can view the block reasons
- **product:** Mastodon
- **version:** prior to 4.1.23, 4.2.16, and 4.3.4

## CVE Reference Links Content Summary
## CVE-2025-27399 Analysis

The provided content relates to CVE-2025-27399. Here's a breakdown of the vulnerability information extracted from the GitHub advisory:

**Root cause of vulnerability:**

The code does not check if a logged-in user is *approved* or has *confirmed their email address* when the visibility for domain blocks/reasons is set to "users". It only checks if a user is logged in.

**Weaknesses/vulnerabilities present:**

*   **CWE-200:** Improper Input Validation (specifically, lack of proper authorization checks).
*   **CWE-285:** Improper Authorization.

**Impact of exploitation:**

Instance admins who do not want their domain blocks to be public, but still visible to their users, are impacted.  Unapproved and unconfirmed users can view domain blocks intended only for approved users.

**Attack vectors:**

*   Network accessible. No specific attack vector details are provided beyond needing to create an unapproved/unconfirmed account.

**Required attacker capabilities/position:**

*   An attacker needs to create a user account that is unapproved (not approved by a moderator) and has not confirmed their email address. No elevated privileges are required.

**Mitigation or fix:**

The vulnerability was patched in versions:

*   4.3.4
*   4.2.16
*   4.1.23

The fix, as evidenced by the commit diff, modifies the `show_domain_blocks_to_user?` and `show_rationale_for_user?` methods in `app/controllers/api/v1/instances/domain_blocks_controller.rb` to include a check for `current_user.functional_or_moved?`. This ensures that only approved and functional users can view the domain blocks when visibility is set to "users".

**Additional Details (more than official CVE description):**

*   The commit `6b519cf` details the fix and includes tests to verify the corrected behavior.
*   The advisory provides CVSS v3 metrics: AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N (Overall score: 5.3/10).
*   The advisory credits @kescherCode for reporting the vulnerability.
*   The advisory also details that suspended and moved users are now handled correctly.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.139 |
| 2 | 267 | Privilege Defined With Unsafe Actions | Base | Allowed | sparse | 0.134 |
| 3 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.131 |
| 4 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.131 |
| 5 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.131 |
| 6 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | sparse | 0.130 |
| 7 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.130 |
| 8 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.128 |
| 9 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | Base | Allowed | dense | 0.333 |
| 10 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | graph | 0.002 |

