# Vulnerability Information: CVE-2024-52308

## Vulnerability Description
The GitHub CLI version 2.6.1 and earlier are vulnerable to remote code execution through a malicious codespace SSH server when using `gh codespace ssh` or `gh codespace logs` commands. This has been patched in the cli v2.62.0. Developers connect to remote codespaces through an SSH server running within the devcontainer, which is generally provided through the [default devcontainer image]( https//docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-... https//docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers#using-the-default-dev-container-configuration) . GitHub CLI [retrieves SSH connection details]( https//github.com/cli/cli/blob/30066b0042d0c5928d959e288144300cb28196c9/internal/codespaces/rpc/inv... https//github.com/cli/cli/blob/30066b0042d0c5928d959e288144300cb28196c9/internal/codespaces/rpc/invoker.go#L230-L244 ), such as remote username, which is used in [executing `ssh` commands]( https//github.com/cli/cli/blob/e356c69a6f0125cfaac782c35acf77314f18908d/pkg/cmd/codespace/ssh.go#L2... https//github.com/cli/cli/blob/e356c69a6f0125cfaac782c35acf77314f18908d/pkg/cmd/codespace/ssh.go#L263 ) for `gh codespace ssh` or `gh codespace logs` commands. This exploit occurs when a malicious third-party devcontainer contains a modified SSH server that injects `ssh` arguments within the SSH connection details. `gh codespace ssh` and `gh codespace logs` commands could execute arbitrary code on the users workstation if the remote username contains something like `-oProxyCommand=echo hacked #`. The `-oProxyCommand` flag causes `ssh` to execute the provided command while `#` shell comment causes any other `ssh` arguments to be ignored. In `2.62.0`, the remote username information is being validated before being used.

### Vulnerability Description Key Phrases
- **weakness:** **improper input validation**
- **impact:** execute arbitrary code and remote code execution
- **vector:** malicious third-party devcontainer
- **product:** GitHub CLI
- **version:** 2.6.1 and earlier
- **component:** gh codespace ssh and gh codespace logs commands

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability lies in how GitHub CLI handles SSH connection details retrieved from a Codespace. Specifically, the CLI does not properly sanitize the remote username before using it in an `ssh` command. This allows an attacker to inject malicious arguments into the `ssh` command via a crafted remote username.

**Weaknesses/Vulnerabilities:**

*   **Insufficient Input Sanitization:** The primary weakness is the lack of sanitization or validation of the remote username obtained from the Codespace.
*   **Command Injection:** The injected `ssh` arguments within the username can lead to command execution.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** An attacker can execute arbitrary commands on the user's workstation, potentially gaining full control over the user's system.
*   **Data Compromise:** Sensitive data stored on the compromised workstation could be accessed or exfiltrated.
*   **System Compromise:**  The compromised system could be used as a stepping stone for further attacks.

**Attack Vectors:**

*   **Malicious Devcontainer:** The attack requires a malicious devcontainer image that has a modified SSH server. This server injects the malicious `ssh` arguments into the remote username it provides to the GitHub CLI.
*   **`gh codespace ssh` or `gh codespace logs` Commands:** The attack is triggered when a user connects to the malicious Codespace using `gh codespace ssh` or `gh codespace logs`.

**Required Attacker Capabilities/Position:**

*   **Ability to create malicious devcontainer:** The attacker needs the ability to create or modify a devcontainer image to include a malicious SSH server.
*   **Victim interaction:** The victim needs to use the GitHub CLI to connect to the malicious Codespace.

**Additional Details:**

*   The vulnerability is located within the `gh` CLI tool, specifically in the way it retrieves and uses SSH connection details.
*   The exploit leverages the `-oProxyCommand` option in the `ssh` command to execute arbitrary commands.
*   The issue is resolved in `gh` version 2.62.0, which now validates the remote username.

This is more detailed than the placeholder description.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 668 | Exposure of Resource to Wrong Sphere | Class | Discouraged | sparse | 1.054 |
| 2 | 214 | Invocation of Process Using Visible Sensitive Information | Base | Allowed | sparse | 0.979 |
| 3 | 321 | Use of Hard-coded Cryptographic Key | Variant | Allowed | sparse | 0.978 |
| 4 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.978 |
| 5 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.976 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.963 |
| 7 | 335 | Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG) | Base | Allowed | sparse | 0.957 |
| 8 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.946 |
| 9 | 863 | Incorrect Authorization | Class | Allowed-with-Review | dense | 0.601 |
| 10 | 942 | Permissive Cross-domain Policy with Untrusted Domains | Variant | Allowed | graph | 0.003 |

