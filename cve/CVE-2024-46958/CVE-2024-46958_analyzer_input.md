# Vulnerability Information: CVE-2024-46958

## Vulnerability Description
In Nextcloud Desktop Client 3.13.1 through 3.13.3 on Linux, synchronized files (between the server and client) may become world writable or world readable. This is fixed in 3.13.4.

### Vulnerability Description Key Phrases
- **weakness:** **race condition**
- **impact:** make synchronized files world writable or world readable
- **product:** Nextcloud Desktop Client
- **version:** 3.13.1 through 3.13.3

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability related to CVE-2024-46958:

**Summary:** The provided content describes a bug fix related to incorrect file/folder permissions being set by the Nextcloud desktop client during synchronization. Specifically, the client was adding write permissions for "group" and "others" to folders, beyond the intended "owner" write permissions. This issue was resolved by narrowing the permissions to only the owner.

**Root Cause of Vulnerability:**

*   The Nextcloud desktop client, when setting `FileSystem::FolderPermissions::ReadWrite` on a folder, was incorrectly adding write permissions for the group and others, not just the owner. This was introduced in a previous change (PR #6839).

**Weaknesses/Vulnerabilities Present:**

*   **Excessive Permissions:** The client was granting broader write permissions than intended, making folders writable by group members and other users on the system.
*   **Incorrect Permission Handling**: The client's logic for setting folder permissions was flawed, leading to unintended consequences.

**Impact of Exploitation:**

*   **Data Modification:**  Exploitation of this vulnerability would allow unintended users (group or others) to modify or delete data within synchronized folders, if they have local file access.
*   **Privacy Violation**: If a user intended to have private folders, the incorrect permissions could expose the data to other users.

**Attack Vectors:**

*   **Local File Access**: An attacker must have local access to the system where the Nextcloud client is running, in order to leverage the excessive permissions.

**Required Attacker Capabilities/Position:**

*   **Local User**: The attacker needs to be a user on the system where the affected Nextcloud client is running and must be able to access the affected directory with the wrong permissions.

**Additional Details:**

*   The issue was addressed in pull request #6949, which narrowed down the permissions to owner-only, and backported to the stable-3.13 branch via pull request #7092, resulting in the release of version 3.13.4.
*   The bug was reported for versions 3.13.1, 3.13.2 and 3.13.3, and affected Linux and MacOS systems.
*   The fix involves modifying how the client sets file system permissions when it encounters `FileSystem::FolderPermissions::ReadWrite`.

**In summary, the vulnerability was due to the Nextcloud desktop client incorrectly setting folder permissions, granting write access to unintended users. The fix implemented in PR #6949 corrects the permission setting, narrowing down write permissions to only the owner of the folder and is available in version 3.13.4.**

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.200 |
| 3 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.190 |
| 4 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.189 |
| 5 | 277 | Insecure Inherited Permissions | Variant | Allowed | sparse | 0.174 |
| 6 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.173 |
| 7 | 459 | Incomplete Cleanup | Base | Allowed | sparse | 0.172 |
| 8 | 415 | Double Free | Variant | Allowed | sparse | 0.171 |
| 9 | 363 | Race Condition Enabling Link Following | Base | Allowed | dense | 0.443 |
| 10 | 689 | Permission Race Condition During Resource Copy | Compound | Allowed | graph | 0.003 |

