{
  "cve_id": "CVE-2025-21823",
  "description": "In the Linux kernel, the following vulnerability has been resolved batman-adv Drop unmanaged ELP metric worker The ELP worker needs to calculate new metric values for all neighbors reachable over an interface. Some of the used metric sources require locks which might need to sleep. This sleep is incompatible with the RCU list iterator used for the recorded neighbors. The initial approach to work around of this problem was to queue another work item per neighbor and then run this in a new context. Even when this solved the RCU vs might_sleep() conflict, it has a major problems Nothing was stopping the work item in case it is not needed anymore - for example because one of the related interfaces was removed or the batman-adv module was unloaded - resulting in potential invalid memory accesses. Directly canceling the metric worker also has various problems * cancel_work_sync for a to-be-deactivated interface is called with rtnl_lock held. But the code in the ELP metric worker also tries to use rtnl_lock() - which will never return in this case. This also means that cancel_work_sync would never return because it is waiting for the worker to finish. * iterating over the neighbor list for the to-be-deactivated interface is currently done using the RCU specific methods. Which means that it is possible to miss items when iterating over it without the associated spinlock - a behaviour which is acceptable for a periodic metric check but not for a cleanup routine (which must stop all still running workers) The better approch is to get rid of the per interface neighbor metric worker and handle everything in the interface worker. The original problems are solved by * creating a list of neighbors which require new metric information inside the RCU protected context, gathering the metric according to the new list outside the RCU protected context * only use rcu_trylock inside metric gathering code to avoid a deadlock when the cancel_delayed_work_sync is called in the interface removal code (which is called with the rtnl_lock held)",
  "key_phrases": {
    "rootcause": "incompatible sleep and RCU list iterator",
    "weakness": "",
    "impact": "potential invalid memory accesses",
    "vector": "",
    "attacker": "",
    "product": "Linux kernel",
    "version": "",
    "component": "batman-adv Drop unmanaged ELP metric worker"
  },
  "reference_content": null,
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 0.8 | Class | Allowed-with-Review | Primary CWE. The vulnerability involves concurrent code accessing a shared resource without proper synchronization, leading to potential data corruption or unexpected behavior.|\n| CWE-833 | Deadlock | 0.6 | Base | Allowed | Secondary Candidate. The description mentions a scenario where locks are held and the code waits indefinitely, which is characteristic of a deadlock situation.|\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.7\n*   **Evidence Strength:** MEDIUM\n\n## Relationship Analysis\nThe primary CWE is CWE-362 (Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')). CWE-362 is a Class-level CWE. The vulnerability description indicates that there's concurrent execution and a shared resource, but synchronization is **improper**, potentially leading to race conditions.\nCWE-833 (Deadlock) is included because the description mentions a scenario where `rtnl_lock` is held and the ELP metric worker also tries to use it, resulting in a situation where the code will never return, indicating a potential deadlock.\n\n```mermaid\ngraph TD\n    cwe362[\"CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\"]\n    cwe667[\"CWE-667: Improper Locking\"]\n    cwe833[\"CWE-833: Deadlock\"]\n\n    cwe362 -->|PARENT_OF| cwe667\n    cwe833 -->|RELATED_TO| cwe362\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe362 primary\n    class cwe833 secondary\n    class cwe667 tertiary\n```\n\n## Vulnerability Chain\nThe vulnerability chain begins with the **improper** handling of concurrent operations (CWE-362). The **root cause** involves an **incompatible sleep and RCU list iterator**. The impact includes potential invalid memory accesses. There's also a deadlock scenario described, which can be considered a consequence of the **improper** synchronization, solidifying the link to CWE-833.\n\n## Summary of Analysis\nThe analysis indicates that the primary weakness is CWE-362 because the **root cause** involves **improper** synchronization leading to potential concurrency issues. The supporting evidence includes the description of an **incompatible sleep and RCU list iterator**. The secondary weakness is CWE-833, as the description clearly states a deadlock situation where `rtnl_lock` is held, and the ELP metric worker is also trying to use it. The selection of CWE-362 as the primary weakness and CWE-833 as a secondary weakness is based on the retriever results, the vulnerability description, and the relationship analysis. The confidence is high because the evidence supports both CWEs.\n\nThe retriever results suggest considering CWE-863 (Incorrect Authorization), CWE-306 (Missing Authentication for Critical Function), CWE-212 (Improper Removal of Sensitive Information Before Storage or Transfer), and CWE-770 (Allocation of Resources Without Limits or Throttling). However, these CWEs do not align as closely with the provided vulnerability description as CWE-362 and CWE-833. The description does not include any evidence of authorization issues, missing authentication, sensitive data handling problems, or resource allocation issues, thus eliminating these candidates.\n\nRelevant CWE Information:\n- CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\n- CWE-833: Deadlock",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 0.8 | Class | Allowed-with-Review | Primary CWE. The vulnerability involves concurrent code accessing a shared resource without proper synchronization, leading to potential data corruption or unexpected behavior.|\n| CWE-833 | Deadlock | 0.6 | Base | Allowed | Secondary Candidate. The description mentions a scenario where locks are held and the code waits indefinitely, which is characteristic of a deadlock situation.|\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.7\n*   **Evidence Strength:** MEDIUM\n\n## Relationship Analysis\nThe primary CWE is CWE-362 (Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')). CWE-362 is a Class-level CWE. The vulnerability description indicates that there's concurrent execution and a shared resource, but synchronization is **improper**, potentially leading to race conditions.\nCWE-833 (Deadlock) is included because the description mentions a scenario where `rtnl_lock` is held and the ELP metric worker also tries to use it, resulting in a situation where the code will never return, indicating a potential deadlock.\n\n```mermaid\ngraph TD\n    cwe362[\"CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\"]\n    cwe667[\"CWE-667: Improper Locking\"]\n    cwe833[\"CWE-833: Deadlock\"]\n\n    cwe362 -->|PARENT_OF| cwe667\n    cwe833 -->|RELATED_TO| cwe362\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe362 primary\n    class cwe833 secondary\n    class cwe667 tertiary\n```\n\n## Vulnerability Chain\nThe vulnerability chain begins with the **improper** handling of concurrent operations (CWE-362). The **root cause** involves an **incompatible sleep and RCU list iterator**. The impact includes potential invalid memory accesses. There's also a deadlock scenario described, which can be considered a consequence of the **improper** synchronization, solidifying the link to CWE-833.\n\n## Summary of Analysis\nThe analysis indicates that the primary weakness is CWE-362 because the **root cause** involves **improper** synchronization leading to potential concurrency issues. The supporting evidence includes the description of an **incompatible sleep and RCU list iterator**. The secondary weakness is CWE-833, as the description clearly states a deadlock situation where `rtnl_lock` is held, and the ELP metric worker is also trying to use it. The selection of CWE-362 as the primary weakness and CWE-833 as a secondary weakness is based on the retriever results, the vulnerability description, and the relationship analysis. The confidence is high because the evidence supports both CWEs.\n\nThe retriever results suggest considering CWE-863 (Incorrect Authorization), CWE-306 (Missing Authentication for Critical Function), CWE-212 (Improper Removal of Sensitive Information Before Storage or Transfer), and CWE-770 (Allocation of Resources Without Limits or Throttling). However, these CWEs do not align as closely with the provided vulnerability description as CWE-362 and CWE-833. The description does not include any evidence of authorization issues, missing authentication, sensitive data handling problems, or resource allocation issues, thus eliminating these candidates.\n\nRelevant CWE Information:\n- CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\n- CWE-833: Deadlock\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-863:**\n- 863 (Incorrect Authorization) - ROOT\n\n\n**Chain starting from CWE-770:**\n- 770 (Allocation of Resources Without Limits or Throttling) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "863",
        "name": "Incorrect Authorization",
        "source": "sparse"
      },
      "similarity": 1574.4170691594854
    },
    {
      "metadata": {
        "doc_id": "923",
        "name": "Improper Restriction of Communication Channel to Intended Endpoints",
        "source": "sparse"
      },
      "similarity": 1521.9305698903388
    },
    {
      "metadata": {
        "doc_id": "306",
        "name": "Missing Authentication for Critical Function",
        "source": "sparse"
      },
      "similarity": 1521.6106819573363
    },
    {
      "metadata": {
        "doc_id": "212",
        "name": "Improper Removal of Sensitive Information Before Storage or Transfer",
        "source": "sparse"
      },
      "similarity": 1516.0279940082364
    },
    {
      "metadata": {
        "doc_id": "833",
        "name": "Deadlock",
        "source": "sparse"
      },
      "similarity": 1502.3206096668148
    },
    {
      "metadata": {
        "doc_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "source": "sparse"
      },
      "similarity": 1492.2388151092662
    },
    {
      "metadata": {
        "doc_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "source": "sparse"
      },
      "similarity": 1490.1279494778498
    },
    {
      "metadata": {
        "doc_id": "296",
        "name": "Improper Following of a Certificate's Chain of Trust",
        "source": "sparse"
      },
      "similarity": 1489.0674748913852
    },
    {
      "metadata": {
        "doc_id": "667",
        "name": "Improper Locking",
        "type": "Class",
        "original_content": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors.",
        "keyphrase_source": "rootcause:incompatible sleep",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed-with-Review",
          "rationale": "This CWE entry is a Class and might have Base-level children that would be more appropriate",
          "comments": "Examine children of this entry to see if there is a better fit",
          "reasons": [
            "Abstraction"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "dense": 0.47054546535141706
          }
        }
      },
      "similarity": 0.47054546535141706
    },
    {
      "doc_id": "322",
      "text": "CWE-322: Key Exchange without Entity Authentication",
      "score": 2.8651999999999997,
      "metadata": {
        "doc_id": "322",
        "name": "Key Exchange without Entity Authentication",
        "type": "base",
        "original_content": "CWE-322: Key Exchange without Entity Authentication",
        "relationships": [
          {
            "source_id": "322",
            "target_id": "295",
            "label": "PEEROF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "322",
            "target_id": "923",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "322",
            "target_id": "306",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "923",
            "target_id": "322",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "306",
            "target_id": "322",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "295",
            "target_id": "322",
            "label": "PEEROF",
            "properties": {
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "abstraction_path": 0.7200000000000001,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "abstraction_path_down",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "923",
                  "322",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "923"
            },
            "abstraction_path_down": {
              "path": [
                [
                  "306",
                  "322",
                  "PARENTOF"
                ]
              ],
              "score": 0.7200000000000001,
              "type": "abstraction_path_down",
              "source": "306"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "923",
                  "322",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "923"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "322",
                  "923",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "923"
            }
          }
        },
        "abstraction_level": "base",
        "position": "before",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.8651999999999997
          }
        }
      },
      "similarity": 2.8651999999999997
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-863",
      "CWE-770",
      "CWE-667",
      "CWE-833",
      "CWE-306",
      "CWE-362",
      "CWE-212"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}