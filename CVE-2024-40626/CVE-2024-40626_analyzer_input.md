# Vulnerability Information: CVE-2024-40626

## Vulnerability Description
Outline is an open source, collaborative document editor. A **type confusion issue** was found in ProseMirrors rendering process that leads to a Stored **Cross-Site Scripting** (XSS) vulnerability in Outline. An authenticated user can create a document containing a malicious JavaScript payload. When other users view this document, the malicious Javascript can execute in the origin of Outline. Outline includes CSP rules to prevent third-party code execution, however in the case of self-hosting and having your file storage on the same domain as Outline a malicious payload can be uploaded as a file attachment and bypass those CSP restrictions. This issue has been addressed in release version 0.77.3. Users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **type confusion issue**
- **weakness:** **Cross-Site Scripting**
- **impact:** Stored Cross-Site Scripting (XSS)
- **vector:** malicious JavaScript payload
- **attacker:** authenticated user
- **product:** Outline
- **version:** before 0.77.3
- **component:** ProseMirrors rendering process

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** A type confusion issue in ProseMirror's rendering process.
- **Weaknesses/vulnerabilities present:** Stored Cross-Site Scripting (XSS) vulnerability (CWE-843: Improperly Controlled Modification of Object Prototype Attributes)
- **Impact of exploitation:** An attacker can inject malicious JavaScript code into a document. When other users view this document, the injected JavaScript can execute within the context of the Outline application. This could lead to unauthorized actions, data theft, or other malicious activities. Additionally, if the file storage is on the same domain as Outline, a malicious payload can be uploaded as a file attachment and bypass CSP restrictions, increasing the attack surface.
- **Attack vectors:** Network-based attack. The attacker creates a malicious document using the Outline editor. When other users view the document, the vulnerability is triggered. If self-hosted, the file storage being on the same domain allows for malicious file attachments bypassing CSP restrictions.
- **Required attacker capabilities/position:** The attacker needs to be an authenticated user capable of creating documents in Outline. The attacker does not need to be local to the system.

The provided content gives more details than the official CVE description by including specific details about the type confusion in the rendering process, the bypass of CSP restrictions via file attachments, and a link to a blog post that explains the vulnerability in more detail.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.775 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.700 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.666 |
| 4 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.665 |
| 5 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.664 |
| 6 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.649 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.644 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.640 |
| 9 | 80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | dense | 0.501 |
| 10 | 494 | Download of Code Without Integrity Check | Base | Allowed | graph | 0.002 |

