## Vulnerability Description
Refit is an automatic type-safe REST library for .NET Core, Xamarin and .NET The various header-related Refit attributes (Header, HeaderCollection and Authorize) are vulnerable to **CRLF injection**. The way HTTP headers are added to a request is via the `HttpHeaders.TryAddWithoutValidation` method. This method does not check for CRLF characters in the header value. This means that any headers added to a refit request are vulnerable to CRLF-injection. In general, CRLF-injection into a HTTP header (when using HTTP/1.1) means that one can inject additional HTTP headers or smuggle whole HTTP requests. If an application using the Refit library passes a user-controllable value through to a header, then that application becomes vulnerable to CRLF-injection. This is not necessarily a security issue for a command line application like the one above, but if such code were present in a web application then it becomes vulnerable to request splitting (as shown in the PoC) and thus Server Side Request Forgery. Strictly speaking this is a potential vulnerability in applications using Refit and not in Refit itself. This issue has been addressed in release versions 7.2.22 and 8.0.0 and all users are advised to upgrade. There are no known workarounds for this vulnerability.

### Vulnerability Description Key Phrases
- **rootcause:** **improper input sanitization**
- **weakness:** **CRLF injection**
- **impact:** Server Side Request Forgery
- **vector:** passing user-controllable value through to header
- **product:** Refit
- **component:** various header-related attributes

## CVE Reference Links Content Summary
```
{
  "Root cause of vulnerability": "The `HttpHeaders.TryAddWithoutValidation` method, used by Refit to add headers to HTTP requests, does not check for CRLF characters in the header value.",
  "Weaknesses/vulnerabilities present": "CRLF injection vulnerability in the `Header`, `HeaderCollection`, and `Authorize` attributes of Refit. This allows injecting arbitrary headers and smuggling HTTP requests.",
  "Impact of exploitation": "An attacker can inject additional HTTP headers or smuggle whole HTTP requests. This can lead to request splitting and Server Side Request Forgery (SSRF) if user-controlled values are passed to headers.",
  "Attack vectors": "By injecting CRLF characters into a user-controlled value that is subsequently used in a Refit header attribute (Header, HeaderCollection, or Authorize).",
  "Required attacker capabilities/position": "The attacker needs to control or influence a value that is used to populate an HTTP header via Refit attributes. This might involve user input or manipulation of data that ends up in a header."
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | sparse | 1.375 |
| 2 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 1.371 |
| 3 | 444 | Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling') | Base | Allowed | sparse | 1.184 |
| 4 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 1.178 |
| 5 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 1.142 |
| 6 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 1.131 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 1.125 |
| 8 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 1.120 |
| 9 | 1289 | Improper Validation of Unsafe Equivalence in Input | Base | Allowed | dense | 0.497 |
| 10 | 41 | Improper Resolution of Path Equivalence | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-113: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting')

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-444: Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')

CWE-138: Improper Neutralization of Special Elements

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-1333: Inefficient Regular Expression Complexity

CWE-1289: Improper Validation of Unsafe Equivalence in Input

CWE-41: Improper Resolution of Path Equivalence