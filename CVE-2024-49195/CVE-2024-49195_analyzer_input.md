# Vulnerability Information: CVE-2024-49195

## Vulnerability Description
Mbed TLS 3.5.x through 3.6.x before 3.6.2 has a **buffer underrun** in pkwrite when writing an opaque key pair

### Vulnerability Description Key Phrases
- **weakness:** **buffer underrun**
- **product:** Mbed TLS
- **version:** 3.5.x through 3.6.x before 3.6.2
- **component:** pkwrite

## CVE Reference Links Content Summary
The provided content is related to CVE-2024-49195.

**Root cause of vulnerability:**
The functions `mbedtls_pk_write_key_der()` and `mbedtls_pk_write_key_pem()` can cause a buffer underrun when the output buffer is too small in certain cases. This occurs when the code writes data to an intermediate buffer and then copies it to the output buffer without verifying if the output buffer is large enough.

**Weaknesses/vulnerabilities present:**
- Buffer underrun in `mbedtls_pk_write_key_der()` and `mbedtls_pk_write_key_pem()`.
- Insufficient output buffer size check when writing an opaque key pair.

**Impact of exploitation:**
- Stack or heap corruption due to buffer underrun.

**Attack vectors:**
- Calling the vulnerable functions with an output buffer that is too small.

**Required attacker capabilities/position:**
- Ability to call `mbedtls_pk_write_key_der()` or `mbedtls_pk_write_key_pem()` with a crafted output buffer and a PK context containing an opaque key.
- The compile-time option `MBEDTLS_USE_PSA_CRYPTO` must be enabled.
- For elliptic curve keys, `MBEDTLS_ECP_C` must be enabled, and the output buffer must be smaller than the uncompressed public key representation.
- For RSA keys with `mbedtls_pk_write_key_der()`, the buffer must be smaller than the actual output.
- For RSA keys with `mbedtls_pk_write_key_pem()`, `MBEDTLS_MPI_MAX_SIZE` must be less than or equal to 420.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 124 | Buffer Underwrite ('Buffer Underflow') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 126 | Buffer Over-read | Variant | Allowed | sparse | 0.131 |
| 3 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | sparse | 0.124 |
| 4 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.118 |
| 5 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.116 |
| 6 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.116 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.114 |
| 8 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 0.110 |
| 9 | 805 | Buffer Access with Incorrect Length Value | Base | Allowed | dense | 0.489 |
| 10 | 131 | Incorrect Calculation of Buffer Size | Base | Allowed | graph | 0.002 |

