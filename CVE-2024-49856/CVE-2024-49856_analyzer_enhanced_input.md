## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved x86/sgx Fix **deadlock in SGX NUMA node search** When the current node doesnt have an EPC section configured by firmware and all other EPC sections are used up, CPU can get stuck inside the while loop that looks for an available EPC page from remote nodes indefinitely, leading to a soft lockup. Note how nid_of_current will never be equal to nid in that while loop because nid_of_current is not set in sgx_numa_mask. Also worth mentioning is that its perfectly fine for the firmware not to setup an EPC section on a node. While setting up an EPC section on each node can enhance performance, it is not a requirement for functionality. Rework the loop to start and end on *a* node that has SGX memory. This avoids the deadlock looking for the current SGX-lacking node to show up in the loop when it never will.

### Vulnerability Description Key Phrases
- **rootcause:** **deadlock in SGX NUMA node search**
- **impact:** soft lockup
- **product:** Linux kernel
- **component:** x86/sgx

## CVE Reference Links Content Summary
- **Root cause of vulnerability:** The vulnerability lies in the NUMA node search logic within the `__sgx_alloc_epc_page` function. When the current node lacks an EPC section, and all other EPC sections are exhausted, the function could get stuck in an infinite loop while searching for an available EPC page from remote nodes, causing a soft lockup. The `nid_of_current` was not part of the `sgx_numa_mask`, causing the loop to never terminate if the node didn't have SGX support.
- **Weaknesses/vulnerabilities present:** The main vulnerability is a deadlock scenario within the allocation logic due to a flawed loop condition when searching for an EPC page across NUMA nodes.
- **Impact of exploitation:** The primary impact of exploiting this vulnerability is a soft lockup, effectively rendering the affected CPU core unresponsive.
- **Attack vectors:** This isn't an externally triggered vulnerability. The deadlock can be triggered internally in the allocation process if an SGX application requests EPC memory and the system's NUMA configuration leads to the described deadlock conditions.
- **Required attacker capabilities/position:** The attacker does not directly exploit the vulnerability. It is triggered by the normal SGX memory allocation mechanism under specific circumstances involving node configuration and resource usage.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | sparse | 0.837 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.819 |
| 3 | 335 | Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG) | Base | Allowed | sparse | 0.811 |
| 4 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.809 |
| 5 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.808 |
| 6 | 295 | Improper Certificate Validation | Base | Allowed | sparse | 0.798 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.795 |
| 8 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | Base | Allowed | sparse | 0.778 |
| 9 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | Allowed | dense | 0.522 |
| 10 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-835: Loop with Unreachable Exit Condition ('Infinite Loop')

CWE-833: Deadlock

CWE-335: Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG)

CWE-400: Uncontrolled Resource Consumption

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-295: Improper Certificate Validation

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-212: Improper Removal of Sensitive Information Before Storage or Transfer

CWE-1342: Information Exposure through Microarchitectural State after Transient Execution

CWE-789: Memory Allocation with Excessive Size Value