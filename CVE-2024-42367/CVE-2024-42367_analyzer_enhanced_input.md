## Vulnerability Description
aiohttp is an asynchronous HTTP client/server framework for asyncio and Python. Prior to version 3.10.2, static routes which contain files with compressed variants (`.gz` or `.br` extension) are vulnerable to **path traversal** outside the root directory if those variants are symbolic links. The server protects static routes from **path traversal** outside the root directory when `follow_symlinks=False` (default). It does this by resolving the requested URL to an absolute path and then checking that path relative to the root. However, these checks are not performed when looking for compressed variants in the `FileResponse` class, and symbolic links are then automatically followed when performing the `Path.stat()` and `Path.open()` to send the file. Version 3.10.2 contains a patch for the issue.

### Vulnerability Description Key Phrases
- **weakness:** **path traversal**
- **attacker:** attacker
- **product:** aiohttp
- **version:** Prior to version 3.10.2
- **component:** static routes

## CVE Reference Links Content Summary
```
{
  "guidelines": "1. First verify if the content relates to the CVE specified based on the official description\n2. If the content does not relate to this CVE, respond with \"UNRELATED\"\n3. If no useful vulnerability information is found, respond with \"NOINFO\" \n4. For relevant content, extract:\n   - Root cause of vulnerability\n   - Weaknesses/vulnerabilities present\n   - Impact of exploitation\n   - Attack vectors\n   - Required attacker capabilities/position\n\nAdditional instructions:\n- Preserve original technical details and descriptions\n- Remove unrelated content\n- Translate non-English content to English\n- Note if the content provides more detail than the official CVE description",
  "response": {
    "related": true,
    "information": {
      "root_cause": "The server does not perform path traversal checks when looking for compressed file variants in the `FileResponse` class. When serving static files, if a compressed variant (.gz or .br) of a file exists as a symbolic link, the server will automatically follow the symbolic link when performing `Path.stat()` and `Path.open()`. This bypasses the intended path traversal protection, which only checks the resolved path relative to the root when `follow_symlinks=False`.",
      "vulnerabilities": [
        "Path Traversal",
        "Incorrect symlink handling"
      ],
      "impact": "An attacker can potentially read arbitrary files outside of the intended static file directory. This could lead to information disclosure of sensitive files.",
      "attack_vectors": [
        "Create a symbolic link to a target file outside of the static directory, and give the link the same name as the requested resource with a '.gz' or '.br' suffix.",
         "Access a static route file via a crafted path using compressed variants as symlinks."
      ],
      "attacker_capabilities": "An attacker needs the ability to create or upload a symbolic link within the static file directory, or have prior knowledge of vulnerable symlinks present in the directory."
    }
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.763 |
| 3 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.700 |
| 4 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.668 |
| 5 | 427 | Uncontrolled Search Path Element | Base | Allowed | sparse | 0.622 |
| 6 | 36 | Absolute Path Traversal | Base | Allowed | sparse | 0.615 |
| 7 | 73 | External Control of File Name or Path | Base | Allowed | sparse | 0.606 |
| 8 | 41 | Improper Resolution of Path Equivalence | Base | Allowed | sparse | 0.600 |
| 9 | 24 | Path Traversal: '../filedir' | Variant | Allowed | dense | 0.409 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-23: Relative Path Traversal

CWE-61: UNIX Symbolic Link (Symlink) Following

CWE-427: Uncontrolled Search Path Element

CWE-36: Absolute Path Traversal

CWE-73: External Control of File Name or Path

CWE-41: Improper Resolution of Path Equivalence

CWE-24: Path Traversal: '../filedir'

CWE-363: Race Condition Enabling Link Following