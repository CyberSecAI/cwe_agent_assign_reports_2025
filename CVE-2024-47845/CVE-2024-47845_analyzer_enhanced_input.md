## Vulnerability Description
**Improper Encoding or Escaping of Output** vulnerability in The Wikimedia Foundation Mediawiki - CSS Extension allows Code Injection.This issue affects Mediawiki - CSS Extension from 1.39.X before 1.39.9, from 1.41.X before 1.41.3, from 1.42.X before 1.42.2.

### Vulnerability Description Key Phrases
- **rootcause:** **Improper Encoding or Escaping of Output**
- **weakness:** **Cross-site scripting**
- **impact:** Code Injection
- **product:** The Wikimedia Foundation Mediawiki - CSS Extension
- **version:** Mediawiki - CSS Extension from 1.39.X before 1.39.9, from 1.41.X before 1.41.3, from 1.42.X before 1.42.2

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2024-47845:

**Root Cause of Vulnerability:**

The `Extension:CSS` for MediaWiki attempts to sanitize entire CSS files using `Sanitizer::checkCSS`. This function is designed for sanitizing individual style attributes, not complete CSS files.

**Weaknesses/Vulnerabilities Present:**

*   **Incorrect Sanitization:** Using `Sanitizer::checkCSS` on entire CSS files fails to prevent malicious CSS from being loaded.
*   **`@import` Bypass:** The sanitizer does not prevent the use of `@import` rules with string URLs (e.g., `@import "https://example.com/mystyles.css"`). This allows an attacker to load an external stylesheet, bypassing sanitization.
*   **Potential for Data Exfiltration:** By loading external stylesheets, attackers can potentially leak IP addresses by loading third-party images or potentially perform token extraction attacks.
*   **Other Potentially Problematic @rules:** Other `@rules` like `@charset` may be problematic, though not confirmed to be exploitable.

**Impact of Exploitation:**

*   **Data Exfiltration:** Attackers could potentially exfiltrate user IP addresses.
*   **Token Extraction:** Attackers might be able to perform token extraction attacks.
*   **Unsanitized CSS Injection:** Allows injection of arbitrary CSS, potentially leading to further attacks.

**Attack Vectors:**

*   **CSS Injection:** An attacker injects malicious CSS code through the `Extension:CSS`.
*   **External Stylesheet Loading:** Using `@import` to load external stylesheets.

**Required Attacker Capabilities/Position:**

*   **Ability to inject CSS**: The attacker needs to be able to inject CSS code using the vulnerable extension, this may depend on the specific wiki configuration
*   **No other apparent capabilities/position required**

**Mitigation:**
The vulnerability has been addressed by replacing the usage of `Sanitizer::checkCSS` with the dedicated `css-sanitizer` and restricting URLs.

**Additional Notes:**
The provided information is more detailed than a typical CVE description, outlining the specific vulnerability, attack vectors, and potential impact of the exploit. It also shows the mitigation steps and the collaborative efforts to resolve the security flaw.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.258 |
| 2 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.235 |
| 3 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.226 |
| 4 | 117 | Improper Output Neutralization for Logs | Base | Allowed | sparse | 0.223 |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.218 |
| 6 | 707 | Improper Neutralization | Pillar | Discouraged | sparse | 0.211 |
| 7 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.198 |
| 8 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.195 |
| 9 | 838 | Inappropriate Encoding for Output Context | Base | Allowed | dense | 0.612 |
| 10 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-116: Improper Encoding or Escaping of Output

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-117: Improper Output Neutralization for Logs

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-707: Improper Neutralization

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-918: Server-Side Request Forgery (SSRF)

CWE-838: Inappropriate Encoding for Output Context

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')