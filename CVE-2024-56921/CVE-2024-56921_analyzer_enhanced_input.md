## Vulnerability Description
An issue was discovered in Open5gs v2.7.2. InitialUEMessage, Registration request sent at a specific time can crash AMF due to **incorrect error handling** of gmm_state_exception() function upon receipt of the Nausf_UEAuthentication_Authenticate response.

### Vulnerability Description Key Phrases
- **rootcause:** **incorrect error handling**
- **impact:** crash AMF
- **vector:** Nausf_UEAuthentication_Authenticate response
- **product:** Open5gs
- **version:** v2.7.2
- **component:** InitialUEMessage, Registration request

## CVE Reference Links Content Summary
CVE-2024-56921: PLACEHOLDER - Implement CVE description retrieval

The provided content details a crash in the open5gs AMF (Access and Mobility Management Function) due to incorrect handling of UE (User Equipment) registration requests. Here's a breakdown of the relevant information:

**Root cause of vulnerability:**

*   Lack of proper handling in the `gmm_state_exception` function for scenarios where multiple registration requests from the same UE arrive before the AUSF (Authentication Server Function) response is received. This leads to processing outdated authentication vectors and incorrect states in the GMM (GMM - General Mobility Management) state machine.

**Weaknesses/vulnerabilities present:**

*   Incorrect state management in the AMF during UE registration.
*   Improper handling of asynchronous responses (from AUSF) in relation to multiple registration requests.

**Impact of exploitation:**

*   AMF crash, potentially leading to denial of service.

**Attack vectors:**

*   Sending continuous registration requests from the same UE while the previous context is released before the AUSF response is received. This can be achieved by repeatedly initiating registration attempts.
*   The provided script automates this process.

**Required attacker capabilities/position:**

*   An attacker needs to be able to control a UE and send registration requests to the network. No special privileges are required beyond the ability to initiate a registration procedure.

**Mitigation or fix:**

*   The issue report suggests adding appropriate handling in the `gmm_state_exception` function (located in `src/amf/gmm-sm.c`) to address the scenario where multiple registration requests occur before the AUSF response.
*   The commit message in the first content snippet states that the commit addresses this issue: "[AMF] Fix crash due to incorrect handling of UE registration requests". The diff shows added code to handle the Nausf\_UEAuthentication\_Authenticate response and ignore SBI messages in certain cases.

**Additional Details:**

*   The vulnerability was found in open5gs version v2.7.2.
*   The issue is reproducible using UERANSIM v3.2.6.
*   The provided PCAP log and logs from v2.7.2 can aid in further analysis.
*   The issue is related to 3GPP TS 33.501 V18.6.0 (2024-07) specification.

This content provides significantly more detail than a typical CVE description, including specific code locations, reproduction steps, and logs.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 755 | Improper Handling of Exceptional Conditions | Class | Discouraged | sparse | 0.204 |
| 2 | 703 | Improper Check or Handling of Exceptional Conditions | Pillar | Discouraged | sparse | 0.182 |
| 3 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.172 |
| 4 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | sparse | 0.170 |
| 5 | 617 | Reachable Assertion | Base | Allowed | sparse | 0.170 |
| 6 | 193 | Off-by-one Error | Base | Allowed | sparse | 0.167 |
| 7 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.163 |
| 8 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.162 |
| 9 | 303 | Incorrect Implementation of Authentication Algorithm | Base | Allowed | dense | 0.454 |
| 10 | 390 | Detection of Error Condition Without Action | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-755: Improper Handling of Exceptional Conditions

CWE-703: Improper Check or Handling of Exceptional Conditions

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-401: Missing Release of Memory after Effective Lifetime

CWE-617: Reachable Assertion

CWE-193: Off-by-one Error

CWE-787: Out-of-bounds Write

CWE-203: Observable Discrepancy

CWE-303: Incorrect Implementation of Authentication Algorithm

CWE-390: Detection of Error Condition Without Action