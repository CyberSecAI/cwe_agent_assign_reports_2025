# Vulnerability Information: CVE-2024-56695

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved drm/amdkfd Use dynamic allocation for CU occupancy array in kfd_get_cu_occupancy() The `kfd_get_cu_occupancy` function previously declared a large `cu_occupancy` array as a local variable, which could lead to stack overflows due to excessive stack usage. This commit replaces the static array allocation with dynamic memory allocation using `kcalloc`, thereby reducing the stack size. This change avoids the risk of stack overflows in kernel space, in scenarios where `AMDGPU_MAX_QUEUES` is large. The allocated memory is freed using `kfree` before the function returns to prevent memory leaks. Fixes the below with gcc W=1 drivers/gpu/drm/amd/amdgpu/../amdkfd/kfd_process.c In function kfd_get_cu_occupancy drivers/gpu/drm/amd/amdgpu/../amdkfd/kfd_process.c3221 warning the frame size of 1056 bytes is larger than 1024 bytes [-Wframe-larger-than=] 322 | } | ^

### Vulnerability Description Key Phrases
- **impact:** stack overflows
- **product:** Linux kernel
- **component:** drm/amdkfd

## CVE Reference Links Content Summary
The provided content relates to a fix for a potential stack overflow vulnerability in the Linux kernel, specifically within the `kfd_get_cu_occupancy` function. This aligns with the provided CVE description of a PLACEHOLDER.

**Root cause of vulnerability:**
The `kfd_get_cu_occupancy` function previously declared a large `cu_occupancy` array as a local variable on the stack. When `AMDGPU_MAX_QUEUES` was large, this could lead to excessive stack usage, potentially causing a stack overflow.

**Weaknesses/vulnerabilities present:**
- Stack overflow due to large stack allocation.
- Potential for denial-of-service or unexpected behavior.

**Impact of exploitation:**
- A stack overflow in kernel space can lead to crashes or other unexpected behavior which can lead to denial of service

**Attack vectors:**
- Triggering the `kfd_get_cu_occupancy` function with a large `AMDGPU_MAX_QUEUES` value.

**Required attacker capabilities/position:**
- The attacker would need to interact with the AMD KFD driver and influence the `AMDGPU_MAX_QUEUES` setting which would require a local user with proper privileges to trigger the vulnerable code path.

**Fix:**
The fix replaces the static array allocation with dynamic memory allocation using `kcalloc`. This allocates the memory from the heap instead of the stack, avoiding the stack overflow. The allocated memory is then freed with `kfree` before the function returns. This also includes an error check to return `-ENOMEM` if memory allocation fails.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.241 |
| 2 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.222 |
| 3 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.214 |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.211 |
| 5 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | sparse | 0.206 |
| 6 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.200 |
| 7 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.196 |
| 8 | 193 | Off-by-one Error | Base | Allowed | sparse | 0.192 |
| 9 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | dense | 0.535 |
| 10 | 364 | Signal Handler Race Condition | Base | Allowed | graph | 0.002 |

