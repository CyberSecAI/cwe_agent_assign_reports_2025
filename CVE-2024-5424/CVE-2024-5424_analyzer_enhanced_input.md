## Vulnerability Description
The Gallery Blocks with Lightbox. Image Gallery, (HTML5 video , YouTube, Vimeo) Video Gallery and Lightbox for native gallery plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the galleryID and className parameters in all versions up to, and including, 3.2.1 due to **insufficient input sanitization and output escaping**. This makes it possible for authenticated attackers, with Contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient input sanitization and output escaping**
- **weakness:** **cross-site scripting**
- **impact:** inject arbitrary web scripts
- **attacker:** authenticated attackers with Contributor-level access and above
- **product:** Gallery Blocks with Lightbox. Image Gallery and (HTML5 video and YouTube and Vimeo) Video Gallery and Lightbox for native gallery plugin for WordPress
- **version:** up to and including 3.2.1
- **component:** galleryID and className parameters

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-79

#### Top CWEs
- CWE-79 (Count: 37)

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability associated with CVE-2024-5424:

**1. Verification of CVE Relevance:**

The provided content directly relates to CVE-2024-5424, which is described as a Stored Cross-Site Scripting (XSS) vulnerability in the "Gallery Blocks with Lightbox" WordPress plugin. The Wordfence article explicitly mentions this CVE and its cause.

**2. Root Cause of Vulnerability:**

*   **Insufficient Input Sanitization:** The plugin fails to properly sanitize the `galleryID` and `className` parameters before using them in the output. This lack of sanitization allows an attacker to inject malicious code.
*   **Improper Output Escaping:** The plugin does not properly escape the unsanitized input when generating the HTML output. This allows injected scripts to be executed in the user's browser.

**3. Weaknesses/Vulnerabilities Present:**

*   **Stored Cross-Site Scripting (XSS):** The primary vulnerability is a stored XSS, meaning the malicious script is stored in the database (via the plugin settings) and executed when a user views the affected page.

**4. Impact of Exploitation:**

*   **Arbitrary Script Execution:** An attacker can inject arbitrary JavaScript code into pages. This could lead to:
    *   **Data theft:** Stealing cookies or session data.
    *   **Redirections:** Redirecting users to malicious sites.
    *   **Website Defacement:** Altering the content of the website.
    *   **Malware distribution:** Delivering malware to site visitors.
    *   **Privilege Escalation:** Potentially gaining elevated access or performing actions on behalf of an authenticated user.

**5. Attack Vectors:**

*   **Plugin Settings:** The vulnerability is exploited by injecting malicious JavaScript code into the `galleryID` and/or `className` parameters when creating/editing a gallery block. These parameters are then used when the gallery is rendered, injecting the malicious script into the page output.

**6. Required Attacker Capabilities/Position:**

*   **Authenticated User:** The attacker needs to be an authenticated WordPress user with at least Contributor-level access. This means they can create or edit posts/pages where the vulnerable block is placed.

**Technical Details:**

*   The Wordfence article highlights the vulnerable code locations within the `init.php` file of the plugin, specifically lines 127, 132, and 70.
*   The vulnerable code is within the `pgc_sgb_render_callback` function, which is responsible for rendering the gallery block and where the `galleryID` and `className` are used.
*   The fix in version 3.2.2 involves proper sanitization using `sanitize_html_class` and escaping using `esc_attr`.
*   The code snippet below shows the lines that were modified in the fix:
    ```diff
    --- a/simply-gallery-block/trunk/blocks/init.php
    +++ b/simply-gallery-block/trunk/blocks/init.php
    @@ -67,7 +67,7 @@
     if ( $item['type'] === 'video' ) {
    -       $poster = ( $image ? 'poster="' . $image['src'] . '"' : '' );
    +        $poster = ( $image ? 'poster="' . esc_url( $image['src'] ) . '"' : '' );
    
            $itemElemant = '<video controls preload="none" ' . $poster . ' src="' . esc_url( $item['url'] ) . '"></video>';
         }
    @@ -114,9 +114,9 @@
         }
         $align = $align . 'align' . $atr['align'];
     }
    -    $className = PGC_SGB_BLOCK_PREF . $skinType . ' ' . $align;
    +    $className = PGC_SGB_BLOCK_PREF . sanitize_html_class( $skinType ) . ' ' . sanitize_html_class( $align );
        if ( isset( $atr['className'] ) ) {
    -        $className = $className . ' ' . $atr['className'];
    +        $className = $className . ' ' . sanitize_html_class( $atr['className'] );
        }
        if ( $skinType === 'slider' || $skinType === 'splitcarousel' || $skinType === 'horizon' || $skinType === 'accordion' || $skinType === 'showcase' ) {
            $minHeight = ( isset( $atr['sliderMaxHeight'] ) ? esc_attr( $atr['sliderMaxHeight'] ) : 400 );
    @@ -124,7 +124,7 @@
         }
         $noscript = '<div class="simply-gallery-amp pgc_sgb_slider ' . esc_attr( $align ) . '" style="display: none;"><div class="sgb-gallery">' . pgc_sgb_noscript( $atr['images'] ) . '</div></div>';
         $preloaderColor = ( isset( $galleryDataArr['galleryPreloaderColor'] ) ? $galleryDataArr['galleryPreloaderColor'] : '#d4d4d4' );
    -    $preloder = '<div class="sgb-preloader" id="pr_' . $atr['galleryId'] . '">
    +    $preloder = '<div class="sgb-preloader" id="pr_' . esc_attr( $atr['galleryId'] ) . '">
             <div class="sgb-square" style="background:' . esc_attr( $preloaderColor ) . '"></div>
             <div class="sgb-square" style="background:' . esc_attr( $preloaderColor ) . '"></div>
             <div class="sgb-square" style="background:' . esc_attr( $preloaderColor ) . '"></div>
    -    $html = '<div class="pgc-sgb-cb ' . $className . '" data-gallery-id="' . $atr['galleryId'] . '"' . (( isset( $style ) ? $style : '' )) . '>' . $preloder . $noscript . '<script type="application/json" class="sgb-data">' . $galleryData . '</script>' . '<script>(function(){if(window.PGC_SGB && window.PGC_SGB.searcher){window.PGC_SGB.searcher.initBlocks()}})()</script>' . '</div>';
    +    $html = '<div class="pgc-sgb-cb ' . $className . '" data-gallery-id="' . esc_attr( $atr['galleryId'] ) . '"' . (( isset( $style ) ? $style : '' )) . '>' . $preloder . $noscript . '<script type="application/json" class="sgb-data">' . $galleryData . '</script>' . '<script>(function(){if(window.PGC_SGB && window.PGC_SGB.searcher){window.PGC_SGB.searcher.initBlocks()}})()</script>' . '</div>';
         return $html;
     }
    ```

**Summary**

CVE-2024-5424 is a stored XSS vulnerability in the "Gallery Blocks with Lightbox" WordPress plugin that allows authenticated attackers to inject malicious scripts into pages by manipulating `galleryID` and `className` parameters, due to improper input sanitization and output escaping. The vulnerability is resolved in version 3.2.2 of the plugin.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.579 |
| 2 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.546 |
| 3 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.517 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.492 |
| 5 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.447 |
| 6 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.442 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.430 |
| 8 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.424 |
| 9 | 82 | Improper Neutralization of Script in Attributes of IMG Tags in a Web Page | Variant | Allowed | dense | 0.486 |
| 10 | 73 | External Control of File Name or Path | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-116: Improper Encoding or Escaping of Output

CWE-138: Improper Neutralization of Special Elements

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-862: Missing Authorization

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-82: Improper Neutralization of Script in Attributes of IMG Tags in a Web Page

CWE-73: External Control of File Name or Path