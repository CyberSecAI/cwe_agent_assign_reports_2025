## Vulnerability Description
YoutubeDLSharp is a wrapper for the command-line video downloaders youtube-dl and yt-dlp. In versions starting from 1.0.0-beta4 and prior to 1.1.2, an **unsafe conversion of arguments** allows the injection of a malicious commands when starting `yt-dlp` from a commands prompt running on Windows OS with the `UseWindowsEncodingWorkaround` value defined to true (default behavior). If a user is using built-in methods from the YoutubeDL.cs file, the value is true by default and a user cannot disable it from these methods. This issue has been patched in version 1.1.2.

### Vulnerability Description Key Phrases
- **rootcause:** **unsafe conversion of arguments**
- **weakness:** **command injection**
- **product:** YoutubeDLSharp
- **version:** 1.0.0-beta4 to 1.1.2
- **component:** yt-dlp

## CVE Reference Links Content Summary
## Analysis of CVE-2025-43858 based on provided content

The provided content details a command injection vulnerability (CVE-2025-43858) in YoutubeDLSharp, specifically affecting versions >= 1.0.0-beta4 and patched in version 1.1.2.

**Root cause of vulnerability:**

The vulnerability stems from an unsafe conversion of arguments when starting `yt-dlp` on Windows systems. A commit introduced a method to start `yt-dlp` via `cmd.exe` to support Unicode characters, but it failed to sanitize user-provided arguments before passing them to the command prompt.

**Weaknesses/vulnerabilities present:**

*   **Command Injection:**  Unsanitized user input is directly incorporated into a command executed by the system shell (cmd.exe).
*   **CWE-20:** Improper Input Validation
*   **CWE-77:** Command Injection
*   **CWE-78:** Improper Neutralization of Special Elements used in an OS Command ('Command Injection')

**Impact of exploitation:**

An attacker can inject malicious commands that will be executed on the system with the privileges of the user running the YoutubeDLSharp application. The severity is rated as Critical (CVSS score 9.2).

**Attack vectors:**

*   The vulnerability is triggered by providing a malicious URL or other arguments to YoutubeDLSharp methods that utilize the vulnerable code path.
*   The PoC demonstrates injecting a command to start `calc.exe` and `msinfo32`.

**Required attacker capabilities/position:**

*   The attacker needs to be able to control the input provided to the YoutubeDLSharp library (e.g., through a URL or other parameters).
*   The attack is particularly dangerous if the application is accepting input from a network or the internet.

**Mitigation or fix:**

*   **Upgrade:** Upgrade to version 1.1.2 or higher of YoutubeDLSharp. This version removes the `UseWindowsEncodingWorkaround` property, which was the source of the vulnerability.
*   **Workaround (for older versions):**
    *   Disable `UseWindowsEncodingWorkaround` when using `YoutubeDLProcess` directly (at the cost of Unicode character support).
    *   Manually sanitize user-provided URLs and other arguments before passing them to the library. The provided code snippet demonstrates URL sanitization using `Uri.TryCreate` and `AbsoluteUri`, but it's noted that this may not be sufficient for all cases.

**Additional Details (more than official CVE description):**

*   The vulnerability was introduced in commit `fdf3256` approximately 3 years ago.
*   The vulnerable code is located in `YoutubeDLSharp/YoutubeDLSharp/YoutubeDLProcess.cs` (lines 87-109 in the provided diff).
*   The `ConvertToArgs` method is responsible for constructing the command string without proper sanitization.
*   The vulnerability only applies to Windows operating systems.
*   The advisory provides a detailed PoC demonstrating the exploitation of the vulnerability.
*   The advisory credits @kitsumed for reporting the vulnerability and @alxnull for developing the remediation.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.546 |
| 4 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.529 |
| 5 | 1333 | Inefficient Regular Expression Complexity | Base | Allowed | sparse | 0.525 |
| 6 | 269 | Improper Privilege Management | Class | Discouraged | sparse | 0.523 |
| 7 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.520 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.519 |
| 9 | 1427 | Improper Neutralization of Input Used for LLM Prompting | Base | Allowed | dense | 0.400 |
| 10 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-1333: Inefficient Regular Expression Complexity

CWE-269: Improper Privilege Management

CWE-863: Incorrect Authorization

CWE-502: Deserialization of Untrusted Data

CWE-1427: Improper Neutralization of Input Used for LLM Prompting

CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')