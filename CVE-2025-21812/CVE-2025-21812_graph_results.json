{
  "query": "In the Linux kernel, the following vulnerability has been resolved ax25 rcu protect dev->ax25_ptr syzbot found a lockdep issue [1]. We should remove ax25 RTNL dependency in ax25_setsockopt() This should also fix a variety of possible UAF in ax25. [1] WARNING possible circular locking dependency detected 6.13.0-rc3-syzkaller-00762-g9268abe611b0 #0 Not tainted ------------------------------------------------------ syz.5.1818/12806 is trying to acquire lock ffffffff8fcb3988 (rtnl_mutex){+.+.}-{44}, at ax25_setsockopt+0xa55/0xe90 net/ax25/af_ax25.c680 but task is already holding lock ffff8880617ac258 (sk_lock-AF_AX25){+.+.}-{00}, at lock_sock include/net/sock.h1618 [inline] ffff8880617ac258 (sk_lock-AF_AX25){+.+.}-{00}, at ax25_setsockopt+0x209/0xe90 net/ax25/af_ax25.c574 which lock already depends on the new lock. the existing dependency chain (in reverse order) is -> #1 (sk_lock-AF_AX25){+.+.}-{00} lock_acquire+0x1ed/0x550 kernel/locking/lockdep.c5849 lock_sock_nested+0x48/0x100 net/core/sock.c3642 lock_sock include/net/sock.h1618 [inline] ax25_kill_by_device net/ax25/af_ax25.c101 [inline] ax25_device_event+0x24d/0x580 net/ax25/af_ax25.c146 notifier_call_chain+0x1a5/0x3f0 kernel/notifier.c85 __dev_notify_flags+0x207/0x400 dev_change_flags+0xf0/0x1a0 net/core/dev.c9026 dev_ifsioc+0x7c8/0xe70 net/core/dev_ioctl.c563 dev_ioctl+0x719/0x1340 net/core/dev_ioctl.c820 sock_do_ioctl+0x240/0x460 net/socket.c1234 sock_ioctl+0x626/0x8e0 net/socket.c1339 vfs_ioctl fs/ioctl.c51 [inline] __do_sys_ioctl fs/ioctl.c906 [inline] __se_sys_ioctl+0xf5/0x170 fs/ioctl.c892 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7f -> #0 (rtnl_mutex){+.+.}-{44} check_prev_add kernel/locking/lockdep.c3161 [inline] check_prevs_add kernel/locking/lockdep.c3280 [inline] validate_chain+0x18ef/0x5920 kernel/locking/lockdep.c3904 __lock_acquire+0x1397/0x2100 kernel/locking/lockdep.c5226 lock_acquire+0x1ed/0x550 kernel/locking/lockdep.c5849 __mutex_lock_common kernel/locking/mutex.c585 [inline] __mutex_lock+0x1ac/0xee0 kernel/locking/mutex.c735 ax25_setsockopt+0xa55/0xe90 net/ax25/af_ax25.c680 do_sock_setsockopt+0x3af/0x720 net/socket.c2324 __sys_setsockopt net/socket.c2349 [inline] __do_sys_setsockopt net/socket.c2355 [inline] __se_sys_setsockopt net/socket.c2352 [inline] __x64_sys_setsockopt+0x1ee/0x280 net/socket.c2352 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7f other info that might help us debug this Possible unsafe locking scenario CPU0 CPU1 ---- ---- lock(sk_lock-AF_AX25) lock(rtnl_mutex) lock(sk_lock-AF_AX25) lock(rtnl_mutex) *** DEADLOCK *** 1 lock held by syz.5.1818/12806 #0 ffff8880617ac258 (sk_lock-AF_AX25){+.+.}-{00}, at lock_sock include/net/sock.h1618 [inline] #0 ffff8880617ac258 (sk_lock-AF_AX25){+.+.}-{00}, at ax25_setsockopt+0x209/0xe90 net/ax25/af_ax25.c574 stack backtrace CPU 1 UID 0 PID 12806 Comm syz.5.1818 Not tainted 6.13.0-rc3-syzkaller-00762-g9268abe611b0 #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024 Call Trace __dump_stack lib/dump_stack.c94 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c120 print_circular_bug+0x13a/0x1b0 kernel/locking/lockdep.c2074 check_noncircular+0x36a/0x4a0 kernel/locking/lockdep.c2206 check_prev_add kernel/locking/lockdep.c3161 [inline] check_prevs_add kernel/lockin ---truncated---",
  "count": 20,
  "results": [
    {
      "cwe_id": "476",
      "name": "NULL Pointer Dereference",
      "abstraction": "Base",
      "score": 2.8299788982468206,
      "original_score": 2.8299788982468206,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1325",
      "name": "Improperly Controlled Sequential Memory Allocation",
      "abstraction": "base",
      "score": 2.2100000000000004,
      "original_score": 2.2100000000000004,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "abstraction": "Class",
      "score": 1.7799255276482402,
      "original_score": 1.7799255276482402,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "123",
      "name": "Write-what-where Condition",
      "abstraction": "base",
      "score": 1.7680000000000005,
      "original_score": 1.7680000000000005,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "120",
      "name": "Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')",
      "abstraction": "base",
      "score": 1.7680000000000005,
      "original_score": 1.7680000000000005,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "364",
      "name": "Signal Handler Race Condition",
      "abstraction": "base",
      "score": 1.7550000000000001,
      "original_score": 1.7550000000000001,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "833",
      "name": "Deadlock",
      "abstraction": "Base",
      "score": 1.7283620025546453,
      "original_score": 1.7283620025546453,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "413",
      "name": "Improper Resource Locking",
      "abstraction": "Base",
      "score": 1.7160593200402363,
      "original_score": 1.7160593200402363,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1265",
      "name": "Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls",
      "abstraction": "base",
      "score": 1.6848000000000003,
      "original_score": 1.6848000000000003,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "386",
      "name": "Symbolic Name not Mapping to Correct Object",
      "abstraction": "base",
      "score": 1.6744000000000003,
      "original_score": 1.6744000000000003,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "662",
      "name": "Improper Synchronization",
      "abstraction": "class",
      "score": 1.6736000000000002,
      "original_score": 1.6736000000000002,
      "mapping_usage": "Discouraged"
    },
    {
      "cwe_id": "1285",
      "name": "Improper Validation of Specified Index, Position, or Offset in Input",
      "abstraction": "Base",
      "score": 1.6374571372556734,
      "original_score": 1.6374571372556734,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "609",
      "name": "Double-Checked Locking",
      "abstraction": "base",
      "score": 1.5912000000000004,
      "original_score": 1.5912000000000004,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "129",
      "name": "Improper Validation of Array Index",
      "abstraction": "Variant",
      "score": 1.581365250961504,
      "original_score": 1.581365250961504,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "252",
      "name": "Unchecked Return Value",
      "abstraction": "Base",
      "score": 1.556560494192409,
      "original_score": 1.556560494192409,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "908",
      "name": "Use of Uninitialized Resource",
      "abstraction": "Base",
      "score": 1.5533391636360911,
      "original_score": 1.5533391636360911,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "456",
      "name": "Missing Initialization of a Variable",
      "abstraction": "variant",
      "score": 1.51536,
      "original_score": 1.51536,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "415",
      "name": "Double Free",
      "abstraction": "variant",
      "score": 1.4784000000000002,
      "original_score": 1.4784000000000002,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "416",
      "name": "Use After Free",
      "abstraction": "Variant",
      "score": 1.4556775657339203,
      "original_score": 1.4556775657339203,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "789",
      "name": "Memory Allocation with Excessive Size Value",
      "abstraction": "Variant",
      "score": 1.4497304585295543,
      "original_score": 1.4497304585295543,
      "mapping_usage": "Allowed"
    }
  ],
  "statistics": {
    "min": 1.4497304585295543,
    "max": 2.8299788982468206,
    "mean": 1.7203607909399548,
    "median": 1.6740000000000004,
    "count": 20
  }
}