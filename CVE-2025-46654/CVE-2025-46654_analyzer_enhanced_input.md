## Vulnerability Description
CodiMD through 2.2.0 has a CSP-based protection mechanism against XSS through uploaded JavaScript content, but it can be bypassed by uploading a .html file that references an uploaded .js file.

### Vulnerability Description Key Phrases
- **weakness:** **bypass CSP-based protection against XSS**
- **vector:** uploading .html file that references an uploaded .js file
- **product:** CodiMD
- **version:** through 2.2.0

## CVE Reference Links Content Summary
## Analysis of CVE-2025-46654 based on provided content

The provided content details an **Insecure File Upload Vulnerability** in CodiMD (versions v2.5.4 - v2.2.1 and ≤v2.2.0), which aligns with a potential CVE.

**Root cause of vulnerability:**

*   **High-Version (v2.5.4 - v2.2.1):** Allowing SVG files in the allowed upload MIME types, which can be exploited for XSS.
*   **Low-Version (≤ v2.2.0):** Lack of validation mechanisms for uploaded files, allowing arbitrary file types to be uploaded.

**Weaknesses/vulnerabilities present:**

*   Insecure file upload.
*   Insufficient input validation.
*   Potential for Cross-Site Scripting (XSS) attacks.
*   Bypass of Content Security Policy (CSP) in certain scenarios (remote server uploads).

**Impact of exploitation:**

*   Attackers can upload malicious files.
*   Potential for stored XSS attacks.
*   Compromise of application security.

**Attack vectors:**

*   **High-Version:** Uploading a malicious SVG file.
*   **Low-Version:** Uploading a malicious HTML file referencing a JavaScript file (if uploaded to the same origin) or uploading to a remote server bypassing CSP.

**Required attacker capabilities/position:**

*   Authenticated user (High-Version).
*   No authentication required (Low-Version, remote upload scenario).
*   Ability to manipulate HTTP requests (e.g., using Burp Suite).

**Mitigation or fix:**

The content does not explicitly state a fix, but implies the following:

*   **High-Version:** Remove SVG from the allowed MIME types or implement stricter validation of SVG files to prevent XSS.
*   **Low-Version:** Implement robust file type validation to restrict uploads to only allowed types.
*   Strengthen CSP to prevent execution of malicious scripts from uploaded files.

**Additional Details (more than official CVE description):**

*   Specific code snippets from `lib/imageRouter/index.js` and `lib\config\index.js` are provided.
*   Detailed test procedures and proof-of-concept steps are outlined, including specific URLs and screenshots.
*   The report highlights differences in vulnerability characteristics between different CodiMD versions.
*   The report details how CSP can be bypassed in certain scenarios.
*   The report is from ZAST.AI, a vulnerability research organization.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 918 | Server-Side Request Forgery (SSRF) | Base | Allowed | sparse | 0.195 |
| 3 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.193 |
| 4 | 330 | Use of Insufficiently Random Values | Class | Discouraged | sparse | 0.174 |
| 5 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | sparse | 0.171 |
| 6 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.168 |
| 7 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.164 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.161 |
| 9 | 692 | Incomplete Denylist to Cross-Site Scripting | Compound | Discouraged | dense | 0.555 |
| 10 | 183 | Permissive List of Allowed Inputs | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-918: Server-Side Request Forgery (SSRF)

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-330: Use of Insufficiently Random Values

CWE-184: Incomplete List of Disallowed Inputs

CWE-352: Cross-Site Request Forgery (CSRF)

CWE-116: Improper Encoding or Escaping of Output

CWE-138: Improper Neutralization of Special Elements

CWE-692: Incomplete Denylist to Cross-Site Scripting

CWE-183: Permissive List of Allowed Inputs