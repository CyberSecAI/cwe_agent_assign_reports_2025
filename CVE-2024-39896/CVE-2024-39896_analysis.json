{
  "cve_id": "CVE-2024-39896",
  "description": "Directus is a real-time API and App dashboard for managing SQL database content. When relying on SSO providers in combination with local authentication it can be possible to enumerate existing SSO users in the instance. This is possible because if an email address exists in Directus and belongs to a known SSO provider then it will throw a helpful error that the user belongs to another provider. This vulnerability is fixed in 10.13.0.",
  "key_phrases": {
    "rootcause": "improper error handling",
    "weakness": "",
    "impact": "enumerate existing SSO users",
    "vector": "",
    "attacker": "",
    "product": "Directus",
    "version": "prior to 10.13.0",
    "component": ""
  },
  "reference_content": "Based on the provided content, here's a breakdown of the vulnerability:\n\n**CVE ID:** CVE-2024-39896\n\n**Root Cause of Vulnerability:**\n- The vulnerability arises from the way Directus handles authentication attempts when both SSO and local authentication are enabled. When a user attempts to log in using the regular login form (or API) with an email address that is already associated with an SSO provider, the system throws a specific error message indicating that the user belongs to another provider. This differs from the generic \"invalid credentials\" error for non-existent or non-SSO users, thus enabling user enumeration.\n\n**Weaknesses/Vulnerabilities Present:**\n- **Account Enumeration:** The system provides specific error messages that can be used to differentiate between valid SSO users and invalid email addresses. This allows an attacker to systematically determine which email addresses are registered as SSO users on the Directus instance.\n- **Information Disclosure:** The error message reveals whether a specific email is a registered SSO user, exposing sensitive information.\n\n**Impact of Exploitation:**\n- **User Enumeration:** An attacker can identify valid SSO user accounts on a Directus instance. This can be used in targeted phishing attacks, credential stuffing, or other social engineering tactics.\n- **Potential for further attacks:** Knowing valid usernames makes it easier to carry out brute-force or password spraying attacks, as the attacker now has a list of potential valid users.\n\n**Attack Vectors:**\n- **Network:** The vulnerability can be exploited remotely over a network.\n- **Login Form/API:** Attackers can trigger the vulnerability by attempting to log in through the regular login form or through the API.\n\n**Required Attacker Capabilities/Position:**\n- **No privileges required:** The attacker does not need any prior authentication or special privileges.\n- **No user interaction:** The attack can be carried out without any user interaction.\n- The attacker needs to be able to send login requests to the Directus instance\n\n**Additional Information:**\n- The vulnerability is present in Directus versions >= 9.11.\n- It's fixed in version 10.13.0.\n- The fix included an explicit provider check and removal of user suspended errors in the authentication service.\n- A workaround is to disable local logins if only using SSO `AUTH_DISABLE_DEFAULT=\"true\"`\n- The vulnerability was introduced as a feature in [#13184](https://github.com/directus/directus/pull/13184)\n- The vulnerability is classified as CWE-200 (Information Exposure).\n- CVSS v3 score: 7.5\n- CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID  | CWE Name                                                        | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n| :-------- | :-------------------------------------------------------------- | :--------- | :-------------------- | :------------------------------ | :------------------------------ |\n| CWE-209   | Generation of Error Message Containing Sensitive Information   | 0.9        | Base                  | Primary                         | Allowed                       |\n| CWE-204   | Observable Response Discrepancy                                | 0.7        | Base                  | Secondary                       | Allowed                       |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship influencing the CWE selection is the hierarchical structure. CWE-209 is a base-level CWE that directly addresses the core issue of generating error messages containing sensitive information. While other CWEs like CWE-204 (Observable Response Discrepancy) are related, they are more general. The analysis focuses on the specific act of generating an error message revealing sensitive data, making CWE-209 the more precise choice. There are no relevant chain relationships to consider.\n\n```mermaid\ngraph TD\n    cwe209[\"CWE-209: Generation of Error Message Containing Sensitive Information\"]\n    cwe204[\"CWE-204: Observable Response Discrepancy\"]\n    \n    cwe209 -- CANALSOBE --> cwe204\n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    \n    class cwe209 primary\n    class cwe204 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with **improper error handling**, which leads to the generation of an error message containing sensitive information (CWE-209). This, in turn, allows for account enumeration. The chain can be summarized as follows:\n1.  **Improper Error Handling**\n2.  CWE-209: Generation of Error Message Containing Sensitive Information\n3.  Account Enumeration\n\n## Summary of Analysis\nThe analysis is based on the vulnerability description, CVE reference links, and retriever results. The key phrase \"**improper error handling**\" and the description of Directus throwing a \"helpful error that the user belongs to another provider\" directly support the selection of CWE-209 (Generation of Error Message Containing Sensitive Information). The CVE reference confirms that the vulnerability arises from the way Directus handles authentication attempts, specifically when a user attempts to log in using an email address already associated with an SSO provider, leading to a specific error message being displayed.\n\nThe retriever results suggest several CWEs, including CWE-1390 (Weak Authentication), CWE-204 (Observable Response Discrepancy), and CWE-209 (Generation of Error Message Containing Sensitive Information). However, CWE-209 is the most specific and accurately reflects the vulnerability's root cause.\n\nThe choice of CWE-209 is at the optimal level of specificity as it directly addresses the generation of sensitive information in error messages, which is the core of the vulnerability. While CWE-204 (Observable Response Discrepancy) is a valid secondary consideration, it's less specific and more of a consequence of the primary weakness.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-204: Observable Response Discrepancy\n**Abstraction Level**: Base\n**Similarity Score**: 0.78\n**Source**: dense\n\n**Description**:\nThe product provides different responses to incoming requests in a way that reveals internal state information to an unauthorized actor outside of the intended control sphere.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n## CWE-209: Generation of Error Message Containing Sensitive Information\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product generates an error message that includes sensitive information about its environment, users, or associated data.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n### Detailed Analysis of Selected CWEs:\n\n**1. CWE-209: Generation of Error Message Containing Sensitive Information**\n\n*   **Technical Explanation:** The vulnerability description clearly states that Directus throws an error message revealing whether an email address is associated with an SSO provider. This aligns directly with the definition of CWE-209, which involves generating error messages containing sensitive information.\n*   **Security Implications and Potential Impact:** The information disclosure enables user enumeration, which can be used for targeted phishing attacks or other social engineering tactics.\n*   **Parent-Child Relationships and Chain Patterns:** CWE-209 can be a part of a chain leading to information exposure.\n*   **Primary/Secondary:** This is the primary weakness as the root cause is the **improper error handling** leading to information exposure.\n*   **MITRE Mapping Guidance:** The usage is \"ALLOWED,\" and the rationale is that it's at the Base level of abstraction, which is preferred.\n\n**2. CWE-204: Observable Response Discrepancy**\n\n*   **Technical Explanation:** Directus provides different responses based on whether the email is an SSO user or not. This falls under the definition of CWE-204, where the system provides different responses that reveal internal state information.\n*   **Security Implications and Potential Impact:** The differing responses allow an attacker to determine valid SSO users, aiding in account enumeration.\n*   **Parent-Child Relationships and Chain Patterns:** Can be related to information disclosure vulnerabilities.\n*   **Primary/Secondary:** This is a secondary weakness, as it is a consequence of the primary weakness (CWE-209) rather than the direct root cause. The root cause is generating the detailed error message (CWE-209), while CWE-204 is the observable difference.\n*   **MITRE Mapping Guidance:** The usage is \"ALLOWED,\" and the rationale is that it's at the Base level of abstraction.\n\n### CWEs Considered but Not Used:\n\n*   **CWE-287 Improper Authentication, CWE-306 Missing Authentication for Critical Function, CWE-862 Missing Authorization, CWE-863 Incorrect Authorization:** These CWEs were considered but deemed less appropriate because the vulnerability is not directly related to authentication or authorization failures. The core issue is the **improper error handling** revealing sensitive information, rather than a failure in authenticating or authorizing users.\n\n*   **CWE-613 Insufficient Session Expiration:** Not applicable as the vulnerability doesn't involve session management issues.\n\n*   **CWE-201 Insertion of Sensitive Information Into Sent Data:** While related to information exposure, CWE-209 is more specific as it focuses on error messages.\n\n*   **CWE-347 Improper Verification of Cryptographic Signature:** Not relevant as the vulnerability does not involve cryptographic signatures.\n\n*   **CWE-756 Missing Custom Error Page:** Not applicable as the vulnerability doesn't involve missing error pages.",
  "analysis_with_relationships": "# Summary\n| CWE ID  | CWE Name                                                        | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n| :-------- | :-------------------------------------------------------------- | :--------- | :-------------------- | :------------------------------ | :------------------------------ |\n| CWE-209   | Generation of Error Message Containing Sensitive Information   | 0.9        | Base                  | Primary                         | Allowed                       |\n| CWE-204   | Observable Response Discrepancy                                | 0.7        | Base                  | Secondary                       | Allowed                       |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary relationship influencing the CWE selection is the hierarchical structure. CWE-209 is a base-level CWE that directly addresses the core issue of generating error messages containing sensitive information. While other CWEs like CWE-204 (Observable Response Discrepancy) are related, they are more general. The analysis focuses on the specific act of generating an error message revealing sensitive data, making CWE-209 the more precise choice. There are no relevant chain relationships to consider.\n\n```mermaid\ngraph TD\n    cwe209[\"CWE-209: Generation of Error Message Containing Sensitive Information\"]\n    cwe204[\"CWE-204: Observable Response Discrepancy\"]\n    \n    cwe209 -- CANALSOBE --> cwe204\n    \n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    \n    class cwe209 primary\n    class cwe204 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with **improper error handling**, which leads to the generation of an error message containing sensitive information (CWE-209). This, in turn, allows for account enumeration. The chain can be summarized as follows:\n1.  **Improper Error Handling**\n2.  CWE-209: Generation of Error Message Containing Sensitive Information\n3.  Account Enumeration\n\n## Summary of Analysis\nThe analysis is based on the vulnerability description, CVE reference links, and retriever results. The key phrase \"**improper error handling**\" and the description of Directus throwing a \"helpful error that the user belongs to another provider\" directly support the selection of CWE-209 (Generation of Error Message Containing Sensitive Information). The CVE reference confirms that the vulnerability arises from the way Directus handles authentication attempts, specifically when a user attempts to log in using an email address already associated with an SSO provider, leading to a specific error message being displayed.\n\nThe retriever results suggest several CWEs, including CWE-1390 (Weak Authentication), CWE-204 (Observable Response Discrepancy), and CWE-209 (Generation of Error Message Containing Sensitive Information). However, CWE-209 is the most specific and accurately reflects the vulnerability's root cause.\n\nThe choice of CWE-209 is at the optimal level of specificity as it directly addresses the generation of sensitive information in error messages, which is the core of the vulnerability. While CWE-204 (Observable Response Discrepancy) is a valid secondary consideration, it's less specific and more of a consequence of the primary weakness.\n\nRelevant CWE Information:\n\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-204: Observable Response Discrepancy\n**Abstraction Level**: Base\n**Similarity Score**: 0.78\n**Source**: dense\n\n**Description**:\nThe product provides different responses to incoming requests in a way that reveals internal state information to an unauthorized actor outside of the intended control sphere.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n## CWE-209: Generation of Error Message Containing Sensitive Information\n**Abstraction Level**: Base\n**Similarity Score**: 0.75\n**Source**: dense\n\n**Description**:\nThe product generates an error message that includes sensitive information about its environment, users, or associated data.\n\n**Mapping Guidance**:\n- Usage: Allowed\n- Rationale: This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.\n\n### Detailed Analysis of Selected CWEs:\n\n**1. CWE-209: Generation of Error Message Containing Sensitive Information**\n\n*   **Technical Explanation:** The vulnerability description clearly states that Directus throws an error message revealing whether an email address is associated with an SSO provider. This aligns directly with the definition of CWE-209, which involves generating error messages containing sensitive information.\n*   **Security Implications and Potential Impact:** The information disclosure enables user enumeration, which can be used for targeted phishing attacks or other social engineering tactics.\n*   **Parent-Child Relationships and Chain Patterns:** CWE-209 can be a part of a chain leading to information exposure.\n*   **Primary/Secondary:** This is the primary weakness as the root cause is the **improper error handling** leading to information exposure.\n*   **MITRE Mapping Guidance:** The usage is \"ALLOWED,\" and the rationale is that it's at the Base level of abstraction, which is preferred.\n\n**2. CWE-204: Observable Response Discrepancy**\n\n*   **Technical Explanation:** Directus provides different responses based on whether the email is an SSO user or not. This falls under the definition of CWE-204, where the system provides different responses that reveal internal state information.\n*   **Security Implications and Potential Impact:** The differing responses allow an attacker to determine valid SSO users, aiding in account enumeration.\n*   **Parent-Child Relationships and Chain Patterns:** Can be related to information disclosure vulnerabilities.\n*   **Primary/Secondary:** This is a secondary weakness, as it is a consequence of the primary weakness (CWE-209) rather than the direct root cause. The root cause is generating the detailed error message (CWE-209), while CWE-204 is the observable difference.\n*   **MITRE Mapping Guidance:** The usage is \"ALLOWED,\" and the rationale is that it's at the Base level of abstraction.\n\n### CWEs Considered but Not Used:\n\n*   **CWE-287 Improper Authentication, CWE-306 Missing Authentication for Critical Function, CWE-862 Missing Authorization, CWE-863 Incorrect Authorization:** These CWEs were considered but deemed less appropriate because the vulnerability is not directly related to authentication or authorization failures. The core issue is the **improper error handling** revealing sensitive information, rather than a failure in authenticating or authorizing users.\n\n*   **CWE-613 Insufficient Session Expiration:** Not applicable as the vulnerability doesn't involve session management issues.\n\n*   **CWE-201 Insertion of Sensitive Information Into Sent Data:** While related to information exposure, CWE-209 is more specific as it focuses on error messages.\n\n*   **CWE-347 Improper Verification of Cryptographic Signature:** Not relevant as the vulnerability does not involve cryptographic signatures.\n\n*   **CWE-756 Missing Custom Error Page:** Not applicable as the vulnerability doesn't involve missing error pages.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-1390:**\n- 1390 (Weak Authentication) - ROOT\n\n\n**Chain starting from CWE-863:**\n- 863 (Incorrect Authorization) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "1390",
        "name": "Weak Authentication",
        "source": "sparse"
      },
      "similarity": 481.64634568130714
    },
    {
      "metadata": {
        "doc_id": "204",
        "name": "Observable Response Discrepancy",
        "source": "sparse"
      },
      "similarity": 456.19376552582105
    },
    {
      "metadata": {
        "doc_id": "201",
        "name": "Insertion of Sensitive Information Into Sent Data",
        "source": "sparse"
      },
      "similarity": 433.42717387498755
    },
    {
      "metadata": {
        "doc_id": "863",
        "name": "Incorrect Authorization",
        "source": "sparse"
      },
      "similarity": 427.7584966969803
    },
    {
      "metadata": {
        "doc_id": "347",
        "name": "Improper Verification of Cryptographic Signature",
        "source": "sparse"
      },
      "similarity": 424.7066779344449
    },
    {
      "metadata": {
        "doc_id": "287",
        "name": "Improper Authentication",
        "source": "sparse"
      },
      "similarity": 424.5968960843702
    },
    {
      "metadata": {
        "doc_id": "209",
        "name": "Generation of Error Message Containing Sensitive Information",
        "source": "sparse"
      },
      "similarity": 423.4332301240944
    },
    {
      "metadata": {
        "doc_id": "862",
        "name": "Missing Authorization",
        "source": "sparse"
      },
      "similarity": 423.4205341640187
    },
    {
      "metadata": {
        "doc_id": "90",
        "name": "Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')",
        "type": "Base",
        "original_content": "The product constructs all or part of an LDAP query using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended LDAP query when it is sent to a downstream component.",
        "keyphrase_source": "rootcause:improper error handling",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense",
            "graph"
          ],
          "retriever_count": 2,
          "normalized_scores": {
            "dense": 0.41334450717822113,
            "graph": 1.4621253198304043
          }
        }
      },
      "similarity": 0.41334450717822113
    },
    {
      "doc_id": "613",
      "text": "CWE-613: Insufficient Session Expiration",
      "score": 2.2100000000000004,
      "metadata": {
        "doc_id": "613",
        "name": "Insufficient Session Expiration",
        "type": "base",
        "original_content": "CWE-613: Insufficient Session Expiration",
        "relationships": [
          {
            "source_id": "613",
            "target_id": "352",
            "label": "REQUIREDBY",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "613",
            "target_id": "287",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "613",
            "target_id": "672",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1003"
            }
          },
          {
            "source_id": "613",
            "target_id": "672",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "672",
            "target_id": "613",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "352",
            "target_id": "613",
            "label": "REQUIRES",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "287",
            "target_id": "613",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.3,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "287",
                  "613",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "287"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "287",
                  "613",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "287"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "613",
                  "287",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "287"
            }
          }
        },
        "position": "before",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.2100000000000004
          }
        }
      },
      "similarity": 2.2100000000000004
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-1390",
      "CWE-863",
      "CWE-862",
      "CWE-306",
      "CWE-201",
      "CWE-613",
      "CWE-209",
      "CWE-756",
      "CWE-347",
      "CWE-287",
      "CWE-204"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}