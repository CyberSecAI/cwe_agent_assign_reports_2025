# Vulnerability Information: CVE-2024-49762

## Vulnerability Description
Pterodactyl is a free, open-source game server management panel. When a user disables two-factor authentication via the Panel, a `DELETE` request with their current password in a query parameter will be sent. While query parameters are encrypted when using TLS, many webservers (including ones officially documented for use with Pterodactyl) will log query parameters in plain-text, storing a users password in plain text. Prior to version 1.11.8, if a malicious user obtains access to these logs they could potentially authenticate against a users account assuming they are able to discover the accounts email address or username separately. This problem has been patched in version 1.11.8. There are no workarounds at this time. There is not a direct vulnerability within the software as it relates to logs generated by intermediate components such as web servers or Layer 7 proxies. Updating to `v1.11.8` or adding the linked patch manually are the only ways to avoid this problem. As this vulnerability relates to historical logging of sensitive data, users who have ever disabled 2FA on a Panel (self-hosted or operated by a company) should change their passwords and consider enabling 2FA if it was left disabled. While its unlikely that their account swill be compromised by this vulnerability, its not impossible. Panel administrators should consider clearing any access logs that may contain sensitive data.

### Vulnerability Description Key Phrases
- **rootcause:** **improper access control**
- **weakness:** **plaintext password exposure**
- **attacker:** malicious user
- **product:** Pterodactyl
- **version:** prior to 1.11.8
- **component:** Panel

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-49762:

**Root Cause of Vulnerability:**

- When a user disables two-factor authentication (2FA) on the Pterodactyl Panel, a `DELETE` request containing their current password in a query parameter was sent.
-  Webservers and proxies often log query parameters in plain text even when TLS encryption is used for the connection.

**Weaknesses/Vulnerabilities Present:**

- **Plaintext Password Logging:** The primary vulnerability is the logging of user passwords in plaintext within web server access logs when 2FA is disabled.
- **Use of `DELETE` Request:**  Using a `DELETE` request with the password in the query parameter was the specific mechanism triggering the logging of sensitive information.

**Impact of Exploitation:**

- **Account Compromise:** If an attacker gains access to the server logs containing the plaintext passwords, they can potentially authenticate to the affected user accounts.
- **Data Breach:**  Exposure of the user’s password in the server logs represents a significant data breach.
- **Limited Scope:**  Exploitation also requires the attacker to know or discover a user's email address or username separately.

**Attack Vectors:**

- **Log Access:** The primary attack vector is gaining unauthorized access to web server access logs. This could be done through system compromise, exploiting other vulnerabilities, or insider threat.
- **Local Access:** The CVSS score indicates a local attack vector, suggesting the attacker needs access to the server where logs are stored.

**Required Attacker Capabilities/Position:**

- **Access to Server Logs:** The attacker must have the ability to read the webserver access logs.
- **Knowledge of User Credentials:** They must then identify the username/email address associated with the exposed password to be able to exploit this issue.

**Additional Details:**

- **Patch:** The vulnerability was fixed by changing the `DELETE` request to a `POST` request, sending the password in the request body rather than as a query parameter. The patch is available in commit `8be2b89` on the `1.0-develop` branch and `75b5908` on top of `v1.11.7`.
- **Mitigation:** Users are advised to change passwords if they have ever disabled 2FA on their Pterodactyl panel, and to enable 2FA.  Panel administrators are advised to clear server access logs.
- **CVSS Score:** The CVSS score is 4.6 (Moderate), indicating a local attack vector with low confidentiality and integrity impact, and no impact on availability.
- **CWE:** The weakness is categorized as CWE-313: Missing Security Check on a Password.

In summary, the vulnerability arises from inadvertently logging user passwords in plain text due to the specific use of a `DELETE` request with parameters and how web servers process those. Exploitation requires an attacker to obtain access to these logs and to independently acquire username/email address information. The vulnerability has been fixed with the use of a POST request sending the password in the request body.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 1390 | Weak Authentication | Class | Allowed-with-Review | sparse | 1.173 |
| 2 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 1.156 |
| 3 | 287 | Improper Authentication | Class | Discouraged | sparse | 1.131 |
| 4 | 256 | Plaintext Storage of a Password | Base | Allowed | sparse | 1.124 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 1.111 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 1.097 |
| 7 | 209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | sparse | 1.083 |
| 8 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 1.077 |
| 9 | 620 | Unverified Password Change | Base | Allowed | dense | 0.471 |
| 10 | 613 | Insufficient Session Expiration | Base | Allowed | graph | 0.002 |


---

## CWE Classification Guidance

The following guidance has been automatically included because relevant keywords were detected in the vulnerability description:

### Authentication vs Authorization vs Access Control Guidance

## ===Guidance===

### Level Set – Authentication vs Authorization vs Access Control

**Authentication**:
Determines *who* the actor is (identity validation). This is typically the *first step* in access control.

* Example phrases: "user must log in", "lack of login check", "bypasses login"
* CWE relevance: authentication is usually mapped to CWE-306 or its children.

  * **CWE-306**: *Missing Authentication for Critical Function* – used when no identity validation is enforced for sensitive functionality (e.g., password reset, user deletion).

**Authorization**:
Determines *what* an authenticated actor is allowed to do. It decides access *after* identity is verified.

* Example phrases: "unauthorized access", "regular user can access admin panel", "role checks are missing"
* CWE relevance: use CWEs like 862, 863, 285 for authorization errors:

  * **CWE-862**: *Missing Authorization* – the application doesn't check whether the user is authorized at all.
  * **CWE-863**: *Incorrect Authorization* – the application checks authorization, but does it incorrectly (e.g., flawed logic).
  * **CWE-285**: *Improper Authorization* – general category for any flawed authorization logic or design.

**Access Control**:
A broader term that includes both authentication and authorization. Governs how resources are protected and who can access them under what conditions.

* CWE relevance:

  * **CWE-284**: *Improper Access Control* – top-level category used when access control failure exists but root cause is unclear.
  * This should be avoided **if** a more specific child CWE like 285, 862, 863, or 306 is appropriate.

---

## Mapping Discussion – Common Misclassification Patterns

### 1. **CWE-306 vs CWE-862**:

* **306** is about lack of **authentication** (e.g., *no login required at all*).
* **862** is about lack of **authorization** *after* authentication (e.g., *admin check missing*).
* ✅ Example CWE-306: *“An unauthenticated attacker can invoke the password reset API.”*
* ✅ Example CWE-862: *“An authenticated user without admin privileges can delete any user account.”*

### 2. **CWE-285 vs CWE-284**:

* **285** is specific to authorization flaws – it's a better choice than 284 **if** the issue involves *improper or missing role checks*.
* **284** should be reserved for general access control issues when it’s unclear whether the issue lies in authn or authz.

---

## Technical Impact vs Root Cause Clarification

**Phrase like "unauthorized access" is not enough.**

* If you **cannot determine whether identity was checked**, assume it’s **authorization** and consider 862 or 863.
* If you **know no login happened**, lean toward **authentication** → CWE-306.
* If the **access control policy is unclear or inconsistently enforced**, but it's not due to missing checks, consider **CWE-284**.

---

## Good Mapping Examples

* ✅ **CWE-306**: “The endpoint `/admin/deleteUser` does not require any authentication.”
* ✅ **CWE-862**: “Any logged-in user can change any other user's email without being an admin.”
* ✅ **CWE-863**: “An admin check exists but incorrectly grants access to non-admin users.”
* ✅ **CWE-285**: “Application uses a static role check that fails when roles change dynamically.”
* ✅ **CWE-284**: “Inconsistent enforcement of access rules across services with unclear policy source.”

---

## Summary – Quick LLM Rules of Thumb

| **Indicator**                                              | **Likely CWE** |
| ---------------------------------------------------------- | -------------- |
| No identity check (no login)                               | CWE-306        |
| No role/privilege check after login                        | CWE-862        |
| Role check is present but flawed                           | CWE-863        |
| General or ambiguous authorization failure                 | CWE-285        |
| High-level access control problem with no clear root cause | CWE-284        |


