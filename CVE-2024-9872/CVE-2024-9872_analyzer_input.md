# Vulnerability Information: CVE-2024-9872

## Vulnerability Description
The Online Booking & Scheduling Calendar for WordPress by vcita plugin for WordPress is vulnerable to unauthorized modification of data due to a **missing capability check** on the vcita_save_user_data_callback() function in all versions up to, and including, 4.5.1. This makes it possible for authenticated attackers, with Subscriber-level access and above, to inject malicious web scripts and update settings.

### Vulnerability Description Key Phrases
- **rootcause:** **missing capability check**
- **impact:** unauthorized modification of data
- **vector:** inject malicious web scripts and update settings
- **attacker:** authenticated attackers with Subscriber-level access and above
- **product:** Online Booking & Scheduling Calendar for WordPress by vcita
- **version:** up to and including 4.5.1
- **component:** vcita_save_user_data_callback() function

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**CVE ID:** CVE-2024-9872

**Root Cause of Vulnerability:**
The vulnerability stems from a missing capability check in the `vcita_save_user_data_callback()` function within the "Online Booking & Scheduling Calendar for WordPress by vcita" plugin. This allows unauthorized users to modify plugin settings.

**Weaknesses/Vulnerabilities Present:**
- **Missing Capability Check:** The primary weakness is the lack of proper authorization checks before allowing users to save data.
- **Stored Cross-Site Scripting (XSS):** By manipulating the `data_name` and `data_val` parameters, an attacker can inject malicious JavaScript code into the plugin's settings. Since these settings are saved in the database, this results in stored XSS.
- **Insecure Data Handling:** The initial code used `sanitize_text_field` on `data_name`, but after the fix this was changed to `sanitize_key` which is more appropriate to sanitize the key of the option name.

**Impact of Exploitation:**
- **Arbitrary Code Execution:** Successful exploitation allows attackers to inject malicious JavaScript that will execute in the browsers of other users, including administrators, when they view pages where the plugin's output is rendered. This allows complete takeover of a WordPress website if the attacker is able to target an admin.
- **Data Manipulation:** Attackers can potentially modify other settings stored in the plugin's database through the vulnerable function, although the primary issue is XSS.

**Attack Vectors:**
- **HTTP Request:** The vulnerability can be exploited by sending a crafted HTTP request to the `vcita_save_user_data_callback()` function via AJAX.
- **`data_name` and `data_val` Parameters:** The attack uses these parameters to inject the malicious payload, since they are not properly sanitized in versions <= 4.5.1

**Required Attacker Capabilities/Position:**
- **Authenticated User:** The attacker needs to be an authenticated user of the WordPress site, with at least "Subscriber" level permissions.
- **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable WordPress site.

**Additional Notes:**

- The provided changeset shows that the vulnerability was addressed by adding a nonce check for CSRF protection, checking for the "manage_options" capability, and using `sanitize_key` instead of `sanitize_text_field` on `data_name`.
- The Wordfence article provides a good explanation of the vulnerability and lists the affected versions and the patched version.
- The vulnerability is rated as Medium severity with a CVSS score of 5.4.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.455 |
| 2 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.454 |
| 3 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.415 |
| 4 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.393 |
| 5 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.391 |
| 6 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.387 |
| 7 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.385 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.368 |
| 9 | 472 | External Control of Assumed-Immutable Web Parameter | Base | Allowed | dense | 0.508 |
| 10 | 471 | Modification of Assumed-Immutable Data (MAID) | Base | Allowed | graph | 0.003 |

