# Vulnerability Information: CVE-2024-39774

## Vulnerability Description
A buffer overflow vulnerability exists in the adm.cgi set_sys_adm() functionality of Wavlink AC3000 M33A8.V5030.210505. A specially crafted HTTP request can lead to **stack-based buffer overflow**. An attacker can make an authenticated HTTP request to trigger this vulnerability.

### Vulnerability Description Key Phrases
- **weakness:** **stack-based buffer overflow**
- **vector:** specially crafted HTTP request
- **attacker:** attacker
- **product:** Wavlink AC3000
- **version:** M33A8.V5030.210505
- **component:** adm.cgi set_sys_adm() functionality

## CVE Reference Links Content Summary
## CVE-2024-39774 - Wavlink AC3000 adm.cgi set_sys_adm() buffer overflow vulnerability

**Root cause of vulnerability:**

A buffer overflow vulnerability exists due to a lack of length checks when copying data into a stack buffer using `sprintf` in the `set_sys_adm` function of the `adm.cgi` file. Specifically, the `new_pwd` POST parameter is copied without size validation.

**Weaknesses/vulnerabilities present:**

*   CWE-120 - Buffer Copy without Checking Size of Input (‘Classic Buffer Overflow’)
*   Stack-based buffer overflow

**Impact of exploitation:**

Successful exploitation allows an attacker to overwrite the return address of the function, leading to code execution. This can result in high impact on confidentiality, integrity, and availability (CVSSv3 score: 9.1).

**Attack vectors:**

*   An attacker can send a specially crafted HTTP POST request to the `adm.cgi` script with a large `new_pwd` parameter.
*   Requires authenticated access (PR:H - Privileges Required: High).

**Required attacker capabilities/position:**

*   Authenticated user with the ability to send HTTP POST requests to the vulnerable endpoint.

**Mitigation or fix:**

The report does not specify a fix, but implies that proper bounds checking on input data before copying it into fixed-size buffers is necessary to prevent the vulnerability. The vendor was contacted and acknowledged the issue, but the product has been discontinued. Patches were being worked on at the time of the report.

**Additional Details (more than official CVE description):**

*   **Vulnerable Product:** Wavlink AC3000 M33A8.V5030.210505
*   **Vulnerable Function:** `set_sys_adm` in `adm.cgi`
*   The router uses lighttpd, and .cgi files are located in the web root.
*   The `check_valid_user()` function is used for authentication, checking the `session` cookie.
*   The vulnerability is triggered when the `page=sysAdm` parameter is used in the HTTP POST request.
*   The `sprintf` function at offsets [2] and [3] are vulnerable.
*   Crash information and a GDB backtrace are provided.
*   Timeline of vendor communication is included.
*   Discovered by Lilith >\_> of Cisco Talos.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | Discouraged | alternate_terms | 0.800 |
| 2 | 190 | Integer Overflow or Wraparound | Base | Allowed | alternate_terms | 0.800 |
| 3 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | sparse | 0.329 |
| 4 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.316 |
| 5 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.282 |
| 6 | 195 | Signed to Unsigned Conversion Error | Variant | Allowed | sparse | 0.274 |
| 7 | 674 | Uncontrolled Recursion | Class | Allowed-with-Review | sparse | 0.272 |
| 8 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.272 |
| 9 | 805 | Buffer Access with Incorrect Length Value | Base | Allowed | dense | 0.591 |
| 10 | 128 | Wrap-around Error | Base | Allowed | graph | 0.003 |

