{
  "query": "In the Linux kernel, the following vulnerability has been resolved drm/fbdev-dma Only cleanup deferred I/O if necessary Commit 5a498d4d06d6 (drm/fbdev-dma Only install deferred I/O if necessary) initializes deferred I/O only if it is used. drm_fbdev_dma_fb_destroy() however calls fb_deferred_io_cleanup() unconditionally with struct fb_info.fbdefio == NULL. KASAN with the out-of-tree Apple silicon display driver posts following warning from __flush_work() of a random struct work_struct instead of the expected NULL pointer derefs. [ 22.053799] ------------[ cut here ]------------ [ 22.054832] WARNING CPU 2 PID 1 at kernel/workqueue.c4177 __flush_work+0x4d8/0x580 [ 22.056597] Modules linked in uhid bnep uinput nls_ascii ip6_tables ip_tables i2c_dev loop fuse dm_multipath nfnetlink zram hid_magicmouse btrfs xor xor_neon brcmfmac_wcc raid6_pq hci_bcm4377 bluetooth brcmfmac hid_apple brcmutil nvmem_spmi_mfd simple_mfd_spmi dockchannel_hid cfg80211 joydev regmap_spmi nvme_apple ecdh_generic ecc macsmc_hid rfkill dwc3 appledrm snd_soc_macaudio macsmc_power nvme_core apple_isp phy_apple_atc apple_sart apple_rtkit_helper apple_dockchannel tps6598x macsmc_hwmon snd_soc_cs42l84 videobuf2_v4l2 spmi_apple_controller nvmem_apple_efuses videobuf2_dma_sg apple_z2 videobuf2_memops spi_nor panel_summit videobuf2_common asahi videodev pwm_apple apple_dcp snd_soc_apple_mca apple_admac spi_apple clk_apple_nco i2c_pasemi_platform snd_pcm_dmaengine mc i2c_pasemi_core mux_core ofpart adpdrm drm_dma_helper apple_dart apple_soc_cpufreq leds_pwm phram [ 22.073768] CPU 2 UID 0 PID 1 Comm systemd-shutdow Not tainted 6.11.2-asahi+ #asahi-dev [ 22.075612] Hardware name Apple MacBook Pro (13-inch, M2, 2022) (DT) [ 22.077032] pstate 01400005 (nzcv daif +PAN -UAO -TCO +DIT -SSBS BTYPE=--) [ 22.078567] pc __flush_work+0x4d8/0x580 [ 22.079471] lr __flush_work+0x54/0x580 [ 22.080345] sp ffffc000836ef820 [ 22.081089] x29 ffffc000836ef880 x28 0000000000000000 x27 ffff80002ddb7128 [ 22.082678] x26 dfffc00000000000 x25 1ffff000096f0c57 x24 ffffc00082d3e358 [ 22.084263] x23 ffff80004b7862b8 x22 dfffc00000000000 x21 ffff80005aa1d470 [ 22.085855] x20 ffff80004b786000 x19 ffff80004b7862a0 x18 0000000000000000 [ 22.087439] x17 0000000000000000 x16 0000000000000000 x15 0000000000000005 [ 22.089030] x14 1ffff800106ddf0a x13 0000000000000000 x12 0000000000000000 [ 22.090618] x11 ffffb800106ddf0f x10 dfffc00000000000 x9 1ffff800106ddf0e [ 22.092206] x8 0000000000000000 x7 aaaaaaaaaaaaaaaa x6 0000000000000001 [ 22.093790] x5 ffffc000836ef728 x4 0000000000000000 x3 0000000000000020 [ 22.095368] x2 0000000000000008 x1 00000000000000aa x0 0000000000000000 [ 22.096955] Call trace [ 22.097505] __flush_work+0x4d8/0x580 [ 22.098330] flush_delayed_work+0x80/0xb8 [ 22.099231] fb_deferred_io_cleanup+0x3c/0x130 [ 22.100217] drm_fbdev_dma_fb_destroy+0x6c/0xe0 [drm_dma_helper] [ 22.101559] unregister_framebuffer+0x210/0x2f0 [ 22.102575] drm_fb_helper_unregister_info+0x48/0x60 [ 22.103683] drm_fbdev_dma_client_unregister+0x4c/0x80 [drm_dma_helper] [ 22.105147] drm_client_dev_unregister+0x1cc/0x230 [ 22.106217] drm_dev_unregister+0x58/0x570 [ 22.107125] apple_drm_unbind+0x50/0x98 [appledrm] [ 22.108199] component_del+0x1f8/0x3a8 [ 22.109042] dcp_platform_shutdown+0x24/0x38 [apple_dcp] [ 22.110357] platform_shutdown+0x70/0x90 [ 22.111219] device_shutdown+0x368/0x4d8 [ 22.112095] kernel_restart+0x6c/0x1d0 [ 22.112946] __arm64_sys_reboot+0x1c8/0x328 [ 22.113868] invoke_syscall+0x78/0x1a8 [ 22.114703] do_el0_svc+0x124/0x1a0 [ 22.115498] el0_svc+0x3c/0xe0 [ 22.116181] el0t_64_sync_handler+0x70/0xc0 [ 22.117110] el0t_64_sync+0x190/0x198 [ 22.117931] ---[ end trace 0000000000000000 ]---",
  "keyphrases": {
    "rootcause": [
      "The function `drm_fbdev_dma_fb_destroy()` calls `fb_deferred_io_cleanup()` unconditionally",
      "even when `struct fb_info.fbdefio` is NULL",
      "leading to a crash during workqueue flushing."
    ],
    "weakness": [
      "The code does not check if deferred I",
      "O is initialized before attempting to clean it up."
    ]
  },
  "timestamp": "2025-07-12T05:26:35.402648",
  "retriever_config": {
    "weights": {
      "dense": 0.35,
      "sparse": 0.4,
      "graph": 0.25
    },
    "use_graph": true,
    "use_rag": true,
    "use_sparse": true
  },
  "raw_results": {
    "graph": [
      {
        "cwe_id": "908",
        "name": "Use of Uninitialized Resource",
        "abstraction": "Base",
        "score": 2.845617118666473,
        "description": "The product uses or accesses a resource that has not been initialized....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "252",
        "name": "Unchecked Return Value",
        "abstraction": "Base",
        "score": 2.521716424217655,
        "description": "The product does not check the return value from a method or function, which can prevent it from detecting unexpected states and conditions....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "base",
        "score": 2.3998000000000004,
        "description": "CWE-770: Allocation of Resources Without Limits or Throttling...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1325",
        "name": "Improperly Controlled Sequential Memory Allocation",
        "abstraction": "base",
        "score": 2.3400000000000003,
        "description": "CWE-1325: Improperly Controlled Sequential Memory Allocation...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "base",
        "score": 2.3295999999999997,
        "description": "CWE-835: Loop with Unreachable Exit Condition ('Infinite Loop')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1322",
        "name": "Use of Blocking Code in Single-threaded, Non-blocking Context",
        "abstraction": "base",
        "score": 2.2100000000000004,
        "description": "CWE-1322: Use of Blocking Code in Single-threaded, Non-blocking Context...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "266",
        "name": "Incorrect Privilege Assignment",
        "abstraction": "base",
        "score": 2.1189999999999998,
        "description": "CWE-266: Incorrect Privilege Assignment...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "129",
        "name": "Improper Validation of Array Index",
        "abstraction": "variant",
        "score": 2.05536,
        "description": "CWE-129: Improper Validation of Array Index...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "456",
        "name": "Missing Initialization of a Variable",
        "abstraction": "variant",
        "score": 1.83936,
        "description": "CWE-456: Missing Initialization of a Variable...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 1.786352172757724,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "120",
        "name": "Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "22",
        "name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "41",
        "name": "Improper Resolution of Path Equivalence",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-41: Improper Resolution of Path Equivalence...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "123",
        "name": "Write-what-where Condition",
        "abstraction": "base",
        "score": 1.7680000000000005,
        "description": "CWE-123: Write-what-where Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "364",
        "name": "Signal Handler Race Condition",
        "abstraction": "base",
        "score": 1.7550000000000001,
        "description": "CWE-364: Signal Handler Race Condition...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 1.6999128751468557,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1265",
        "name": "Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls",
        "abstraction": "base",
        "score": 1.6848000000000003,
        "description": "CWE-1265: Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "386",
        "name": "Symbolic Name not Mapping to Correct Object",
        "abstraction": "base",
        "score": 1.6744000000000003,
        "description": "CWE-386: Symbolic Name not Mapping to Correct Object...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "61",
        "name": "UNIX Symbolic Link (Symlink) Following",
        "abstraction": "compound",
        "score": 1.61,
        "description": "CWE-61: UNIX Symbolic Link (Symlink) Following...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "609",
        "name": "Double-Checked Locking",
        "abstraction": "base",
        "score": 1.5912000000000004,
        "description": "CWE-609: Double-Checked Locking...",
        "mapping_usage": "Allowed"
      }
    ],
    "dense": [
      {
        "cwe_id": "667",
        "name": "Improper Locking",
        "abstraction": "Class",
        "score": 0.6251710481695505,
        "description": "The product does not properly acquire or release a lock on a resource, leading to unexpected resource state changes and behaviors....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "909",
        "name": "Missing Initialization of Resource",
        "abstraction": "Class",
        "score": 0.617428272392873,
        "description": "The product does not initialize a critical resource....",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "1285",
        "name": "Improper Validation of Specified Index, Position, or Offset in Input",
        "abstraction": "Base",
        "score": 0.6022339179445985,
        "description": "The product receives input that is expected to specify an index, position, or offset into an indexable resource such as a buffer or file, but it does not validate or incorrectly validates that the spe...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "362",
        "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
        "abstraction": "Class",
        "score": 0.5954158473791874,
        "description": "The product contains a concurrent code sequence that requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code ...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "908",
        "name": "Use of Uninitialized Resource",
        "abstraction": "Base",
        "score": 0.5887189237787716,
        "description": "The product uses or accesses a resource that has not been initialized....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "665",
        "name": "Improper Initialization",
        "abstraction": "Class",
        "score": 0.5866827848482572,
        "description": "The product does not initialize or incorrectly initializes a resource, which might leave the resource in an unexpected state when it is accessed or used....",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "119",
        "name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
        "abstraction": "Class",
        "score": 0.5827089734834852,
        "description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected m...",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "416",
        "name": "Use After Free",
        "abstraction": "Variant",
        "score": 0.5813245576144027,
        "description": "The product reuses or references memory after it has been freed. At some point afterward, the memory may be allocated again and saved in another pointer, while the original pointer references a locati...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "126",
        "name": "Buffer Over-read",
        "abstraction": "Variant",
        "score": 0.5791465862799405,
        "description": "The product reads from a buffer using buffer access mechanisms such as indexes or pointers that reference memory locations after the targeted buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "190",
        "name": "Integer Overflow or Wraparound",
        "abstraction": "Base",
        "score": 0.5740736530052799,
        "description": "The product performs a calculation that can\n         produce an integer overflow or wraparound when the logic\n         assumes that the resulting value will always be larger than\n         the original...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "787",
        "name": "Out-of-bounds Write",
        "abstraction": "Base",
        "score": 0.5436504770483219,
        "description": "The product writes data past the end, or before the beginning, of the intended buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "122",
        "name": "Heap-based Buffer Overflow",
        "abstraction": "Variant",
        "score": 0.5381676220408016,
        "description": "A heap overflow condition is a buffer overflow, where the buffer that can be overwritten is allocated in the heap portion of memory, generally meaning that the buffer was allocated using a routine suc...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "476",
        "name": "NULL Pointer Dereference",
        "abstraction": "Base",
        "score": 0.5254043851069361,
        "description": "The product dereferences a pointer that it expects to be valid but is NULL....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "125",
        "name": "Out-of-bounds Read",
        "abstraction": "Base",
        "score": 0.5220350211075979,
        "description": "The product reads data past the end, or before the beginning, of the intended buffer....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "401",
        "name": "Missing Release of Memory after Effective Lifetime",
        "abstraction": "Variant",
        "score": 0.5193923849078035,
        "description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "367",
        "name": "Time-of-check Time-of-use (TOCTOU) Race Condition",
        "abstraction": "Base",
        "score": 0.5191815813042945,
        "description": "The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can ca...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "1284",
        "name": "Improper Validation of Specified Quantity in Input",
        "abstraction": "Base",
        "score": 0.5155046801517376,
        "description": "The product receives input that is expected to specify a quantity (such as size or length), but it does not validate or incorrectly validates that the quantity has the required properties....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "415",
        "name": "Double Free",
        "abstraction": "Variant",
        "score": 0.5123719423886816,
        "description": "The product calls free() twice on the same memory address, potentially leading to modification of unexpected memory locations....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "121",
        "name": "Stack-based Buffer Overflow",
        "abstraction": "Variant",
        "score": 0.5123513929150909,
        "description": "A stack-based buffer overflow condition is a condition where the buffer being overwritten is allocated on the stack (i.e., is a local variable or, rarely, a parameter to a function)....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "20",
        "name": "Improper Input Validation",
        "abstraction": "Class",
        "score": 0.5112797418571133,
        "description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correct...",
        "mapping_usage": "Discouraged"
      }
    ],
    "sparse": [
      {
        "cwe_id": "252",
        "name": "Unchecked Return Value",
        "abstraction": "Base",
        "score": 871.2885805917404,
        "description": "The product does not check the return value from a method or function, which can prevent it from detecting unexpected states and conditions....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "835",
        "name": "Loop with Unreachable Exit Condition ('Infinite Loop')",
        "abstraction": "Base",
        "score": 817.932121737533,
        "description": "The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "77",
        "name": "Improper Neutralization of Special Elements used in a Command ('Command Injection')",
        "abstraction": "Class",
        "score": 767.5107196635979,
        "description": "The product constructs all or part of a command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify t...",
        "mapping_usage": "Allowed-with-Review"
      },
      {
        "cwe_id": "770",
        "name": "Allocation of Resources Without Limits or Throttling",
        "abstraction": "Base",
        "score": 761.3597327434928,
        "description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the in...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "266",
        "name": "Incorrect Privilege Assignment",
        "abstraction": "Base",
        "score": 743.9219724312431,
        "description": "A product incorrectly assigns a privilege to a particular actor, creating an unintended sphere of control for that actor....",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "90",
        "name": "Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection')",
        "abstraction": "Base",
        "score": 740.3430460660438,
        "description": "The product constructs all or part of an LDAP query using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modi...",
        "mapping_usage": "Allowed"
      },
      {
        "cwe_id": "693",
        "name": "Protection Mechanism Failure",
        "abstraction": "Pillar",
        "score": 737.9997603719962,
        "description": "The product does not use or incorrectly uses a protection mechanism that provides sufficient defense against directed attacks against the product....",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "610",
        "name": "Externally Controlled Reference to a Resource in Another Sphere",
        "abstraction": "Class",
        "score": 718.752032060092,
        "description": "The product uses an externally controlled name or reference that resolves to a resource that is outside of the intended control sphere....",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "200",
        "name": "Exposure of Sensitive Information to an Unauthorized Actor",
        "abstraction": "Class",
        "score": 714.6675107292604,
        "description": "The product exposes sensitive information to an actor that is not explicitly authorized to have access to that information....",
        "mapping_usage": "Discouraged"
      },
      {
        "cwe_id": "20",
        "name": "Improper Input Validation",
        "abstraction": "Class",
        "score": 714.1987684123256,
        "description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correct...",
        "mapping_usage": "Discouraged"
      }
    ]
  },
  "score_statistics": {
    "dense": {
      "min": 0.5112797418571133,
      "max": 0.6251710481695505,
      "mean": 0.5576121896862362,
      "median": 0.5588620650268009,
      "count": 20
    },
    "sparse": {
      "min": 714.1987684123256,
      "max": 871.2885805917404,
      "mean": 758.7974244807326,
      "median": 742.1325092486435,
      "count": 10
    },
    "graph": {
      "min": 1.5912000000000004,
      "max": 2.845617118666473,
      "mean": 1.9767059295394354,
      "median": 1.7771760863788622,
      "count": 20
    }
  }
}