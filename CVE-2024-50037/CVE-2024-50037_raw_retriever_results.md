# Raw Retriever Results for CVE-2024-50037

# Raw Retriever Results for CVE-2024-50037
## Query
In the Linux kernel, the following vulnerability has been resolved drm/fbdev-dma Only cleanup deferred I/O if necessary Commit 5a498d4d06d6 (drm/fbdev-dma Only install deferred I/O if necessary) initializes deferred I/O only if it is used. drm_fbdev_dma_fb_destroy() however calls fb_deferred_io_cleanup() unconditionally with struct fb_info.fbdefio == NULL. KASAN with the out-of-tree Apple silicon display driver posts following warning from __flush_work() of a random struct work_struct instead of the expected NULL pointer derefs. [ 22.053799] ------------[ cut here ]------------ [ 22.054832] WARNING CPU 2 PID 1 at kernel/workqueue.c4177 __flush_work+0x4d8/0x580 [ 22.056597] Modules linked in uhid bnep uinput nls_ascii ip6_tables ip_tables i2c_dev loop fuse dm_multipath nfnetlink zram hid_magicmouse btrfs xor xor_neon brcmfmac_wcc raid6_pq hci_bcm4377 bluetooth brcmfmac hid_apple brcmutil nvmem_spmi_mfd simple_mfd_spmi dockchannel_hid cfg80211 joydev regmap_spmi nvme_apple ecdh_generic ecc macsmc_hid rfkill dwc3 appledrm snd_soc_macaudio macsmc_power nvme_core apple_isp phy_apple_atc apple_sart apple_rtkit_helper apple_dockchannel tps6598x macsmc_hwmon snd_soc_cs42l84 videobuf2_v4l2 spmi_apple_controller nvmem_apple_efuses videobuf2_dma_sg apple_z2 videobuf2_memops spi_nor panel_summit videobuf2_common asahi videodev pwm_apple apple_dcp snd_soc_apple_mca apple_admac spi_apple clk_apple_nco i2c_pasemi_platform snd_pcm_dmaengine mc i2c_pasemi_core mux_core ofpart adpdrm drm_dma_helper apple_dart apple_soc_cpufreq leds_pwm phram [ 22.073768] CPU 2 UID 0 PID 1 Comm systemd-shutdow Not tainted 6.11.2-asahi+ #asahi-dev [ 22.075612] Hardware name Apple MacBook Pro (13-inch, M2, 2022) (DT) [ 22.077032] pstate 01400005 (nzcv daif +PAN -UAO -TCO +DIT -SSBS BTYPE=--) [ 22.078567] pc __flush_work+0x4d8/0x580 [ 22.079471] lr __flush_work+0x54/0x580 [ 22.080345] sp ffffc000836ef820 [ 22.081089] x29 ffffc000836ef880 x28 0000000000000000 x27 ffff80002ddb7128 [ 22.082678] x26 dfffc00000000000 x25 1ffff000096f0c57 x24 ffffc00082d3e358 [ 22.084263] x23 ffff80004b7862b8 x22 dfffc00000000000 x21 ffff80005aa1d470 [ 22.085855] x20 ffff80004b786000 x19 ffff80004b7862a0 x18 0000000000000000 [ 22.087439] x17 0000000000000000 x16 0000000000000000 x15 0000000000000005 [ 22.089030] x14 1ffff800106ddf0a x13 0000000000000000 x12 0000000000000000 [ 22.090618] x11 ffffb800106ddf0f x10 dfffc00000000000 x9 1ffff800106ddf0e [ 22.092206] x8 0000000000000000 x7 aaaaaaaaaaaaaaaa x6 0000000000000001 [ 22.093790] x5 ffffc000836ef728 x4 0000000000000000 x3 0000000000000020 [ 22.095368] x2 0000000000000008 x1 00000000000000aa x0 0000000000000000 [ 22.096955] Call trace [ 22.097505] __flush_work+0x4d8/0x580 [ 22.098330] flush_delayed_work+0x80/0xb8 [ 22.099231] fb_deferred_io_cleanup+0x3c/0x130 [ 22.100217] drm_fbdev_dma_fb_destroy+0x6c/0xe0 [drm_dma_helper] [ 22.101559] unregister_framebuffer+0x210/0x2f0 [ 22.102575] drm_fb_helper_unregister_info+0x48/0x60 [ 22.103683] drm_fbdev_dma_client_unregister+0x4c/0x80 [drm_dma_helper] [ 22.105147] drm_client_dev_unregister+0x1cc/0x230 [ 22.106217] drm_dev_unregister+0x58/0x570 [ 22.107125] apple_drm_unbind+0x50/0x98 [appledrm] [ 22.108199] component_del+0x1f8/0x3a8 [ 22.109042] dcp_platform_shutdown+0x24/0x38 [apple_dcp] [ 22.110357] platform_shutdown+0x70/0x90 [ 22.111219] device_shutdown+0x368/0x4d8 [ 22.112095] kernel_restart+0x6c/0x1d0 [ 22.112946] __arm64_sys_reboot+0x1c8/0x328 [ 22.113868] invoke_syscall+0x78/0x1a8 [ 22.114703] do_el0_svc+0x124/0x1a0 [ 22.115498] el0_svc+0x3c/0xe0 [ 22.116181] el0t_64_sync_handler+0x70/0xc0 [ 22.117110] el0t_64_sync+0x190/0x198 [ 22.117931] ---[ end trace 0000000000000000 ]---

## Keyphrases
- **rootcause**: 'The function `drm_fbdev_dma_fb_destroy()` calls `fb_deferred_io_cleanup()` unconditionally', 'even when `struct fb_info.fbdefio` is NULL', 'leading to a crash during workqueue flushing.'
- **weakness**: 'The code does not check if deferred I', 'O is initialized before attempting to clean it up.'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.5113 | 0.6252 | 0.5576 | 0.5589 | 20 |
| Sparse | 714.1988 | 871.2886 | 758.7974 | 742.1325 | 10 |
| Graph | 1.5931 | 2.8457 | 1.9981 | 1.7772 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 908 | Use of Uninitialized Resource | Base | 2.8457 | Allowed |
| 2 | 770 | Allocation of Resources Without Limits or Throttling | base | 2.8210 | Allowed |
| 3 | 252 | Unchecked Return Value | Base | 2.5217 | Allowed |
| 4 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.3400 | Allowed |
| 5 | 1322 | Use of Blocking Code in Single-threaded, Non-blocking Context | base | 2.2100 | Allowed |
| 6 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | base | 2.1190 | Allowed |
| 7 | 266 | Incorrect Privilege Assignment | base | 2.1190 | Allowed |
| 8 | 456 | Missing Initialization of a Variable | variant | 2.0554 | Allowed |
| 9 | 129 | Improper Validation of Array Index | variant | 2.0554 | Allowed |
| 10 | 909 | Missing Initialization of Resource | Class | 1.7864 | Allowed-with-Review |
| 11 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | base | 1.7680 | Allowed |
| 12 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 13 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 14 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 15 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 667 | Improper Locking | Class | 0.6252 | 0.6252 | Allowed-with-Review |
| 2 | 909 | Missing Initialization of Resource | Class | 0.6174 | 0.6174 | Allowed-with-Review |
| 3 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.6022 | 0.6022 | Allowed |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5954 | 0.5954 | Allowed-with-Review |
| 5 | 908 | Use of Uninitialized Resource | Base | 0.5887 | 0.5887 | Allowed |
| 6 | 665 | Improper Initialization | Class | 0.5867 | 0.5867 | Discouraged |
| 7 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.5827 | 0.5827 | Discouraged |
| 8 | 416 | Use After Free | Variant | 0.5813 | 0.5813 | Allowed |
| 9 | 126 | Buffer Over-read | Variant | 0.5792 | 0.5792 | Allowed |
| 10 | 190 | Integer Overflow or Wraparound | Base | 0.5741 | 0.5741 | Allowed |
| 11 | 787 | Out-of-bounds Write | Base | 0.5437 | 0.5437 | Allowed |
| 12 | 122 | Heap-based Buffer Overflow | Variant | 0.5382 | 0.5382 | Allowed |
| 13 | 476 | NULL Pointer Dereference | Base | 0.5254 | 0.5254 | Allowed |
| 14 | 125 | Out-of-bounds Read | Base | 0.5220 | 0.5220 | Allowed |
| 15 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5194 | 0.5194 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 252 | Unchecked Return Value | 871.2886 | 871.2886 | Allowed |
| 2 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | 817.9321 | 817.9321 | Allowed |
| 3 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | 767.5107 | 767.5107 | Allowed-with-Review |
| 4 | 770 | Allocation of Resources Without Limits or Throttling | 761.3597 | 761.3597 | Allowed |
| 5 | 266 | Incorrect Privilege Assignment | 743.9220 | 743.9220 | Allowed |
| 6 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | 740.3430 | 740.3430 | Allowed |
| 7 | 693 | Protection Mechanism Failure | 737.9998 | 737.9998 | Discouraged |
| 8 | 610 | Externally Controlled Reference to a Resource in Another Sphere | 718.7520 | 718.7520 | Discouraged |
| 9 | 200 | Exposure of Sensitive Information to an Unauthorized Actor | 714.6675 | 714.6675 | Discouraged |
| 10 | 20 | Improper Input Validation | 714.1988 | 714.1988 | Discouraged |
