{
  "query": "In the Linux kernel, the following vulnerability has been resolved ext4 ignore xattrs past end Once inside ext4_xattr_inode_dec_ref_all we should ignore xattrs entries past the end entry. This fixes the following KASAN reported issue ================================================================== BUG KASAN slab-use-after-free in ext4_xattr_inode_dec_ref_all+0xb8c/0xe90 Read of size 4 at addr ffff888012c120c4 by task repro/2065 CPU 1 UID 0 PID 2065 Comm repro Not tainted 6.13.0-rc2+ #11 Hardware name QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org 04/01/2014 Call Trace dump_stack_lvl+0x1fd/0x300 ? tcp_gro_dev_warn+0x260/0x260 ? _printk+0xc0/0x100 ? read_lock_is_recursive+0x10/0x10 ? irq_work_queue+0x72/0xf0 ? __virt_addr_valid+0x17b/0x4b0 print_address_description+0x78/0x390 print_report+0x107/0x1f0 ? __virt_addr_valid+0x17b/0x4b0 ? __virt_addr_valid+0x3ff/0x4b0 ? __phys_addr+0xb5/0x160 ? ext4_xattr_inode_dec_ref_all+0xb8c/0xe90 kasan_report+0xcc/0x100 ? ext4_xattr_inode_dec_ref_all+0xb8c/0xe90 ext4_xattr_inode_dec_ref_all+0xb8c/0xe90 ? ext4_xattr_delete_inode+0xd30/0xd30 ? __ext4_journal_ensure_credits+0x5f0/0x5f0 ? __ext4_journal_ensure_credits+0x2b/0x5f0 ? inode_update_timestamps+0x410/0x410 ext4_xattr_delete_inode+0xb64/0xd30 ? ext4_truncate+0xb70/0xdc0 ? ext4_expand_extra_isize_ea+0x1d20/0x1d20 ? __ext4_mark_inode_dirty+0x670/0x670 ? ext4_journal_check_start+0x16f/0x240 ? ext4_inode_is_fast_symlink+0x2f2/0x3a0 ext4_evict_inode+0xc8c/0xff0 ? ext4_inode_is_fast_symlink+0x3a0/0x3a0 ? do_raw_spin_unlock+0x53/0x8a0 ? ext4_inode_is_fast_symlink+0x3a0/0x3a0 evict+0x4ac/0x950 ? proc_nr_inodes+0x310/0x310 ? trace_ext4_drop_inode+0xa2/0x220 ? _raw_spin_unlock+0x1a/0x30 ? iput+0x4cb/0x7e0 do_unlinkat+0x495/0x7c0 ? try_break_deleg+0x120/0x120 ? 0xffffffff81000000 ? __check_object_size+0x15a/0x210 ? strncpy_from_user+0x13e/0x250 ? getname_flags+0x1dc/0x530 __x64_sys_unlinkat+0xc8/0xf0 do_syscall_64+0x65/0x110 entry_SYSCALL_64_after_hwframe+0x67/0x6f RIP 00330x434ffd Code 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 8 RSP 002b00007ffc50fa7b28 EFLAGS 00000246 ORIG_RAX 0000000000000107 RAX ffffffffffffffda RBX 00007ffc50fa7e18 RCX 0000000000434ffd RDX 0000000000000000 RSI 0000000020000240 RDI 0000000000000005 RBP 00007ffc50fa7be0 R08 0000000000000000 R09 0000000000000000 R10 0000000000000000 R11 0000000000000246 R12 0000000000000001 R13 00007ffc50fa7e08 R14 00000000004bbf30 R15 0000000000000001 The buggy address belongs to the object at ffff888012c12000 which belongs to the cache filp of size 360 The buggy address is located 196 bytes inside of freed 360-byte region [ffff888012c12000, ffff888012c12168) The buggy address belongs to the physical page page refcount1 mapcount0 mapping0000000000000000 index0x0 pfn0x12c12 head order1 mapcount0 entire_mapcount0 nr_pages_mapped0 pincount0 flags 0x40(head|node=0|zone=0) page_type f5(slab) raw 0000000000000040 ffff888000ad7640 ffffea0000497a00 dead000000000004 raw 0000000000000000 0000000000100010 00000001f5000000 0000000000000000 head 0000000000000040 ffff888000ad7640 ffffea0000497a00 dead000000000004 head 0000000000000000 0000000000100010 00000001f5000000 0000000000000000 head 0000000000000001 ffffea00004b0481 ffffffffffffffff 0000000000000000 head 0000000000000002 0000000000000000 00000000ffffffff 0000000000000000 page dumped because kasan bad access detected Memory state around the buggy address ffff888012c11f80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ffff888012c12000 fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb > ffff888012c12080 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb ^ ffff888012c12100 fb fb fb fb fb fb fb fb fb fb fb fb fb fc fc fc ffff888012c12180 fc fc fc fc fc fc fc fc fc ---truncated---",
  "count": 20,
  "results": [
    {
      "cwe_id": "909",
      "name": "Missing Initialization of Resource",
      "abstraction": "Class",
      "score": 0.5577603908318347,
      "original_score": 0.5577603908318347,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "667",
      "name": "Improper Locking",
      "abstraction": "Class",
      "score": 0.5543404563819639,
      "original_score": 0.5543404563819639,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "362",
      "name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
      "abstraction": "Class",
      "score": 0.5432589836137728,
      "original_score": 0.5432589836137728,
      "mapping_usage": "Allowed-with-Review"
    },
    {
      "cwe_id": "823",
      "name": "Use of Out-of-range Pointer Offset",
      "abstraction": "Base",
      "score": 0.5416907356840808,
      "original_score": 0.5416907356840808,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1285",
      "name": "Improper Validation of Specified Index, Position, or Offset in Input",
      "abstraction": "Base",
      "score": 0.5412827832731129,
      "original_score": 0.5412827832731129,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "416",
      "name": "Use After Free",
      "abstraction": "Variant",
      "score": 0.534374957474112,
      "original_score": 0.534374957474112,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "126",
      "name": "Buffer Over-read",
      "abstraction": "Variant",
      "score": 0.5318515356951481,
      "original_score": 0.5318515356951481,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "822",
      "name": "Untrusted Pointer Dereference",
      "abstraction": "Base",
      "score": 0.5280626145211341,
      "original_score": 0.5280626145211341,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "190",
      "name": "Integer Overflow or Wraparound",
      "abstraction": "Base",
      "score": 0.527526861016411,
      "original_score": 0.527526861016411,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "908",
      "name": "Use of Uninitialized Resource",
      "abstraction": "Base",
      "score": 0.526536632263808,
      "original_score": 0.526536632263808,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1342",
      "name": "Information Exposure through Microarchitectural State after Transient Execution",
      "abstraction": "Base",
      "score": 0.5220338863217984,
      "original_score": 0.5220338863217984,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "125",
      "name": "Out-of-bounds Read",
      "abstraction": "Base",
      "score": 0.5203629293537713,
      "original_score": 0.5203629293537713,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "911",
      "name": "Improper Update of Reference Count",
      "abstraction": "Base",
      "score": 0.5175024119083038,
      "original_score": 0.5175024119083038,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "805",
      "name": "Buffer Access with Incorrect Length Value",
      "abstraction": "Base",
      "score": 0.5147939758562509,
      "original_score": 0.5147939758562509,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "786",
      "name": "Access of Memory Location Before Start of Buffer",
      "abstraction": "Base",
      "score": 0.5138447484503441,
      "original_score": 0.5138447484503441,
      "mapping_usage": "Discouraged"
    },
    {
      "cwe_id": "119",
      "name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
      "abstraction": "Class",
      "score": 0.5107921106763413,
      "original_score": 0.5107921106763413,
      "mapping_usage": "Discouraged"
    },
    {
      "cwe_id": "131",
      "name": "Incorrect Calculation of Buffer Size",
      "abstraction": "Base",
      "score": 0.5103288977136923,
      "original_score": 0.5103288977136923,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "1421",
      "name": "Exposure of Sensitive Information in Shared Microarchitectural Structures during Transient Execution",
      "abstraction": "Base",
      "score": 0.5102791220282124,
      "original_score": 0.5102791220282124,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "366",
      "name": "Race Condition within a Thread",
      "abstraction": "Base",
      "score": 0.5096793857279431,
      "original_score": 0.5096793857279431,
      "mapping_usage": "Allowed"
    },
    {
      "cwe_id": "476",
      "name": "NULL Pointer Dereference",
      "abstraction": "Base",
      "score": 0.509643944935275,
      "original_score": 0.509643944935275,
      "mapping_usage": "Allowed"
    }
  ],
  "statistics": {
    "min": 0.509643944935275,
    "max": 0.5577603908318347,
    "mean": 0.5262973681863655,
    "median": 0.5242852592928031,
    "count": 20
  }
}