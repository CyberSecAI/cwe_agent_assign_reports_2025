# Vulnerability Information: CVE-2024-56802

## Vulnerability Description
Tapir is a private Terraform registry. Tapir versions 0.9.0 and 0.9.1 are facing a critical issue with scope-able Deploykeys where attackers can guess the key to get write access to the registry. User must upgrade to 0.9.2.

### Vulnerability Description Key Phrases
- **impact:** get write access to the registry
- **vector:** guess the key
- **attacker:** attackers
- **product:** Tapir
- **version:** 0.9.0 and 0.9.1
- **component:** scope-able Deploykeys

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause of Vulnerability:**

The vulnerability stems from how DeployKeys were being retrieved by value in Tapir versions 0.9.0 and 0.9.1. The system was not performing an exact match when searching for a DeployKey by its value. Instead it was retrieving the first key that matched the provided value, allowing partial key matches.

**Weaknesses/Vulnerabilities Present:**

*   **Insecure Key Retrieval:** The primary weakness is that the `getDeployKeyByValue` method in the `DynamodbRepository`, `CosmosDbRepository` and `ElasticSearchRepository` classes did not enforce an exact match of the key value. This allowed an attacker to potentially gain access with a substring of a valid deploy key.

**Impact of Exploitation:**

*   **Unauthorized Write Access:** An attacker could potentially guess a deploy key (or a substring) and use it to gain write access to the registry, which could allow them to push malicious images or make other unauthorized changes.

**Attack Vectors:**

*   **Key Guessing:** An attacker could attempt to guess a valid DeployKey by trying various substrings.

**Required Attacker Capabilities/Position:**

*   **Knowledge of Deploy Key Format:** The attacker would need some knowledge or ability to guess the structure of the deploy keys.
*  **Network Access:** The attacker would need network access to interact with the registry API.

**Additional Notes:**
*   The vulnerability is fixed in version 0.9.2 by adding a filter to ensure an exact match of the deploy key when retrieving it by value. The fix is implemented in the `DynamodbRepository.java`, `CosmosDbRepository.java` and `ElasticSearchRepository.java` files.
* The provided commit also includes tests to verify this fix.
* The vulnerability is rated as high severity.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.074 |
| 2 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.074 |
| 3 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.074 |
| 4 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.074 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.073 |
| 6 | 285 | Improper Authorization | Class | Discouraged | sparse | 0.072 |
| 7 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.072 |
| 8 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.072 |
| 9 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | dense | 0.394 |
| 10 | 73 | External Control of File Name or Path | Base | Allowed | graph | 0.002 |

