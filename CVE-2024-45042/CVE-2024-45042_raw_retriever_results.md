# Raw Retriever Results for CVE-2024-45042

# Raw Retriever Results for CVE-2024-45042
## Query
Ory Kratos is an identity, user management and authentication system for cloud services. Prior to version 1.3.0, given a number of preconditions, the `highest_available` setting will incorrectly assume that the identitys highest available AAL is `aal1` even though it really is `aal2`. This means that the `highest_available` configuration will act as if the user has only one factor set up, for that particular user. This means that they can call the settings and whoami endpoint without a `aal2` session, even though that should be disallowed. An attacker would need to steal or guess a valid login OTP of a user who has only OTP for login enabled and who has an incorrect `available_aal` value stored, to exploit this vulnerability. All other aspects of the session (e.g. the sessions aal) are not impacted by this issue. On the Ory Network, only 0.00066% of registered users were affected by this issue, and most of those users appeared to be test users. Their respective AAL values have since been updated and they are no longer vulnerable to this attack. Version 1.3.0 is not affected by this issue. As a workaround, those who require MFA should disable the passwordless code login method. If that is not possible, check the sessions `aal` to identify if the user has `aal1` or `aal2`.

## Keyphrases
- **weakness**: 'improper access control'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4659 | 0.5267 | 0.4876 | 0.4801 | 20 |
| Sparse | 1008.3742 | 1120.4981 | 1056.5029 | 1058.8750 | 10 |
| Graph | 1.0539 | 2.7342 | 1.6333 | 1.5210 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 322 | Key Exchange without Entity Authentication | base | 2.7342 | Allowed |
| 2 | 350 | Reliance on Reverse DNS Resolution for a Security-Critical Action | variant | 2.5507 | Allowed |
| 3 | 226 | Sensitive Information in Resource Not Removed Before Reuse | base | 2.2100 | Allowed |
| 4 | 212 | Improper Removal of Sensitive Information Before Storage or Transfer | base | 2.2100 | Allowed |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | base | 2.1190 | Allowed |
| 6 | 307 | Improper Restriction of Excessive Authentication Attempts | Base | 1.7005 | Allowed |
| 7 | 303 | Incorrect Implementation of Authentication Algorithm | Base | 1.6981 | Allowed |
| 8 | 305 | Authentication Bypass by Primary Weakness | Base | 1.6951 | Allowed |
| 9 | 1275 | Sensitive Cookie with Improper SameSite Attribute | variant | 1.5768 | Allowed |
| 10 | 202 | Exposure of Sensitive Information Through Data Queries | base | 1.5210 | Allowed |
| 11 | 209 | Generation of Error Message Containing Sensitive Information | base | 1.5210 | Allowed |
| 12 | 613 | Insufficient Session Expiration | Base | 1.5174 | Allowed |
| 13 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | class | 1.3648 | Allowed-with-Review |
| 14 | 352 | Cross-Site Request Forgery (CSRF) | compound | 1.3600 | Allowed |
| 15 | 295 | Improper Certificate Validation | base | 1.3104 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 307 | Improper Restriction of Excessive Authentication Attempts | Base | 0.5267 | 0.5267 | Allowed |
| 2 | 303 | Incorrect Implementation of Authentication Algorithm | Base | 0.5224 | 0.5224 | Allowed |
| 3 | 305 | Authentication Bypass by Primary Weakness | Base | 0.5208 | 0.5208 | Allowed |
| 4 | 287 | Improper Authentication | Class | 0.5083 | 0.5083 | Discouraged |
| 5 | 1390 | Weak Authentication | Class | 0.5061 | 0.5061 | Allowed-with-Review |
| 6 | 288 | Authentication Bypass Using an Alternate Path or Channel | Base | 0.5024 | 0.5024 | Allowed |
| 7 | 308 | Use of Single-factor Authentication | Base | 0.5003 | 0.5003 | Allowed |
| 8 | 290 | Authentication Bypass by Spoofing | Base | 0.4972 | 0.4972 | Allowed |
| 9 | 304 | Missing Critical Step in Authentication | Base | 0.4927 | 0.4927 | Allowed |
| 10 | 294 | Authentication Bypass by Capture-replay | Base | 0.4888 | 0.4888 | Allowed |
| 11 | 289 | Authentication Bypass by Alternate Name | Base | 0.4713 | 0.4713 | Allowed |
| 12 | 302 | Authentication Bypass by Assumed-Immutable Data | Base | 0.4712 | 0.4712 | Allowed |
| 13 | 306 | Missing Authentication for Critical Function | Base | 0.4692 | 0.4692 | Allowed |
| 14 | 285 | Improper Authorization | Class | 0.4691 | 0.4691 | Discouraged |
| 15 | 620 | Unverified Password Change | Base | 0.4686 | 0.4686 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 863 | Incorrect Authorization | 1120.4981 | 1120.4981 | Allowed-with-Review |
| 2 | 1390 | Weak Authentication | 1100.0589 | 1100.0589 | Allowed-with-Review |
| 3 | 287 | Improper Authentication | 1077.7266 | 1077.7266 | Discouraged |
| 4 | 201 | Insertion of Sensitive Information Into Sent Data | 1073.9757 | 1073.9757 | Allowed |
| 5 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | 1060.0869 | 1060.0869 | Allowed-with-Review |
| 6 | 306 | Missing Authentication for Critical Function | 1057.6631 | 1057.6631 | Allowed |
| 7 | 347 | Improper Verification of Cryptographic Signature | 1040.1506 | 1040.1506 | Allowed |
| 8 | 285 | Improper Authorization | 1014.3998 | 1014.3998 | Discouraged |
| 9 | 532 | Insertion of Sensitive Information into Log File | 1012.0948 | 1012.0948 | Allowed |
| 10 | 639 | Authorization Bypass Through User-Controlled Key | 1008.3742 | 1008.3742 | Allowed |
