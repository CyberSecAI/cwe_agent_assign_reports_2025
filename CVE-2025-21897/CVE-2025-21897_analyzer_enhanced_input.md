## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved sched_ext Fix pick_task_scx() picking non-queued tasks when its called without balance() a6250aa251ea (sched_ext Handle cases where pick_task_scx() is called without preceding balance_scx()) added a workaround to handle the cases where pick_task_scx() is called without prececing balance_scx() which is due to a fair class bug where pick_taks_fair() may return NULL after a true return from balance_fair(). The workaround detects when pick_task_scx() is called without preceding balance_scx() and emulates SCX_RQ_BAL_KEEP and triggers kicking to avoid stalling. Unfortunately, the workaround code was testing whether @prev was on SCX to decide whether to keep the task running. This is incorrect as the task may be on SCX but no longer runnable. This could lead to a **non-runnable task to be returned from pick_task_scx()** which cause interesting confusions and failures. e.g. A common failure mode is the task ending up with (!on_rq && on_cpu) state which can cause potential wakers to busy loop, which can easily lead to deadlocks. Fix it by testing whether @prev has SCX_TASK_QUEUED set. This makes @prev_on_scx only used in one place. Open code the usage and improve the comment while at it.

### Vulnerability Description Key Phrases
- **weakness:** **non-runnable task to be returned from pick_task_scx()**
- **impact:** busy loop
- **product:** Linux kernel

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.823 |
| 2 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.790 |
| 3 | 364 | Signal Handler Race Condition | Base | Allowed | sparse | 0.788 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.786 |
| 5 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.780 |
| 6 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.779 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.769 |
| 8 | 203 | Observable Discrepancy | Base | Allowed | sparse | 0.768 |
| 9 | 833 | Deadlock | Base | Allowed | dense | 0.515 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-364: Signal Handler Race Condition

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-863: Incorrect Authorization

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-203: Observable Discrepancy

CWE-833: Deadlock

CWE-363: Race Condition Enabling Link Following