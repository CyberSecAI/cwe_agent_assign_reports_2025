# Vulnerability Information: CVE-2024-40965

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved i2c lpi2c Avoid calling clk_get_rate during transfer Instead of repeatedly calling clk_get_rate for each transfer, lock the clock rate and cache the value. A **deadlock** has been observed while adding tlv320aic32x4 audio codec to the system. When this clock provider adds its clock, the clk mutex is locked already, it needs to access i2c, which in return needs the mutex for clk_get_rate as well.

### Vulnerability Description Key Phrases
- **rootcause:** **deadlock**
- **product:** Linux kernel
- **component:** i2c lpi2c

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-40965.

**Root cause of vulnerability:**
The i2c-imx-lpi2c driver repeatedly calls `clk_get_rate` for each I2C transfer. This can lead to a deadlock when another clock provider, such as an audio codec (tlv320aic32x4), also needs to access the I2C bus while holding a clock mutex. The I2C access, in turn, requires the same mutex for `clk_get_rate`, resulting in a deadlock scenario.

**Weaknesses/vulnerabilities present:**
-   **Deadlock:** The primary vulnerability is a deadlock caused by the nested locking of the clock mutex.
-   **Inefficient clock access:** Repeatedly calling `clk_get_rate` for each transfer is inefficient.

**Impact of exploitation:**
-   **System freeze:** The deadlock can lead to a system freeze or hang, making the device unresponsive.
-   **Denial of service:** The deadlock effectively causes a denial of service as the I2C bus becomes unusable.

**Attack vectors:**
-   **Device driver interaction:** The vulnerability is triggered through normal device driver interactions, specifically when an I2C device is used and a clock provider is active.
-   **Concurrency:** The issue arises due to concurrent access to the clock and I2C resources.

**Required attacker capabilities/position:**
-   **Ability to load and use an I2C device driver:** An attacker needs to trigger the I2C bus to be used concurrently with another clock provider, such as by adding an audio codec, in order to trigger the deadlock

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.407 |
| 2 | 833 | Deadlock | Base | Allowed | sparse | 0.371 |
| 3 | 1256 | Improper Restriction of Software Interfaces to Hardware Features | Base | Allowed | sparse | 0.349 |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.331 |
| 5 | 1247 | Improper Protection Against Voltage and Clock Glitches | Base | Allowed | sparse | 0.328 |
| 6 | 1250 | Improper Preservation of Consistency Between Independent Representations of Shared State | Base | Allowed | sparse | 0.325 |
| 7 | 337 | Predictable Seed in Pseudo-Random Number Generator (PRNG) | Variant | Allowed | sparse | 0.318 |
| 8 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.317 |
| 9 | 413 | Improper Resource Locking | Base | Allowed | dense | 0.477 |
| 10 | 416 | Use After Free | Variant | Allowed | graph | 0.002 |

