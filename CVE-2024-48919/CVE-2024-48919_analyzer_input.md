# Vulnerability Information: CVE-2024-48919

## Vulnerability Description
Cursor is a code editor built for programming with AI. Prior to Sep 27, 2024, if a user generated a terminal command via Cursors Terminal Cmd-K/Ctrl-K feature and if the user explicitly imported a malicious web page into the Terminal Cmd-K prompt, an attacker with control over the referenced web page could have a significant chance of influencing a language model to output arbitrary commands for execution in the users terminal. This scenario would require the user explicitly opt-in to including the contents of a compromised webpage, and it would require that the attacker display prompt injection text in the the contents of the compromised webpage. A server-side patch to not stream back newlines or control characters was released on September 27, 2024, within two hours of the issue being reported. Additionally, Cursor 0.42 includes client-side mitigations to prevent any newline or control character from being streamed into the terminal directly. It also contains a new setting, `cursor.terminal.usePreviewBox`, which, if set to true, streams the response into a preview box whose contents then have to be manually accepted before being inserted into the terminal. This setting is useful if youre working in a shell environment where commands can be executed without pressing enter or any control character. The patch has been applied server-side, so no additional action is needed, even on older versions of Cursor. Separately, Cursors maintainers also recommend, as best practice

### Vulnerability Description Key Phrases
- **impact:** arbitrary command execution
- **vector:** malicious webpage
- **attacker:** attacker
- **product:** Cursor
- **version:** prior to Sep 27, 2024
- **component:** Terminal Cmd-K/Ctrl-K feature

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

*   Prompt injection vulnerability in Cursor's Terminal Cmd-K feature. The language model used by Cursor was susceptible to manipulation through malicious content injected into the prompt via imported web pages.

**Weaknesses/Vulnerabilities Present:**

*   **Lack of Input Sanitization:** The application failed to properly sanitize or validate input received through the Terminal Cmd-K feature, allowing an attacker-controlled web page to inject malicious prompts.
*   **Unfiltered output streaming:** The application streamed the language model's response, including potentially malicious commands and newlines, directly into the user's terminal without proper filtering.
*  **Trust of user provided context:** The application was implicitly trusting of the context provided to the language model, without any mechanism for assessing if it contained malicious content.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** By injecting malicious commands, an attacker could potentially execute arbitrary code on the user's machine when the language model's response was streamed to the terminal and executed due to the trailing newline.
*   **Data Exfiltration / System Manipulation:** The attacker can potentially use the code execution to exfiltrate data or manipulate the system, based on the commands injected.

**Attack Vectors:**

*   **Malicious Web Page:** An attacker would need to host or control a web page.
*   **User Interaction:** The user would have to explicitly import the malicious web page's content into the Cursor's Terminal Cmd-K prompt.

**Required Attacker Capabilities/Position:**

*   **Control over a web page:** The attacker needs the ability to inject malicious prompts within the content of a web page.
*   **Limited user interaction:** An attacker depends on the user to intentionally import the malicious page as context for a prompt.

**Additional Details (Beyond CVE Description):**

*   The vulnerability was patched server-side within two hours of being reported, by preventing newlines and control characters in the streaming response.
*   Client-side mitigations were included in Cursor 0.42 to prevent newlines/control characters being streamed directly and a setting `cursor.terminal.usePreviewBox` that streams into a preview box, requiring manual acceptance before inserting into the terminal.
*   The content highlights the importance of not automatically trusting external context fed into a prompt, and recommend users to only include trusted sources.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | sparse | 0.376 |
| 2 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.374 |
| 3 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.374 |
| 4 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.373 |
| 5 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.370 |
| 6 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.368 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.367 |
| 8 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.364 |
| 9 | 619 | Dangling Database Cursor ('Cursor Injection') | Base | Allowed | dense | 0.494 |
| 10 | 117 | Improper Output Neutralization for Logs | Base | Allowed | graph | 0.003 |

