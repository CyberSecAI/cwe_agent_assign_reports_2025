## Vulnerability Description
AX3000 Dual-Band Gigabit Wi-Fi 6 Router AX9 V22.03.01.46 and AX3000 Dual-Band Gigabit Wi-Fi 6 Router AX12 V1.0 V22.03.01.46 were discovered to contain an authenticated remote command execution (RCE) vulnerability via the macFilterType parameter at /goform/setMacFilterCfg.

### Vulnerability Description Key Phrases
- **impact:** remote command execution
- **vector:** macFilterType parameter
- **attacker:** authenticated
- **product:** AX3000 Dual-Band Gigabit Wi-Fi 6 Router and AX3000 Dual-Band Gigabit Wi-Fi 6 Router
- **version:** V22.03.01.46 and V22.03.01.46
- **component:** /goform/setMacFilterCfg

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

The root cause of the vulnerability lies in the lack of proper input sanitization for the `macFilterType` parameter within the `/goform/setMacFilterCfg` request handler on Tenda AX9 and AX12 routers. The router's web server directly uses this unsanitized input in a `strcpy` operation, which can lead to writing arbitrary characters into the file system. Furthermore, the router compares the original and new value of `macFilterType`, and if different, executes a command via `doSystemCmd`.

**Weaknesses/Vulnerabilities:**

1.  **Lack of Input Sanitization:** The `macFilterType` parameter is not validated or sanitized, allowing an attacker to inject arbitrary characters.
2.  **Insecure String Copy:** The use of `strcpy` with attacker-controlled data can lead to buffer overflows or other memory corruption issues if the length is not carefully managed. While the code includes a check to ensure the length doesn't exceed 17 bytes, the attacker has full control over this 17-byte input, including special characters.
3.  **Command Injection:** By writing specific characters, the attacker can construct a malicious command using `printf` and write it to a temporary file. When the `macFilterType` value is subsequently changed, a shell command is executed, resulting in arbitrary command execution.
4.  **Insufficient command injection checks:** The `doSystemCmd` has insufficient checks allowing injection by avoiding the strings `liuguizhou` and `telnetd`.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** An attacker can execute arbitrary commands on the router's operating system with root privileges.
*   **Full System Compromise:**  RCE gives an attacker complete control over the router, allowing them to:
    *   Modify configurations
    *   Steal data
    *   Install malware
    *   Use the router as part of a botnet.
*   **Loss of Confidentiality and Integrity:** An attacker could potentially access network traffic or sensitive data passing through the router and perform malicious actions within the local network.

**Attack Vectors:**

*   **HTTP Request:** The attacker sends a specifically crafted HTTP POST request to the `/goform/setMacFilterCfg` endpoint.
*   **`macFilterType` Parameter:** The malicious payload is injected into the `macFilterType` parameter.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker must have network access to the router's web interface. This could be from the local network or potentially from the WAN if remote administration is enabled.
*   **Authentication:** The attacker needs valid admin credentials to access the vulnerable endpoint.
*   **Understanding of the Exploit:** The attacker needs to understand how to craft the malicious input for the `macFilterType` parameter to achieve arbitrary command execution.

**Additional Details:**
The exploit is a multi-step process:

1. The attacker logs in to the router's web interface using valid credentials.
2. Obtains `stok` and `sign` from the `/goform/stokCfg` endpoint.
3. The attacker sends a crafted POST request to `/goform/setMacFilterCfg` with a malicious payload within the `macFilterType` parameter, using the retrieved `stok` and `sign` for encryption. This payload uses `printf` to write a shell script to a temporary file.
4. The attacker modifies the `macFilterType` value in a subsequent POST request, triggering the execution of the injected script using `doSystemCmd`.
5. The exploit in the script removes the root password and enables `telnetd`, enabling remote access for the attacker.

The provided exploit code demonstrates how to automate this process, including login, payload crafting, and sending the malicious requests.

This content provides more detail than a typical CVE description by giving:
- Specific vulnerable parameter
- Root cause analysis
- Full exploit chain
- Full exploit code

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.080 |
| 2 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.075 |
| 3 | 653 | Improper Isolation or Compartmentalization | Class | Allowed | sparse | 0.064 |
| 4 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | sparse | 0.064 |
| 5 | 259 | Use of Hard-coded Password | Variant | Allowed | sparse | 0.057 |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.057 |
| 7 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.055 |
| 8 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | sparse | 0.053 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.536 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-121: Stack-based Buffer Overflow

CWE-653: Improper Isolation or Compartmentalization

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-259: Use of Hard-coded Password

CWE-201: Insertion of Sensitive Information Into Sent Data

CWE-287: Improper Authentication

CWE-96: Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection')

CWE-790: Improper Filtering of Special Elements

CWE-184: Incomplete List of Disallowed Inputs