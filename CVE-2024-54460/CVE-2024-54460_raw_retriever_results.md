# Raw Retriever Results for CVE-2024-54460

# Raw Retriever Results for CVE-2024-54460
## Query
In the Linux kernel, the following vulnerability has been resolved Bluetooth iso Fix circular lock in iso_listen_bis This fixes the circular locking dependency warning below, by releasing the socket lock before enterning iso_listen_bis, to avoid any potential deadlock with hdev lock. [ 75.307983] ====================================================== [ 75.307984] WARNING possible circular locking dependency detected [ 75.307985] 6.12.0-rc6+ #22 Not tainted [ 75.307987] ------------------------------------------------------ [ 75.307987] kworker/u812/2623 is trying to acquire lock [ 75.307988] ffff8fde1769da58 (sk_lock-AF_BLUETOOTH-BTPROTO_ISO) at iso_connect_cfm+0x253/0x840 [bluetooth] [ 75.308021] but task is already holding lock [ 75.308022] ffff8fdd61a10078 (&hdev->lock) at hci_le_per_adv_report_evt+0x47/0x2f0 [bluetooth] [ 75.308053] which lock already depends on the new lock. [ 75.308054] the existing dependency chain (in reverse order) is [ 75.308055] -> #1 (&hdev->lock){+.+.}-{33} [ 75.308057] __mutex_lock+0xad/0xc50 [ 75.308061] mutex_lock_nested+0x1b/0x30 [ 75.308063] iso_sock_listen+0x143/0x5c0 [bluetooth] [ 75.308085] __sys_listen_socket+0x49/0x60 [ 75.308088] __x64_sys_listen+0x4c/0x90 [ 75.308090] x64_sys_call+0x2517/0x25f0 [ 75.308092] do_syscall_64+0x87/0x150 [ 75.308095] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 75.308098] -> #0 (sk_lock-AF_BLUETOOTH-BTPROTO_ISO){+.+.}-{00} [ 75.308100] __lock_acquire+0x155e/0x25f0 [ 75.308103] lock_acquire+0xc9/0x300 [ 75.308105] lock_sock_nested+0x32/0x90 [ 75.308107] iso_connect_cfm+0x253/0x840 [bluetooth] [ 75.308128] hci_connect_cfm+0x6c/0x190 [bluetooth] [ 75.308155] hci_le_per_adv_report_evt+0x27b/0x2f0 [bluetooth] [ 75.308180] hci_le_meta_evt+0xe7/0x200 [bluetooth] [ 75.308206] hci_event_packet+0x21f/0x5c0 [bluetooth] [ 75.308230] hci_rx_work+0x3ae/0xb10 [bluetooth] [ 75.308254] process_one_work+0x212/0x740 [ 75.308256] worker_thread+0x1bd/0x3a0 [ 75.308258] kthread+0xe4/0x120 [ 75.308259] ret_from_fork+0x44/0x70 [ 75.308261] ret_from_fork_asm+0x1a/0x30 [ 75.308263] other info that might help us debug this [ 75.308264] Possible unsafe locking scenario [ 75.308264] CPU0 CPU1 [ 75.308265] ---- ---- [ 75.308265] lock(&hdev->lock) [ 75.308267] lock(sk_lock- AF_BLUETOOTH-BTPROTO_ISO) [ 75.308268] lock(&hdev->lock) [ 75.308269] lock(sk_lock-AF_BLUETOOTH-BTPROTO_ISO) [ 75.308270] *** DEADLOCK *** [ 75.308271] 4 locks held by kworker/u812/2623 [ 75.308272] #0 ffff8fdd66e52148 ((wq_completion)hci0#2){+.+.}-{00}, at process_one_work+0x443/0x740 [ 75.308276] #1 ffffafb488b7fe48 ((work_completion)(&hdev->rx_work)), at process_one_work+0x1ce/0x740 [ 75.308280] #2 ffff8fdd61a10078 (&hdev->lock){+.+.}-{33} at hci_le_per_adv_report_evt+0x47/0x2f0 [bluetooth] [ 75.308304] #3 ffffffffb6ba4900 (rcu_read_lock){....}-{12}, at hci_connect_cfm+0x29/0x190 [bluetooth]

## Keyphrases
- **rootcause**: 'circular locking dependency'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4678 | 0.5421 | 0.4907 | 0.4823 | 20 |
| Sparse | 663.6939 | 1207.8422 | 877.4885 | 857.1696 | 10 |
| Graph | 1.4080 | 2.4700 | 1.7286 | 1.6964 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 76 | Improper Neutralization of Equivalent Special Elements | base | 2.4700 | Allowed |
| 2 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 3 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | base | 2.1190 | Allowed |
| 4 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | base | 1.7680 | Allowed |
| 5 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 6 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 7 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 8 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 9 | 833 | Deadlock | Base | 1.7167 | Allowed |
| 10 | 413 | Improper Resource Locking | Base | 1.7080 | Allowed |
| 11 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 12 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 13 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 14 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 15 | 61 | UNIX Symbolic Link (Symlink) Following | compound | 1.6100 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 833 | Deadlock | Base | 0.5421 | 0.5421 | Allowed |
| 2 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5358 | 0.5358 | Allowed-with-Review |
| 3 | 667 | Improper Locking | Class | 0.5351 | 0.5351 | Allowed-with-Review |
| 4 | 413 | Improper Resource Locking | Base | 0.5167 | 0.5167 | Allowed |
| 5 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5001 | 0.5001 | Allowed |
| 6 | 909 | Missing Initialization of Resource | Class | 0.4950 | 0.4950 | Allowed-with-Review |
| 7 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.4930 | 0.4930 | Allowed |
| 8 | 908 | Use of Uninitialized Resource | Base | 0.4912 | 0.4912 | Allowed |
| 9 | 366 | Race Condition within a Thread | Base | 0.4827 | 0.4827 | Allowed |
| 10 | 416 | Use After Free | Variant | 0.4825 | 0.4825 | Allowed |
| 11 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4821 | 0.4821 | Allowed |
| 12 | 820 | Missing Synchronization | Base | 0.4821 | 0.4821 | Allowed |
| 13 | 126 | Buffer Over-read | Variant | 0.4764 | 0.4764 | Allowed |
| 14 | 248 | Uncaught Exception | Base | 0.4763 | 0.4763 | Allowed |
| 15 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.4754 | 0.4754 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 75 | Failure to Sanitize Special Elements into a Different Plane (Special Element Injection) | 1207.8422 | 1207.8422 | Discouraged |
| 2 | 76 | Improper Neutralization of Equivalent Special Elements | 1202.6148 | 1202.6148 | Allowed |
| 3 | 359 | Exposure of Private Personal Information to an Unauthorized Actor | 1022.9322 | 1022.9322 | Allowed |
| 4 | 833 | Deadlock | 905.4427 | 905.4427 | Allowed |
| 5 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | 863.1881 | 863.1881 | Discouraged |
| 6 | 667 | Improper Locking | 851.1511 | 851.1511 | Allowed-with-Review |
| 7 | 764 | Multiple Locks of a Critical Resource | 697.2144 | 697.2144 | Allowed |
| 8 | 843 | Access of Resource Using Incompatible Type ('Type Confusion') | 686.4499 | 686.4499 | Allowed |
| 9 | 327 | Use of a Broken or Risky Cryptographic Algorithm | 674.3554 | 674.3554 | Allowed-with-Review |
| 10 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | 663.6939 | 663.6939 | Allowed |
