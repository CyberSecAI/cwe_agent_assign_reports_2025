# Raw Retriever Results for CVE-2024-53195

# Raw Retriever Results for CVE-2024-53195
## Query
In the Linux kernel, the following vulnerability has been resolved KVM arm64 Get rid of userspace_irqchip_in_use Improper use of userspace_irqchip_in_use led to syzbot hitting the following WARN_ON() in kvm_timer_update_irq() WARNING CPU 0 PID 3281 at arch/arm64/kvm/arch_timer.c459 kvm_timer_update_irq+0x21c/0x394 Call trace kvm_timer_update_irq+0x21c/0x394 arch/arm64/kvm/arch_timer.c459 kvm_timer_vcpu_reset+0x158/0x684 arch/arm64/kvm/arch_timer.c968 kvm_reset_vcpu+0x3b4/0x560 arch/arm64/kvm/reset.c264 kvm_vcpu_set_target arch/arm64/kvm/arm.c1553 [inline] kvm_arch_vcpu_ioctl_vcpu_init arch/arm64/kvm/arm.c1573 [inline] kvm_arch_vcpu_ioctl+0x112c/0x1b3c arch/arm64/kvm/arm.c1695 kvm_vcpu_ioctl+0x4ec/0xf74 virt/kvm/kvm_main.c4658 vfs_ioctl fs/ioctl.c51 [inline] __do_sys_ioctl fs/ioctl.c907 [inline] __se_sys_ioctl fs/ioctl.c893 [inline] __arm64_sys_ioctl+0x108/0x184 fs/ioctl.c893 __invoke_syscall arch/arm64/kernel/syscall.c35 [inline] invoke_syscall+0x78/0x1b8 arch/arm64/kernel/syscall.c49 el0_svc_common+0xe8/0x1b0 arch/arm64/kernel/syscall.c132 do_el0_svc+0x40/0x50 arch/arm64/kernel/syscall.c151 el0_svc+0x54/0x14c arch/arm64/kernel/entry-common.c712 el0t_64_sync_handler+0x84/0xfc arch/arm64/kernel/entry-common.c730 el0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S598 The following sequence led to the scenario - Userspace creates a VM and a vCPU. - The vCPU is initialized with KVM_ARM_VCPU_PMU_V3 during KVM_ARM_VCPU_INIT. - Without any other setup, such as vGIC or vPMU, userspace issues KVM_RUN on the vCPU. Since the vPMU is requested, but not setup, kvm_arm_pmu_v3_enable() fails in kvm_arch_vcpu_run_pid_change(). As a result, KVM_RUN returns after enabling the timer, but before incrementing userspace_irqchip_in_use kvm_arch_vcpu_run_pid_change() ret = kvm_arm_pmu_v3_enable() if (!vcpu->arch.pmu.created) return -EINVAL if (ret) return ret [...] if (!irqchip_in_kernel(kvm)) static_branch_inc(&userspace_irqchip_in_use) - Userspace ignores the error and issues KVM_ARM_VCPU_INIT again. Since the timer is already enabled, control moves through the following flow, ultimately hitting the WARN_ON() kvm_timer_vcpu_reset() if (timer->enabled) kvm_timer_update_irq() if (!userspace_irqchip()) ret = kvm_vgic_inject_irq() ret = vgic_lazy_init() if (unlikely(!vgic_initialized(kvm))) if (kvm->arch.vgic.vgic_model != KVM_DEV_TYPE_ARM_VGIC_V2) return -EBUSY WARN_ON(ret) Theoretically, since userspace_irqchip_in_uses functionality can be simply replaced by !irqchip_in_kernel(), get rid of the static key to avoid the mismanagement, which also helps with the syzbot issue.

## Keyphrases
- **rootcause**: 'Improper use of userspace_irqchip_in_use', 'userspace doesn't account for IRQ chip state'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4569 | 0.5423 | 0.4823 | 0.4826 | 20 |
| Sparse | 735.5556 | 1086.5820 | 853.7385 | 836.9947 | 11 |
| Graph | 1.4784 | 2.8652 | 1.8701 | 1.7320 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 609 | Double-Checked Locking | base | 2.8652 | Allowed |
| 2 | 226 | Sensitive Information in Resource Not Removed Before Reuse | base | 2.4700 | Allowed |
| 3 | 386 | Symbolic Name not Mapping to Correct Object | base | 2.3764 | Allowed |
| 4 | 476 | NULL Pointer Dereference | base | 2.2100 | Allowed |
| 5 | 201 | Insertion of Sensitive Information Into Sent Data | base | 2.2100 | Allowed |
| 6 | 393 | Return of Wrong Status Code | base | 2.1190 | Allowed |
| 7 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 8 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 9 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 10 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 11 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | 1.7091 | Allowed |
| 12 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 13 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 14 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 1.6847 | Allowed |
| 15 | 61 | UNIX Symbolic Link (Symlink) Following | compound | 1.6100 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | 0.5423 | 0.5423 | Allowed |
| 2 | 909 | Missing Initialization of Resource | Class | 0.5170 | 0.5170 | Allowed-with-Review |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5079 | 0.5079 | Allowed-with-Review |
| 4 | 667 | Improper Locking | Class | 0.5038 | 0.5038 | Allowed-with-Review |
| 5 | 1256 | Improper Restriction of Software Interfaces to Hardware Features | Base | 0.4992 | 0.4992 | Allowed |
| 6 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.4873 | 0.4873 | Allowed |
| 7 | 1332 | Improper Handling of Faults that Lead to Instruction Skips | Base | 0.4858 | 0.4858 | Allowed |
| 8 | 1281 | Sequence of Processor Instructions Leads to Unexpected Behavior | Base | 0.4857 | 0.4857 | Allowed |
| 9 | 1421 | Exposure of Sensitive Information in Shared Microarchitectural Structures during Transient Execution | Base | 0.4852 | 0.4852 | Allowed |
| 10 | 1260 | Improper Handling of Overlap Between Protected Memory Ranges | Base | 0.4838 | 0.4838 | Allowed |
| 11 | 1037 | Processor Optimization Removal or Modification of Security-critical Code | Base | 0.4813 | 0.4813 | Allowed |
| 12 | 1423 | Exposure of Sensitive Information caused by Shared Microarchitectural Predictor State that Influences Transient Execution | Base | 0.4729 | 0.4729 | Allowed |
| 13 | 1274 | Improper Access Control for Volatile Memory Containing Boot Code | Base | 0.4692 | 0.4692 | Allowed |
| 14 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.4640 | 0.4640 | Allowed |
| 15 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4634 | 0.4634 | Allowed |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 393 | Return of Wrong Status Code | 1086.5820 | 1086.5820 | Allowed |
| 2 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 986.9726 | 986.9726 | Allowed |
| 3 | 733 | Compiler Optimization Removal or Modification of Security-critical Code | 906.1920 | 906.1920 | Allowed |
| 4 | 226 | Sensitive Information in Resource Not Removed Before Reuse | 888.4281 | 888.4281 | Allowed |
| 5 | 909 | Missing Initialization of Resource | 874.5553 | 874.5553 | Allowed-with-Review |
| 6 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 836.9947 | 836.9947 | Allowed-with-Review |
| 7 | 125 | Out-of-bounds Read | 820.3178 | 820.3178 | Allowed |
| 8 | 667 | Improper Locking | 779.3285 | 779.3285 | Allowed-with-Review |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | 739.3967 | 739.3967 | Allowed |
| 10 | 364 | Signal Handler Race Condition | 736.8003 | 736.8003 | Allowed |
| 11 | 476 | NULL Pointer Dereference | 735.5556 | 735.5556 | Allowed |
