## Vulnerability Description
Versions of the package spatie/browsershot before 5.0.5 are vulnerable to Improper Input Validation due to improper URL validation through the setUrl method, which results in a Local File Inclusion allowing the attacker to read sensitive files. **Note** This is a bypass of the fix for [CVE-2024-21549](https//security.snyk.io/vuln/SNYK-PHP-SPATIEBROWSERSHOT-8533023).

### Vulnerability Description Key Phrases
- **rootcause:** **improper URL validation, improper input validation**
- **vector:** improper URL validation through the setUrl method
- **weakness:** **local file inclusion, file inclusion**
- **product:** spatie/browsershot
- **impact:** local file inclusion, read sensitive files
- **attacker:** attacker
- **version:** before 5.0.5

## CVE Reference Links Content Summary
Here's an analysis of the provided content, focusing on information relevant to CVE-2025-1026:

**Content from gist.github.com_02031e46_20250624_150156.html (text):**

*   **Relevance:** The content discusses a vulnerability in the `spatie/browsershot` package, specifically related to a "trim() bypass due to URI normalisation leading to local file read". This aligns with the CVE description.
*   **Root cause of vulnerability:** The vulnerability stems from improper input validation in the `setUrl` function. The `trim()` function only removes whitespace, and the code doesn't adequately handle URI normalization.
*   **Weaknesses/vulnerabilities present:**  Improper input validation, leading to a Local File Inclusion (LFI) vulnerability.
*   **Impact of exploitation:** Attackers can read sensitive server files such as API keys, source code, and other sensitive information stored on the target server.
*   **Attack vectors:** An attacker can supply a malicious URL to the `setUrl` function, such as `file:%0A///etc/passwd`.
*   **Required attacker capabilities/position:** The attacker needs to be able to control the URL passed to the `Browsershot::url()` function. This could be achieved if the `Browsershot` library is used in a web application where user-supplied input is used to construct the URL.
*   **Mitigation or fix:** Not explicitly mentioned in this gist, but there is mention of a PR.

**Content from gist.github.com_27115117_20250624_150157.html (text):**

*   **Relevance:** This content also describes a vulnerability in the `spatie/browsershot` package related to improper input validation. It directly discusses the `setUrl()` function and a bypass that leads to arbitrary file read.
*   **Root cause of vulnerability:** Improper input validation in `setUrl()` function, specifically the lack of validation for the number of slashes in `file://<filename>`
*   **Weaknesses/vulnerabilities present:** Local File Inclusion (LFI).
*   **Impact of exploitation:** Arbitrary file read on a system that utilizes Browsershot.
*   **Attack vectors:** Bypassing validation by omitting slashes in `file://<filename>`, leading to arbitrary file read.  The example given is <http://localhost/browsershot/example.php?url=file:etc/passwd>
*   **Required attacker capabilities/position:**  The attacker can control the `$url` parameter passed to the `setUrl()` function.
*   **Mitigation or fix:** Not explicitly mentioned, but implies a need for proper validation of the URL, as well as the slashes after "file:"

**Content from github.com_64ab66d5_20250624_150203.html (stripped):**

*   **Relevance:** This content is a pull request related to the `spatie/browsershot` package. The title is "filter\_var to sanitise URL #908". It shows an effort to fix the vulnerability by using the `filter_var()` function with the `FILTER_VALIDATE_URL` flag. This relates to the CVE.
*   **Mitigation or fix:** The code uses `filter_var()` function to filter the URL with the FILTER\_VALIDATE\_URL flag.

**Content from github.com_da8ba851_20250624_150200.html (stripped):**

*   **Relevance:** This content is a commit related to the `spatie/browsershot` package. This commit directly addresses the vulnerability, as it includes the changes to the code to mitigate it.
*   **Mitigation or fix:** The code now uses the `filter_var()` function to validate the URL.
    *   Also, a new exception `FileUrlNotAllowed::urlCannotBeParsed($url)` is added and the unsafe protocol list now contains `file:` and not `file:,`

**Content from security.snyk.io_9f1365b8_20250624_150205.html (text):**

*   **Relevance:** This content describes the vulnerability in the `spatie/browsershot` package, versions <5.0.5, which directly matches the CVE description.
*   **Root cause of vulnerability:** Improper URL validation through the `setUrl` method.
*   **Weaknesses/vulnerabilities present:** Local File Inclusion (LFI)
*   **Impact of exploitation:** The attacker can read sensitive files.
*   **Attack vectors:** Attackers can supply a malicious URL.
*   **Mitigation or fix:** Upgrade `spatie/browsershot` to version 5.0.5 or higher.
*   **Additional detail:** Provides a Proof of Concept (PoC) for the vulnerability, the affected versions, and links to relevant references.

**Content from snyk.io_ce6ec986_20250624_204537.html (text):**

*   **Relevance:** Unrelated. This content is a website landing page for snyk.io.

**Content from support.snyk.io_340a6d77_20250624_204538.html (text):**

*   **Relevance:** Unrelated. This content is a support page for snyk.io.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 98 | Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion') | Variant | Allowed | alternate_terms | 1.000 |
| 2 | 88 | Improper Neutralization of Argument Delimiters in a Command ('Argument Injection') | Base | Allowed | sparse | 0.375 |
| 3 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.342 |
| 4 | 1321 | Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution') | Variant | Allowed | sparse | 0.337 |
| 5 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.337 |
| 6 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.334 |
| 7 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.332 |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.329 |
| 9 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | dense | 0.597 |
| 10 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | graph | 0.002 |



# Complete CWE Specifications

CWE-98: Improper Control of Filename for Include/Require Statement in PHP Program ('PHP Remote File Inclusion')

CWE-88: Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-1321: Improperly Controlled Modification of Object Prototype Attributes ('Prototype Pollution')

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-20: Improper Input Validation

CWE-138: Improper Neutralization of Special Elements

CWE-1284: Improper Validation of Specified Quantity in Input

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-94: Improper Control of Generation of Code ('Code Injection')