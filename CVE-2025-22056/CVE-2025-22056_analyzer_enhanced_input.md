## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved netfilter nft_tunnel fix geneve_opt **type confusion** addition When handling multiple NFTA_TUNNEL_KEY_OPTS_GENEVE attributes, the parsing logic should place every geneve_opt structure one by one compactly. Hence, when deciding the next geneve_opt position, the pointer addition should be in units of char *. However, the current implementation erroneously does type conversion before the addition, which will lead to heap out-of-bounds write. [ 6.989857] ================================================================== [ 6.990293] BUG KASAN slab-out-of-bounds in nft_tunnel_obj_init+0x977/0xa70 [ 6.990725] Write of size 124 at addr ffff888005f18974 by task poc/178 [ 6.991162] [ 6.991259] CPU 0 PID 178 Comm poc-oob-write Not tainted 6.1.132 #1 [ 6.991655] Hardware name QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014 [ 6.992281] Call Trace [ 6.992423] [ 6.992586] dump_stack_lvl+0x44/0x5c [ 6.992801] print_report+0x184/0x4be [ 6.993790] kasan_report+0xc5/0x100 [ 6.994252] kasan_check_range+0xf3/0x1a0 [ 6.994486] memcpy+0x38/0x60 [ 6.994692] nft_tunnel_obj_init+0x977/0xa70 [ 6.995677] nft_obj_init+0x10c/0x1b0 [ 6.995891] nf_tables_newobj+0x585/0x950 [ 6.996922] nfnetlink_rcv_batch+0xdf9/0x1020 [ 6.998997] nfnetlink_rcv+0x1df/0x220 [ 6.999537] netlink_unicast+0x395/0x530 [ 7.000771] netlink_sendmsg+0x3d0/0x6d0 [ 7.001462] __sock_sendmsg+0x99/0xa0 [ 7.001707] ____sys_sendmsg+0x409/0x450 [ 7.002391] ___sys_sendmsg+0xfd/0x170 [ 7.003145] __sys_sendmsg+0xea/0x170 [ 7.004359] do_syscall_64+0x5e/0x90 [ 7.005817] entry_SYSCALL_64_after_hwframe+0x6e/0xd8 [ 7.006127] RIP 00330x7ec756d4e407 [ 7.006339] Code 48 89 fa 4c 89 df e8 38 aa 00 00 8b 93 08 03 00 00 59 5e 48 83 f8 fc 74 1a 5b c3 0f 1f 84 00 00 00 00 00 48 8b 44 24 10 0f 05 c3 0f 1f 80 00 00 00 00 83 e2 39 83 faf [ 7.007364] RSP 002b00007ffed5d46760 EFLAGS 00000202 ORIG_RAX 000000000000002e [ 7.007827] RAX ffffffffffffffda RBX 00007ec756cc4740 RCX 00007ec756d4e407 [ 7.008223] RDX 0000000000000000 RSI 00007ffed5d467f0 RDI 0000000000000003 [ 7.008620] RBP 00007ffed5d468a0 R08 0000000000000000 R09 0000000000000000 [ 7.009039] R10 0000000000000000 R11 0000000000000202 R12 0000000000000000 [ 7.009429] R13 00007ffed5d478b0 R14 00007ec756ee5000 R15 00005cbd4e655cb8 Fix this bug with correct pointer addition and conversion in parse and dump code.

### Vulnerability Description Key Phrases
- **component:** netfilter nft_tunnel
- **rootcause:** **type confusion**
- **weakness:** **heap out-of-bounds write, slab-out-of-bounds write**
- **product:** Linux kernel
- **version:** 6.1.132

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | alternate_terms | 0.700 |
| 2 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.834 |
| 3 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.820 |
| 4 | 912 | Hidden Functionality | Class | Allowed-with-Review | sparse | 0.811 |
| 5 | 121 | Stack-based Buffer Overflow | Variant | Allowed | sparse | 0.806 |
| 6 | 302 | Authentication Bypass by Assumed-Immutable Data | Base | Allowed | sparse | 0.803 |
| 7 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.801 |
| 8 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.795 |
| 9 | 191 | Integer Underflow (Wrap or Wraparound) | Base | Allowed | dense | 0.578 |
| 10 | 170 | Improper Null Termination | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-843: Access of Resource Using Incompatible Type ('Type Confusion')

CWE-306: Missing Authentication for Critical Function

CWE-20: Improper Input Validation

CWE-912: Hidden Functionality

CWE-121: Stack-based Buffer Overflow

CWE-302: Authentication Bypass by Assumed-Immutable Data

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-190: Integer Overflow or Wraparound

CWE-191: Integer Underflow (Wrap or Wraparound)

CWE-170: Improper Null Termination