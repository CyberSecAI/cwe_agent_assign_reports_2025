# Raw Retriever Results for CVE-2025-37959

# Raw Retriever Results for CVE-2025-37959
## Query
In the Linux kernel, the following vulnerability has been resolved bpf Scrub packet on bpf_redirect_peer When bpf_redirect_peer is used to redirect packets to a device in another network namespace, the skb isnt scrubbed. That can lead skb information from one namespace to be misused in another namespace. As one example, this is causing Cilium to drop traffic when using bpf_redirect_peer to redirect packets that just went through IPsec decryption to a container namespace. The following pwru trace shows (1) the packet path from the hosts XFRM layer to the containers XFRM layer where its dropped and (2) the number of active skb extensions at each function. NETNS MARK IFACE TUPLE FUNC 4026533547 d00 eth0 10.244.3.12435473->10.244.2.15853 xfrm_rcv_cb .active_extensions = (__u8)2, 4026533547 d00 eth0 10.244.3.12435473->10.244.2.15853 xfrm4_rcv_cb .active_extensions = (__u8)2, 4026533547 d00 eth0 10.244.3.12435473->10.244.2.15853 gro_cells_receive .active_extensions = (__u8)2, [...] 4026533547 0 eth0 10.244.3.12435473->10.244.2.15853 skb_do_redirect .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 ip_rcv .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 ip_rcv_core .active_extensions = (__u8)2, [...] 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 udp_queue_rcv_one_skb .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 __xfrm_policy_check .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 __xfrm_decode_session .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 security_xfrm_decode_session .active_extensions = (__u8)2, 4026534999 0 eth0 10.244.3.12435473->10.244.2.15853 kfree_skb_reason(SKB_DROP_REASON_XFRM_POLICY) .active_extensions = (__u8)2, In this case, there are no XFRM policies in the containers network namespace so the drop is unexpected. When we decrypt the IPsec packet, the XFRM state used for decryption is set in the skb extensions. This information is preserved across the netns switch. When we reach the XFRM policy check in the containers netns, __xfrm_policy_check drops the packet with LINUX_MIB_XFRMINNOPOLS because a (container-side) XFRM policy cant be found that matches the (host-side) XFRM state used for decryption. This patch fixes this by scrubbing the packet when using bpf_redirect_peer, as is done on typical netns switches via veth devices except skb->mark and skb->tstamp are not zeroed.

## Keyphrases
No keyphrases provided.

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4642 | 0.5129 | 0.4780 | 0.4753 | 20 |
| Sparse | 411.9980 | 480.3217 | 425.7393 | 419.8091 | 10 |
| Graph | 1.4913 | 2.6784 | 1.8442 | 1.7199 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 789 | Memory Allocation with Excessive Size Value | variant | 2.6784 | Allowed |
| 2 | 833 | Deadlock | base | 2.3998 | Allowed |
| 3 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.3400 | Allowed |
| 4 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 5 | 129 | Improper Validation of Array Index | variant | 2.1936 | Allowed |
| 6 | 1284 | Improper Validation of Specified Quantity in Input | Base | 2.0073 | Allowed |
| 7 | 41 | Improper Resolution of Path Equivalence | base | 1.7680 | Allowed |
| 8 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 9 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 10 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 11 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 12 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 13 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 14 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 1.6522 | Allowed |
| 15 | 770 | Allocation of Resources Without Limits or Throttling | Base | 1.6476 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5129 | 0.5129 | Allowed |
| 2 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.4939 | 0.4939 | Allowed |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.4887 | 0.4887 | Allowed-with-Review |
| 4 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.4881 | 0.4881 | Allowed |
| 5 | 406 | Insufficient Control of Network Message Volume (Network Amplification) | Class | 0.4866 | 0.4866 | Allowed-with-Review |
| 6 | 770 | Allocation of Resources Without Limits or Throttling | Base | 0.4853 | 0.4853 | Allowed |
| 7 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4843 | 0.4843 | Allowed |
| 8 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.4831 | 0.4831 | Allowed |
| 9 | 126 | Buffer Over-read | Variant | 0.4801 | 0.4801 | Allowed |
| 10 | 121 | Stack-based Buffer Overflow | Variant | 0.4772 | 0.4772 | Allowed |
| 11 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | 0.4734 | 0.4734 | Allowed |
| 12 | 346 | Origin Validation Error | Class | 0.4730 | 0.4730 | Allowed-with-Review |
| 13 | 1317 | Improper Access Control in Fabric Bridge | Base | 0.4696 | 0.4696 | Allowed |
| 14 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.4684 | 0.4684 | Discouraged |
| 15 | 606 | Unchecked Input for Loop Condition | Base | 0.4676 | 0.4676 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 833 | Deadlock | 480.3217 | 480.3217 | Allowed |
| 2 | 770 | Allocation of Resources Without Limits or Throttling | 428.8705 | 428.8705 | Allowed |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | 427.0195 | 427.0195 | Allowed |
| 4 | 244 | Improper Clearing of Heap Memory Before Release ('Heap Inspection') | 424.6700 | 424.6700 | Allowed |
| 5 | 863 | Incorrect Authorization | 419.9680 | 419.9680 | Allowed-with-Review |
| 6 | 201 | Insertion of Sensitive Information Into Sent Data | 419.6501 | 419.6501 | Allowed |
| 7 | 400 | Uncontrolled Resource Consumption | 417.9746 | 417.9746 | Discouraged |
| 8 | 401 | Missing Release of Memory after Effective Lifetime | 413.5520 | 413.5520 | Allowed |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | 413.3689 | 413.3689 | Allowed |
| 10 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | 411.9980 | 411.9980 | Allowed-with-Review |
