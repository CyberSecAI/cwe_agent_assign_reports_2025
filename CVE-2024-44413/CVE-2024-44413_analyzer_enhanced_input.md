## Vulnerability Description
A vulnerability was discovered in DI_8200-16.07.26A1, which has been classified as critical. This issue affects the upgrade_filter_asp function in the upgrade_filter.asp file. Manipulation of the path parameter can lead to **command injection**.

### Vulnerability Description Key Phrases
- **weakness:** **command injection**
- **product:** DI_8200-16.07.26A1
- **component:** upgrade_filter_asp function in upgrade_filter.asp file

### CWE for similar CVE Descriptions
### Primary CWE Match
CWE-77

#### Top CWEs
- CWE-77 (Count: 6)

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:** The `upgrade_filter_asp` function in the D-Link DI-8200 firmware is vulnerable to command injection.

**Vulnerabilities:**
*   **Insufficient Input Validation:** The `parm` variable, which receives the request, is not filtered. The code only checks for `http://` in the input string and does not sanitize or validate the rest.
*   **Unsafe String Handling:** The received data is copied to `v17` using `strcpy`, and then a string is formatted into `v16` using `sprintf` without proper sanitization, before being passed to the `system()` call. This lack of sanitization enables command injection.
*   **Direct `system()` Call:** The vulnerable code executes the constructed string directly with `system(v16)` which allows for execution of arbitrary system commands.

**Impact of Exploitation:**
*   **Remote Command Execution:** An attacker can execute arbitrary system commands on the device. This can lead to complete control of the router.
*   **Data Exfiltration:**  The attacker could gain access to sensitive data stored on the router, such as network configuration details, credentials and potentially even internal network traffic.
*   **Malware Installation:** An attacker could install malicious software on the router, turning it into part of a botnet.
*   **Denial of Service:** The attacker could crash the router or disrupt its operation.

**Attack Vectors:**
*   **HTTP GET Request:**  The attack vector is an HTTP GET request to the `/upgrade_filter.asp` endpoint.
*   **Manipulated `path` Parameter:** The `path` parameter within the GET request is used to inject malicious commands.

**Required Attacker Capabilities/Position:**
*   **Network Access:** The attacker needs to be able to send HTTP requests to the router.
*   **Authentication:**  The attacker needs to have access to an active session on the device, as a valid `Cookie` is included in the provided exploit. In this case, it is shown that an authenticated user session of an administrator user (`wys_userid=admin,wys_passwd=861A198CDBD425F0B9D91C42FAB93A86`) is required.

**Technical Details:**
The provided proof of concept (PoC) demonstrates the injection by using backticks to execute a `ps > /rce.txt` command on the router using the path parameter. This command would redirect the process list to `/rce.txt`.
```
GET /upgrade_filter.asp?path=http://`ps%20%3E%20/rce.txt` HTTP/1.1
```
The response shows how the injected command is executed within the firmware, resulting in a new file containing the processes list.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | sparse | 0.249 |
| 4 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.219 |
| 5 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.213 |
| 6 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | Class | Discouraged | sparse | 0.210 |
| 7 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.208 |
| 8 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.204 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.612 |
| 10 | 494 | Download of Code Without Integrity Check | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')

CWE-74: Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection')

CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-790: Improper Filtering of Special Elements

CWE-494: Download of Code Without Integrity Check