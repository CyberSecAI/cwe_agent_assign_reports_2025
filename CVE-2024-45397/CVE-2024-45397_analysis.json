{
  "cve_id": "CVE-2024-45397",
  "description": "h2o is an HTTP server with support for HTTP/1.x, HTTP/2 and HTTP/3. When an HTTP request using TLS/1.3 early data on top of TCP Fast Open or QUIC 0-RTT packets is received and the IP-address-based access control is used, the access control does not detect and prohibit HTTP requests conveyed by packets with a **spoofed source address**. This behavior allows attackers on the network to execute HTTP requests from addresses that are otherwise rejected by the address-based access control. The vulnerability has been addressed in commit 15ed15a. Users may disable the use of TCP FastOpen and QUIC to mitigate the issue.",
  "key_phrases": {
    "rootcause": "",
    "weakness": "spoofed source address",
    "impact": "execute HTTP requests from unauthorized addresses",
    "vector": "HTTP request using TLS/1.3 early data on TCP Fast Open or QUIC 0-RTT packets",
    "attacker": "attackers on the network",
    "product": "h2o",
    "version": "",
    "component": "IP-address-based access control"
  },
  "reference_content": "Based on the provided content, here's an analysis of CVE-2024-45397:\n\n**Root Cause of Vulnerability:**\n\nThe vulnerability stems from how h2o handles early data in TLS 1.3 (0-RTT) and TCP Fast Open connections when IP-address-based access control is configured. Specifically, the access control mechanism does not properly check the source IP address of the initial packets containing the early data.\n\n**Weaknesses/Vulnerabilities Present:**\n\n*   **Bypassed Access Control:** The primary weakness is that the IP-address-based access control is bypassed for requests made using early data. This allows attackers to potentially bypass restrictions put in place by the server's configuration.\n*   **Lack of Source Address Validation:** The vulnerability arises because the server does not validate the source IP address of the early data packets. This is particularly dangerous when using TCP Fast Open or QUIC 0-RTT.\n\n**Impact of Exploitation:**\n\n*   **Unauthorized Access:** An attacker on the network can send HTTP requests from source addresses that would otherwise be blocked by the access control rules.\n*   **Circumvention of Security Policy:** This allows an attacker to circumvent the security policies defined by the IP address access control rules and potentially reach protected endpoints.\n\n**Attack Vectors:**\n\n*   **Network-based Attack:** The attack can be launched from anywhere on the network where the server is reachable.\n*   **Spoofed Source Address:** The attacker sends HTTP requests using TLS 1.3 early data or TCP Fast Open with a spoofed source IP address.\n\n**Required Attacker Capabilities/Position:**\n\n*   **Network Access:** The attacker must be on the same network or have a network path to the vulnerable h2o server.\n*   **Ability to Send Spoofed Packets:** The attacker needs to be able to forge packets with a source IP address that they want to bypass the access control with.\n*   **Understanding of TLS 1.3 Early Data / TCP Fast Open:** They must be able to establish a connection and send a valid HTTP request using these mechanisms.",
  "similar_info": {
    "cwe_distribution": {},
    "cwe_consensus": "",
    "similarity_stats": {
      "thresholds": [],
      "total_samples_by_threshold": {},
      "top_cwes_by_threshold": {}
    }
  },
  "similarity_summary": {
    "consensus_cwe": "",
    "top_cwes": [],
    "confidence_levels": {},
    "total_samples": 0
  },
  "analysis": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-290 | Authentication Bypass by Spoofing | 0.9 | Base | Primary CWE | Allowed |\n| CWE-923 | Improper Restriction of Communication Channel to Intended Endpoints | 0.7 | Class | Secondary Candidate | Allowed-with-Review |\n| CWE-807 | Reliance on Untrusted Inputs in a Security Decision | 0.6 | Base | Secondary Candidate | Allowed |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-290, which is a Base level weakness. This CWE has child-of relationships to CWE-287 Improper Authentication and CWE-300 Channel Accessible by Non-Endpoint. CWE-290 is related to CWE-923 \"Improper Restriction of Communication Channel to Intended Endpoints\" through a \"CanPrecede\" relationship. CWE-807 is related as a more general case of relying on untrusted input for security decisions, which aligns with the concept of spoofed addresses.\n\n```mermaid\ngraph TD\n    cwe290[\"CWE-290: Authentication Bypass by Spoofing\"]\n    cwe287[\"CWE-287: Improper Authentication\"]\n    cwe300[\"CWE-300: Channel Accessible by Non-Endpoint\"]\n    cwe923[\"CWE-923: Improper Restriction of Communication Channel to Intended Endpoints\"]\n    cwe807[\"CWE-807: Reliance on Untrusted Inputs in a Security Decision\"]\n\n    cwe290 -->|CHILDOF| cwe287\n    cwe290 -->|CHILDOF| cwe300\n    cwe290 -->|CANPRECEDE| cwe923\n    cwe290 -->|CHILDOF| cwe807\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe290 primary\n    class cwe287,cwe300,cwe923,cwe807 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **spoofed source address** being accepted by the IP-address-based access control due to the use of TLS/1.3 early data on top of TCP Fast Open or QUIC 0-RTT packets. This leads to the **bypassing of authentication** and the ability to **execute HTTP requests from unauthorized addresses**.\n\n## Summary of Analysis\nThe initial analysis identified CWE-290 Authentication Bypass by Spoofing as the primary weakness, supported by the **weakness** of the **spoofed source address** and the bypass of access control. The Retriever Results and the Vulnerability Description Key Phrases both support this conclusion. The vulnerability chain highlights the root cause (spoofing) leading to the impact (unauthorized access).\n\nCWE-290 is the most specific and appropriate choice because the attack relies on **spoofing** the source address to bypass access control.\n\nCWE-923, Improper Restriction of Communication Channel to Intended Endpoints, was considered because the vulnerability involves a failure to properly restrict the communication channel to intended endpoints by validating the source IP address, but is a more general case.\n\nCWE-807, Reliance on Untrusted Inputs in a Security Decision, was considered because the access control relies on the IP address, which can be spoofed, representing an untrusted input. But CWE-290 more accurately captures the core issue of authentication bypass via spoofing.\n\nRelevant CWE Information:\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-290: Authentication Bypass by Spoofing\nThe vulnerability involves the **spoofing** of the source IP address to bypass the IP-address-based access control. This aligns with the core concept of CWE-290.\n\n## CWE-923: Improper Restriction of Communication Channel to Intended Endpoints\nThe vulnerability involves a failure to properly restrict the communication channel to intended endpoints by validating the source IP address.\n\n## CWE-807: Reliance on Untrusted Inputs in a Security Decision\nThe access control relies on the IP address, which can be spoofed, representing an untrusted input.",
  "analysis_with_relationships": "# Summary\n| CWE ID | CWE Name | Confidence | CWE Abstraction Level | CWE Vulnerability Mapping Label | CWE-Vulnerability Mapping Notes |\n|---|---|---|---|---|---|\n| CWE-290 | Authentication Bypass by Spoofing | 0.9 | Base | Primary CWE | Allowed |\n| CWE-923 | Improper Restriction of Communication Channel to Intended Endpoints | 0.7 | Class | Secondary Candidate | Allowed-with-Review |\n| CWE-807 | Reliance on Untrusted Inputs in a Security Decision | 0.6 | Base | Secondary Candidate | Allowed |\n\n## Evidence and Confidence\n\n*   **Confidence Score:** 0.8\n*   **Evidence Strength:** HIGH\n\n## Relationship Analysis\nThe primary CWE is CWE-290, which is a Base level weakness. This CWE has child-of relationships to CWE-287 Improper Authentication and CWE-300 Channel Accessible by Non-Endpoint. CWE-290 is related to CWE-923 \"Improper Restriction of Communication Channel to Intended Endpoints\" through a \"CanPrecede\" relationship. CWE-807 is related as a more general case of relying on untrusted input for security decisions, which aligns with the concept of spoofed addresses.\n\n```mermaid\ngraph TD\n    cwe290[\"CWE-290: Authentication Bypass by Spoofing\"]\n    cwe287[\"CWE-287: Improper Authentication\"]\n    cwe300[\"CWE-300: Channel Accessible by Non-Endpoint\"]\n    cwe923[\"CWE-923: Improper Restriction of Communication Channel to Intended Endpoints\"]\n    cwe807[\"CWE-807: Reliance on Untrusted Inputs in a Security Decision\"]\n\n    cwe290 -->|CHILDOF| cwe287\n    cwe290 -->|CHILDOF| cwe300\n    cwe290 -->|CANPRECEDE| cwe923\n    cwe290 -->|CHILDOF| cwe807\n\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n    class cwe290 primary\n    class cwe287,cwe300,cwe923,cwe807 secondary\n```\n\n## Vulnerability Chain\nThe vulnerability chain starts with the **spoofed source address** being accepted by the IP-address-based access control due to the use of TLS/1.3 early data on top of TCP Fast Open or QUIC 0-RTT packets. This leads to the **bypassing of authentication** and the ability to **execute HTTP requests from unauthorized addresses**.\n\n## Summary of Analysis\nThe initial analysis identified CWE-290 Authentication Bypass by Spoofing as the primary weakness, supported by the **weakness** of the **spoofed source address** and the bypass of access control. The Retriever Results and the Vulnerability Description Key Phrases both support this conclusion. The vulnerability chain highlights the root cause (spoofing) leading to the impact (unauthorized access).\n\nCWE-290 is the most specific and appropriate choice because the attack relies on **spoofing** the source address to bypass access control.\n\nCWE-923, Improper Restriction of Communication Channel to Intended Endpoints, was considered because the vulnerability involves a failure to properly restrict the communication channel to intended endpoints by validating the source IP address, but is a more general case.\n\nCWE-807, Reliance on Untrusted Inputs in a Security Decision, was considered because the access control relies on the IP address, which can be spoofed, representing an untrusted input. But CWE-290 more accurately captures the core issue of authentication bypass via spoofing.\n\nRelevant CWE Information:\n# Enhanced Context (25 CWEs)\nThe following CWEs were identified as potentially relevant to this vulnerability:\n\n## CWE-290: Authentication Bypass by Spoofing\nThe vulnerability involves the **spoofing** of the source IP address to bypass the IP-address-based access control. This aligns with the core concept of CWE-290.\n\n## CWE-923: Improper Restriction of Communication Channel to Intended Endpoints\nThe vulnerability involves a failure to properly restrict the communication channel to intended endpoints by validating the source IP address.\n\n## CWE-807: Reliance on Untrusted Inputs in a Security Decision\nThe access control relies on the IP address, which can be spoofed, representing an untrusted input.\n\n\n## CWE Relationship Analysis\n\nCurrent CWEs represent these abstraction levels: .\n\n\n### Vulnerability Chain Analysis\n\n**Chain starting from CWE-290:**\n- 290 (Authentication Bypass by Spoofing) - ROOT\n\n\n**Chain starting from CWE-923:**\n- 923 (Improper Restriction of Communication Channel to Intended Endpoints) - ROOT\n\n\n\n### CWE Relationship Diagram\n\n```mermaid\ngraph TD\n    classDef primary fill:#f96,stroke:#333,stroke-width:2px\n    classDef secondary fill:#69f,stroke:#333\n    classDef tertiary fill:#9e9,stroke:#333\n```",
  "criticism": "",
  "resolution": "",
  "relevant_cwes": [
    {
      "metadata": {
        "doc_id": "290",
        "name": "Authentication Bypass by Spoofing",
        "source": "sparse"
      },
      "similarity": 602.1971073284211
    },
    {
      "metadata": {
        "doc_id": "201",
        "name": "Insertion of Sensitive Information Into Sent Data",
        "source": "sparse"
      },
      "similarity": 572.8818308227453
    },
    {
      "metadata": {
        "doc_id": "923",
        "name": "Improper Restriction of Communication Channel to Intended Endpoints",
        "source": "sparse"
      },
      "similarity": 570.8367385267359
    },
    {
      "metadata": {
        "doc_id": "941",
        "name": "Incorrectly Specified Destination in a Communication Channel",
        "source": "sparse"
      },
      "similarity": 570.658834403048
    },
    {
      "metadata": {
        "doc_id": "400",
        "name": "Uncontrolled Resource Consumption",
        "source": "sparse"
      },
      "similarity": 565.0540580403685
    },
    {
      "metadata": {
        "doc_id": "20",
        "name": "Improper Input Validation",
        "source": "sparse"
      },
      "similarity": 564.8364980916804
    },
    {
      "metadata": {
        "doc_id": "1286",
        "name": "Improper Validation of Syntactic Correctness of Input",
        "source": "sparse"
      },
      "similarity": 562.2749217101014
    },
    {
      "metadata": {
        "doc_id": "306",
        "name": "Missing Authentication for Critical Function",
        "source": "sparse"
      },
      "similarity": 561.7058010310446
    },
    {
      "metadata": {
        "doc_id": "444",
        "name": "Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')",
        "type": "Base",
        "original_content": "The product acts as an intermediary HTTP agent\n         (such as a proxy or firewall) in the data flow between two\n         entities such as a client and server, but it does not\n         interpret malformed HTTP requests or responses in ways that\n         are consistent with how the messages will be processed by\n         those entities that are at the ultimate destination.",
        "keyphrase_source": "weakness:spoofed source address",
        "source": "dense",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Base level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "dense",
            "graph"
          ],
          "retriever_count": 2,
          "normalized_scores": {
            "dense": 0.5098530338936538,
            "graph": 1.4912437070041935
          }
        }
      },
      "similarity": 0.5098530338936538
    },
    {
      "doc_id": "350",
      "text": "CWE-350: Reliance on Reverse DNS Resolution for a Security-Critical Action",
      "score": 2.6784000000000003,
      "metadata": {
        "doc_id": "350",
        "name": "Reliance on Reverse DNS Resolution for a Security-Critical Action",
        "type": "variant",
        "original_content": "CWE-350: Reliance on Reverse DNS Resolution for a Security-Critical Action",
        "relationships": [
          {
            "source_id": "350",
            "target_id": "923",
            "label": "CANPRECEDE",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "350",
            "target_id": "807",
            "label": "CHILDOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "350",
            "target_id": "290",
            "label": "CHILDOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          },
          {
            "source_id": "923",
            "target_id": "350",
            "label": "CANFOLLOW",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "807",
            "target_id": "350",
            "label": "PARENTOF",
            "properties": {
              "view_id": "1000"
            }
          },
          {
            "source_id": "290",
            "target_id": "350",
            "label": "PARENTOF",
            "properties": {
              "ordinal": "Primary",
              "view_id": "1000"
            }
          }
        ],
        "score_components": {
          "relationship_chain": 1.0,
          "abstraction_path": 0.76,
          "sequence_path": 1.0
        },
        "abstraction_factor": 1.2,
        "graph_path_info": {
          "path_types": [
            "relationship_chain",
            "abstraction_path_down",
            "vulnerability_sequence_forward",
            "vulnerability_sequence_backward"
          ],
          "best_paths": {
            "relationship_chain": {
              "path": [
                [
                  "923",
                  "350",
                  "CANFOLLOW"
                ]
              ],
              "score": 1.0,
              "type": "relationship_chain",
              "source": "923"
            },
            "abstraction_path_down": {
              "path": [
                [
                  "290",
                  "350",
                  "PARENTOF"
                ]
              ],
              "score": 0.76,
              "type": "abstraction_path_down",
              "source": "290"
            },
            "vulnerability_sequence_forward": {
              "path": [
                [
                  "923",
                  "350",
                  "CANFOLLOW"
                ]
              ],
              "score": 0.9,
              "type": "vulnerability_sequence_forward",
              "source": "923"
            },
            "vulnerability_sequence_backward": {
              "path": [
                [
                  "350",
                  "923",
                  "CANPRECEDE"
                ]
              ],
              "score": 1.0,
              "type": "vulnerability_sequence_backward",
              "source": "923"
            }
          }
        },
        "abstraction_level": "variant",
        "position": "before",
        "sources": [
          "graph"
        ],
        "source": "graph",
        "mapping_notes": {
          "usage": "Allowed",
          "rationale": "This CWE entry is at the Variant level of abstraction, which is a preferred level of abstraction for mapping to the root causes of vulnerabilities.",
          "comments": "Carefully read both the name and description to ensure that this mapping is an appropriate fit. Do not try to 'force' a mapping to a lower-level Base/Variant simply to comply with this preferred level of abstraction.",
          "reasons": [
            "Acceptable-Use"
          ]
        },
        "score_info": {
          "retrievers": [
            "graph"
          ],
          "retriever_count": 1,
          "normalized_scores": {
            "graph": 2.6784000000000003
          }
        }
      },
      "similarity": 2.6784000000000003
    }
  ],
  "identified_cwes": {
    "analyzer": [
      "CWE-290",
      "CWE-923",
      "CWE-300",
      "CWE-807",
      "CWE-287"
    ],
    "critic_additional": []
  },
  "keyphrase_cwe_mapping": {}
}