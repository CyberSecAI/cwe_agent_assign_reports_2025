# Raw Retriever Results for CVE-2024-58089

# Raw Retriever Results for CVE-2024-58089
## Query
In the Linux kernel, the following vulnerability has been resolved btrfs fix double accounting race when btrfs_run_delalloc_range() failed [BUG] When running btrfs with block size (4K) smaller than page size (64K, aarch64), there is a very high chance to crash the kernel at generic/750, with the following messages (before the call traces, there are 3 extra debug messages added) BTRFS warning (device dm-3) read-write for sector size 4096 with page size 65536 is experimental BTRFS info (device dm-3) checking UUID tree hrtimer interrupt took 5451385 ns BTRFS error (device dm-3) cow_file_range failed, root=4957 inode=257 start=1605632 len=69632 -28 BTRFS error (device dm-3) run_delalloc_nocow failed, root=4957 inode=257 start=1605632 len=69632 -28 BTRFS error (device dm-3) failed to run delalloc range, root=4957 ino=257 folio=1572864 submit_bitmap=8-15 start=1605632 len=69632 -28 ------------[ cut here ]------------ WARNING CPU 2 PID 3020984 at ordered-data.c360 can_finish_ordered_extent+0x370/0x3b8 [btrfs] CPU 2 UID 0 PID 3020984 Comm kworker/u241 Tainted G OE 6.13.0-rc1-custom+ #89 Tainted [O]=OOT_MODULE, [E]=UNSIGNED_MODULE Hardware name QEMU KVM Virtual Machine, BIOS unknown 2/2/2022 Workqueue events_unbound btrfs_async_reclaim_data_space [btrfs] pc can_finish_ordered_extent+0x370/0x3b8 [btrfs] lr can_finish_ordered_extent+0x1ec/0x3b8 [btrfs] Call trace can_finish_ordered_extent+0x370/0x3b8 [btrfs] (P) can_finish_ordered_extent+0x1ec/0x3b8 [btrfs] (L) btrfs_mark_ordered_io_finished+0x130/0x2b8 [btrfs] extent_writepage+0x10c/0x3b8 [btrfs] extent_write_cache_pages+0x21c/0x4e8 [btrfs] btrfs_writepages+0x94/0x160 [btrfs] do_writepages+0x74/0x190 filemap_fdatawrite_wbc+0x74/0xa0 start_delalloc_inodes+0x17c/0x3b0 [btrfs] btrfs_start_delalloc_roots+0x17c/0x288 [btrfs] shrink_delalloc+0x11c/0x280 [btrfs] flush_space+0x288/0x328 [btrfs] btrfs_async_reclaim_data_space+0x180/0x228 [btrfs] process_one_work+0x228/0x680 worker_thread+0x1bc/0x360 kthread+0x100/0x118 ret_from_fork+0x10/0x20 ---[ end trace 0000000000000000 ]--- BTRFS critical (device dm-3) bad ordered extent accounting, root=4957 ino=257 OE offset=1605632 OE len=16384 to_dec=16384 left=0 BTRFS critical (device dm-3) bad ordered extent accounting, root=4957 ino=257 OE offset=1622016 OE len=12288 to_dec=12288 left=0 Unable to handle kernel NULL pointer dereference at virtual address 0000000000000008 BTRFS critical (device dm-3) bad ordered extent accounting, root=4957 ino=257 OE offset=1634304 OE len=8192 to_dec=4096 left=0 CPU 1 UID 0 PID 3286940 Comm kworker/u243 Tainted G W OE 6.13.0-rc1-custom+ #89 Hardware name QEMU KVM Virtual Machine, BIOS unknown 2/2/2022 Workqueue btrfs_work_helper [btrfs] (btrfs-endio-write) pstate 404000c5 (nZcv daIF +PAN -UAO -TCO -DIT -SSBS BTYPE=--) pc process_one_work+0x110/0x680 lr worker_thread+0x1bc/0x360 Call trace process_one_work+0x110/0x680 (P) worker_thread+0x1bc/0x360 (L) worker_thread+0x1bc/0x360 kthread+0x100/0x118 ret_from_fork+0x10/0x20 Code f84086a1 f9000fe1 53041c21 b9003361 (f9400661) ---[ end trace 0000000000000000 ]--- Kernel panic - not syncing Oops Fatal exception SMP stopping secondary CPUs SMP failed to stop secondary CPUs 2-3 Dumping ftrace buffer (ftrace buffer empty) Kernel Offset 0x275bb9540000 from 0xffff800080000000 PHYS_OFFSET 0xffff8fbba0000000 CPU features 0x100,00000070,00801250,8201720b [CAUSE] The above warning is triggered immediately after the delalloc range failure, this happens in the following sequence - Range [1568K, 1636K) is dirty 1536K 1568K 1600K 1636K 1664K | |/////////|////////| | Where 1536K, 1600K and 1664K are page boundaries (64K page size) - Enter extent_writepage() for page 1536K - Enter run_delalloc_nocow() with locke ---truncated---

## Keyphrases
No keyphrases provided.

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4869 | 0.5509 | 0.5064 | 0.5011 | 20 |
| Sparse | 302.2958 | 458.9705 | 337.3690 | 316.5741 | 10 |
| Graph | 1.7486 | 2.9120 | 2.2365 | 2.2100 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 1339 | Insufficient Precision or Accuracy of a Real Number | base | 2.9120 | Allowed |
| 2 | 128 | Wrap-around Error | base | 2.9120 | Allowed |
| 3 | 190 | Integer Overflow or Wraparound | Base | 2.8143 | Allowed |
| 4 | 129 | Improper Validation of Array Index | variant | 2.6784 | Allowed |
| 5 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 2.4232 | Allowed-with-Review |
| 6 | 123 | Write-what-where Condition | base | 2.4232 | Allowed |
| 7 | 364 | Signal Handler Race Condition | base | 2.3400 | Allowed |
| 8 | 1284 | Improper Validation of Specified Quantity in Input | Base | 2.2615 | Allowed |
| 9 | 410 | Insufficient Resource Pool | base | 2.2100 | Allowed |
| 10 | 843 | Access of Resource Using Incompatible Type ('Type Confusion') | base | 2.2100 | Allowed |
| 11 | 1257 | Improper Access Control Applied to Mirrored or Aliased Memory Regions | base | 2.2100 | Allowed |
| 12 | 839 | Numeric Range Comparison Without Minimum Check | base | 2.2100 | Allowed |
| 13 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.2090 | Allowed |
| 14 | 456 | Missing Initialization of a Variable | variant | 2.0554 | Allowed |
| 15 | 195 | Signed to Unsigned Conversion Error | variant | 2.0400 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5509 | 0.5509 | Allowed-with-Review |
| 2 | 667 | Improper Locking | Class | 0.5458 | 0.5458 | Allowed-with-Review |
| 3 | 909 | Missing Initialization of Resource | Class | 0.5449 | 0.5449 | Allowed-with-Review |
| 4 | 190 | Integer Overflow or Wraparound | Base | 0.5178 | 0.5178 | Allowed |
| 5 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5171 | 0.5171 | Allowed |
| 6 | 789 | Memory Allocation with Excessive Size Value | Variant | 0.5095 | 0.5095 | Allowed |
| 7 | 908 | Use of Uninitialized Resource | Base | 0.5088 | 0.5088 | Allowed |
| 8 | 126 | Buffer Over-read | Variant | 0.5074 | 0.5074 | Allowed |
| 9 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.5037 | 0.5037 | Discouraged |
| 10 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.5034 | 0.5034 | Allowed |
| 11 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.4988 | 0.4988 | Allowed |
| 12 | 416 | Use After Free | Variant | 0.4958 | 0.4958 | Allowed |
| 13 | 122 | Heap-based Buffer Overflow | Variant | 0.4952 | 0.4952 | Allowed |
| 14 | 366 | Race Condition within a Thread | Base | 0.4940 | 0.4940 | Allowed |
| 15 | 1342 | Information Exposure through Microarchitectural State after Transient Execution | Base | 0.4912 | 0.4912 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 667 | Improper Locking | 458.9705 | 458.9705 | Allowed-with-Review |
| 2 | 833 | Deadlock | 414.7444 | 414.7444 | Allowed |
| 3 | 1284 | Improper Validation of Specified Quantity in Input | 328.5801 | 328.5801 | Allowed |
| 4 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | 321.9614 | 321.9614 | Discouraged |
| 5 | 400 | Uncontrolled Resource Consumption | 317.3256 | 317.3256 | Discouraged |
| 6 | 125 | Out-of-bounds Read | 315.8226 | 315.8226 | Allowed |
| 7 | 122 | Heap-based Buffer Overflow | 305.6649 | 305.6649 | Allowed |
| 8 | 775 | Missing Release of File Descriptor or Handle after Effective Lifetime | 304.7760 | 304.7760 | Allowed |
| 9 | 770 | Allocation of Resources Without Limits or Throttling | 303.5491 | 303.5491 | Allowed |
| 10 | 401 | Missing Release of Memory after Effective Lifetime | 302.2958 | 302.2958 | Allowed |
