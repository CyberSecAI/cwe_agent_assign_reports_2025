## Vulnerability Description
RestrictedPython is a restricted execution environment for Python to run untrusted code. A user can gain access to protected (and potentially sensible) information indirectly via AttributeError.obj and the string module. The problem will be fixed in version 7.3. As a workaround, If the application does not require access to the module string, it can remove it from RestrictedPython.Utilities.utility_builtins or otherwise do not make it available in the restricted execution environment.

### Vulnerability Description Key Phrases
- **weakness:** **gain access to protected information**
- **vector:** AttributeError.obj and the string module
- **attacker:** user
- **product:** RestrictedPython
- **version:** 7.3

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from the way `RestrictedPython` handles `AttributeError` exceptions and its interaction with the `string` module. Specifically, the `AttributeError` object was exposing a reference to the underlying object that caused the exception via `AttributeError.obj`, potentially leaking internal information. Additionally, the `string` module was being exposed in a way that could be leveraged for unintended access.

**Weaknesses/Vulnerabilities Present:**

*   **Information Leakage via `AttributeError.obj`:** The `AttributeError` exception object contained a reference to the object on which the attribute access failed (`e.obj = self`). This could be used to access protected or sensitive information.
*   **Unrestricted Access to `string` module:** The `string` module, when exposed without proper restriction, could be exploited to gain access to more of the underlying Python environment than intended.

**Impact of Exploitation:**

An attacker could potentially gain access to protected (and potentially sensitive) information by:

1.  Triggering an `AttributeError` in a restricted environment.
2.  Accessing the `obj` attribute of the `AttributeError` object.
3.  Leveraging the leaked object reference and the available methods in the `string` module or related objects to gain additional information or perform unauthorized operations.

**Attack Vectors:**

*   By crafting malicious input that triggers an `AttributeError` within the restricted environment.
*   By leveraging the unrestricted access to the `string` module in the restricted context.

**Required Attacker Capabilities/Position:**

*   The attacker needs to have the ability to execute code or control the input within a `RestrictedPython` environment that is vulnerable (versions < 7.3).
*   The attacker must be able to access or interact with the `string` module, or cause an `AttributeError` to occur on a `_AttributeDelegator` object.

**Additional Details from the Patch:**

The fix implemented in commit `d701cc36cccac36b21fa200f1f2d1945a9a215e6` addresses the vulnerability by:

*   Modifying the `_AttributeDelegator.__getattr__` method to no longer set the `obj` attribute on `AttributeError`.
*   Restricting access to the `string` module by providing only a restricted view of it (as an `_AttributeDelegator` object) rather than the module itself.

This ensures that the `AttributeError` does not leak the object reference, and direct access to the `string` module is no longer possible.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.430 |
| 2 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.423 |
| 3 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.422 |
| 4 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.421 |
| 5 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.413 |
| 6 | 668 | Exposure of Resource to Wrong Sphere | Class | Discouraged | sparse | 0.412 |
| 7 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.412 |
| 8 | 287 | Improper Authentication | Class | Discouraged | sparse | 0.405 |
| 9 | 1177 | Use of Prohibited Code | Class | Allowed-with-Review | dense | 0.402 |
| 10 | 322 | Key Exchange without Entity Authentication | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-863: Incorrect Authorization

CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

CWE-923: Improper Restriction of Communication Channel to Intended Endpoints

CWE-306: Missing Authentication for Critical Function

CWE-668: Exposure of Resource to Wrong Sphere

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-287: Improper Authentication

CWE-1177: Use of Prohibited Code

CWE-322: Key Exchange without Entity Authentication