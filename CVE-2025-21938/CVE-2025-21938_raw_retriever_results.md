# Raw Retriever Results for CVE-2025-21938

# Raw Retriever Results for CVE-2025-21938
## Query
In the Linux kernel, the following vulnerability has been resolved mptcp fix scheduling while atomic in mptcp_pm_nl_append_new_local_addr If multiple connection requests attempt to create an implicit mptcp endpoint in parallel, more than one caller may end up in mptcp_pm_nl_append_new_local_addr because none found the address in local_addr_list during their call to mptcp_pm_nl_get_local_id. In this case, the concurrent new_local_addr calls may delete the address entry created by the previous caller. These deletes use synchronize_rcu, but this is not permitted in some of the contexts where this function may be called. During packet recv, the caller may be in a rcu read critical section and have preemption disabled. An example stack BUG scheduling while atomic swapper/2/0/0x00000302 Call Trace dump_stack_lvl (lib/dump_stack.c117 (discriminator 1)) dump_stack (lib/dump_stack.c124) __schedule_bug (kernel/sched/core.c5943) schedule_debug.constprop.0 (arch/x86/include/asm/preempt.h33 kernel/sched/core.c5970) __schedule (arch/x86/include/asm/jump_label.h27 include/linux/jump_label.h207 kernel/sched/features.h29 kernel/sched/core.c6621) schedule (arch/x86/include/asm/preempt.h84 kernel/sched/core.c6804 kernel/sched/core.c6818) schedule_timeout (kernel/time/timer.c2160) wait_for_completion (kernel/sched/completion.c96 kernel/sched/completion.c116 kernel/sched/completion.c127 kernel/sched/completion.c148) __wait_rcu_gp (include/linux/rcupdate.h311 kernel/rcu/update.c444) synchronize_rcu (kernel/rcu/tree.c3609) mptcp_pm_nl_append_new_local_addr (net/mptcp/pm_netlink.c966 net/mptcp/pm_netlink.c1061) mptcp_pm_nl_get_local_id (net/mptcp/pm_netlink.c1164) mptcp_pm_get_local_id (net/mptcp/pm.c420) subflow_check_req (net/mptcp/subflow.c98 net/mptcp/subflow.c213) subflow_v4_route_req (net/mptcp/subflow.c305) tcp_conn_request (net/ipv4/tcp_input.c7216) subflow_v4_conn_request (net/mptcp/subflow.c651) tcp_rcv_state_process (net/ipv4/tcp_input.c6709) tcp_v4_do_rcv (net/ipv4/tcp_ipv4.c1934) tcp_v4_rcv (net/ipv4/tcp_ipv4.c2334) ip_protocol_deliver_rcu (net/ipv4/ip_input.c205 (discriminator 1)) ip_local_deliver_finish (include/linux/rcupdate.h813 net/ipv4/ip_input.c234) ip_local_deliver (include/linux/netfilter.h314 include/linux/netfilter.h308 net/ipv4/ip_input.c254) ip_sublist_rcv_finish (include/net/dst.h461 net/ipv4/ip_input.c580) ip_sublist_rcv (net/ipv4/ip_input.c640) ip_list_rcv (net/ipv4/ip_input.c675) __netif_receive_skb_list_core (net/core/dev.c5583 net/core/dev.c5631) netif_receive_skb_list_internal (net/core/dev.c5685 net/core/dev.c5774) napi_complete_done (include/linux/list.h37 include/net/gro.h449 include/net/gro.h444 net/core/dev.c6114) igb_poll (drivers/net/ethernet/intel/igb/igb_main.c8244) igb __napi_poll (net/core/dev.c6582) net_rx_action (net/core/dev.c6653 net/core/dev.c6787) handle_softirqs (kernel/softirq.c553) __irq_exit_rcu (kernel/softirq.c588 kernel/softirq.c427 kernel/softirq.c636) irq_exit_rcu (kernel/softirq.c651) common_interrupt (arch/x86/kernel/irq.c247 (discriminator 14)) This problem seems particularly prevalent if the user advertises an endpoint that has a different external vs internal address. In the case where the external address is advertised and multiple connections already exist, multiple subflow SYNs arrive in parallel which tends to trigger the race during creation of the first local_addr_list entries which have the internal address instead. Fix by skipping the replacement of an existing implicit local address if called via mptcp_pm_nl_get_local_id.

## Keyphrases
- **rootcause**: 'race condition in mptcp_pm_nl_append_new_local_addr function'
- **weakness**: 'synchronize_rcu in a non-permissible context'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.5060 | 0.5847 | 0.5340 | 0.5307 | 20 |
| Sparse | 1232.4009 | 1616.1878 | 1434.2319 | 1424.2168 | 11 |
| Graph | 1.4784 | 2.2100 | 1.7607 | 1.6848 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 390 | Detection of Error Condition Without Action | base | 2.2100 | Allowed |
| 2 | 772 | Missing Release of Resource after Effective Lifetime | base | 2.2100 | Allowed |
| 3 | 911 | Improper Update of Reference Count | Base | 2.0499 | Allowed |
| 4 | 416 | Use After Free | variant | 2.0400 | Allowed |
| 5 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 6 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 7 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 8 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 9 | 366 | Race Condition within a Thread | Base | 1.7105 | Allowed |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 11 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 12 | 1341 | Multiple Releases of Same Resource or Handle | base | 1.6848 | Allowed |
| 13 | 562 | Return of Stack Variable Address | base | 1.6848 | Allowed |
| 14 | 826 | Premature Release of Resource During Expected Lifetime | base | 1.6848 | Allowed |
| 15 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5847 | 0.5847 | Allowed-with-Review |
| 2 | 909 | Missing Initialization of Resource | Class | 0.5705 | 0.5705 | Allowed-with-Review |
| 3 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5656 | 0.5656 | Allowed |
| 4 | 667 | Improper Locking | Class | 0.5590 | 0.5590 | Allowed-with-Review |
| 5 | 366 | Race Condition within a Thread | Base | 0.5548 | 0.5548 | Allowed |
| 6 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5442 | 0.5442 | Allowed |
| 7 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.5418 | 0.5418 | Allowed |
| 8 | 606 | Unchecked Input for Loop Condition | Base | 0.5395 | 0.5395 | Allowed |
| 9 | 126 | Buffer Over-read | Variant | 0.5395 | 0.5395 | Allowed |
| 10 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.5390 | 0.5390 | Allowed |
| 11 | 131 | Incorrect Calculation of Buffer Size | Base | 0.5224 | 0.5224 | Allowed |
| 12 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.5213 | 0.5213 | Allowed |
| 13 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.5211 | 0.5211 | Allowed |
| 14 | 121 | Stack-based Buffer Overflow | Variant | 0.5209 | 0.5209 | Allowed |
| 15 | 770 | Allocation of Resources Without Limits or Throttling | Base | 0.5142 | 0.5142 | Allowed |

## Sparse Retriever Results (11)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 911 | Improper Update of Reference Count | 1616.1878 | 1616.1878 | Allowed |
| 2 | 909 | Missing Initialization of Resource | 1591.5592 | 1591.5592 | Allowed-with-Review |
| 3 | 667 | Improper Locking | 1586.2559 | 1586.2559 | Allowed-with-Review |
| 4 | 674 | Uncontrolled Recursion | 1494.4894 | 1494.4894 | Allowed-with-Review |
| 5 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 1424.6207 | 1424.6207 | Allowed-with-Review |
| 6 | 415 | Double Free | 1424.2168 | 1424.2168 | Allowed |
| 7 | 401 | Missing Release of Memory after Effective Lifetime | 1423.0569 | 1423.0569 | Allowed |
| 8 | 197 | Numeric Truncation Error | 1337.5915 | 1337.5915 | Allowed |
| 9 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | 1329.7632 | 1329.7632 | Discouraged |
| 10 | 502 | Deserialization of Untrusted Data | 1316.4084 | 1316.4084 | Allowed |
| 11 | 770 | Allocation of Resources Without Limits or Throttling | 1232.4009 | 1232.4009 | Allowed |
