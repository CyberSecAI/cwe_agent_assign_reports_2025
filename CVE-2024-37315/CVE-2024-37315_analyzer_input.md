# Vulnerability Information: CVE-2024-37315

## Vulnerability Description
Nextcloud Server is a self hosted personal cloud system. An attacker with read-only access to a file is able to restore older versions of a document when the files_versions app is enabled. It is recommended that the Nextcloud Server is upgraded to 26.0.12, 27.1.7 or 28.0.3 and that the Nextcloud Enterprise Server is upgraded to 23.0.12.16, 24.0.12.12, 25.0.13.6, 26.0.12, 27.1.7 or 28.0.3.

### Vulnerability Description Key Phrases
- **impact:** restore older versions of a document
- **attacker:** attacker with read-only access
- **product:** Nextcloud Server
- **component:** files_versions app

## CVE Reference Links Content Summary
Based on the provided information, here's an analysis of CVE-2024-37315:

**Root Cause of Vulnerability:**

The vulnerability stems from a lack of proper permission checks in the Nextcloud `files_versions` app. Specifically, read-only users were able to restore older versions of files, even when they lacked the necessary permissions to do so on the current version.

**Weaknesses/Vulnerabilities Present:**

*   **Incorrect Permission Checks:** The core issue is that the system didn't adequately verify user permissions before allowing a file version to be restored. This is a violation of the principle of least privilege.
*   **Inadequate Share Status Checks:** The system failed to check the share status correctly, allowing users with read-only access to bypass restrictions related to version control.

**Impact of Exploitation:**

*   **Data Integrity Violation:** An attacker could revert a file to an older version, potentially causing data loss or corruption. This is a violation of data integrity, even though there is no confidentiality breach.
*   **Unauthorized Modification:** While the attacker doesn't gain write access to the current file version, they effectively modify the file's state by restoring an older version, which could overwrite recent changes from other users.

**Attack Vectors:**

*   **Network:** The attack is exploitable over the network.
*   **User Account:** The attacker needs a valid user account with at least read-only access to a file.

**Required Attacker Capabilities/Position:**

*   **Read-Only Access:** The attacker needs an account with read-only privileges to a file.
*   **`files_versions` App Enabled:** The `files_versions` app must be enabled on the Nextcloud instance.
*   **User interaction**: User interaction is required.

**Additional Details:**

*   The vulnerability was fixed by implementing checks for share attributes when downloading, restoring, deleting, and labeling versions. This ensures that a user has the necessary permissions to perform these operations on older versions of a document, as well as the current version of the document.
*   The fix was implemented in a series of commits, addressing different aspects of the versioning functionality.
*   The vulnerability affects multiple versions of both Nextcloud Server and Nextcloud Enterprise Server. Patches are available for all affected versions.

The content from hackerone.com is not helpful as it requires login to view.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | sparse | 0.181 |
| 2 | 532 | Insertion of Sensitive Information into Log File | Base | Allowed | sparse | 0.178 |
| 3 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.174 |
| 4 | 639 | Authorization Bypass Through User-Controlled Key | Base | Allowed | sparse | 0.167 |
| 5 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.163 |
| 6 | 917 | Improper Neutralization of Special Elements used in an Expression Language Statement ('Expression Language Injection') | Base | Allowed | sparse | 0.161 |
| 7 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.159 |
| 8 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.159 |
| 9 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | dense | 0.410 |
| 10 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | graph | 0.002 |

