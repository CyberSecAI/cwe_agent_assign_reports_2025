# Vulnerability Information: CVE-2024-12895

## Vulnerability Description
A vulnerability has been found in TreasureHuntGame TreasureHunt up to 963e0e0 and classified as critical. Affected by this vulnerability is the function console_log of the file TreasureHunt/checkflag.php. The manipulation of the argument problema leads to **sql injection**. The attack can be launched remotely. The identifier of the patch is 8bcc649abc35b7734951be084bb522a532faac4e. It is recommended to apply a patch to fix this issue.

### Vulnerability Description Key Phrases
- **weakness:** **sql injection**
- **vector:** manipulation of the argument problema
- **product:** TreasureHuntGame TreasureHunt
- **version:** up to 963e0e0
- **component:** function console_log of the file TreasureHunt/checkflag.php

## CVE Reference Links Content Summary
The provided content is related to a commit that fixes a SQL injection vulnerability, as indicated by the commit message "fix(acesso.php e checkflag.php): SQL Injection".

**Root cause of vulnerability:**
The vulnerability stems from the direct inclusion of user-supplied input into SQL queries without proper sanitization or parameterization. Specifically, the `acesso.php` and `checkflag.php` files were vulnerable to SQL injection.

**Weaknesses/vulnerabilities present:**
- **SQL Injection:** The original code in `acesso.php` used string concatenation to build SQL queries, making it vulnerable to SQL injection. The `$usuario` variable was directly inserted into the SQL query: `$sql = "SELECT * FROM Usuario where id='$usuario'";`
-  Similarly, `checkflag.php` was vulnerable due to the `$problema` variable being directly inserted into SQL queries.

**Impact of exploitation:**
- An attacker could potentially bypass authentication, retrieve sensitive data, modify database records, or execute arbitrary SQL commands.
- In `acesso.php`, an attacker could bypass the user id check to access other user's data.
- In `checkflag.php`, an attacker could potentially manipulate database records related to the challenges.

**Attack vectors:**
- The attack vector is through HTTP POST requests to the `acesso.php` and `checkflag.php` files, by manipulating the `usuario` and `problema` parameters respectively.
- An attacker could inject malicious SQL code within the `usuario` and `problema` parameters.

**Required attacker capabilities/position:**
- The attacker needs to be able to send HTTP POST requests to the vulnerable `acesso.php` and `checkflag.php` endpoints.
- They would need knowledge of the application's structure, specifically the vulnerable parameters to target in the injection attack.

**Mitigation:**
- The commit mitigates the vulnerability by using prepared statements with bound parameters.
- In `acesso.php`, the SQL query is changed to `$sql = "SELECT * FROM Usuario where id=:usuario";` and the parameter is bound to the statement.
-  The code uses `filter_input` with `FILTER_SANITIZE_NUMBER_INT` to sanitize input before it is used, although this is not sufficient to prevent SQL Injection as input is still used in the SQL query.
-  The code is improved to use a prepared statement to prevent SQL injection.
- The commit addresses the SQL injection vulnerabilities present in `acesso.php` and `checkflag.php` by sanitizing input and using parameterized queries in `acesso.php`.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 1.000 |
| 2 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.477 |
| 3 | 1241 | Use of Predictable Algorithm in Random Number Generator | Base | Allowed | sparse | 0.403 |
| 4 | 341 | Predictable from Observable State | Base | Allowed | sparse | 0.401 |
| 5 | 93 | Improper Neutralization of CRLF Sequences ('CRLF Injection') | Base | Allowed | sparse | 0.396 |
| 6 | 1336 | Improper Neutralization of Special Elements Used in a Template Engine | Base | Allowed | sparse | 0.391 |
| 7 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.386 |
| 8 | 99 | Improper Control of Resource Identifiers ('Resource Injection') | Class | Allowed-with-Review | sparse | 0.380 |
| 9 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | dense | 0.542 |
| 10 | 113 | Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting') | Variant | Allowed | graph | 0.003 |

