# Vulnerability Information: CVE-2024-36129

## Vulnerability Description
The OpenTelemetry Collector offers a vendor-agnostic implementation on how to receive, process and export telemetry data. An **unsafe decompression vulnerability** allows unauthenticated attackers to crash the collector via excessive memory consumption. OTel Collector version 0.102.1 fixes this issue. It is also fixed in the confighttp module version 0.102.0 and configgrpc module version 0.102.1.

### Vulnerability Description Key Phrases
- **weakness:** **unsafe decompression vulnerability**
- **impact:** crash the collector and memory consumption
- **vector:** excessive memory consumption
- **attacker:** unauthenticated attackers
- **product:** OTel Collector
- **version:** before 0.102.1

## CVE Reference Links Content Summary
Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from a lack of proper size validation on decompressed data within the OpenTelemetry Collector's HTTP and gRPC receivers. The collector would check the size of the compressed payload but not the resulting uncompressed size, which can be significantly larger.

**Weaknesses/Vulnerabilities:**

*   **Unsafe Decompression:** The collector's decompression logic for HTTP and gRPC requests did not limit the size of the decompressed data. This allowed an attacker to send a small, compressed payload that would expand into a large uncompressed payload, consuming excessive memory.
*   **Missing Size Limits:** Prior to the fix, the `max_request_body_size` parameter in HTTP receivers only applied to the compressed payload, not the decompressed size.
*   **gRPC zstd vulnerability:** The gRPC implementation did not properly handle zstd compressed payloads, leading to excessive memory consumption.

**Impact of Exploitation:**

*   **Denial of Service (DoS):** By sending a "compressed bomb" (a small, compressed payload that expands to a large size when decompressed), an attacker could cause the collector to crash due to excessive memory consumption. This would disrupt the entire telemetry collection process.
*   **Out-of-Memory (OOM) Kill:** The collector application instance could be terminated due to running out of memory when decompressing a malicious payload.

**Attack Vectors:**

*   **HTTP:** An attacker sends a specially crafted HTTP request with a compressed payload (gzip, zstd, zlib, snappy, or deflate) to a publicly exposed HTTP receiver endpoint (e.g., OTLP receiver).
*   **gRPC:** An attacker sends a specially crafted gRPC request with zstd compression to a publicly exposed gRPC receiver endpoint (e.g. OTLP receiver).

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker must be able to send requests to the collector's exposed HTTP/gRPC port. This usually means the port must be exposed to the public internet or a network segment that the attacker has access to.
*   **No Authentication (gRPC):** For gRPC, the vulnerability exists before authentication is performed, making it exploitable without valid credentials.
*   **Authentication (HTTP):** If HTTP authentication is enabled, the attacker needs valid credentials.

**Additional Notes:**

*   The vulnerability affects OpenTelemetry Collector versions 0.102.0 and below for the HTTP receiver, and 0.102.1 and below for the gRPC receiver.
*   The fixes were implemented in the `confighttp` module (version 0.102.0) and `configgrpc` module (version 0.102.1).
*   The fix for HTTP involved applying the size limit to the decompressed payload, and the default value for the parameter `max_request_body_size` was established to 20 MiB
*   The fix for gRPC involved using a custom implementation for zstd decompression and a default limit of 4 MiB was applied.
*   The issue was discovered during a security audit.
*   The vulnerability is assigned CVE-2024-36129.
*   The CVSS score is 8.2 (High).
*   The vulnerability is classified under CWE-119.

This detailed analysis should provide a clear understanding of the vulnerability, its potential impact, and how it was addressed.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 789 | Memory Allocation with Excessive Size Value | Variant | Allowed | sparse | 0.276 |
| 2 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.264 |
| 3 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.248 |
| 4 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.247 |
| 5 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.244 |
| 6 | 122 | Heap-based Buffer Overflow | Variant | Allowed | sparse | 0.244 |
| 7 | 409 | Improper Handling of Highly Compressed Data (Data Amplification) | Base | Allowed | sparse | 0.237 |
| 8 | 138 | Improper Neutralization of Special Elements | Class | Discouraged | sparse | 0.237 |
| 9 | 401 | Missing Release of Memory after Effective Lifetime | Variant | Allowed | dense | 0.468 |
| 10 | 1325 | Improperly Controlled Sequential Memory Allocation | Base | Allowed | graph | 0.004 |

