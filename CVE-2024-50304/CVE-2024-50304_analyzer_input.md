# Vulnerability Information: CVE-2024-50304

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved ipv4 ip_tunnel Fix suspicious RCU usage warning in ip_tunnel_find() The per-netns IP tunnel hash table is protected by the RTNL mutex and ip_tunnel_find() is only called from the control path where the mutex is taken. Add a lockdep expression to hlist_for_each_entry_rcu() in ip_tunnel_find() in order to validate that the mutex is held and to silence the suspicious RCU usage warning [1]. [1] WARNING suspicious RCU usage 6.12.0-rc3-custom-gd95d9a31aceb #139 Not tainted ----------------------------- net/ipv4/ip_tunnel.c221 RCU-list traversed in non-reader section!! other info that might help us debug this rcu_scheduler_active = 2, debug_locks = 1 1 lock held by ip/362 #0 ffffffff86fc7cb0 (rtnl_mutex){+.+.}-{33}, at rtnetlink_rcv_msg+0x377/0xf60 stack backtrace CPU 12 UID 0 PID 362 Comm ip Not tainted 6.12.0-rc3-custom-gd95d9a31aceb #139 Hardware name Bochs Bochs, BIOS Bochs 01/01/2011 Call Trace dump_stack_lvl+0xba/0x110 lockdep_rcu_suspicious.cold+0x4f/0xd6 ip_tunnel_find+0x435/0x4d0 ip_tunnel_newlink+0x517/0x7a0 ipgre_newlink+0x14c/0x170 __rtnl_newlink+0x1173/0x19c0 rtnl_newlink+0x6c/0xa0 rtnetlink_rcv_msg+0x3cc/0xf60 netlink_rcv_skb+0x171/0x450 netlink_unicast+0x539/0x7f0 netlink_sendmsg+0x8c1/0xd80 ____sys_sendmsg+0x8f9/0xc20 ___sys_sendmsg+0x197/0x1e0 __sys_sendmsg+0x122/0x1f0 do_syscall_64+0xbb/0x1d0 entry_SYSCALL_64_after_hwframe+0x77/0x7f

### Vulnerability Description Key Phrases
- **rootcause:** **The per-netns IP tunnel hash table is protected by the RTNL mutex but hlist_for_each_entry_rcu() in ip_tunnel_find() was not validating that the mutex was held, leading to a suspicious RCU usage warning.**
- **weakness:** **The code was missing a lockdep expression to validate the RTNL mutex is held before using hlist_for_each_entry_rcu().**
- **impact:** A suspicious RCU usage warning was triggered.
- **vector:** The vulnerability was triggered in the control path when calling ip_tunnel_find() without proper validation that the RTNL mutex was held.
- **product:** Linux Kernel
- **version:** 6.12.0-rc3
- **component:** ipv4 ip_tunnel

## CVE Reference Links Content Summary
The provided content relates to a fix for a suspicious RCU usage warning in the Linux kernel's IP tunnel code, specifically within the `ip_tunnel_find()` function. While the content describes a bug, it does not represent a security vulnerability that could be exploited.

**Root cause of the issue:**
The code was generating a warning because `hlist_for_each_entry_rcu()` was being used without a lockdep expression, even though the function was always called from within a context where the `rtnl_mutex` was held. This was causing a false positive warning from the RCU (Read-Copy-Update) mechanism.

**Weaknesses/vulnerabilities present:**
No actual security vulnerabilities are present. The issue was a false positive warning related to RCU usage.

**Impact of exploitation:**
There is no exploitation impact, as this was a false positive warning.

**Attack vectors:**
There is no attack vector as this is a false positive warning.

**Required attacker capabilities/position:**
Not applicable, since this isn't a vulnerability.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.674 |
| 2 | 201 | Insertion of Sensitive Information Into Sent Data | Base | Allowed | sparse | 0.630 |
| 3 | 400 | Uncontrolled Resource Consumption | Class | Discouraged | sparse | 0.628 |
| 4 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | Class | Allowed-with-Review | sparse | 0.627 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.612 |
| 6 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.608 |
| 7 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.607 |
| 8 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.604 |
| 9 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | Allowed | dense | 0.525 |
| 10 | 476 | NULL Pointer Dereference | Base | Allowed | graph | 0.003 |

