## Vulnerability Description
An arbitrary script execution vulnerability exists in the MPV functionality of Ankitects Anki 24.04. A specially crafted flashcard can lead to a arbitrary code execution. An attacker can send malicious flashcard to trigger this vulnerability.

### Vulnerability Description Key Phrases
- **impact:** arbitrary code execution, script execution
- **vector:** specially crafted flashcard
- **product:** Anki
- **version:** 24.04
- **component:** MPV functionality

## CVE Reference Links Content Summary
## Analysis of CVE-2024-26020 based on provided content:

This content **IS RELATED** to CVE-2024-26020 and provides significantly more detail than the placeholder CVE description.

**Root cause of vulnerability:**

The vulnerability stems from the way Anki (version 24.04) handles media files played through MPV on Windows. Specifically, it allows for arbitrary arguments to be passed directly to the MPV command-line interface.

**Weaknesses/vulnerabilities present:**

*   **CWE-74 - Improper Neutralization of Special Elements in Output Used by a Downstream Component (‘Injection’):**  The vulnerability is a script injection flaw.
*   The Anki application does not properly sanitize user-supplied input when constructing the command to execute MPV.
*   MPV's ability to load and execute Lua scripts via configuration files.

**Impact of exploitation:**

Successful exploitation leads to **full command injection on the user's system**. This means an attacker can execute arbitrary code with the privileges of the user running Anki.

**Attack vectors:**

*   An attacker can craft a malicious flashcard containing a specially crafted `[sound:]` tag.
*   The crafted tag includes a reference to a configuration file (`extra.conf`) that instructs MPV to load and execute a Lua script (`run.lua`).
*   The attacker bundles the malicious `extra.conf` and `run.lua` files within the Anki media folder of the deck.
*   When a user imports the deck (and its media), the malicious script is executed by MPV.

**Required attacker capabilities/position:**

*   The attacker needs to be able to create and distribute a malicious Anki deck containing the crafted flashcard and associated files.
*   The attacker relies on the user importing the malicious deck and its media.

**Mitigation or fix:**

*   The vendor released a patch for Anki in version 24.04 on June 24, 2024.  Users are advised to update to the patched version.

**Additional Details:**

*   **CVSSv3 Score:** 9.6 (CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H) - indicating a critical severity.
*   The exploit leverages MPV's configuration file loading mechanism to execute arbitrary Lua scripts.
*   The `[sound:--include=extra.conf]` tag is used to inject the malicious configuration file.
*   The `extra.conf` file contains instructions to load and execute the `run.lua` script.
*   The `idle=yes` parameter in `extra.conf` prevents MPV from closing immediately, allowing the script to complete execution.
*   Discovered by Autumn Bee Skerritt of Cisco Duo Security and Jacob B.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | Base | Allowed-with-Review | sparse | 0.076 |
| 2 | 129 | Improper Validation of Array Index | Variant | Allowed | sparse | 0.074 |
| 3 | 1287 | Improper Validation of Specified Type of Input | Base | Allowed | sparse | 0.073 |
| 4 | 190 | Integer Overflow or Wraparound | Base | Allowed | sparse | 0.073 |
| 5 | 80 | Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS) | Variant | Allowed | sparse | 0.072 |
| 6 | 134 | Use of Externally-Controlled Format String | Base | Allowed | sparse | 0.071 |
| 7 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | sparse | 0.070 |
| 8 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.070 |
| 9 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | dense | 0.502 |
| 10 | 843 | Access of Resource Using Incompatible Type ('Type Confusion') | Base | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')

CWE-129: Improper Validation of Array Index

CWE-1287: Improper Validation of Specified Type of Input

CWE-190: Integer Overflow or Wraparound

CWE-80: Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS)

CWE-134: Use of Externally-Controlled Format String

CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')

CWE-502: Deserialization of Untrusted Data

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-843: Access of Resource Using Incompatible Type ('Type Confusion')