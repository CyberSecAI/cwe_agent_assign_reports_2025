# Vulnerability Information: CVE-2024-8757

## Vulnerability Description
The WP Post Author - Boost Your Blog&#039s Engagement with Author Box, Social Links, Co-Authors, Guest Authors, Post Rating System, and Custom User Registration Form Builder plugin for WordPress is vulnerable to time-based SQL Injection via the linked_user_id parameter in all versions up to, and including, 3.8.1 due to **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**. This makes it possible for authenticated attackers, with Administrator-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

### Vulnerability Description Key Phrases
- **rootcause:** **insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query**
- **weakness:** **time-based SQL injection**
- **impact:** extract sensitive information from the database and information disclosure
- **attacker:** authenticated attackers with Administrator-level access
- **product:** WP Post Author - Boost Your Blog's Engagement with Author Box
- **version:** up to and including 3.8.1
- **component:** linked_user_id parameter

## CVE Reference Links Content Summary
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

*   The vulnerability is a time-based SQL injection flaw caused by insufficient sanitization of the `linked_user_id` parameter within the `awpa_is_guest_linked_with_author` function of the WP Post Author plugin. The plugin does not properly escape user-supplied input before using it in a SQL query.
*   Specifically, the code in `wpa-multi-authors.php` on line 182 directly includes the unescaped user-provided `$user_id` variable within a `prepare()` method for a database query. Although prepare is used, the user supplied variable is not used as a parameter.

**Weaknesses/Vulnerabilities:**

*   **SQL Injection:** The primary vulnerability is SQL injection, allowing an attacker to manipulate SQL queries.
*   **Lack of Parameterization:** The SQL query, while using `$wpdb->prepare`, does not use it correctly. The vulnerable code uses the `%d` format specifier, but does not pass the user supplied value as a parameter. This results in the user-supplied value being directly injected into the SQL query.
*   **Insufficient Input Sanitization:** The plugin fails to properly sanitize and escape the `linked_user_id` parameter before using it in a SQL query.

**Impact of Exploitation:**

*   **Data Extraction:** Attackers can use the SQL injection vulnerability to extract sensitive information from the WordPress database.
*   **Potential for other attacks:**  While the provided information doesn't explicitly detail further exploitation, SQL injection can potentially lead to other attacks, including but not limited to data modification and even complete system compromise, depending on database user permissions

**Attack Vectors:**

*   **Network:** The attack is carried out over the network.
*   **HTTP Request:** The vulnerability is triggered by sending a malicious HTTP request that includes a crafted `linked_user_id` parameter.

**Required Attacker Capabilities/Position:**

*   **Authentication:** The attacker needs to be authenticated as an administrator or a user with higher privileges to exploit this vulnerability.
*   **Knowledge of SQL:** The attacker must have knowledge of SQL syntax to craft malicious payloads.

**Additional Notes:**

*   The vulnerability is present in all versions of the WP Post Author plugin up to and including 3.8.1.
*   The vulnerability was fixed in version 3.8.2.
*   The Wordfence article provides a CVSS score of 7.2 (High) for this vulnerability.
*   The vulnerable code can be found in the `wpa-multi-authors.php` file on line 182.
*   The identified vulnerable function is `awpa_is_guest_linked_with_author()`.
* The fix for the vulnerability can be seen in the provided changeset, specifically the use of $wpdb->prepare correctly with parameters.

**Summary of Vulnerable Code:**

The vulnerable code resides within the `awpa_is_guest_linked_with_author` function. Specifically, the line constructing the SQL query is vulnerable. Instead of properly using the prepare method with parameters, it directly inserts a user-controlled value:

```php
$query = $wpdb->prepare(
    "SELECT * FROM $table_name WHERE linked_user_id = %d",
    $user_id // Vulnerable due to incorrect usage of prepare.
);

```

**Corrected Code:**

The corrected code in the changeset shows the proper usage of $wpdb->prepare with a placeholder and parameter:
```php
$query = $wpdb->prepare(
	"SELECT * FROM $table_name WHERE linked_user_id = %d",
	$user_id
);
```

This effectively escapes the user provided input, preventing the injection vulnerability.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 352 | Cross-Site Request Forgery (CSRF) | Compound | Allowed | sparse | 0.595 |
| 3 | 116 | Improper Encoding or Escaping of Output | Class | Allowed-with-Review | sparse | 0.594 |
| 4 | 862 | Missing Authorization | Class | Allowed-with-Review | sparse | 0.568 |
| 5 | 863 | Incorrect Authorization | Class | Allowed-with-Review | sparse | 0.568 |
| 6 | 90 | Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection') | Base | Allowed | sparse | 0.565 |
| 7 | 790 | Improper Filtering of Special Elements | Class | Allowed-with-Review | sparse | 0.555 |
| 8 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.543 |
| 9 | 96 | Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection') | Base | Allowed | dense | 0.509 |
| 10 | 471 | Modification of Assumed-Immutable Data (MAID) | Base | Allowed | graph | 0.003 |

