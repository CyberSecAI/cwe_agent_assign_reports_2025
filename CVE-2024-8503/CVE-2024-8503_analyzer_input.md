# Vulnerability Information: CVE-2024-8503

## Vulnerability Description
An unauthenticated attacker can leverage a **time-based SQL injection** vulnerability in VICIdial to enumerate database records. By default, VICIdial stores plaintext credentials within the database.

### Vulnerability Description Key Phrases
- **weakness:** **time-based SQL injection**
- **impact:** enumerate database records
- **attacker:** unauthenticated attacker
- **product:** VICIdial

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the vulnerability:

**Root Cause:**

*   The vulnerability stems from inconsistent input sanitization in VICIdial. While most PHP scripts sanitize user-controlled input using `preg_replace` to prevent SQL injection, the `VERM_AJAX_functions.php` script fails to sanitize the username taken from the `Authorization` header before using it in an SQL query.

**Weaknesses/Vulnerabilities:**

*   **Unauthenticated SQL Injection:** The `VERM_AJAX_functions.php` script is accessible without authentication and directly uses the unsanitized username from the `Authorization` header in an SQL INSERT statement. This lack of sanitization enables SQL injection.
*   **Time-Based SQL Injection:** Although the response from the vulnerable script cannot be manipulated directly, the attacker can observe delays using SQL functions like `sleep()`, allowing for time-based SQL injection to enumerate database records.
*   **Inconsistent Sanitization:**  The lack of a shared PHP file for sanitization leads to inconsistent implementation of `preg_replace` across different scripts, creating opportunities for exploitation.

**Impact of Exploitation:**

*   **Database Enumeration:** An attacker can use the time-based SQL injection to enumerate database records, including potentially sensitive information.
*   **Plaintext Credential Exposure:** VICIdial stores plaintext credentials in the database by default, which could be extracted via this vulnerability. This would allow complete access to the system.

**Attack Vectors:**

*   **HTTP Request Manipulation:** The attacker crafts a malicious `Authorization` header with a username containing SQL injection payloads.
*   **Unauthenticated Access:** The `VERM_AJAX_functions.php` script does not require authentication to be accessed.
*   **Time-Based Inference:**  The attacker leverages the delay caused by the `sleep()` function to infer the results of their injected SQL queries.

**Required Attacker Capabilities/Position:**

*   **Network Access:** The attacker needs to be able to send HTTP requests to the vulnerable VICIdial server.
*   **Basic HTTP Knowledge:** The attacker needs to know how to modify the `Authorization` header.
*   **No Prior Authentication:** No authentication is required for the initial attack.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 89 | Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection') | Base | Allowed | alternate_terms | 0.800 |
| 2 | 312 | Cleartext Storage of Sensitive Information | Base | Allowed | sparse | 0.173 |
| 3 | 916 | Use of Password Hash With Insufficient Computational Effort | Base | Allowed | sparse | 0.165 |
| 4 | 522 | Insufficiently Protected Credentials | Class | Allowed-with-Review | sparse | 0.159 |
| 5 | 502 | Deserialization of Untrusted Data | Base | Allowed | sparse | 0.158 |
| 6 | 209 | Generation of Error Message Containing Sensitive Information | Base | Allowed | sparse | 0.152 |
| 7 | 943 | Improper Neutralization of Special Elements in Data Query Logic | Class | Allowed-with-Review | sparse | 0.151 |
| 8 | 204 | Observable Response Discrepancy | Base | Allowed | sparse | 0.149 |
| 9 | 564 | SQL Injection: Hibernate | Variant | Allowed | dense | 0.516 |
| 10 | 523 | Unprotected Transport of Credentials | Base | Allowed | graph | 0.002 |

