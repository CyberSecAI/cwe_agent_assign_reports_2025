# Vulnerability Information: CVE-2024-50034

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved net/smc fix lacks of icsk_syn_mss with IPPROTO_SMC Eric report a panic on IPPROTO_SMC, and give the facts that when INET_PROTOSW_ICSK was set, icsk->icsk_sync_mss must be set too. Bug Unable to handle **kernel NULL pointer dereference** at virtual address 0000000000000000 Mem abort info ESR = 0x0000000086000005 EC = 0x21 IABT (current EL), IL = 32 bits SET = 0, FnV = 0 EA = 0, S1PTW = 0 FSC = 0x05 level 1 translation fault user pgtable 4k pages, 48-bit VAs, pgdp=00000001195d1000 [0000000000000000] pgd=0800000109c46003, p4d=0800000109c46003, pud=0000000000000000 Internal error Oops 0000000086000005 [#1] PREEMPT SMP Modules linked in CPU 1 UID 0 PID 8037 Comm syz.3.265 Not tainted 6.11.0-rc7-syzkaller-g5f5673607153 #0 Hardware name Google Google Compute Engine/Google Compute Engine, BIOS Google 08/06/2024 pstate 80400005 (Nzcv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--) pc 0x0 lr cipso_v4_sock_setattr+0x2a8/0x3c0 net/ipv4/cipso_ipv4.c1910 sp ffff80009b887a90 x29 ffff80009b887aa0 x28 ffff80008db94050 x27 0000000000000000 x26 1fffe0001aa6f5b3 x25 dfff800000000000 x24 ffff0000db75da00 x23 0000000000000000 x22 ffff0000d8b78518 x21 0000000000000000 x20 ffff0000d537ad80 x19 ffff0000d8b78000 x18 1fffe000366d79ee x17 ffff8000800614a8 x16 ffff800080569b84 x15 0000000000000001 x14 000000008b336894 x13 00000000cd96feaa x12 0000000000000003 x11 0000000000040000 x10 00000000000020a3 x9

### Vulnerability Description Key Phrases
- **rootcause:** **kernel NULL pointer dereference**
- **impact:** Oops and panic
- **product:** Linux kernel
- **component:** net/smc fix

## CVE Reference Links Content Summary
Based on the provided information, this content relates to CVE-2024-50034.

**Root cause of vulnerability:**
The root cause is a missing initialization of `icsk->icsk_sync_mss` for IPPROTO_SMC sockets. When `INET_PROTOSW_ICSK` is set, `icsk->icsk_sync_mss` must also be set to a valid function pointer. This function is called during the socket creation to synchronize the Maximum Segment Size (MSS). The lack of initialization resulted in a NULL pointer dereference during socket creation.

**Weaknesses/vulnerabilities present:**
- **NULL Pointer Dereference:** The primary vulnerability is a null pointer dereference when the kernel attempts to call `icsk->icsk_sync_mss` which was not initialized.

**Impact of exploitation:**
- **Kernel Panic:** The vulnerability leads to a kernel panic, resulting in a denial-of-service (DoS). The system crashes and becomes unavailable.

**Attack vectors:**
- **Socket Creation:** The vulnerability is triggered during the creation of an IPPROTO_SMC socket.
- An attacker could trigger this vulnerability by creating a socket using IPPROTO_SMC and triggering a code path which calls the uninitialized `icsk->icsk_sync_mss`.

**Required attacker capabilities/position:**
- The attacker must be able to create sockets, which typically requires local access or the ability to trigger socket creation via a network service or application.

**Additional Details:**
- The patch introduces a toy implementation of `smc_sync_mss` to prevent the panic. This function simply returns 0, indicating that MSS synchronization for IPPROTO_SMC isn't fully supported yet.
- The patch notes that MSS can be set via `sock_create_kern` or `smc_setsockopt`, however synchronization within `__sys_connect_file` is missing and this patch provides a foundation for this in the future.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 476 | NULL Pointer Dereference | Base | Allowed | sparse | 0.453 |
| 2 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.429 |
| 3 | 822 | Untrusted Pointer Dereference | Base | Allowed | sparse | 0.420 |
| 4 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.404 |
| 5 | 665 | Improper Initialization | Class | Discouraged | sparse | 0.401 |
| 6 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | sparse | 0.397 |
| 7 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.393 |
| 8 | 252 | Unchecked Return Value | Base | Allowed | sparse | 0.390 |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | dense | 0.612 |
| 10 | 128 | Wrap-around Error | Base | Allowed | graph | 0.003 |

