# Vulnerability Information: CVE-2024-49939

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved wifi rtw89 avoid to add interface to list twice when SER If SER L2 occurs during the WoWLAN resume flow, the add interface flow is triggered by ieee80211_reconfig(). However, due to **rtw89_wow_resume() return failure**, it will cause the add interface flow to be executed again, resulting in a double add list and causing a kernel panic. Therefore, we have added a check to prevent double adding of the list. list_add double add new=ffff99d6992e2010, prev=ffff99d6992e2010, next=ffff99d695302628. ------------[ cut here ]------------ kernel BUG at lib/list_debug.c37! invalid opcode 0000

### Vulnerability Description Key Phrases
- **rootcause:** **rtw89_wow_resume() return failure**
- **impact:** kernel BUG and kernel panic
- **vector:** SER L2 occurs during the WoWLAN resume flow
- **product:** Linux kernel
- **component:** wifi rtw89

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-49939.

**Root cause of vulnerability:**
The vulnerability occurs due to a double addition of an interface to a list in the `rtw89` WiFi driver during a specific scenario involving System Error Recovery (SER) Level 2 during WoWLAN (Wake-on-Wireless LAN) resume.

**Weaknesses/vulnerabilities present:**
The core issue is the lack of proper checks before adding a network interface (`rtwvif`) to the list of interfaces (`rtwdev->rtwvifs_list`). Specifically, when a SER L2 event occurs during a WoWLAN resume, the `ieee80211_reconfig()` function can be triggered multiple times. Because `rtw89_wow_resume()` may return failure, the interface add flow can execute repeatedly. This results in adding the same interface multiple times, leading to a kernel panic because the `list_add` operation detects an existing entry.

**Impact of exploitation:**
The impact of this vulnerability is a kernel panic, causing a denial of service. The double addition to a linked list corrupts the list structure, leading to a system crash.

**Attack vectors:**
The attack vector involves triggering a specific sequence of events during WoWLAN resume, specifically causing a SER L2 event.

**Required attacker capabilities/position:**
An attacker would need to be in a position to influence the system behavior to trigger a SER L2 event during the WoWLAN resume flow. This likely requires some level of control over the wireless environment or the device's power management.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 415 | Double Free | Variant | Allowed | sparse | 0.471 |
| 2 | 617 | Reachable Assertion | Base | Allowed | sparse | 0.433 |
| 3 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.424 |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.418 |
| 5 | 667 | Improper Locking | Class | Allowed-with-Review | sparse | 0.414 |
| 6 | 610 | Externally Controlled Reference to a Resource in Another Sphere | Class | Discouraged | sparse | 0.406 |
| 7 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.398 |
| 8 | 833 | Deadlock | Base | Allowed | sparse | 0.397 |
| 9 | 606 | Unchecked Input for Loop Condition | Base | Allowed | dense | 0.470 |
| 10 | 364 | Signal Handler Race Condition | Base | Allowed | graph | 0.003 |

