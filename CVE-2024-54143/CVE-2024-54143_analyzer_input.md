# Vulnerability Information: CVE-2024-54143

## Vulnerability Description
openwrt/asu is an image on demand server for OpenWrt based distributions. The **request hashing mechanism truncates SHA-256 hashes** to only 12 characters. This significantly reduces entropy, making it feasible for an attacker to generate collisions. By exploiting this, a previously built malicious image can be served in place of a legitimate one, allowing the attacker to poison the artifact cache and deliver compromised images to unsuspecting users. This can be combined with other attacks, such as a **command injection** in Imagebuilder that allows malicious users to inject arbitrary commands into the build process, resulting in the production of malicious firmware images signed with the legitimate build key. This has been patched with 920c8a1.

### Vulnerability Description Key Phrases
- **rootcause:** **request hashing mechanism truncates SHA-256 hashes**
- **weakness:** **command injection**
- **impact:** deliver compromised images to unsuspecting users
- **attacker:** attacker
- **product:** openwrt/asu

## CVE Reference Links Content Summary
The provided content relates to CVE-2024-54143.

**Root Cause of Vulnerability:**
The vulnerability stems from two main issues: command injection in the `openwrt/imagebuilder` and the use of a truncated SHA-256 hash in the build request.

**Weaknesses/Vulnerabilities Present:**
1.  **Command Injection:** User-supplied package names were incorporated into `make` commands without proper sanitization, allowing injection of arbitrary commands.
2.  **Insufficient Hash Length:** The SHA-256 hash of the build request was truncated to 12 characters, significantly reducing entropy and making collision generation feasible.

**Impact of Exploitation:**
An attacker can poison the build artifact cache by generating a collision, serving a malicious firmware image instead of a legitimate one. This can lead to compromised firmware being installed on devices using the ASU service, which affects the integrity of the delivered builds.

**Attack Vectors:**
An attacker can manipulate the package list to inject commands and generate a hash collision.

**Required Attacker Capabilities/Position:**
The attacker needs to be able to make build requests to the ASU service and manipulate the package list in a way that leads to a hash collision and command injection.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 77 | Improper Neutralization of Special Elements used in a Command ('Command Injection') | Class | Allowed-with-Review | alternate_terms | 1.000 |
| 2 | 78 | Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection') | Base | Allowed | alternate_terms | 0.700 |
| 3 | 328 | Use of Weak Hash | Base | Allowed | sparse | 0.687 |
| 4 | 916 | Use of Password Hash With Insufficient Computational Effort | Base | Allowed | sparse | 0.673 |
| 5 | 345 | Insufficient Verification of Data Authenticity | Class | Discouraged | sparse | 0.642 |
| 6 | 347 | Improper Verification of Cryptographic Signature | Base | Allowed | sparse | 0.625 |
| 7 | 327 | Use of a Broken or Risky Cryptographic Algorithm | Class | Allowed-with-Review | sparse | 0.625 |
| 8 | 79 | Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') | Base | Allowed | sparse | 0.624 |
| 9 | 760 | Use of a One-Way Hash with a Predictable Salt | Variant | Allowed | dense | 0.442 |
| 10 | 184 | Incomplete List of Disallowed Inputs | Base | Allowed | graph | 0.002 |

