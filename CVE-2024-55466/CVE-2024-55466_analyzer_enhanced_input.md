## Vulnerability Description
An **arbitrary file upload vulnerability** in the Image Gallery of ThingsBoard Community, ThingsBoard Cloud and ThingsBoard Professional v3.8.1 allows attackers to execute arbitrary code via uploading a crafted file.

### Vulnerability Description Key Phrases
- **component:** Image Gallery
- **vector:** uploading a crafted file
- **weakness:** **arbitrary file upload vulnerability**
- **product:** ThingsBoard Community, ThingsBoard Cloud, ThingsBoard Professional
- **impact:** execute arbitrary code, remote code execution
- **attacker:** attackers
- **version:** v3.8.1

## CVE Reference Links Content Summary
```json
{
  "CVE": "CVE-2024-55466",
  "content_analysis": [
    {
      "content": "While tinkering with IoT technology, I found vulnerability in the Thingsboard Application that allowed avenues for privilege escalation.",
      "related": true,
      "extracted_information": {
        "vulnerability": "Stored Cross-Site Scripting",
        "impact": "Privilege Escalation",
        "affected_versions": "3.8.1 or earlier",
        "affected_software": "Thingsboard",
        "attack_vector": "Crafting a malicious image file (SVG file with JavaScript Payload)",
        "attack_capabilities": "Low privileged user access to the image gallery."
      }
    },
    {
      "content": "While exploring its features, I noticed a file upload functionality in the \"Image Gallery\" view. Unfortunately, the feature was vulnerable to stored cross-site scripting which allowed an adversary to escalate privileges by leveraging authentication token theft.",
      "related": true,
      "extracted_information": {
        "vulnerability": "Stored cross-site scripting",
        "impact": "Privilege escalation by leveraging authentication token theft.",
        "attack_vector": "File upload functionality in the \"Image Gallery\" view."
      }
    },
    {
      "content": "This vulnerability impacts all Thingsboard releases, including Community, Cloud, and Professional editions. I responsibly reported the issue to the Thingsboard security team, who acknowledged it and committed to addressed it in a future release. Subsequently, I reported the vulnerability to MITRE, resulting in the assignment of a CVE.",
      "related": true,
      "extracted_information": {
        "affected_software": "Community, Cloud, and Professional editions",
        "mitigation": "Addressed in a future release",
        "cve_reporting": "Reported to MITRE, resulting in the assignment of a CVE."
      }
    },
    {
      "content": "* Bug: Stored Cross-Site Scripting\n* Severity: **CRITICAL**\n* OWASP Vulnerability Category: [A03 Injection](https://owasp.org/Top10/A03_2021-Injection/)\n* CVSS 4.0 Score: 8.8 `CVSS:4.0/AV:N/AC:L/AT:P/PR:L/UI:A/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H`\n* Affected Software Releases: Community Edition, Professional Edition, Cloud\n* Affected Versions: 3.8.1 or earlier\n* Vendor Details: Thingsboard (<https://github.com/thingsboard/thingsboard>)",
      "related": true,
      "extracted_information": {
        "vulnerability": "Stored Cross-Site Scripting",
        "severity": "CRITICAL",
        "owasp_category": "A03 Injection",
        "cvss_score": "8.8",
        "affected_software": "Community Edition, Professional Edition, Cloud",
        "affected_versions": "3.8.1 or earlier",
        "vendor": "Thingsboard"
      }
    },
    {
      "content": "* **Step 1:** Log into a low privileged customer account.\n* **Step 2:** Navigate to `Resources > Image Gallery`\n* **Step 3:** Craft a malicious image file (*here, a SVG file is used with JavaScript Payload*) to exploit the Cross Site Scripting vulnerability.\n* **Step 4:** Upload the file and inspect the response to identify the destination file path where the payload was uploaded.\n* **Step 5:** Visit the `publicLink` file path to trigger the payload.",
      "related": true,
      "extracted_information": {
        "attack_vector": "Upload a malicious image file (SVG with Javascript Payload)",
        "steps_to_reproduce": "1. Log into low privileged account. 2. Navigate to image gallery. 3. Craft a malicious image file. 4. Upload the file and inspect the response. 5. Visit the file path to trigger the payload."
      }
    },
    {
      "content": "* **Step 1:** Log into a high value account (*here Tenant administrator account is used in chrome browser, to demonstrate isolated enviroment from the firefox browser used above*).\n* **Step 2:** Visit the `publicLink` file path, retrieved earlier.",
      "related": true,
      "extracted_information": {
        "impact": "Account takeover",
        "steps_to_reproduce": "1. Log into a high value account. 2. Visit the public link file path."
      }
    }
  ]
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 434 | Unrestricted Upload of File with Dangerous Type | Base | Allowed | sparse | 0.183 |
| 2 | 95 | Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') | Variant | Allowed | sparse | 0.168 |
| 3 | 94 | Improper Control of Generation of Code ('Code Injection') | Base | Allowed-with-Review | sparse | 0.158 |
| 4 | 23 | Relative Path Traversal | Base | Allowed | sparse | 0.157 |
| 5 | 306 | Missing Authentication for Critical Function | Base | Allowed | sparse | 0.157 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.146 |
| 7 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.145 |
| 8 | 20 | Improper Input Validation | Class | Discouraged | sparse | 0.144 |
| 9 | 646 | Reliance on File Name or Extension of Externally-Supplied File | Variant | Allowed | dense | 0.599 |
| 10 | 473 | PHP External Variable Modification | Variant | Allowed | graph | 0.002 |



# Complete CWE Specifications

CWE-434: Unrestricted Upload of File with Dangerous Type

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

CWE-94: Improper Control of Generation of Code ('Code Injection')

CWE-23: Relative Path Traversal

CWE-306: Missing Authentication for Critical Function

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-787: Out-of-bounds Write

CWE-20: Improper Input Validation

CWE-646: Reliance on File Name or Extension of Externally-Supplied File

CWE-473: PHP External Variable Modification