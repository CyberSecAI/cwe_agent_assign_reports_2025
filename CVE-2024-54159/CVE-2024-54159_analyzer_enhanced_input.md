## Vulnerability Description
stalld through 1.19.7 allows local users to cause a denial of service (file overwrite) via a /tmp/rtthrottle symlink attack.

### Vulnerability Description Key Phrases
- **impact:** denial of service
- **vector:** /tmp/rtthrottle symlink attack
- **attacker:** local users
- **product:** stalld
- **version:** through 1.19.7

## CVE Reference Links Content Summary
Based on the provided content, here's an analysis of the identified vulnerabilities in stalld:

**1. Fixed Temporary File Path Vulnerability**

*   **Root Cause:** The `throttlectl.sh` script uses a fixed path `/tmp/rtthrottle` to store temporary data related to real-time scheduling parameters.
*   **Weaknesses/Vulnerabilities:**
    *   **Symlink Attack:** If the kernel's `protected_symlinks` setting is not in effect, an attacker can create a symlink at `/tmp/rtthrottle` to redirect writes to an arbitrary file.
    *   **File Pre-Creation Attack:** An attacker can pre-create the `/tmp/rtthrottle` directory and its contents, and the script will overwrite them, because it does not use the O_CREAT flag. This allows for controlled values to be written to `/proc/sys/kernel/sched_rt_*` when the script restores values.
*   **Impact:**
    *   Local Denial of Service (DoS) by overwriting critical system files through a symlink attack.
    *   Local Denial of Service or local integrity violation by manipulating values in `/proc/sys/kernel/sched_rt_*` via file pre-creation.
*   **Attack Vector:** Local unprivileged user.
*   **Required Attacker Capabilities:** Ability to create files and symlinks in `/tmp`.

**2.  `fill_process_comm()` Function Vulnerability**

*   **Root Cause:** The `fill_process_comm()` function reads process names from `/proc/<pid>/comm`, which can contain arbitrary data, including control characters.
*   **Weaknesses/Vulnerabilities:** The function does not sanitize the data read from `/proc/<pid>/comm`.
*   **Impact:** Log spoofing by injecting carriage return or terminal control sequences into logs.
*   **Attack Vector:** Local unprivileged user.
*   **Required Attacker Capabilities:** Ability to control the process name of an executable.

**3. Experimental FIFO Boosting Feature Vulnerability**

*   **Root Cause:** The `--force_fifo` option allows boosting tasks to `SCHED_FIFO`, which can potentially lock up the system if a rogue task is boosted and never yields the CPU.
*  **Weaknesses/Vulnerabilities:** The system does not have a mechanism to prevent the boosted tasks from locking the system.
*   **Impact:** Potential system lockup or denial of service.
*   **Attack Vector:** A rogue task using the `SCHED_FIFO` scheduler.
*   **Required Attacker Capabilities:** Ability to create/control a process using this scheduler.

**4. Race Conditions in `/proc` Access Vulnerability**

*   **Root Cause:** When iterating over processes in `/proc`, race conditions can occur if target processes replace themselves.
*   **Weaknesses/Vulnerabilities:**  Potential for inconsistencies due to process replacement during iteration.
*   **Impact:**  Potential to confuse stalld's process monitoring, although not easily exploitable to cause a "stall".
*   **Attack Vector:** Local unprivileged user
*   **Required Attacker Capabilities:** Ability to replace processes.

**5. `umask()` Setting Vulnerability**

*   **Root Cause:** The `daemonize()` function sets umask using the incorrect value `0x133`, intended to be `0644`.
*   **Weaknesses/Vulnerabilities:**  The mask `0x133` (octal 0463) masks out owner-readable bit, read-write bits for group, and write-execute bits for world, contrary to the intention.
*   **Impact:** Misconfiguration leading to unexpected file permission issues, such as the file owner not having read permissions. Not directly a security issue but a misconfiguration with potential for future problems.
*   **Attack Vector:** None.
*   **Required Attacker Capabilities:** Not applicable, this is an internal coding error.

**CVE Relevance:**

The primary vulnerability described (fixed temporary file use) aligns with the need for a CVE as per the report. The `fill_process_comm` function and the FIFO scheduling issues also represent potential security flaws, but are not explicitly mentioned in the CVE description.

The content provides more detail than a typical CVE description, outlining not only the vulnerability but also potential attack vectors, impact, and suggested fixes.

Therefore, based on the content, only the fixed temporary file usage vulnerability is relevant to CVE-2024-54159 and should be assigned a CVE identifier.

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 59 | Improper Link Resolution Before File Access ('Link Following') | Base | Allowed | sparse | 0.043 |
| 2 | 61 | UNIX Symbolic Link (Symlink) Following | Compound | Allowed | sparse | 0.040 |
| 3 | 379 | Creation of Temporary File in Directory with Insecure Permissions | Base | Allowed | sparse | 0.037 |
| 4 | 732 | Incorrect Permission Assignment for Critical Resource | Class | Allowed-with-Review | sparse | 0.036 |
| 5 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.035 |
| 6 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | Base | Allowed | sparse | 0.034 |
| 7 | 497 | Exposure of Sensitive System Information to an Unauthorized Control Sphere | Base | Allowed | sparse | 0.034 |
| 8 | 770 | Allocation of Resources Without Limits or Throttling | Base | Allowed | sparse | 0.034 |
| 9 | 378 | Creation of Temporary File With Insecure Permissions | Base | Allowed | dense | 0.492 |
| 10 | 363 | Race Condition Enabling Link Following | Base | Allowed | graph | 0.003 |



# Complete CWE Specifications

CWE-59: Improper Link Resolution Before File Access ('Link Following')

CWE-61: UNIX Symbolic Link (Symlink) Following

CWE-379: Creation of Temporary File in Directory with Insecure Permissions

CWE-732: Incorrect Permission Assignment for Critical Resource

CWE-367: Time-of-check Time-of-use (TOCTOU) Race Condition

CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')

CWE-497: Exposure of Sensitive System Information to an Unauthorized Control Sphere

CWE-770: Allocation of Resources Without Limits or Throttling

CWE-378: Creation of Temporary File With Insecure Permissions

CWE-363: Race Condition Enabling Link Following