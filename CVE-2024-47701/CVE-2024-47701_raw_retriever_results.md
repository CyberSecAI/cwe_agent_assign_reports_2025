# Raw Retriever Results for CVE-2024-47701

# Raw Retriever Results for CVE-2024-47701
## Query
In the Linux kernel, the following vulnerability has been resolved ext4 avoid OOB when system.data xattr changes underneath the filesystem When looking up for an entry in an inlined directory, if e_value_offs is changed underneath the filesystem by some change in the block device, it will lead to an out-of-bounds access that KASAN detects as an UAF. EXT4-fs (loop0) mounted filesystem 00000000-0000-0000-0000-000000000000 r/w without journal. Quota mode none. loop0 detected capacity change from 2048 to 2047 ================================================================== BUG KASAN use-after-free in ext4_search_dir+0xf2/0x1c0 fs/ext4/namei.c1500 Read of size 1 at addr ffff88803e91130f by task syz-executor269/5103 CPU 0 UID 0 PID 5103 Comm syz-executor269 Not tainted 6.11.0-rc4-syzkaller #0 Hardware name QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2~bpo12+1 04/01/2014 Call Trace __dump_stack lib/dump_stack.c93 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c119 print_address_description mm/kasan/report.c377 [inline] print_report+0x169/0x550 mm/kasan/report.c488 kasan_report+0x143/0x180 mm/kasan/report.c601 ext4_search_dir+0xf2/0x1c0 fs/ext4/namei.c1500 ext4_find_inline_entry+0x4be/0x5e0 fs/ext4/inline.c1697 __ext4_find_entry+0x2b4/0x1b30 fs/ext4/namei.c1573 ext4_lookup_entry fs/ext4/namei.c1727 [inline] ext4_lookup+0x15f/0x750 fs/ext4/namei.c1795 lookup_one_qstr_excl+0x11f/0x260 fs/namei.c1633 filename_create+0x297/0x540 fs/namei.c3980 do_symlinkat+0xf9/0x3a0 fs/namei.c4587 __do_sys_symlinkat fs/namei.c4610 [inline] __se_sys_symlinkat fs/namei.c4607 [inline] __x64_sys_symlinkat+0x95/0xb0 fs/namei.c4607 do_syscall_x64 arch/x86/entry/common.c52 [inline] do_syscall_64+0xf3/0x230 arch/x86/entry/common.c83 entry_SYSCALL_64_after_hwframe+0x77/0x7f RIP 00330x7f3e73ced469 Code 28 00 00 00 75 05 48 83 c4 28 c3 e8 21 18 00 00 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 3d 01 f0 ff ff 73 01 c3 48 c7 c1 b8 ff ff ff f7 d8 64 89 01 48 RSP 002b00007fff4d40c258 EFLAGS 00000246 ORIG_RAX 000000000000010a RAX ffffffffffffffda RBX 0032656c69662f2e RCX 00007f3e73ced469 RDX 0000000020000200 RSI 00000000ffffff9c RDI 00000000200001c0 RBP 0000000000000000 R08 00007fff4d40c290 R09 00007fff4d40c290 R10 0023706f6f6c2f76 R11 0000000000000246 R12 00007fff4d40c27c R13 0000000000000003 R14 431bde82d7b634db R15 00007fff4d40c2b0 Calling ext4_xattr_ibody_find right after reading the inode with ext4_get_inode_loc will lead to a check of the validity of the xattrs, avoiding this problem.

## Keyphrases
- **rootcause**: 'An out-of-bounds access occurs in ext4_search_dir when e_value_offs is changed underneath the filesystem', 'leading to a use-after-free condition.'
- **weakness**: 'The vulnerability arises from a race condition where the value of e_value_offs in an inlined directory entry can change after it's initially read', 'leading to an out-of-bounds access.'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4946 | 0.5792 | 0.5309 | 0.5398 | 20 |
| Sparse | 238.2970 | 979.9958 | 802.3793 | 834.2850 | 14 |
| Graph | 1.6205 | 2.8652 | 1.9888 | 1.7680 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 609 | Double-Checked Locking | base | 2.8652 | Allowed |
| 2 | 908 | Use of Uninitialized Resource | Base | 2.8218 | Allowed |
| 3 | 386 | Symbolic Name not Mapping to Correct Object | base | 2.3764 | Allowed |
| 4 | 128 | Wrap-around Error | base | 2.2698 | Allowed |
| 5 | 1339 | Insufficient Precision or Accuracy of a Real Number | base | 2.2698 | Allowed |
| 6 | 410 | Insufficient Resource Pool | base | 2.2100 | Allowed |
| 7 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 2.2090 | Allowed |
| 8 | 288 | Authentication Bypass Using an Alternate Path or Channel | base | 2.1190 | Allowed |
| 9 | 456 | Missing Initialization of a Variable | variant | 1.8394 | Allowed |
| 10 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 11 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 12 | 909 | Missing Initialization of Resource | Class | 1.7601 | Allowed-with-Review |
| 13 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 14 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 1.7006 | Allowed |
| 15 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5792 | 0.5792 | Allowed-with-Review |
| 2 | 909 | Missing Initialization of Resource | Class | 0.5642 | 0.5642 | Allowed-with-Review |
| 3 | 667 | Improper Locking | Class | 0.5618 | 0.5618 | Allowed-with-Review |
| 4 | 190 | Integer Overflow or Wraparound | Base | 0.5534 | 0.5534 | Allowed |
| 5 | 908 | Use of Uninitialized Resource | Base | 0.5526 | 0.5526 | Allowed |
| 6 | 191 | Integer Underflow (Wrap or Wraparound) | Base | 0.5515 | 0.5515 | Allowed |
| 7 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.5502 | 0.5502 | Allowed |
| 8 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5475 | 0.5475 | Allowed |
| 9 | 125 | Out-of-bounds Read | Base | 0.5444 | 0.5444 | Allowed |
| 10 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.5426 | 0.5426 | Allowed |
| 11 | 126 | Buffer Over-read | Variant | 0.5369 | 0.5369 | Allowed |
| 12 | 416 | Use After Free | Variant | 0.5235 | 0.5235 | Allowed |
| 13 | 770 | Allocation of Resources Without Limits or Throttling | Base | 0.5099 | 0.5099 | Allowed |
| 14 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | Class | 0.5087 | 0.5087 | Discouraged |
| 15 | 1284 | Improper Validation of Specified Quantity in Input | Base | 0.5046 | 0.5046 | Allowed |

## Sparse Retriever Results (14)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 912 | Hidden Functionality | 979.9958 | 979.9958 | Allowed-with-Review |
| 2 | 288 | Authentication Bypass Using an Alternate Path or Channel | 978.9216 | 978.9216 | Allowed |
| 3 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | 898.3974 | 898.3974 | Allowed |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | 850.7456 | 850.7456 | Allowed-with-Review |
| 5 | 400 | Uncontrolled Resource Consumption | 848.0516 | 848.0516 | Discouraged |
| 6 | 284 | Improper Access Control | 841.3162 | 841.3162 | Discouraged |
| 7 | 22 | Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') | 840.2027 | 840.2027 | Allowed |
| 8 | 294 | Authentication Bypass by Capture-replay | 828.3674 | 828.3674 | Allowed |
| 9 | 1335 | Incorrect Bitwise Shift of Integer | 823.7887 | 823.7887 | Allowed |
| 10 | 119 | Improper Restriction of Operations within the Bounds of a Memory Buffer | 807.3666 | 807.3666 | Discouraged |
| 11 | 416 | Use After Free | 800.0000 | 800.0000 | Allowed |
| 12 | 667 | Improper Locking | 772.4781 | 772.4781 | Allowed-with-Review |
| 13 | 125 | Out-of-bounds Read | 725.3809 | 725.3809 | Allowed |
| 14 | 74 | Improper Neutralization of Special Elements in Output Used by a Downstream Component ('Injection') | 238.2970 | 238.2970 | Discouraged |
