# Vulnerability Information: CVE-2024-45005

## Vulnerability Description
In the Linux kernel, the following vulnerability has been resolved KVM s390 fix validity interception issue when gisa is switched off We might run into a SIE validity if gisa has been disabled either via using kernel parameter kvm.use_gisa=0 or by setting the related sysfs attribute to N (echo N >/sys/module/kvm/parameters/use_gisa). The validity is caused by an invalid value in the SIE control blocks gisa designation. That happens because we pass the uninitialized gisa origin to virt_to_phys() before writing it to the gisa designation. To fix this we return 0 in kvm_s390_get_gisa_desc() if the origin is 0. kvm_s390_get_gisa_desc() is used to determine which gisa designation to set in the SIE control block. A value of 0 in the gisa designation disables gisa usage. The issue surfaces in the host kernel with the following kernel message as soon a new kvm guest start is attemted. kvm unhandled validity intercept 0x1011 WARNING CPU 0 PID 781237 at arch/s390/kvm/intercept.c101 kvm_handle_sie_intercept+0x42e/0x4d0 [kvm] Modules linked in vhost_net tap tun xt_CHECKSUM xt_MASQUERADE xt_conntrack ipt_REJECT xt_tcpudp nft_compat x_tables nf_nat_tftp nf_conntrack_tftp vfio_pci_core irqbypass vhost_vsock vmw_vsock_virtio_transport_common vsock vhost vhost_iotlb kvm nft_fib_inet nft_fib_ipv4 nft_fib_ipv6 nft_fib nft_reject_inet nf_reject_ipv4 nf_reject_ipv6 nft_reject nft_ct nft_chain_nat nf_nat nf_conntrack nf_defrag_ipv6 nf_defrag_ipv4 ip_set nf_tables sunrpc mlx5_ib i

### Vulnerability Description Key Phrases
- **rootcause:** **uninitialized variable**
- **impact:** invalid value in the SIE control blocks gisa designation
- **product:** Linux kernel
- **component:** KVM s390

## CVE Reference Links Content Summary
```
{
  "vulnerability": {
    "root_cause": "The vulnerability arises from passing an uninitialized gisa origin to `virt_to_phys()` before writing it to the gisa designation in the SIE control block. This occurs when gisa is disabled via the kernel parameter `kvm.use_gisa=0` or the sysfs attribute.",
    "weaknesses": [
      "The code fails to handle the case where gisa is disabled, leading to the usage of an uninitialized value for gisa origin.",
      "An invalid value in the SIE control block's gisa designation triggers a validity intercept."
    ],
    "impact": "The impact is a kernel panic triggered by a validity intercept (0x1011), which occurs during the attempt to start a new KVM guest, crashing the host system.",
    "attack_vectors": "The attack vector involves disabling the gisa feature via kernel parameter or sysfs attribute, followed by attempting to start a new KVM guest.",
    "required_capabilities": "The attacker needs the capability to control the kernel parameters or sysfs attributes related to KVM, specifically the `kvm.use_gisa` setting. The attacker would also require the ability to create/start KVM guests. This is usually a privileged user or someone who has root access.",
      "description": "The provided patches fix a validity interception issue in the KVM s390 implementation when the Guest Instruction Set Architecture (GISA) is switched off. This occurs due to the usage of an uninitialized gisa origin when constructing the SIE control block's gisa designation. The fix ensures a zero value is returned when gisa is disabled, preventing the invalid value from being written to the SIE control block. The issue is triggered during a new KVM guest start and results in a host kernel panic."
  }
}
```

## Retriever Results

### Top Combined Results

| Rank | CWE ID | Name | Abstraction | Usage  | Retrievers | Individual Scores |
|------|--------|------|-------------|-------|------------|-------------------|
| 1 | 125 | Out-of-bounds Read | Base | Allowed | sparse | 0.783 |
| 2 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | Allowed | sparse | 0.759 |
| 3 | 226 | Sensitive Information in Resource Not Removed Before Reuse | Base | Allowed | sparse | 0.746 |
| 4 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | Allowed-with-Review | sparse | 0.727 |
| 5 | 1284 | Improper Validation of Specified Quantity in Input | Base | Allowed | sparse | 0.721 |
| 6 | 457 | Use of Uninitialized Variable | Variant | Allowed | sparse | 0.710 |
| 7 | 909 | Missing Initialization of Resource | Class | Allowed-with-Review | sparse | 0.708 |
| 8 | 787 | Out-of-bounds Write | Base | Allowed | sparse | 0.687 |
| 9 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | Allowed | dense | 0.495 |
| 10 | 386 | Symbolic Name not Mapping to Correct Object | Base | Allowed | graph | 0.002 |

