# Raw Retriever Results for CVE-2024-54191

# Raw Retriever Results for CVE-2024-54191
## Query
In the Linux kernel, the following vulnerability has been resolved Bluetooth iso Fix circular lock in iso_conn_big_sync This fixes the circular locking dependency warning below, by reworking iso_sock_recvmsg, to ensure that the socket lock is always released before calling a function that locks hdev. [ 561.670344] ====================================================== [ 561.670346] WARNING possible circular locking dependency detected [ 561.670349] 6.12.0-rc6+ #26 Not tainted [ 561.670351] ------------------------------------------------------ [ 561.670353] iso-tester/3289 is trying to acquire lock [ 561.670355] ffff88811f600078 (&hdev->lock){+.+.}-{33}, at iso_conn_big_sync+0x73/0x260 [bluetooth] [ 561.670405] but task is already holding lock [ 561.670407] ffff88815af58258 (sk_lock-AF_BLUETOOTH){+.+.}-{00}, at iso_sock_recvmsg+0xbf/0x500 [bluetooth] [ 561.670450] which lock already depends on the new lock. [ 561.670452] the existing dependency chain (in reverse order) is [ 561.670453] -> #2 (sk_lock-AF_BLUETOOTH){+.+.}-{00} [ 561.670458] lock_acquire+0x7c/0xc0 [ 561.670463] lock_sock_nested+0x3b/0xf0 [ 561.670467] bt_accept_dequeue+0x1a5/0x4d0 [bluetooth] [ 561.670510] iso_sock_accept+0x271/0x830 [bluetooth] [ 561.670547] do_accept+0x3dd/0x610 [ 561.670550] __sys_accept4+0xd8/0x170 [ 561.670553] __x64_sys_accept+0x74/0xc0 [ 561.670556] x64_sys_call+0x17d6/0x25f0 [ 561.670559] do_syscall_64+0x87/0x150 [ 561.670563] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670567] -> #1 (sk_lock-AF_BLUETOOTH-BTPROTO_ISO){+.+.}-{00} [ 561.670571] lock_acquire+0x7c/0xc0 [ 561.670574] lock_sock_nested+0x3b/0xf0 [ 561.670577] iso_sock_listen+0x2de/0xf30 [bluetooth] [ 561.670617] __sys_listen_socket+0xef/0x130 [ 561.670620] __x64_sys_listen+0xe1/0x190 [ 561.670623] x64_sys_call+0x2517/0x25f0 [ 561.670626] do_syscall_64+0x87/0x150 [ 561.670629] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670632] -> #0 (&hdev->lock){+.+.}-{33} [ 561.670636] __lock_acquire+0x32ad/0x6ab0 [ 561.670639] lock_acquire.part.0+0x118/0x360 [ 561.670642] lock_acquire+0x7c/0xc0 [ 561.670644] __mutex_lock+0x18d/0x12f0 [ 561.670647] mutex_lock_nested+0x1b/0x30 [ 561.670651] iso_conn_big_sync+0x73/0x260 [bluetooth] [ 561.670687] iso_sock_recvmsg+0x3e9/0x500 [bluetooth] [ 561.670722] sock_recvmsg+0x1d5/0x240 [ 561.670725] sock_read_iter+0x27d/0x470 [ 561.670727] vfs_read+0x9a0/0xd30 [ 561.670731] ksys_read+0x1a8/0x250 [ 561.670733] __x64_sys_read+0x72/0xc0 [ 561.670736] x64_sys_call+0x1b12/0x25f0 [ 561.670738] do_syscall_64+0x87/0x150 [ 561.670741] entry_SYSCALL_64_after_hwframe+0x76/0x7e [ 561.670744] other info that might help us debug this [ 561.670745] Chain exists of &hdev->lock --> sk_lock-AF_BLUETOOTH-BTPROTO_ISO --> sk_lock-AF_BLUETOOTH [ 561.670751] Possible unsafe locking scenario [ 561.670753] CPU0 CPU1 [ 561.670754] ---- ---- [ 561.670756] lock(sk_lock-AF_BLUETOOTH) [ 561.670758] lock(sk_lock AF_BLUETOOTH-BTPROTO_ISO) [ 561.670761] lock(sk_lock-AF_BLUETOOTH) [ 561.670764] lock(&hdev->lock) [ 561.670767] *** DEADLOCK ***

## Keyphrases
- **rootcause**: 'circular locking dependency'

## Score Statistics
| Retriever | Min | Max | Mean | Median | Count |
|-----------|-----|-----|------|--------|-------|
| Dense | 0.4705 | 0.5521 | 0.4978 | 0.4897 | 20 |
| Sparse | 822.3172 | 1684.4987 | 1282.1712 | 1390.0312 | 10 |
| Graph | 1.3010 | 4.3290 | 2.0232 | 1.6848 | 20 |

## Graph Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Mapping Usage |
|---|--------|------|-------------|-------|---------------|
| 1 | 561 | Dead Code | base | 4.3290 | Allowed |
| 2 | 571 | Expression is Always True | base | 4.3290 | Allowed |
| 3 | 570 | Expression is Always False | base | 4.3290 | Allowed |
| 4 | 129 | Improper Validation of Array Index | variant | 1.8394 | Allowed |
| 5 | 120 | Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') | base | 1.7680 | Allowed-with-Review |
| 6 | 123 | Write-what-where Condition | base | 1.7680 | Allowed |
| 7 | 364 | Signal Handler Race Condition | base | 1.7550 | Allowed |
| 8 | 833 | Deadlock | Base | 1.7177 | Allowed |
| 9 | 413 | Improper Resource Locking | Base | 1.7105 | Allowed |
| 10 | 1265 | Unintended Reentrant Invocation of Non-reentrant Code Via Nested Calls | base | 1.6848 | Allowed |
| 11 | 1325 | Improperly Controlled Sequential Memory Allocation | base | 1.6848 | Allowed |
| 12 | 386 | Symbolic Name not Mapping to Correct Object | base | 1.6744 | Allowed |
| 13 | 662 | Improper Synchronization | class | 1.6736 | Discouraged |
| 14 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 1.6171 | Allowed |
| 15 | 61 | UNIX Symbolic Link (Symlink) Following | compound | 1.6100 | Allowed |

## Dense Retriever Results (20)
| # | CWE ID | Name | Abstraction | Score | Original Score | Mapping Usage |
|---|--------|------|-------------|-------|----------------|---------------|
| 1 | 833 | Deadlock | Base | 0.5521 | 0.5521 | Allowed |
| 2 | 667 | Improper Locking | Class | 0.5509 | 0.5509 | Allowed-with-Review |
| 3 | 362 | Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition') | Class | 0.5416 | 0.5416 | Allowed-with-Review |
| 4 | 413 | Improper Resource Locking | Base | 0.5251 | 0.5251 | Allowed |
| 5 | 1285 | Improper Validation of Specified Index, Position, or Offset in Input | Base | 0.5046 | 0.5046 | Allowed |
| 6 | 401 | Missing Release of Memory after Effective Lifetime | Variant | 0.5031 | 0.5031 | Allowed |
| 7 | 909 | Missing Initialization of Resource | Class | 0.5002 | 0.5002 | Allowed-with-Review |
| 8 | 835 | Loop with Unreachable Exit Condition ('Infinite Loop') | Base | 0.4923 | 0.4923 | Allowed |
| 9 | 908 | Use of Uninitialized Resource | Base | 0.4920 | 0.4920 | Allowed |
| 10 | 820 | Missing Synchronization | Base | 0.4899 | 0.4899 | Allowed |
| 11 | 367 | Time-of-check Time-of-use (TOCTOU) Race Condition | Base | 0.4896 | 0.4896 | Allowed |
| 12 | 277 | Insecure Inherited Permissions | Variant | 0.4881 | 0.4881 | Allowed |
| 13 | 366 | Race Condition within a Thread | Base | 0.4867 | 0.4867 | Allowed |
| 14 | 131 | Incorrect Calculation of Buffer Size | Base | 0.4858 | 0.4858 | Allowed |
| 15 | 126 | Buffer Over-read | Variant | 0.4822 | 0.4822 | Allowed |

## Sparse Retriever Results (10)
| # | CWE ID | Name | Score | Original Score | Mapping Usage |
|---|--------|------|-------|---------------|---------------|
| 1 | 561 | Dead Code | 1684.4987 | 1684.4987 | Allowed |
| 2 | 570 | Expression is Always False | 1453.7472 | 1453.7472 | Allowed |
| 3 | 571 | Expression is Always True | 1453.7472 | 1453.7472 | Allowed |
| 4 | 1164 | Irrelevant Code | 1422.1801 | 1422.1801 | Allowed-with-Review |
| 5 | 705 | Incorrect Control Flow Scoping | 1408.2391 | 1408.2391 | Allowed-with-Review |
| 6 | 393 | Return of Wrong Status Code | 1371.8232 | 1371.8232 | Allowed |
| 7 | 300 | Channel Accessible by Non-Endpoint | 1245.4078 | 1245.4078 | Discouraged |
| 8 | 691 | Insufficient Control Flow Management | 1121.3962 | 1121.3962 | Discouraged |
| 9 | 923 | Improper Restriction of Communication Channel to Intended Endpoints | 838.3554 | 838.3554 | Allowed-with-Review |
| 10 | 295 | Improper Certificate Validation | 822.3172 | 822.3172 | Allowed |
